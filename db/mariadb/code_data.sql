INSERT INTO code_action (actionid, action) VALUES (0, '');
INSERT INTO code_action (actionid, action) VALUES (1, 'cycle started');
INSERT INTO code_action (actionid, action) VALUES (2, 'cycle finished');
INSERT INTO code_action (actionid, action) VALUES (3, 'program started');
INSERT INTO code_action (actionid, action) VALUES (4, 'program finished');
INSERT INTO code_action (actionid, action) VALUES (5, 'query started');
INSERT INTO code_action (actionid, action) VALUES (6, 'query finished');

INSERT INTO code_layer (layerid, layer) VALUES (0, '');
INSERT INTO code_layer (layerid, layer) VALUES (1, 'cfg');
INSERT INTO code_layer (layerid, layer) VALUES (2, 'code');
INSERT INTO code_layer (layerid, layer) VALUES (3, 'ref');
INSERT INTO code_layer (layerid, layer) VALUES (4, 'raw');
INSERT INTO code_layer (layerid, layer) VALUES (5, 'src');
INSERT INTO code_layer (layerid, layer) VALUES (6, 'info');
INSERT INTO code_layer (layerid, layer) VALUES (7, 'nnml');
INSERT INTO code_layer (layerid, layer) VALUES (8, 'main');
INSERT INTO code_layer (layerid, layer) VALUES (9, 'hist');
INSERT INTO code_layer (layerid, layer) VALUES (10, 'log');
INSERT INTO code_layer (layerid, layer) VALUES (11, 'tmp');
INSERT INTO code_layer (layerid, layer) VALUES (12, 'zbx');
INSERT INTO code_layer (layerid, layer) VALUES (13, 'pre');
INSERT INTO code_layer (layerid, layer) VALUES (14, 'post');
INSERT INTO code_layer (layerid, layer) VALUES (15, 'shot');

INSERT INTO code_program (programid, program, enabled, layerid) VALUES (0, '', 0, 0);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (401, 'raw_mac', 1, 4);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (601, 'info_mac',1, 6);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (402, 'raw_netbox', 1, 4);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (602, 'info_netbox', 1, 6);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (301, 'ref_netbox', 1, 3);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (403, 'raw_scan', 1, 4);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (404, 'raw_map', 1, 4);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (405, 'raw_enplug', 1, 4);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (406, 'raw_activaire', 1, 4);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (407, 'raw_snmp', 1, 4);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (408, 'raw_mist', 1, 4);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (409, 'raw_ruckussz', 1, 4);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (501, 'src_enplug', 1, 5);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (502, 'src_activaire', 1, 5);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (503, 'src_scan', 1, 5);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (504, 'src_snmp', 1, 5);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (505, 'src_mist', 1, 5);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (506, 'src_ruckussz', 1, 5);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (507, 'src_addr', 1, 5);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (701, 'nnml_prepare', 1, 7);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (702, 'nnml_label', 1, 7);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (703, 'nnml_train', 1, 7);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (704, 'nnml_predict', 1, 7);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (1501, 'shot_enplug', 1, 15);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (1502, 'shot_activaire', 1, 15);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (1503, 'shot_mist', 1, 15);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (1504, 'shot_ruckussz', 1, 15);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (1505, 'shot_wap', 1, 15);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (1506, 'shot_nnml', 1, 15);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (1507, 'shot_host', 1, 15);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (1508, 'shot_router', 1, 15);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (801, 'main_addr', 1, 8);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (802, 'main_host', 1, 8);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (901, 'hist_dump', 1, 9);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (1201, 'zbx_zbx2omni', 1, 12);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (1202, 'zbx_omni2zbx', 1, 12);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (1203, 'zbx_main2zbx', 1, 12);
INSERT INTO code_program (programid, program, enabled, layerid) VALUES (1204, 'zbx_zbx2main', 1, 12);

INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (10, 401, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (11, 601, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (20, 402, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (21, 602, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (22, 301, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (30, 405, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (31, 406, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (32, 408, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (40, 403, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (41, 404, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (42, 407, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (43, 409, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (50, 501, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (51, 502, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (52, 503, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (53, 504, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (54, 505, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (55, 506, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (56, 507, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (60, 701, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (61, 702, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (62, 703, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (63, 704, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (71, 1501, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (72, 1502, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (73, 1503, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (74, 1504, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (75, 1505, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (76, 1506, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (77, 1508, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (79, 1507, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (81, 801, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (82, 802, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (91, 1201, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (92, 1203, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (93, 1202, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (94, 1201, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (95, 1204, NULL, 1, 1);
INSERT INTO code_program_launch (priority, programid, parameters, wait, enabled) VALUES (101, 901, NULL, 1, 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (401, 1, 10, 'TRUNCATE TABLE raw_mac;', 1);

INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (601, 1, 10, 1, 'UPDATE IGNORE raw_mac SET assignment=UPPER(assignment);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (601, 1, 20, 1, 'INSERT IGNORE INTO info_mac (assignment, registry, organization, address, assignment_len, first_mac, last_mac, first_mac_num, last_mac_num) SELECT assignment, registry, organization, address, LENGTH(assignment) AS assignment_len, RPAD(assignment,12,\'0\') AS first_mac, RPAD(assignment,12,\'F\') AS last_mac, CONV(RPAD(assignment,12,\'0\'),16,10) AS first_mac_num, CONV(RPAD(assignment,12,\'F\'),16,10) AS last_mac_num FROM raw_mac WHERE assignment NOT IN (SELECT assignment FROM info_mac);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (601, 1, 30, 1, 'UPDATE IGNORE info_mac INNER JOIN raw_mac ON info_mac.assignment=raw_mac.assignment SET info_mac.registry=raw_mac.registry, info_mac.organization=raw_mac.organization, info_mac.address=raw_mac.address, info_mac.assignment_len=LENGTH(raw_mac.assignment), info_mac.first_mac=RPAD(raw_mac.assignment,12,\'0\'), info_mac.last_mac=RPAD(raw_mac.assignment,12,\'F\'), info_mac.first_mac_num=CONV(RPAD(raw_mac.assignment,12,\'0\'),16,10), info_mac.last_mac_num=CONV(RPAD(raw_mac.assignment,12,\'F\'),16,10);');

INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 10, 1, 'TRUNCATE TABLE raw_netbox_tenancy_tenantgroup;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 11, 1, 'TRUNCATE TABLE raw_netbox_tenancy_tenant;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 12, 1, 'TRUNCATE TABLE raw_netbox_dcim_sitegroup;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 13, 1, 'TRUNCATE TABLE raw_netbox_dcim_region;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 14, 1, 'TRUNCATE TABLE raw_netbox_dcim_site;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 15, 1, 'TRUNCATE TABLE raw_netbox_dcim_location;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 16, 1, 'TRUNCATE TABLE raw_netbox_dcim_rackrole;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 17, 1, 'TRUNCATE TABLE raw_netbox_dcim_rack;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 18, 1, 'TRUNCATE TABLE raw_netbox_dcim_manufacturer;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 19, 1, 'TRUNCATE TABLE raw_netbox_dcim_devicerole;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 20, 1, 'TRUNCATE TABLE raw_netbox_dcim_platform;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 21, 1, 'TRUNCATE TABLE raw_netbox_dcim_devicetype;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 22, 1, 'TRUNCATE TABLE raw_netbox_dcim_virtualchassis;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 23, 1, 'TRUNCATE TABLE raw_netbox_dcim_device;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 24, 1, 'TRUNCATE TABLE raw_netbox_dcim_interface;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 25, 1, 'TRUNCATE TABLE raw_netbox_ipam_vrf;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 26, 1, 'TRUNCATE TABLE raw_netbox_ipam_role;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 27, 1, 'TRUNCATE TABLE raw_netbox_ipam_vlangroup;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 28, 1, 'TRUNCATE TABLE raw_netbox_ipam_vlan;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 29, 1, 'TRUNCATE TABLE raw_netbox_ipam_prefix;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 30, 1, 'TRUNCATE TABLE raw_netbox_ipam_iprange;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (402, 1, 31, 1, 'TRUNCATE TABLE raw_netbox_ipam_ipaddress;');

INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 10, 1, 'UPDATE IGNORE raw_netbox_dcim_interface SET mac_address=REPLACE(UPPER(mac_address),\':\',\'\');');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 11, 1, 'UPDATE IGNORE raw_netbox_dcim_device SET primary_ip=LOWER(primary_ip);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 12, 1, 'UPDATE IGNORE raw_netbox_ipam_prefix SET prefix=LOWER(prefix);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 13, 1, 'UPDATE IGNORE raw_netbox_ipam_iprange SET start_address=LOWER(start_address), end_address=LOWER(end_address);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 14, 1, 'UPDATE IGNORE raw_netbox_ipam_ipaddress SET address=LOWER(address);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 20, 1, 'DELETE IGNORE FROM info_netbox_ipam_ipaddress WHERE id NOT IN (SELECT id FROM raw_netbox_ipam_ipaddress);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 21, 1, 'DELETE IGNORE FROM info_netbox_ipam_iprange WHERE id NOT IN (SELECT id FROM raw_netbox_ipam_iprange);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 22, 1, 'DELETE IGNORE FROM info_netbox_ipam_prefix WHERE id NOT IN (SELECT id FROM raw_netbox_ipam_prefix);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 23, 1, 'DELETE IGNORE FROM info_netbox_ipam_vlan WHERE id NOT IN (SELECT id FROM raw_netbox_ipam_vlan);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 24, 1, 'DELETE IGNORE FROM info_netbox_ipam_vrf WHERE id NOT IN (SELECT id FROM raw_netbox_ipam_vrf);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 25, 1, 'DELETE IGNORE FROM info_netbox_ipam_role WHERE id NOT IN (SELECT id FROM raw_netbox_ipam_role);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 26, 1, 'DELETE IGNORE FROM info_netbox_ipam_vlangroup WHERE id NOT IN (SELECT id FROM raw_netbox_ipam_vlangroup);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 30, 1, 'DELETE IGNORE FROM info_netbox_dcim_interface WHERE id NOT IN (SELECT id FROM raw_netbox_dcim_interface);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 31, 1, 'DELETE IGNORE FROM info_netbox_dcim_device WHERE id NOT IN (SELECT id FROM raw_netbox_dcim_device);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 32, 1, 'DELETE IGNORE FROM info_netbox_dcim_virtualchassis WHERE id NOT IN (SELECT id FROM raw_netbox_dcim_virtualchassis);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 33, 1, 'DELETE IGNORE FROM info_netbox_dcim_devicetype WHERE id NOT IN (SELECT id FROM raw_netbox_dcim_devicetype);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 34, 1, 'DELETE IGNORE FROM info_netbox_dcim_platform WHERE id NOT IN (SELECT id FROM raw_netbox_dcim_platform);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 35, 1, 'DELETE IGNORE FROM info_netbox_dcim_devicerole WHERE id NOT IN (SELECT id FROM raw_netbox_dcim_devicerole);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 36, 1, 'DELETE IGNORE FROM info_netbox_dcim_manufacturer WHERE id NOT IN (SELECT id FROM raw_netbox_dcim_manufacturer);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 40, 1, 'DELETE IGNORE FROM info_netbox_dcim_rack WHERE id NOT IN (SELECT id FROM raw_netbox_dcim_rack);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 41, 1, 'DELETE IGNORE FROM info_netbox_dcim_rackrole WHERE id NOT IN (SELECT id FROM raw_netbox_dcim_rackrole);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 42, 1, 'DELETE IGNORE FROM info_netbox_dcim_location WHERE id NOT IN (SELECT id FROM raw_netbox_dcim_location);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 43, 1, 'DELETE IGNORE FROM info_netbox_dcim_site WHERE id NOT IN (SELECT id FROM raw_netbox_dcim_site);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 44, 1, 'DELETE IGNORE FROM info_netbox_dcim_region WHERE id NOT IN (SELECT id FROM raw_netbox_dcim_region);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 45, 1, 'DELETE IGNORE FROM info_netbox_dcim_sitegroup WHERE id NOT IN (SELECT id FROM raw_netbox_dcim_sitegroup);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 46, 1, 'DELETE IGNORE FROM info_netbox_tenancy_tenant WHERE id NOT IN (SELECT id FROM raw_netbox_tenancy_tenant);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 47, 1, 'DELETE IGNORE FROM info_netbox_tenancy_tenantgroup WHERE id NOT IN (SELECT id FROM raw_netbox_tenancy_tenantgroup);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 100, 1, 'INSERT IGNORE INTO info_netbox_tenancy_tenantgroup (id, name, slug, parent_id, description, level, created, last_updated, custom_fields) SELECT id, name, slug, parent_id, description, level, created, last_updated, custom_fields FROM raw_netbox_tenancy_tenantgroup WHERE id NOT IN (SELECT id FROM info_netbox_tenancy_tenantgroup);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 101, 1, 'INSERT IGNORE INTO info_netbox_tenancy_tenant (id, name, slug, group_id, description, created, last_updated, comments, custom_fields) SELECT id, name, slug, group_id, description, created, last_updated, comments, custom_fields FROM raw_netbox_tenancy_tenant WHERE id NOT IN (SELECT id FROM info_netbox_tenancy_tenant);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 102, 1, 'INSERT IGNORE INTO info_netbox_dcim_sitegroup (id, name, slug, description, created, last_updated, parent_id, level, custom_fields) SELECT id, name, slug, description, created, last_updated, parent_id, level, custom_fields FROM raw_netbox_dcim_sitegroup WHERE id NOT IN (SELECT id FROM info_netbox_dcim_sitegroup);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 103, 1, 'INSERT IGNORE INTO info_netbox_dcim_region (id, name, slug, description, created, last_updated, parent_id, level, custom_fields) SELECT id, name, slug, description, created, last_updated, parent_id, level, custom_fields FROM raw_netbox_dcim_region WHERE id NOT IN (SELECT id FROM info_netbox_dcim_region);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 104, 1, 'INSERT IGNORE INTO info_netbox_dcim_site (id, name, slug, description, created, last_updated, status, region_id, group_id, tenant_id, facility, time_zone, physical_address, shipping_address, latitude, longitude, contact_name, contact_phone, contact_email, comments, asn, custom_fields) SELECT id, name, slug, description, created, last_updated, status, region_id, group_id, tenant_id, facility, time_zone, physical_address, shipping_address, latitude, longitude, contact_name, contact_phone, contact_email, comments, asn, custom_fields FROM raw_netbox_dcim_site WHERE id NOT IN (SELECT id FROM info_netbox_dcim_site);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 105, 1, 'INSERT IGNORE INTO info_netbox_dcim_location (id, name, slug, description, created, last_updated, site_id, parent_id, level, tenant_id, custom_fields) SELECT id, name, slug, description, created, last_updated, site_id, parent_id, level, tenant_id, custom_fields FROM raw_netbox_dcim_location WHERE id NOT IN (SELECT id FROM info_netbox_dcim_location);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 106, 1, 'INSERT IGNORE INTO info_netbox_dcim_rackrole (id, name, slug, description, created, last_updated, color, custom_fields) SELECT id, name, slug, description, created, last_updated, color, custom_fields FROM raw_netbox_dcim_rackrole WHERE id NOT IN (SELECT id FROM info_netbox_dcim_rackrole);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 107, 1, 'INSERT IGNORE INTO info_netbox_dcim_rack (id, name, created, last_updated, facility_id, site_id, location_id, tenant_id, status, role_id, type, serial, asset_tag, width, u_height, desc_units, comments, outer_width, outer_depth, outer_unit, custom_fields) SELECT id, name, created, last_updated, facility_id, site_id, location_id, tenant_id, status, role_id, type, serial, asset_tag, width, u_height, desc_units, comments, outer_width, outer_depth, outer_unit, custom_fields FROM raw_netbox_dcim_rack WHERE id NOT IN (SELECT id FROM info_netbox_dcim_rack);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 110, 1, 'INSERT IGNORE INTO info_netbox_dcim_manufacturer (id, name, slug, description, created, last_updated, custom_fields) SELECT id, name, slug, description, created, last_updated, custom_fields FROM raw_netbox_dcim_manufacturer WHERE id NOT IN (SELECT id FROM info_netbox_dcim_manufacturer);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 111, 1, 'INSERT IGNORE INTO info_netbox_dcim_devicerole (id, name, slug, description, created, last_updated, color, vm_role, custom_fields) SELECT id, name, slug, description, created, last_updated, color, vm_role, custom_fields FROM raw_netbox_dcim_devicerole WHERE id NOT IN (SELECT id FROM info_netbox_dcim_devicerole);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 112, 1, 'INSERT IGNORE INTO info_netbox_dcim_platform (id, name, slug, description, created, last_updated, manufacturer_id, napalm_driver, napalm_args, custom_fields) SELECT id, name, slug, description, created, last_updated, manufacturer_id, napalm_driver, napalm_args, custom_fields FROM raw_netbox_dcim_platform WHERE id NOT IN (SELECT id FROM info_netbox_dcim_platform);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 113, 1, 'INSERT IGNORE INTO info_netbox_dcim_devicetype (id, slug, created, last_updated, manufacturer_id, model, part_number, u_height, is_full_depth, subdevice_role, airflow, front_image, rear_image, comments, custom_fields) SELECT id, slug, created, last_updated, manufacturer_id, model, part_number, u_height, is_full_depth, subdevice_role, airflow, front_image, rear_image, comments, custom_fields FROM raw_netbox_dcim_devicetype WHERE id NOT IN (SELECT id FROM info_netbox_dcim_devicetype);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 114, 1, 'INSERT IGNORE INTO info_netbox_dcim_virtualchassis (id, name, created, last_updated, domain, master_id, custom_fields) SELECT id, name, created, last_updated, domain, master_id, custom_fields FROM raw_netbox_dcim_virtualchassis WHERE id NOT IN (SELECT id FROM info_netbox_dcim_virtualchassis);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 115, 1, 'INSERT IGNORE INTO info_netbox_dcim_device (id, name, created, last_updated, device_type_id, device_role_id, tenant_id, platform_id, serial, asset_tag, site_id, location_id, rack_id, position, face, parent_device_id, status, primary_ip, primary_ip4_id, primary_ip6_id, cluster_id, virtual_chassis_id, vc_position, vc_priority, comments, local_context_data, custom_fields) SELECT id, name, created, last_updated, device_type_id, device_role_id, tenant_id, platform_id, serial, asset_tag, site_id, location_id, rack_id, position, face, parent_device_id, status, primary_ip, primary_ip4_id, primary_ip6_id, cluster_id, virtual_chassis_id, vc_position, vc_priority, comments, local_context_data, custom_fields FROM raw_netbox_dcim_device WHERE id NOT IN (SELECT id FROM info_netbox_dcim_device);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 116, 1, 'INSERT IGNORE INTO info_netbox_dcim_interface (id, name, description, created, last_updated, device_id, type, enabled, parent_id, bridge_id, lag_id, mtu, mac_address, wwn, mgmt_only, mode, rf_role, rf_channel, rf_channel_frequency, rf_channel_width, tx_power, untagged_vlan_id, mark_connected, label, cable_id, wireless_link_id, link_peer, link_peer_type, custom_fields) SELECT id, name, description, created, last_updated, device_id, type, enabled, parent_id, bridge_id, lag_id, mtu, mac_address, wwn, mgmt_only, mode, rf_role, rf_channel, rf_channel_frequency, rf_channel_width, tx_power, untagged_vlan_id, mark_connected, label, cable_id, wireless_link_id, link_peer, link_peer_type, custom_fields FROM raw_netbox_dcim_interface WHERE id NOT IN (SELECT id FROM info_netbox_dcim_interface);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 120, 1, 'INSERT IGNORE INTO info_netbox_ipam_vlangroup (id, name, slug, description, created, last_updated, scope_type, scope_id, custom_fields) SELECT id, name, slug, description, created, last_updated, scope_type, scope_id, custom_fields FROM raw_netbox_ipam_vlangroup WHERE id NOT IN (SELECT id FROM info_netbox_ipam_vlangroup);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 121, 1, 'INSERT IGNORE INTO info_netbox_ipam_vrf (id, name, description, created, last_updated, rd, tenant_id, enforce_unique, custom_fields) SELECT id, name, description, created, last_updated, rd, tenant_id, enforce_unique, custom_fields FROM raw_netbox_ipam_vrf WHERE id NOT IN (SELECT id FROM info_netbox_ipam_vrf);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 122, 1, 'INSERT IGNORE INTO info_netbox_ipam_role (id, name, slug, description, weight, custom_fields) SELECT id, name, slug, description, weight, custom_fields FROM raw_netbox_ipam_role WHERE id NOT IN (SELECT id FROM info_netbox_ipam_role);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 123, 1, 'INSERT IGNORE INTO info_netbox_ipam_vlan (id, name, slug, description, created, last_updated, site_id, group_id, vid, tenant_id, status, role_id, custom_fields) SELECT id, name, slug, description, created, last_updated, site_id, group_id, vid, tenant_id, status, role_id, custom_fields FROM raw_netbox_ipam_vlan WHERE id NOT IN (SELECT id FROM info_netbox_ipam_vlan);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 124, 1, 'INSERT IGNORE INTO info_netbox_ipam_prefix (id, description, created, last_updated, family, prefix, site_id, vrf_id, tenant_id, vlan_id, status, role_id, is_pool, mark_utilized, level, custom_fields) SELECT id, description, created, last_updated, family, prefix, site_id, vrf_id, tenant_id, vlan_id, status, role_id, is_pool, mark_utilized, level, custom_fields FROM raw_netbox_ipam_prefix WHERE id NOT IN (SELECT id FROM info_netbox_ipam_prefix);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 125, 1, 'INSERT IGNORE INTO info_netbox_ipam_iprange (id, description, created, last_updated, family, start_address, end_address, size, vrf_id, tenant_id, status, role_id, custom_fields) SELECT id, description, created, last_updated, family, start_address, end_address, size, vrf_id, tenant_id, status, role_id, custom_fields FROM raw_netbox_ipam_iprange WHERE id NOT IN (SELECT id FROM info_netbox_ipam_iprange);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 126, 1, 'INSERT IGNORE INTO info_netbox_ipam_ipaddress (id, description, created, last_updated, family, address, vrf_id, tenant_id, status, role, assigned_object_type, assigned_object_id, assigned_object, nat_inside_id, nat_outside_id, dns_name, custom_fields) SELECT id, description, created, last_updated, family, address, vrf_id, tenant_id, status, role, assigned_object_type, assigned_object_id, assigned_object, nat_inside_id, nat_outside_id, dns_name, custom_fields FROM raw_netbox_ipam_ipaddress WHERE id NOT IN (SELECT id FROM info_netbox_ipam_ipaddress);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 200, 1, 'UPDATE IGNORE info_netbox_tenancy_tenantgroup AS it INNER JOIN raw_netbox_tenancy_tenantgroup AS rt ON it.id=rt.id SET it.name=rt.name, it.slug=rt.slug, it.parent_id=rt.parent_id, it.description=rt.description, it.level=rt.level, it.created=rt.created, it.last_updated=rt.last_updated, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 201, 1, 'UPDATE IGNORE info_netbox_tenancy_tenant AS it INNER JOIN raw_netbox_tenancy_tenant AS rt ON it.id=rt.id SET it.name=rt.name, it.slug=rt.slug, it.group_id=rt.group_id, it.description=rt.description, it.created=rt.created, it.last_updated=rt.last_updated, it.comments=rt.comments, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 202, 1, 'UPDATE IGNORE info_netbox_dcim_sitegroup AS it INNER JOIN raw_netbox_dcim_sitegroup AS rt ON it.id=rt.id SET it.name=rt.name, it.slug=rt.slug, it.description=rt.description, it.created=rt.created, it.last_updated=rt.last_updated, it.parent_id=rt.parent_id, it.level=rt.level, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 203, 1, 'UPDATE IGNORE info_netbox_dcim_region AS it INNER JOIN raw_netbox_dcim_region AS rt ON it.id=rt.id SET it.name=rt.name, it.slug=rt.slug, it.description=rt.description, it.created=rt.created, it.last_updated=rt.last_updated, it.parent_id=rt.parent_id, it.level=rt.level, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 204, 1, 'UPDATE IGNORE info_netbox_dcim_site AS it INNER JOIN raw_netbox_dcim_site AS rt ON it.id=rt.id SET it.name=rt.name, it.slug=rt.slug, it.description=rt.description, it.created=rt.created, it.last_updated=rt.last_updated, it.status=rt.status, it.region_id=rt.region_id, it.group_id=rt.group_id, it.tenant_id=rt.tenant_id, it.facility=rt.facility, it.time_zone=rt.time_zone, it.physical_address=rt.physical_address, it.shipping_address=rt.shipping_address, it.latitude=rt.latitude, it.longitude=rt.longitude, it.contact_name=rt.contact_name, it.contact_phone=rt.contact_phone, it.contact_email=rt.contact_email, it.comments=rt.comments, it.asn=rt.asn, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 205, 1, 'UPDATE IGNORE info_netbox_dcim_location AS it INNER JOIN raw_netbox_dcim_location AS rt ON it.id=rt.id SET it.name=rt.name, it.slug=rt.slug, it.description=rt.description, it.created=rt.created, it.last_updated=rt.last_updated, it.site_id=rt.site_id, it.parent_id=rt.parent_id, it.level=rt.level, it.tenant_id=rt.tenant_id, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 206, 1, 'UPDATE IGNORE info_netbox_dcim_rackrole AS it INNER JOIN raw_netbox_dcim_rackrole AS rt ON it.id=rt.id SET it.name=rt.name, it.slug=rt.slug, it.description=rt.description, it.created=rt.created, it.last_updated=rt.last_updated, it.color=rt.color, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 207, 1, 'UPDATE IGNORE info_netbox_dcim_rack AS it INNER JOIN info_netbox_dcim_rack AS rt ON it.id=rt.id SET it.name=rt.name, it.created=rt.created, it.last_updated=rt.last_updated, it.facility_id=rt.facility_id, it.site_id=rt.site_id, it.location_id=rt.location_id, it.tenant_id=rt.tenant_id, it.status=rt.status, it.role_id=rt.role_id, it.type=rt.type, it.serial=rt.serial, it.asset_tag=rt.asset_tag, it.width=rt.width, it.u_height=rt.u_height, it.desc_units=rt.desc_units, it.comments=rt.comments, it.outer_width=rt.outer_width, it.outer_depth=rt.outer_depth, it.outer_unit=rt.outer_unit, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 210, 1, 'UPDATE IGNORE info_netbox_dcim_manufacturer AS it INNER JOIN raw_netbox_dcim_manufacturer AS rt ON it.id=rt.id SET it.name=rt.name, it.slug=rt.slug, it.description=rt.description, it.created=rt.created, it.last_updated=rt.last_updated, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 211, 1, 'UPDATE IGNORE info_netbox_dcim_devicerole AS it INNER JOIN raw_netbox_dcim_devicerole AS rt ON it.id=rt.id SET it.name=rt.name, it.slug=rt.slug, it.description=rt.description, it.created=rt.created, it.last_updated=rt.last_updated, it.color=rt.color, it.vm_role=rt.vm_role, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 212, 1, 'UPDATE IGNORE info_netbox_dcim_platform AS it INNER JOIN raw_netbox_dcim_platform AS rt ON it.id=rt.id SET it.name=rt.name, it.slug=rt.slug, it.description=rt.description, it.created=rt.created, it.last_updated=rt.last_updated, it.manufacturer_id=rt.manufacturer_id, it.napalm_driver=rt.napalm_driver, it.napalm_args=rt.napalm_args, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 213, 1, 'UPDATE IGNORE info_netbox_dcim_devicetype AS it INNER JOIN raw_netbox_dcim_devicetype AS rt ON it.id=rt.id SET it.slug=rt.slug, it.created=rt.created, it.last_updated=rt.last_updated, it.manufacturer_id=rt.manufacturer_id, it.model=rt.model, it.part_number=rt.part_number, it.u_height=rt.u_height, it.is_full_depth=rt.is_full_depth, it.subdevice_role=rt.subdevice_role, it.airflow=rt.airflow, it.front_image=rt.front_image, it.rear_image=rt.rear_image, it.comments=rt.comments, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 214, 1, 'UPDATE IGNORE info_netbox_dcim_virtualchassis AS it INNER JOIN raw_netbox_dcim_virtualchassis AS rt ON it.id=rt.id SET it.name=rt.name, it.created=rt.created, it.last_updated=rt.last_updated, it.domain=rt.domain, it.master_id=rt.master_id, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 215, 1, 'UPDATE IGNORE info_netbox_dcim_device AS it INNER JOIN raw_netbox_dcim_device AS rt ON it.id=rt.id SET it.name=rt.name, it.created=rt.created, it.last_updated=rt.last_updated, it.device_type_id=rt.device_type_id, it.device_role_id=rt.device_role_id, it.tenant_id=rt.tenant_id, it.platform_id=rt.platform_id, it.serial=rt.serial, it.asset_tag=rt.asset_tag, it.site_id=rt.site_id, it.location_id=rt.location_id, it.rack_id=rt.rack_id, it.position=rt.position, it.face=rt.face, it.parent_device_id=rt.parent_device_id, it.status=rt.status, it.primary_ip=rt.primary_ip, it.primary_ip4_id=rt.primary_ip4_id, it.primary_ip6_id=rt.primary_ip6_id, it.cluster_id=rt.cluster_id, it.virtual_chassis_id=rt.virtual_chassis_id, it.vc_position=rt.vc_position, it.vc_priority=rt.vc_priority, it.comments=rt.comments, it.local_context_data=rt.local_context_data, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 216, 1, 'UPDATE IGNORE info_netbox_dcim_interface AS it INNER JOIN raw_netbox_dcim_interface AS rt ON it.id=rt.id SET it.name=rt.name, it.description=rt.description, it.created=rt.created, it.last_updated=rt.last_updated, it.device_id=rt.device_id, it.type=rt.type, it.enabled=rt.enabled, it.parent_id=rt.parent_id, it.bridge_id=rt.bridge_id, it.lag_id=rt.lag_id, it.mtu=rt.mtu, it.mac_address=rt.mac_address, it.wwn=rt.wwn, it.mgmt_only=rt.mgmt_only, it.mode=rt.mode, it.rf_role=rt.rf_role, it.rf_channel=rt.rf_channel, it.rf_channel_frequency=rt.rf_channel_frequency, it.rf_channel_width=rt.rf_channel_width, it.tx_power=rt.tx_power, it.untagged_vlan_id=rt.untagged_vlan_id, it.mark_connected=rt.mark_connected, it.label=rt.label, it.cable_id=rt.cable_id, it.wireless_link_id=rt.wireless_link_id, it.link_peer=rt.link_peer, it.link_peer_type=rt.link_peer_type, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 220, 1, 'UPDATE IGNORE info_netbox_ipam_vlangroup AS it INNER JOIN raw_netbox_ipam_vlangroup AS rt ON it.id=rt.id SET it.name=rt.name, it.slug=rt.slug, it.description=rt.description, it.created=rt.created, it.last_updated=rt.last_updated, it.scope_type=rt.scope_type, it.scope_id=rt.scope_id, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 221, 1, 'UPDATE IGNORE info_netbox_ipam_vrf AS it INNER JOIN raw_netbox_ipam_vrf AS rt ON it.id=rt.id SET it.name=rt.name, it.description=rt.description, it.created=rt.created, it.last_updated=rt.last_updated, it.rd=rt.rd, it.tenant_id=rt.tenant_id, it.enforce_unique=rt.enforce_unique, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 222, 1, 'UPDATE IGNORE info_netbox_ipam_role AS it INNER JOIN raw_netbox_ipam_role AS rt ON it.id=rt.id SET it.name=rt.name, it.slug=rt.slug, it.description=rt.description, it.weight=rt.weight, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 223, 1, 'UPDATE IGNORE info_netbox_ipam_vlan AS it INNER JOIN raw_netbox_ipam_vlan AS rt ON it.id=rt.id SET it.name=rt.name, it.slug=rt.slug, it.description=rt.description, it.created=rt.created, it.last_updated=rt.last_updated, it.site_id=rt.site_id, it.group_id=rt.group_id, it.vid=rt.vid, it.tenant_id=rt.tenant_id, it.status=rt.status, it.role_id=rt.role_id, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 224, 1, 'UPDATE IGNORE info_netbox_ipam_prefix AS it INNER JOIN raw_netbox_ipam_prefix AS rt ON it.id=rt.id SET it.description=rt.description, it.created=rt.created, it.last_updated=rt.last_updated, it.family=rt.family, it.prefix=rt.prefix, it.site_id=rt.site_id, it.vrf_id=rt.vrf_id, it.tenant_id=rt.tenant_id, it.vlan_id=rt.vlan_id, it.status=rt.status, it.role_id=rt.role_id, it.is_pool=rt.is_pool, it.mark_utilized=rt.mark_utilized, it.level=rt.level, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 225, 1, 'UPDATE IGNORE info_netbox_ipam_iprange AS it INNER JOIN raw_netbox_ipam_iprange AS rt ON it.id=rt.id SET it.description=rt.description, it.created=rt.created, it.last_updated=rt.last_updated, it.family=rt.family, it.start_address=rt.start_address, it.end_address=rt.end_address, it.size=rt.size, it.vrf_id=rt.vrf_id, it.tenant_id=rt.tenant_id, it.status=rt.status, it.role_id=rt.role_id, it.custom_fields=rt.custom_fields;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (602, 1, 226, 1, 'UPDATE IGNORE info_netbox_ipam_ipaddress AS it INNER JOIN raw_netbox_ipam_ipaddress AS rt ON it.id=rt.id SET it.description=rt.description, it.created=rt.created, it.last_updated=rt.last_updated, it.family=rt.family, it.address=rt.address, it.vrf_id=rt.vrf_id, it.tenant_id=rt.tenant_id, it.status=rt.status, it.role=rt.role, it.assigned_object_type=rt.assigned_object_type, it.assigned_object_id=rt.assigned_object_id, it.assigned_object=rt.assigned_object, it.nat_inside_id=rt.nat_inside_id, it.nat_outside_id=rt.nat_outside_id, it.dns_name=rt.dns_name, it.custom_fields=rt.custom_fields;');

INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 1, 10, 1, 'CREATE TEMPORARY TABLE tmp_bigintid (id BIGINT NOT NULL PRIMARY KEY);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 1, 20, 1, 'CREATE TEMPORARY TABLE tmp_bigintmap (id BIGINT NOT NULL PRIMARY KEY, mapidbi BIGINT DEFAULT NULL UNIQUE, mapidi INT DEFAULT NULL UNIQUE);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 1, 30, 1, 'CREATE TEMPORARY TABLE tmp_bigintauto (autoid BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT, id BIGINT NOT NULL UNIQUE);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 1, 40, 1, 'CREATE TEMPORARY TABLE tmp_strid (id VARCHAR(256) NOT NULL PRIMARY KEY);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 1, 50, 1, 'CREATE TEMPORARY TABLE tmp_strmap (id VARCHAR(256) NOT NULL PRIMARY KEY, mapidbi BIGINT DEFAULT NULL UNIQUE, mapidi INT DEFAULT NULL UNIQUE);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 1, 60, 1, 'CREATE TEMPORARY TABLE tmp_strauto (autoid BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT, id VARCHAR(256) NOT NULL UNIQUE);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 1, 70, 1, 'CREATE TEMPORARY TABLE tmp_intid (id INT NOT NULL PRIMARY KEY);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 20, 1, 'TRUNCATE TABLE tmp_bigintid;');
INSERT INTO code_program_query (programid, stage, priority, parameter, tablename, enabled, query) VALUES (301, 2, 21, 'netbox_filter', 'info_netbox_tenancy_tenantgroup', 1, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT id FROM info_netbox_tenancy_tenantgroup {0};');
INSERT INTO code_program_query (programid, stage, priority, nrepeat, enabled, query) VALUES (301, 2, 22, 10, 1, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT id FROM info_netbox_tenancy_tenantgroup WHERE id NOT IN (SELECT id FROM tmp_bigintid) AND parent_id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 23, 1, 'DELETE IGNORE FROM ref_tenantgroup WHERE netboxid IS NOT NULL AND netboxid NOT IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 24, 1, 'UPDATE IGNORE ref_tenantgroup AS ref INNER JOIN info_netbox_tenancy_tenantgroup AS info ON ref.tenantgroup_alias=info.slug SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_tenantgroup WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 25, 1, 'UPDATE IGNORE ref_tenantgroup AS ref INNER JOIN info_netbox_tenancy_tenantgroup AS info ON ref.tenantgroup=info.name SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_tenantgroup WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 26, 1, 'INSERT IGNORE INTO ref_tenantgroup (netboxid, tenantgroup, tenantgroup_alias, parentid, description) SELECT id, name, slug, NULL, description FROM info_netbox_tenancy_tenantgroup WHERE id IN (SELECT id FROM tmp_bigintid) AND id NOT IN (SELECT netboxid FROM ref_tenantgroup WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 27, 1, 'UPDATE IGNORE ref_tenantgroup AS ref INNER JOIN info_netbox_tenancy_tenantgroup AS info ON ref.netboxid=info.id INNER JOIN ref_tenantgroup AS ref1 ON info.parent_id=ref1.netboxid SET ref.parentid=ref1.tenantgroupid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 28, 1, 'UPDATE IGNORE ref_tenantgroup AS ref INNER JOIN info_netbox_tenancy_tenantgroup AS info ON ref.netboxid=info.id SET ref.tenantgroup=info.name, ref.tenantgroup_alias=info.slug, ref.description=info.description;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 40, 1, 'TRUNCATE TABLE tmp_bigintid;');
INSERT INTO code_program_query (programid, stage, priority, parameter, tablename, enabled, query) VALUES (301, 2, 41, 'netbox_filter', 'info_netbox_dcim_sitegroup', 1, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT id FROM info_netbox_dcim_sitegroup {0};');
INSERT INTO code_program_query (programid, stage, priority, nrepeat, enabled, query) VALUES (301, 2, 42, 10, 1, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT id FROM info_netbox_dcim_sitegroup WHERE id NOT IN (SELECT id FROM tmp_bigintid) AND parent_id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 43, 1, 'DELETE IGNORE FROM ref_sitegroup WHERE netboxid IS NOT NULL AND netboxid NOT IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 44, 1, 'UPDATE IGNORE ref_sitegroup AS ref INNER JOIN info_netbox_dcim_sitegroup AS info ON ref.sitegroup_alias=info.slug SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_sitegroup WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 45, 1, 'UPDATE IGNORE ref_sitegroup AS ref INNER JOIN info_netbox_dcim_sitegroup AS info ON ref.sitegroup=info.name SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_sitegroup WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 46, 1, 'INSERT IGNORE INTO ref_sitegroup (netboxid, sitegroup, sitegroup_alias, parentid, description) SELECT id, name, slug, NULL, description FROM info_netbox_dcim_sitegroup  WHERE id IN (SELECT id FROM tmp_bigintid) AND id NOT IN (SELECT netboxid FROM ref_sitegroup WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 47, 1, 'UPDATE IGNORE ref_sitegroup AS ref INNER JOIN info_netbox_dcim_sitegroup AS info ON ref.netboxid=info.id INNER JOIN ref_sitegroup AS ref1 ON info.parent_id=ref1.netboxid SET ref.parentid=ref1.sitegroupid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 48, 1, 'UPDATE IGNORE ref_sitegroup AS ref INNER JOIN info_netbox_dcim_sitegroup AS info ON ref.netboxid=info.id SET ref.sitegroup=info.name, ref.sitegroup_alias=info.slug, ref.description=info.description;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 60, 1, 'TRUNCATE TABLE tmp_bigintid;');
INSERT INTO code_program_query (programid, stage, priority, parameter, tablename, enabled, query) VALUES (301, 2, 61, 'netbox_filter', 'info_netbox_tenancy_tenant', 1, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT id FROM info_netbox_tenancy_tenant {0};');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 63, 1, 'DELETE IGNORE FROM ref_tenant WHERE netboxid IS NOT NULL AND netboxid NOT IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 64, 1, 'UPDATE IGNORE ref_tenant AS ref INNER JOIN info_netbox_tenancy_tenant AS info ON ref.tenant_alias=info.slug SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_tenant WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 65, 1, 'UPDATE IGNORE ref_tenant AS ref INNER JOIN info_netbox_tenancy_tenant AS info ON ref.tenant=info.name SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_tenant WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 66, 1, 'INSERT IGNORE INTO ref_tenant (netboxid, tenant, tenant_alias, tenantgroupid, description, comments) SELECT id, name, slug, NULL, description, comments FROM info_netbox_tenancy_tenant  WHERE id IN (SELECT id FROM tmp_bigintid) AND id NOT IN (SELECT netboxid FROM ref_tenant WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 67, 1, 'UPDATE IGNORE ref_tenant AS ref INNER JOIN info_netbox_tenancy_tenant AS info ON ref.netboxid=info.id INNER JOIN ref_tenantgroup AS ref1 ON info.group_id=ref1.netboxid SET ref.tenantgroupid=ref1.tenantgroupid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 68, 1, 'UPDATE IGNORE ref_tenant AS ref INNER JOIN info_netbox_tenancy_tenant AS info ON ref.netboxid=info.id SET ref.tenant=info.name, ref.tenant_alias=info.slug, ref.description=info.description, ref.comments=info.comments;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 69, 1, 'UPDATE IGNORE ref_tenant AS ref INNER JOIN info_netbox_tenancy_tenant AS info ON ref.netboxid=info.id LEFT JOIN ref_tenantgroup AS ref1 ON info.group_id=ref1.netboxid SET ref.tenantgroupid=NULL WHERE ref.tenantgroupid IS NOT NULL AND ref1.tenantgroupid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 80, 1, 'TRUNCATE TABLE tmp_bigintid;');
INSERT INTO code_program_query (programid, stage, priority, parameter, tablename, enabled, query) VALUES (301, 2, 81, 'netbox_filter', 'info_netbox_dcim_region', 1, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT id FROM info_netbox_dcim_region {0};');
INSERT INTO code_program_query (programid, stage, priority, nrepeat, enabled, query) VALUES (301, 2, 82, 10, 1, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT id FROM info_netbox_dcim_region WHERE id NOT IN (SELECT id FROM tmp_bigintid) AND parent_id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 83, 1, 'DELETE IGNORE FROM ref_region WHERE netboxid IS NOT NULL AND netboxid NOT IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 84, 1, 'UPDATE IGNORE ref_region AS ref INNER JOIN info_netbox_dcim_region AS info ON ref.region_alias=info.slug SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_region WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 85, 1, 'UPDATE IGNORE ref_region AS ref INNER JOIN info_netbox_dcim_region AS info ON ref.region=info.name SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_region WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 90, 1, 'TRUNCATE TABLE tmp_bigintmap;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 91, 1, 'TRUNCATE TABLE tmp_bigintauto;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 92, 1, 'INSERT IGNORE INTO tmp_bigintauto(id) SELECT id FROM tmp_bigintid WHERE id NOT IN (SELECT netboxid FROM ref_region WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 93, 1, 'INSERT IGNORE INTO tmp_bigintmap(id, mapidi) SELECT id, autoid FROM tmp_bigintauto;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 94, 1, 'UPDATE IGNORE tmp_bigintmap INNER JOIN (SELECT IFNULL(MAX(regionid),0) AS mid FROM ref_region) AS ref SET tmp_bigintmap.mapidi=tmp_bigintmap.mapidi+ref.mid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 100, 1, 'INSERT IGNORE INTO ref_region (regionid, netboxid, region, region_alias, parentid, description) SELECT tmp_bigintmap.mapidi, info_netbox_dcim_region.id, info_netbox_dcim_region.name, info_netbox_dcim_region.slug, NULL, info_netbox_dcim_region.description FROM info_netbox_dcim_region INNER JOIN tmp_bigintmap ON info_netbox_dcim_region.id=tmp_bigintmap.id WHERE info_netbox_dcim_region.id IN (SELECT id FROM tmp_bigintid) AND info_netbox_dcim_region.id NOT IN (SELECT netboxid FROM ref_region WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 101, 1, 'UPDATE IGNORE ref_region AS ref INNER JOIN info_netbox_dcim_region AS info ON ref.netboxid=info.id INNER JOIN ref_region AS ref1 ON info.parent_id=ref1.netboxid SET ref.parentid=ref1.regionid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 102, 1, 'UPDATE IGNORE ref_region AS ref INNER JOIN info_netbox_dcim_region AS info ON ref.netboxid=info.id SET ref.region=info.name, ref.region_alias=info.slug, ref.description=info.description;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 120, 1, 'TRUNCATE TABLE tmp_bigintid;');
INSERT INTO code_program_query (programid, stage, priority, parameter, tablename, enabled, query) VALUES (301, 2, 121, 'netbox_filter', 'info_netbox_dcim_site', 1, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT id FROM info_netbox_dcim_site {0};');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 123, 1, 'DELETE IGNORE FROM ref_site WHERE netboxid IS NOT NULL AND netboxid NOT IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 124, 1, 'UPDATE IGNORE ref_site AS ref INNER JOIN info_netbox_dcim_site AS info ON ref.site_alias=info.slug SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_site WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 125, 1, 'UPDATE IGNORE ref_site AS ref INNER JOIN info_netbox_dcim_site AS info ON ref.site=info.name SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_site WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 130, 1, 'TRUNCATE TABLE tmp_bigintmap;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 131, 1, 'TRUNCATE TABLE tmp_bigintauto;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 132, 1, 'INSERT IGNORE INTO tmp_bigintauto(id) SELECT id FROM tmp_bigintid WHERE id NOT IN (SELECT netboxid FROM ref_site WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 133, 1, 'INSERT IGNORE INTO tmp_bigintmap(id, mapidi) SELECT id, autoid FROM tmp_bigintauto;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 134, 1, 'UPDATE IGNORE tmp_bigintmap INNER JOIN (SELECT IFNULL(MAX(siteid),0) AS mid FROM ref_site) AS ref SET tmp_bigintmap.mapidi=tmp_bigintmap.mapidi+ref.mid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 140, 1, 'INSERT IGNORE INTO ref_site (siteid, netboxid, site, site_alias, description, active, regionid, groupid, tenantid, facility, time_zone, physical_address, shipping_address, latitude, longitude, contact_name, contact_phone, contact_email, importance, comments) SELECT tmp_bigintmap.mapidi, info.id, info.name, info.slug, info.description, IF(LOWER(info.status) IN (\'active\', \'decommissioning\'), TRUE, FALSE), NULL, NULL, NULL, info.facility, info.time_zone, info.physical_address, info.shipping_address, info.latitude, info.longitude, info.contact_name, info.contact_phone, info.contact_email, 1, info.comments FROM info_netbox_dcim_site AS info INNER JOIN tmp_bigintmap ON info.id=tmp_bigintmap.id WHERE info.id IN (SELECT id FROM tmp_bigintid) AND info.id NOT IN (SELECT netboxid FROM ref_site WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 141, 1, 'UPDATE IGNORE ref_site AS ref INNER JOIN info_netbox_dcim_site AS info ON ref.netboxid=info.id INNER JOIN ref_region AS ref1 ON info.region_id=ref1.netboxid SET ref.regionid=ref1.regionid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 142, 1, 'UPDATE IGNORE ref_site AS ref INNER JOIN info_netbox_dcim_site AS info ON ref.netboxid=info.id INNER JOIN ref_tenant AS ref1 ON info.tenant_id=ref1.netboxid SET ref.tenantid=ref1.tenantid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 143, 1, 'UPDATE IGNORE ref_site AS ref INNER JOIN info_netbox_dcim_site AS info ON ref.netboxid=info.id INNER JOIN ref_sitegroup AS ref1 ON info.group_id=ref1.netboxid SET ref.groupid=ref1.sitegroupid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 144, 1, 'UPDATE IGNORE ref_site AS ref INNER JOIN info_netbox_dcim_site AS info ON ref.netboxid=info.id SET ref.site=info.name, ref.site_alias=info.slug, ref.description=info.description, ref.facility=info.facility, ref.time_zone=info.time_zone, ref.physical_address=info.physical_address, ref.shipping_address=info.shipping_address, ref.latitude=info.latitude, ref.longitude=info.longitude, ref.contact_name=info.contact_name, ref.contact_phone=info.contact_phone, ref.contact_email=info.contact_email, ref.comments=info.comments, ref.active=IF(LOWER(info.status) IN (\'active\', \'decommissioning\', TRUE, FALSE));');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 145, 1, 'UPDATE IGNORE ref_site AS ref INNER JOIN info_netbox_dcim_site AS info ON ref.netboxid=info.id LEFT JOIN ref_region AS ref1 ON info.region_id=ref1.netboxid SET ref.regionid=NULL WHERE ref.regionid IS NOT NULL AND ref1.regionid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 146, 1, 'UPDATE IGNORE ref_site AS ref INNER JOIN info_netbox_dcim_site AS info ON ref.netboxid=info.id LEFT JOIN ref_tenant AS ref1 ON info.tenant_id=ref1.netboxid SET ref.tenantid=NULL WHERE ref.tenantid IS NOT NULL AND ref1.tenantid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 147, 1, 'UPDATE IGNORE ref_site AS ref INNER JOIN info_netbox_dcim_site AS info ON ref.netboxid=info.id LEFT JOIN ref_sitegroup AS ref1 ON info.group_id=ref1.netboxid SET ref.groupid=NULL WHERE ref.groupid IS NOT NULL AND ref1.sitegroupid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 200, 1, 'TRUNCATE TABLE tmp_bigintauto;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 201, 1, 'TRUNCATE TABLE tmp_bigintmap;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 202, 1, 'DELETE IGNORE FROM ref_manufacturer WHERE netboxid IS NOT NULL AND netboxid NOT IN (SELECT id FROM info_netbox_dcim_manufacturer);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 203, 1, 'UPDATE IGNORE ref_manufacturer AS ref INNER JOIN info_netbox_dcim_manufacturer AS info ON ref.manufacturer_alias=info.slug SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_manufacturer WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 204, 1, 'UPDATE IGNORE ref_manufacturer AS ref INNER JOIN info_netbox_dcim_manufacturer AS info ON ref.manufacturer=info.name SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_manufacturer WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 205, 1, 'INSERT IGNORE INTO tmp_bigintauto(id) SELECT id FROM info_netbox_dcim_manufacturer WHERE id NOT IN (SELECT netboxid FROM ref_manufacturer WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 206, 1, 'INSERT IGNORE INTO tmp_bigintmap(id, mapidi) SELECT id, autoid FROM tmp_bigintauto;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 207, 1, 'UPDATE IGNORE tmp_bigintmap INNER JOIN (SELECT IFNULL(MAX(manufacturerid),0) AS mid FROM ref_manufacturer) AS ref SET tmp_bigintmap.mapidi=tmp_bigintmap.mapidi+ref.mid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 208, 1, 'INSERT IGNORE INTO ref_manufacturer (manufacturerid, netboxid, manufacturer, manufacturer_alias, description) SELECT tmp_bigintmap.mapidi, info.id, info.name, info.slug, info.description FROM info_netbox_dcim_manufacturer AS info INNER JOIN tmp_bigintmap ON info.id=tmp_bigintmap.id WHERE info.id NOT IN (SELECT netboxid FROM ref_manufacturer WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 209, 1, 'UPDATE IGNORE ref_manufacturer AS ref INNER JOIN info_netbox_dcim_manufacturer AS info ON ref.netboxid=info.id SET ref.manufacturer=info.name, ref.manufacturer_alias=info.slug, ref.description=info.description;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 220, 1, 'TRUNCATE TABLE tmp_bigintauto;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 221, 1, 'TRUNCATE TABLE tmp_bigintmap;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 222, 1, 'DELETE IGNORE FROM ref_devicerole WHERE netboxid IS NOT NULL AND netboxid NOT IN (SELECT id FROM info_netbox_dcim_devicerole);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 223, 1, 'UPDATE IGNORE ref_devicerole AS ref INNER JOIN info_netbox_dcim_devicerole AS info ON ref.devicerole_alias=info.slug SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_devicerole WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 224, 1, 'UPDATE IGNORE ref_devicerole AS ref INNER JOIN info_netbox_dcim_devicerole AS info ON ref.devicerole=info.name SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_devicerole WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 225, 1, 'INSERT IGNORE INTO tmp_bigintauto(id) SELECT id FROM info_netbox_dcim_devicerole WHERE id NOT IN (SELECT netboxid FROM ref_devicerole WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 226, 1, 'INSERT IGNORE INTO tmp_bigintmap(id, mapidi) SELECT id, autoid FROM tmp_bigintauto;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 227, 1, 'UPDATE IGNORE tmp_bigintmap INNER JOIN (SELECT IFNULL(MAX(deviceroleid),0) AS mid FROM ref_devicerole) AS ref SET tmp_bigintmap.mapidi=tmp_bigintmap.mapidi+ref.mid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 228, 1, 'INSERT IGNORE INTO ref_devicerole (deviceroleid, netboxid, devicerole, devicerole_alias, description, vm_role) SELECT tmp_bigintmap.mapidi, info.id, info.name, info.slug, info.description, info.vm_role FROM info_netbox_dcim_devicerole AS info INNER JOIN tmp_bigintmap ON info.id=tmp_bigintmap.id WHERE info.id NOT IN (SELECT netboxid FROM ref_devicerole WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 229, 1, 'UPDATE IGNORE ref_devicerole AS ref INNER JOIN info_netbox_dcim_devicerole AS info ON ref.netboxid=info.id SET ref.devicerole=info.name, ref.devicerole_alias=info.slug, ref.description=info.description, ref.vm_role=info.vm_role;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 240, 1, 'TRUNCATE TABLE tmp_bigintauto;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 241, 1, 'TRUNCATE TABLE tmp_bigintmap;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 242, 1, 'DELETE IGNORE FROM ref_platform WHERE netboxid IS NOT NULL AND netboxid NOT IN (SELECT id FROM info_netbox_dcim_platform);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 243, 1, 'UPDATE IGNORE ref_platform AS ref INNER JOIN info_netbox_dcim_platform AS info ON ref.platform_alias=info.slug SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_platform WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 244, 1, 'UPDATE IGNORE ref_platform AS ref INNER JOIN info_netbox_dcim_platform AS info ON ref.platform=info.name SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_platform WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 245, 1, 'INSERT IGNORE INTO tmp_bigintauto(id) SELECT id FROM info_netbox_dcim_platform WHERE id NOT IN (SELECT netboxid FROM ref_platform WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 246, 1, 'INSERT IGNORE INTO tmp_bigintmap(id, mapidi) SELECT id, autoid FROM tmp_bigintauto;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 247, 1, 'UPDATE IGNORE tmp_bigintmap INNER JOIN (SELECT IFNULL(MAX(platformid),0) AS mid FROM ref_platform) AS ref SET tmp_bigintmap.mapidi=tmp_bigintmap.mapidi+ref.mid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 248, 1, 'INSERT IGNORE INTO ref_platform (platformid, netboxid, platform, platform_alias, description, manufacturerid) SELECT tmp_bigintmap.mapidi, info.id, info.name, info.slug, info.description, NULL FROM info_netbox_dcim_platform AS info INNER JOIN tmp_bigintmap ON info.id=tmp_bigintmap.id WHERE info.id NOT IN (SELECT netboxid FROM ref_platform WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 249, 1, 'UPDATE IGNORE ref_platform AS ref INNER JOIN info_netbox_dcim_platform AS info ON ref.netboxid=info.id SET ref.platform=info.name, ref.platform_alias=info.slug, ref.description=info.description;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 250, 1, 'UPDATE IGNORE ref_platform AS ref INNER JOIN info_netbox_dcim_platform AS info ON ref.netboxid=info.id INNER JOIN ref_manufacturer AS ref1 ON info.manufacturer_id=ref1.netboxid SET ref.manufacturerid=ref1.manufacturerid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 2, 251, 1, 'UPDATE IGNORE ref_platform AS ref INNER JOIN info_netbox_dcim_platform AS info ON ref.netboxid=info.id LEFT JOIN ref_manufacturer AS ref1 ON info.manufacturer_id=ref1.netboxid SET ref.manufacturerid=NULL WHERE ref.manufacturerid IS NOT NULL AND ref1.manufacturerid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 20, 1, 'TRUNCATE TABLE tmp_strid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 21, 1, 'TRUNCATE TABLE tmp_strmap;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 21, 1, 'TRUNCATE TABLE tmp_strauto;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 22, 1, 'INSERT IGNORE INTO tmp_strauto (id) SELECT DISTINCT role FROM info_netbox_ipam_ipaddress WHERE role IS NOT NULL AND LOWER(role) NOT IN (SELECT LOWER(ipaddress_role) FROM ref_ipaddress_role);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 23, 1, 'INSERT IGNORE INTO tmp_strmap (id, mapidi) SELECT id, autoid FROM tmp_strauto;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 24, 1, 'UPDATE IGNORE tmp_strmap INNER JOIN (SELECT IFNULL(MAX(ipaddress_roleid),0) AS mid FROM ref_ipaddress_role) AS ref SET tmp_strmap.mapidi=tmp_strmap.mapidi+ref.mid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 25, 1, 'INSERT IGNORE INTO ref_ipaddress_role (ipaddress_roleid, ipaddress_role) SELECT mapidi, id FROM tmp_strmap;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 40, 1, 'TRUNCATE TABLE tmp_bigintid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, tablename, parameter, query) VALUES (301, 3, 41, 1, 'info_netbox_ipam_vrf', 'netbox_filter', 'INSERT IGNORE INTO tmp_bigintid (id) SELECT id FROM info_netbox_ipam_vrf {0};');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 42, 1, 'DELETE IGNORE FROM ref_vrf WHERE netboxid IS NOT NULL AND netboxid NOT IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 43, 1, 'UPDATE IGNORE ref_vrf AS ref INNER JOIN info_netbox_ipam_vrf AS info ON ref.vrf=info.name SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_vrf WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 44, 1, 'INSERT IGNORE INTO ref_vrf (netboxid, vrf, description, tenantid, enforce_unique) SELECT id, name, description, NULL, enforce_unique FROM info_netbox_ipam_vrf WHERE id IN (SELECT id FROM tmp_bigintid) AND id NOT IN (SELECT netboxid FROM ref_vrf WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 45, 1, 'UPDATE IGNORE ref_vrf AS ref INNER JOIN info_netbox_ipam_vrf AS info ON ref.netboxid=info.id INNER JOIN ref_tenant AS ref1 ON info.tenant_id=ref1.tenantid SET ref.tenantid=ref1.tenantid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 46, 1, 'UPDATE IGNORE ref_vrf AS ref INNER JOIN info_netbox_ipam_vrf AS info ON ref.netboxid=info.id SET ref.vrf=info.name, ref.description=info.description, ref.enforce_unique=info.enforce_unique;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 60, 1, 'TRUNCATE TABLE tmp_bigintid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 61, 1, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT id FROM info_netbox_ipam_role;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 62, 1, 'DELETE IGNORE FROM ref_subnet_role WHERE netboxid IS NOT NULL AND netboxid NOT IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 63, 1, 'UPDATE IGNORE ref_subnet_role AS ref INNER JOIN info_netbox_ipam_role AS info ON ref.subnet_role_alias=info.slug SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_subnet_role WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 64, 1, 'UPDATE IGNORE ref_subnet_role AS ref INNER JOIN info_netbox_ipam_role AS info ON ref.subnet_role=info.name SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_subnet_role WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 65, 1, 'INSERT IGNORE INTO ref_subnet_role (netboxid, subnet_role, subnet_role_alias, description) SELECT id, name, slug, description FROM info_netbox_ipam_role WHERE id IN (SELECT id FROM tmp_bigintid) AND id NOT IN (SELECT netboxid FROM ref_subnet_role WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 66, 1, 'UPDATE IGNORE ref_subnet_role AS ref INNER JOIN info_netbox_ipam_role AS info ON ref.netboxid=info.id SET ref.subnet_role=info.name, ref.subnet_role_alias=info.slug, ref.description=info.description;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 80, 1, 'TRUNCATE TABLE tmp_bigintid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 81, 1, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT id FROM info_netbox_ipam_vlangroup WHERE scope_id IS NULL OR (scope_type IS NOT NULL AND scope_type=\'dcim.site\' AND scope_id IN (SELECT netboxid FROM ref_site WHERE netboxid IS NOT NULL));');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 82, 1, 'DELETE IGNORE FROM ref_vlangroup WHERE netboxid IS NOT NULL AND netboxid NOT IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 83, 1, 'UPDATE IGNORE ref_vlangroup AS ref INNER JOIN info_netbox_ipam_vlangroup AS info ON ref.vlangroup_alias=info.slug SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_vlangroup WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 84, 1, 'UPDATE IGNORE ref_vlangroup AS ref INNER JOIN info_netbox_ipam_vlangroup AS info ON ref.vlangroup=info.name SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_vlangroup WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 85, 1, 'INSERT IGNORE INTO ref_vlangroup (netboxid, vlangroup, vlangroup_alias, description, siteid) SELECT id, name, slug, description, 0 FROM info_netbox_ipam_vlangroup WHERE id IN (SELECT id FROM tmp_bigintid) AND id NOT IN (SELECT netboxid FROM ref_vlangroup WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 86, 1, 'UPDATE IGNORE ref_vlangroup AS ref INNER JOIN info_netbox_ipam_vlangroup AS info ON ref.netboxid=info.id INNER JOIN ref_site AS ref1 ON info.scope_id=ref1.netboxid AND info.scope_type=\'dcim.site\' SET ref.siteid=ref1.siteid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 87, 1, 'UPDATE IGNORE ref_vlangroup AS ref INNER JOIN info_netbox_ipam_vlangroup AS info ON ref.netboxid=info.id LEFT JOIN ref_site AS ref1 ON info.scope_id=ref1.netboxid AND info.scope_type=\'dcim.site\' SET ref.siteid=0 WHERE ref1.siteid=0;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 88, 1, 'UPDATE IGNORE ref_vlangroup AS ref INNER JOIN info_netbox_ipam_vlangroup AS info ON ref.netboxid=info.id SET ref.vlangroup=info.name, ref.vlangroup_alias=info.slug, ref.description=info.description;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 100, 1, 'TRUNCATE TABLE tmp_bigintid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 101, 1, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT id FROM info_netbox_ipam_vlan WHERE (site_id IS NULL OR site_id IN (SELECT netboxid FROM ref_site WHERE netboxid IS NOT NULL)) AND (tenant_id IS NULL OR tenant_id IN (SELECT netboxid FROM ref_tenant WHERE netboxid IS NOT NULL));');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 102, 1, 'DELETE IGNORE FROM ref_vlan WHERE netboxid IS NOT NULL AND netboxid NOT IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 103, 1, 'UPDATE IGNORE ref_vlan AS ref INNER JOIN ref_site ON ref.siteid=ref_site.siteid INNER JOIN info_netbox_ipam_vlan AS info ON ref.vid=info.vid AND info.site_id=ref_site.netboxid SET ref.netboxid=info.id WHERE ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_vlan WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid) AND ref_site.netboxid IS NOT NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 105, 1, 'INSERT IGNORE INTO ref_vlan (netboxid, vlan, description, siteid, groupid, vid, tenantid, roleid, active) SELECT id, name, description, NULL, NULL, vid, NULL, NULL, IF(LOWER(info_netbox_ipam_vlan.status) IN (\'active\'), TRUE, FALSE) FROM info_netbox_ipam_vlan WHERE id IN (SELECT id FROM tmp_bigintid) AND id NOT IN (SELECT netboxid FROM ref_vlan WHERE netboxid IS NOT NULL);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 106, 1, 'UPDATE IGNORE ref_vlan AS ref INNER JOIN info_netbox_ipam_vlan AS info ON ref.netboxid=info.id INNER JOIN ref_site AS ref1 ON info.site_id=ref1.netboxid SET ref.siteid=ref1.siteid WHERE ref1.netboxid IS NOT NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 107, 1, 'UPDATE IGNORE ref_vlan AS ref INNER JOIN info_netbox_ipam_vlan AS info ON ref.netboxid=info.id INNER JOIN ref_vlangroup AS ref1 ON info.group_id=ref1.netboxid SET ref.groupid=ref1.vlangroupid WHERE ref1.netboxid IS NOT NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 108, 1, 'UPDATE IGNORE ref_vlan AS ref INNER JOIN info_netbox_ipam_vlan AS info ON ref.netboxid=info.id INNER JOIN ref_tenant AS ref1 ON info.tenant_id=ref1.netboxid SET ref.tenantid=ref1.tenantid WHERE ref1.netboxid IS NOT NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 109, 1, 'UPDATE IGNORE ref_vlan AS ref INNER JOIN info_netbox_ipam_vlan AS info ON ref.netboxid=info.id INNER JOIN ref_subnet_role AS ref1 ON info.role_id=ref1.netboxid SET ref.roleid=ref1.subnet_roleid WHERE ref1.netboxid IS NOT NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 110, 1, 'UPDATE IGNORE ref_vlan AS ref INNER JOIN info_netbox_ipam_vlan AS info ON ref.netboxid=info.id LEFT JOIN ref_site AS ref1 ON info.site_id=ref1.netboxid SET ref.siteid=NULL WHERE ref1.siteid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 111, 1, 'UPDATE IGNORE ref_vlan AS ref INNER JOIN info_netbox_ipam_vlan AS info ON ref.netboxid=info.id LEFT JOIN ref_vlangroup AS ref1 ON info.group_id=ref1.netboxid SET ref.groupid=NULL WHERE ref1.vlangroupid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 112, 1, 'UPDATE IGNORE ref_vlan AS ref INNER JOIN info_netbox_ipam_vlan AS info ON ref.netboxid=info.id LEFT JOIN ref_tenant AS ref1 ON info.tenant_id=ref1.netboxid SET ref.tenantid=NULL WHERE ref1.tenantid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 113, 1, 'UPDATE IGNORE ref_vlan AS ref INNER JOIN info_netbox_ipam_vlan AS info ON ref.netboxid=info.id LEFT JOIN ref_subnet_role AS ref1 ON info.role_id=ref1.netboxid SET ref.roleid=NULL WHERE ref1.subnet_roleid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 114, 1, 'UPDATE IGNORE ref_vlan AS ref INNER JOIN info_netbox_ipam_vlan AS info ON ref.netboxid=info.id SET ref.vlan=info.name, ref.description=info.description, ref.vid=info.vid, ref.active=IF(LOWER(info.status) IN (\'active\'), TRUE, FALSE);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 130, 1, 'TRUNCATE TABLE tmp_bigintid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 131, 1, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT id FROM info_netbox_ipam_prefix WHERE (site_id IS NULL OR site_id IN (SELECT netboxid FROM ref_site WHERE netboxid IS NOT NULL)) AND (vrf_id IS NULL OR vrf_id IN (SELECT netboxid FROM ref_vrf WHERE netboxid IS NOT NULL)) AND (tenant_id IS NULL OR tenant_id IN (SELECT netboxid FROM ref_tenant WHERE netboxid IS NOT NULL)) AND (vlan_id IS NULL OR vlan_id IN (SELECT netboxid FROM ref_vlan WHERE netboxid IS NOT NULL));');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 132, 1, 'DELETE IGNORE FROM ref_ipprefix WHERE netboxid IS NOT NULL AND netboxid NOT IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 133, 1, 'UPDATE IGNORE ref_ipprefix AS ref INNER JOIN info_netbox_ipam_prefix AS info ON ref.prefix=info.prefix SET ref.netboxid=info.id WHERE ref.vrfid=0 AND info.vrf_id IS NULL AND ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_ipprefix WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 134, 1, 'UPDATE IGNORE ref_ipprefix AS ref INNER JOIN ref_vrf ON ref.vrfid=ref_vrf.vrfid INNER JOIN info_netbox_ipam_prefix AS info ON ref.prefix=info.prefix AND ref_vrf.netboxid=info.vrf_id SET ref.netboxid=info.id WHERE ref_vrf.netboxid IS NOT NULL AND info.vrf_id IS NOT NULL AND ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_ipprefix WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 135, 1, 'INSERT IGNORE INTO ref_ipprefix (netboxid, description, familyid, prefix, siteid, vrfid, tenantid, vlanid, roleid, active, is_pool, netnum, startip, endip, startipnum, endipnum) SELECT info.id, info.description, ref_ipfamily.familyid, info.prefix, IFNULL(ref_site.siteid, 0), IFNULL(ref_vrf.vrfid,0), ref_tenant.tenantid, ref_vlan.vlanid, ref_subnet_role.subnet_roleid, IF(LOWER(info.status) IN (\'active\'), TRUE, FALSE), info.is_pool, REGEXP_REPLACE(info.prefix, \'^(.+)/(.+)$\', \'\\\\2\') AS netnum, REGEXP_REPLACE(info.prefix, \'^(.+)/.+$\', \'\\\\1\') AS startip, INET_NTOA(INET_ATON(REGEXP_REPLACE(info.prefix, \'^(.+)/.+$\', \'\\\\1\'))+POWER(2, 32-REGEXP_REPLACE(info.prefix, \'^(.+)/(.+)$\', \'\\\\2\'))-1) AS endip, INET_ATON(REGEXP_REPLACE(info.prefix, \'^(.+)/.+$\', \'\\\\1\')) AS startipnum, INET_ATON(REGEXP_REPLACE(info.prefix, \'^(.+)/.+$\', \'\\\\1\'))+POWER(2, 32-REGEXP_REPLACE(info.prefix, \'^(.+)/(.+)$\', \'\\\\2\'))-1 AS endipnum FROM info_netbox_ipam_prefix AS info INNER JOIN ref_ipfamily ON LOWER(info.family)=LOWER(ref_ipfamily.family) LEFT JOIN ref_site ON info.site_id=ref_site.netboxid LEFT JOIN ref_vrf ON info.vrf_id=ref_vrf.netboxid LEFT JOIN ref_tenant ON info.tenant_id=ref_tenant.netboxid LEFT JOIN ref_vlan ON info.vlan_id=ref_vlan.netboxid LEFT JOIN ref_subnet_role ON info.role_id=ref_subnet_role.netboxid WHERE info.id IN (SELECT id FROM tmp_bigintid) AND info.id NOT IN (SELECT netboxid FROM ref_ipprefix WHERE netboxid IS NOT NULL) AND ref_ipfamily.familyid=1;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 136, 1, 'UPDATE IGNORE ref_ipprefix AS ref INNER JOIN info_netbox_ipam_prefix AS info ON ref.netboxid=info.id INNER JOIN ref_site AS ref1 ON info.site_id=ref1.netboxid SET ref.siteid=ref1.siteid WHERE ref1.netboxid IS NOT NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 137, 1, 'UPDATE IGNORE ref_ipprefix AS ref INNER JOIN info_netbox_ipam_prefix AS info ON ref.netboxid=info.id INNER JOIN ref_vrf AS ref1 ON info.vrf_id=ref1.netboxid SET ref.vrfid=ref1.vrfid WHERE ref1.netboxid IS NOT NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 138, 1, 'UPDATE IGNORE ref_ipprefix AS ref INNER JOIN info_netbox_ipam_prefix AS info ON ref.netboxid=info.id INNER JOIN ref_tenant AS ref1 ON info.tenant_id=ref1.netboxid SET ref.tenantid=ref1.tenantid WHERE ref1.netboxid IS NOT NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 139, 1, 'UPDATE IGNORE ref_ipprefix AS ref INNER JOIN info_netbox_ipam_prefix AS info ON ref.netboxid=info.id INNER JOIN ref_vlan AS ref1 ON info.vlan_id=ref1.netboxid SET ref.vlanid=ref1.vlanid WHERE ref1.netboxid IS NOT NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 140, 1, 'UPDATE IGNORE ref_ipprefix AS ref INNER JOIN info_netbox_ipam_prefix AS info ON ref.netboxid=info.id INNER JOIN ref_subnet_role AS ref1 ON info.role_id=ref1.netboxid SET ref.roleid=ref1.subnet_roleid WHERE ref1.netboxid IS NOT NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 141, 1, 'UPDATE IGNORE ref_ipprefix AS ref INNER JOIN info_netbox_ipam_prefix AS info ON ref.netboxid=info.id LEFT JOIN ref_site AS ref1 ON info.site_id=ref1.netboxid SET ref.siteid=0 WHERE ref1.siteid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 142, 1, 'UPDATE IGNORE ref_ipprefix AS ref INNER JOIN info_netbox_ipam_prefix AS info ON ref.netboxid=info.id LEFT JOIN ref_vrf AS ref1 ON info.vrf_id=ref1.netboxid SET ref.vrfid=0 WHERE ref1.vrfid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 143, 1, 'UPDATE IGNORE ref_ipprefix AS ref INNER JOIN info_netbox_ipam_prefix AS info ON ref.netboxid=info.id LEFT JOIN ref_tenant AS ref1 ON info.tenant_id=ref1.netboxid SET ref.tenantid=NULL WHERE ref1.tenantid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 144, 1, 'UPDATE IGNORE ref_ipprefix AS ref INNER JOIN info_netbox_ipam_prefix AS info ON ref.netboxid=info.id LEFT JOIN ref_vlan AS ref1 ON info.vlan_id=ref1.netboxid SET ref.vlanid=NULL WHERE ref1.vlanid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 145, 1, 'UPDATE IGNORE ref_ipprefix AS ref INNER JOIN info_netbox_ipam_prefix AS info ON ref.netboxid=info.id LEFT JOIN ref_subnet_role AS ref1 ON info.role_id=ref1.netboxid SET ref.roleid=NULL WHERE ref1.subnet_roleid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 146, 1, 'UPDATE IGNORE ref_ipprefix AS ref INNER JOIN info_netbox_ipam_prefix AS info ON ref.netboxid=info.id SET ref.description=info.description, ref.prefix=info.prefix, ref.active=IF(LOWER(info.status) IN (\'active\'), TRUE, FALSE), ref.is_pool=info.is_pool, ref.netnum=REGEXP_REPLACE(info.prefix, \'^(.+)/(.+)$\', \'\\\\2\'), ref.startip=REGEXP_REPLACE(info.prefix, \'^(.+)/.+$\', \'\\\\1\'), ref.endip=INET_NTOA(INET_ATON(REGEXP_REPLACE(info.prefix, \'^(.+)/.+$\', \'\\\\1\'))+POWER(2, 32-REGEXP_REPLACE(info.prefix, \'^(.+)/(.+)$\', \'\\\\2\'))-1), ref.startipnum=INET_ATON(REGEXP_REPLACE(info.prefix, \'^(.+)/.+$\', \'\\\\1\')), ref.endipnum=INET_ATON(REGEXP_REPLACE(info.prefix, \'^(.+)/.+$\', \'\\\\1\'))+POWER(2, 32-REGEXP_REPLACE(info.prefix, \'^(.+)/(.+)$\', \'\\\\2\'))-1;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 160, 1, 'TRUNCATE TABLE tmp_bigintid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 161, 1, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT id FROM info_netbox_ipam_iprange WHERE (vrf_id IS NULL OR vrf_id IN (SELECT netboxid FROM ref_vrf WHERE netboxid IS NOT NULL)) AND (tenant_id IS NULL OR tenant_id IN (SELECT netboxid FROM ref_tenant WHERE netboxid IS NOT NULL));');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 162, 1, 'DELETE IGNORE FROM ref_iprange WHERE netboxid IS NOT NULL AND netboxid NOT IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 163, 1, 'UPDATE IGNORE ref_iprange AS ref INNER JOIN info_netbox_ipam_iprange AS info ON ref.start_address=info.start_address AND ref.end_address=info.end_address SET ref.netboxid=info.id WHERE ref.vrfid=0 AND info.vrf_id IS NULL AND ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_iprange WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 164, 1, 'UPDATE IGNORE ref_iprange AS ref INNER JOIN ref_vrf ON ref.vrfid=ref_vrf.vrfid INNER JOIN info_netbox_ipam_iprange AS info ON ref.start_address=info.start_address AND ref.end_address=info.end_address AND ref_vrf.netboxid=info.vrf_id SET ref.netboxid=info.id WHERE ref_vrf.netboxid IS NOT NULL AND info.vrf_id IS NOT NULL AND ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_iprange WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 165, 1, 'INSERT IGNORE INTO ref_iprange (netboxid, description, familyid, start_address, end_address, netnum, startip, endip, startipnum, endipnum, size, active, vrfid, tenantid, roleid) SELECT info.id, info.description, ref_ipfamily.familyid, info.start_address, info.end_address, REGEXP_REPLACE(info.start_address, \'^(.+)/(.+)$\', \'\\\\2\') AS netnum, REGEXP_REPLACE(info.start_address, \'^(.+)/.+$\', \'\\\\1\') AS startip, INET_NTOA(INET_ATON(REGEXP_REPLACE(info.start_address, \'^(.+)/.+$\', \'\\\\1\'))+POWER(2, 32-REGEXP_REPLACE(info.start_address, \'^(.+)/(.+)$\', \'\\\\2\'))-1) AS endip, INET_ATON(REGEXP_REPLACE(info.start_address, \'^(.+)/.+$\', \'\\\\1\')) AS startipnum, INET_ATON(REGEXP_REPLACE(info.start_address, \'^(.+)/.+$\', \'\\\\1\'))+POWER(2, 32-REGEXP_REPLACE(info.start_address, \'^(.+)/(.+)$\', \'\\\\2\'))-1 AS endipnum, info.size, IF(LOWER(info.status) IN (\'active\'), TRUE, FALSE) AS active, IFNULL(ref_vrf.vrfid,0), ref_tenant.tenantid, ref_subnet_role.subnet_roleid FROM info_netbox_ipam_iprange AS info INNER JOIN ref_ipfamily ON LOWER(info.family)=LOWER(ref_ipfamily.family) LEFT JOIN ref_vrf ON info.vrf_id=ref_vrf.netboxid LEFT JOIN ref_tenant ON info.tenant_id=ref_tenant.netboxid LEFT JOIN ref_subnet_role ON info.role_id=ref_subnet_role.netboxid WHERE info.id IN (SELECT id FROM tmp_bigintid) AND info.id NOT IN (SELECT netboxid FROM ref_iprange WHERE netboxid IS NOT NULL) AND ref_ipfamily.familyid=1;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 166, 1, 'UPDATE IGNORE ref_iprange AS ref INNER JOIN info_netbox_ipam_iprange AS info ON ref.netboxid=info.id INNER JOIN ref_vrf AS ref1 ON info.vrf_id=ref1.netboxid SET ref.vrfid=ref1.vrfid WHERE ref1.netboxid IS NOT NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 167, 1, 'UPDATE IGNORE ref_iprange AS ref INNER JOIN info_netbox_ipam_iprange AS info ON ref.netboxid=info.id INNER JOIN ref_tenant AS ref1 ON info.tenant_id=ref1.netboxid SET ref.tenantid=ref1.tenantid WHERE ref1.netboxid IS NOT NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 168, 1, 'UPDATE IGNORE ref_iprange AS ref INNER JOIN info_netbox_ipam_iprange AS info ON ref.netboxid=info.id INNER JOIN ref_subnet_role AS ref1 ON info.role_id=ref1.netboxid SET ref.roleid=ref1.subnet_roleid WHERE ref1.netboxid IS NOT NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 169, 1, 'UPDATE IGNORE ref_iprange AS ref INNER JOIN info_netbox_ipam_iprange AS info ON ref.netboxid=info.id LEFT JOIN ref_vrf AS ref1 ON info.vrf_id=ref1.netboxid SET ref.vrfid=0 WHERE ref1.vrfid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 170, 1, 'UPDATE IGNORE ref_iprange AS ref INNER JOIN info_netbox_ipam_iprange AS info ON ref.netboxid=info.id LEFT JOIN ref_tenant AS ref1 ON info.tenant_id=ref1.netboxid SET ref.tenantid=NULL WHERE ref1.tenantid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 171, 1, 'UPDATE IGNORE ref_iprange AS ref INNER JOIN info_netbox_ipam_iprange AS info ON ref.netboxid=info.id LEFT JOIN ref_subnet_role AS ref1 ON info.role_id=ref1.netboxid SET ref.roleid=NULL WHERE ref1.subnet_roleid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 172, 1, 'UPDATE IGNORE ref_iprange AS ref INNER JOIN info_netbox_ipam_iprange AS info ON ref.netboxid=info.id SET ref.description=info.description, ref.start_address=info.start_address, ref.end_address=info.end_address, ref.size=info.size, ref.active=IF(LOWER(info.status) IN (\'active\'), TRUE, FALSE), ref.netnum=REGEXP_REPLACE(info.start_address, \'^(.+)/(.+)$\', \'\\\\2\'), ref.startip=REGEXP_REPLACE(info.start_address, \'^(.+)/.+$\', \'\\\\1\'), ref.endip=INET_NTOA(INET_ATON(REGEXP_REPLACE(info.start_address, \'^(.+)/.+$\', \'\\\\1\'))+POWER(2, 32-REGEXP_REPLACE(info.start_address, \'^(.+)/(.+)$\', \'\\\\2\'))-1), ref.startipnum=INET_ATON(REGEXP_REPLACE(info.start_address, \'^(.+)/.+$\', \'\\\\1\')), ref.endipnum=INET_ATON(REGEXP_REPLACE(info.start_address, \'^(.+)/.+$\', \'\\\\1\'))+POWER(2, 32-REGEXP_REPLACE(info.start_address, \'^(.+)/(.+)$\', \'\\\\2\'))-1;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 190, 1, 'TRUNCATE TABLE tmp_bigintid;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 191, 1, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT id FROM info_netbox_ipam_ipaddress WHERE (vrf_id IS NULL OR vrf_id IN (SELECT netboxid FROM ref_vrf WHERE netboxid IS NOT NULL)) AND (tenant_id IS NULL OR tenant_id IN (SELECT netboxid FROM ref_tenant WHERE netboxid IS NOT NULL));');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 192, 1, 'DELETE IGNORE FROM ref_ipaddress WHERE netboxid IS NOT NULL AND netboxid NOT IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 193, 1, 'UPDATE IGNORE ref_ipaddress AS ref INNER JOIN info_netbox_ipam_ipaddress AS info ON ref.address=info.address SET ref.netboxid=info.id WHERE ref.vrfid=0 AND info.vrf_id IS NULL AND ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_ipaddress WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 194, 1, 'UPDATE IGNORE ref_ipaddress AS ref INNER JOIN ref_vrf ON ref.vrfid=ref_vrf.vrfid INNER JOIN info_netbox_ipam_ipaddress AS info ON ref.address=info.address AND ref_vrf.netboxid=info.vrf_id SET ref.netboxid=info.id WHERE ref_vrf.netboxid IS NOT NULL AND info.vrf_id IS NOT NULL AND ref.netboxid IS NULL AND info.id NOT IN (SELECT netboxid FROM ref_ipaddress WHERE netboxid IS NOT NULL) AND info.id IN (SELECT id FROM tmp_bigintid);');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 195, 1, 'INSERT IGNORE INTO ref_ipaddress (netboxid, description, familyid, address, netnum, ip, ipnum, active, vrfid, tenantid, iproleid) SELECT info.id, info.description, ref_ipfamily.familyid, info.address, REGEXP_REPLACE(info.address, \'^(.+)/(.+)$\', \'\\\\2\') AS netnum, REGEXP_REPLACE(info.address, \'^(.+)/.+$\', \'\\\\1\') AS ip, INET_ATON(REGEXP_REPLACE(info.address, \'^(.+)/.+$\', \'\\\\1\')) AS ipnum, IF(LOWER(info.status) IN (\'active\'), TRUE, FALSE) AS active, IFNULL(ref_vrf.vrfid,0), ref_tenant.tenantid, ref_ipaddress_role.ipaddress_roleid FROM info_netbox_ipam_ipaddress AS info INNER JOIN ref_ipfamily ON LOWER(info.family)=LOWER(ref_ipfamily.family) LEFT JOIN ref_vrf ON info.vrf_id=ref_vrf.netboxid LEFT JOIN ref_tenant ON info.tenant_id=ref_tenant.netboxid LEFT JOIN ref_ipaddress_role ON info.role IS NOT NULL AND LOWER(info.role)=LOWER(ref_ipaddress_role.ipaddress_role) WHERE info.id IN (SELECT id FROM tmp_bigintid) AND info.id NOT IN (SELECT netboxid FROM ref_ipaddress WHERE netboxid IS NOT NULL) AND ref_ipfamily.familyid=1;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 196, 1, 'UPDATE IGNORE ref_ipaddress AS ref INNER JOIN info_netbox_ipam_ipaddress AS info ON ref.netboxid=info.id INNER JOIN ref_vrf AS ref1 ON info.vrf_id=ref1.netboxid SET ref.vrfid=ref1.vrfid WHERE ref1.netboxid IS NOT NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 197, 1, 'UPDATE IGNORE ref_ipaddress AS ref INNER JOIN info_netbox_ipam_ipaddress AS info ON ref.netboxid=info.id INNER JOIN ref_tenant AS ref1 ON info.tenant_id=ref1.netboxid SET ref.tenantid=ref1.tenantid WHERE ref1.netboxid IS NOT NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 198, 1, 'UPDATE IGNORE ref_ipaddress AS ref INNER JOIN info_netbox_ipam_ipaddress AS info ON ref.netboxid=info.id INNER JOIN ref_ipaddress_role AS ref1 ON info.role IS NOT NULL AND LOWER(info.role)=LOWER(ref1.ipaddress_role) SET ref.iproleid=ref1.ipaddress_roleid WHERE ref1.ipaddress_roleid IS NOT NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 199, 1, 'UPDATE IGNORE ref_ipaddress AS ref INNER JOIN info_netbox_ipam_ipaddress AS info ON ref.netboxid=info.id LEFT JOIN ref_vrf AS ref1 ON info.vrf_id=ref1.netboxid SET ref.vrfid=0 WHERE ref1.vrfid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 200, 1, 'UPDATE IGNORE ref_ipaddress AS ref INNER JOIN info_netbox_ipam_ipaddress AS info ON ref.netboxid=info.id LEFT JOIN ref_tenant AS ref1 ON info.tenant_id=ref1.netboxid SET ref.tenantid=NULL WHERE ref1.tenantid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 201, 1, 'UPDATE IGNORE ref_ipaddress AS ref INNER JOIN info_netbox_ipam_ipaddress AS info ON ref.netboxid=info.id LEFT JOIN ref_ipaddress_role AS ref1 ON info.role IS NOT NULL AND LOWER(info.role)=LOWER(ref1.ipaddress_role) SET ref.iproleid=NULL WHERE ref1.ipaddress_roleid IS NULL;');
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (301, 3, 202, 1, 'UPDATE IGNORE ref_ipaddress AS ref INNER JOIN info_netbox_ipam_ipaddress AS info ON ref.netboxid=info.id SET ref.description=info.description, ref.address=info.address, ref.active=IF(LOWER(info.status) IN (\'active\'), TRUE, FALSE), ref.netnum=REGEXP_REPLACE(info.address, \'^(.+)/(.+)$\', \'\\\\2\'), ref.ip=REGEXP_REPLACE(info.address, \'^(.+)/.+$\', \'\\\\1\'), ref.ipnum=INET_ATON(REGEXP_REPLACE(info.address, \'^(.+)/.+$\', \'\\\\1\'));');

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (403, 1, 10, 'TRUNCATE TABLE raw_scan_ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (403, 1, 11, 'TRUNCATE TABLE raw_scan_ip_info;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (403, 1, 12, 'TRUNCATE TABLE raw_scan_arp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (403, 1, 13, 'TRUNCATE TABLE raw_scan_dhcp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (403, 1, 14, 'TRUNCATE TABLE raw_scan_port;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (403, 1, 15, 'TRUNCATE TABLE raw_scan_script;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (403, 1, 16, 'TRUNCATE TABLE raw_scan_service;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (403, 1, 17, 'TRUNCATE TABLE raw_scan_osportused;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (403, 1, 18, 'TRUNCATE TABLE raw_scan_osmatch;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (403, 1, 19, 'TRUNCATE TABLE raw_scan_osclass;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (403, 1, 20, 'TRUNCATE TABLE raw_snmp RESTART IDENTITY;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (403, 2, 10, 'INSERT IGNORE INTO raw_scan_ip (ip, refid, sourceid) SELECT raw_enplug.internalipaddress, rip2.ipprefixid, 1 AS sourceid FROM raw_enplug INNER JOIN ref_ipprefix AS rip1 ON INET_ATON(raw_enplug.ipaddress) BETWEEN rip1.startipnum AND rip1.endipnum INNER JOIN ref_ipprefix AS rip2 ON INET_ATON(raw_enplug.internalipaddress) BETWEEN rip2.startipnum AND rip2.endipnum WHERE UPPER(raw_enplug.statuscode) IN (\'OK\', \'ERROR\') AND raw_enplug.ipaddress IS NOT NULL AND raw_enplug.internalipaddress IS NOT NULL AND raw_enplug.ipaddress LIKE \'%.%.%.%\' AND raw_enplug.internalipaddress LIKE \'%.%.%.%\' AND raw_enplug.internalipaddress NOT IN (SELECT ip FROM raw_scan_ip) AND rip2.ipprefixid IN (SELECT refid FROM raw_scan_ip WHERE sourceid=1) AND rip1.siteid=rip2.siteid AND rip1.siteid<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (403, 2, 11, 'INSERT IGNORE INTO raw_scan_ip (ip, refid, sourceid) SELECT raw_activaire.internalipaddress, rip2.ipprefixid, 1 AS sourceid FROM raw_activaire INNER JOIN ref_ipprefix AS rip1 ON INET_ATON(raw_activaire.publicipaddress) BETWEEN rip1.startipnum AND rip1.endipnum INNER JOIN ref_ipprefix AS rip2 ON INET_ATON(raw_activaire.internalipaddress) BETWEEN rip2.startipnum AND rip2.endipnum WHERE UPPER(raw_activaire.devicestatus) IN (\'ACTIVE\') AND raw_activaire.publicipaddress IS NOT NULL AND raw_activaire.internalipaddress IS NOT NULL AND raw_activaire.publicipaddress LIKE \'%.%.%.%\' AND raw_activaire.internalipaddress LIKE \'%.%.%.%\' AND raw_activaire.internalipaddress NOT IN (SELECT ip FROM raw_scan_ip) AND rip2.ipprefixid IN (SELECT refid FROM raw_scan_ip WHERE sourceid=1) AND rip1.siteid=rip2.siteid AND rip1.siteid<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (403, 2, 12, 'INSERT IGNORE INTO raw_scan_ip (ip, refid, sourceid) SELECT raw_mist.ip, rip2.ipprefixid, 1 AS sourceid FROM raw_mist INNER JOIN ref_ipprefix AS rip1 ON INET_ATON(raw_mist.ext_ip) BETWEEN rip1.startipnum AND rip1.endipnum INNER JOIN ref_ipprefix AS rip2 ON INET_ATON(raw_mist.ip) BETWEEN rip2.startipnum AND rip2.endipnum WHERE UPPER(raw_mist.status) IN (\'CONNECTED\') AND raw_mist.ext_ip IS NOT NULL AND raw_mist.ip IS NOT NULL AND raw_mist.ext_ip LIKE \'%.%.%.%\' AND raw_mist.ip LIKE \'%.%.%.%\' AND raw_mist.ip NOT IN (SELECT ip FROM raw_scan_ip) AND rip2.ipprefixid IN (SELECT refid FROM raw_scan_ip WHERE sourceid=1) AND rip1.siteid=rip2.siteid AND rip1.siteid<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (403, 2, 13, 'INSERT IGNORE INTO raw_scan_ip (ip, refid, sourceid) SELECT ref_static_device.ip, ref_static_device.deviceid, ref_ipaddress_source.sourceid FROM ref_static_device INNER JOIN ref_ipaddress_source ON ref_ipaddress_source.tablename=\'ref_static_device\' WHERE ref_static_device.ip NOT IN (SELECT ip FROM raw_scan_ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (403, 3, 10, 'INSERT IGNORE INTO raw_scan_ip_info (ipid, infoid, value) SELECT raw_scan_ip.ipid, ref_scan_ip_info.infoid, ref_static_device.snmp_community FROM raw_scan_ip INNER JOIN ref_static_device ON raw_scan_ip.ip=ref_static_device.ip INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'snmp_community\' WHERE ref_static_device.snmp_community IS NOT NULL AND (raw_scan_ip.ipid, ref_scan_ip_info.infoid) NOT IN (SELECT ipid, infoid FROM raw_scan_ip_info);', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (404, 1, 10, 'TRUNCATE TABLE raw_scan_port;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (404, 1, 11, 'TRUNCATE TABLE raw_scan_script;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (404, 1, 12, 'TRUNCATE TABLE raw_scan_service;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (404, 1, 13, 'TRUNCATE TABLE raw_scan_osportused;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (404, 1, 14, 'TRUNCATE TABLE raw_scan_osmatch;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (404, 1, 15, 'TRUNCATE TABLE raw_scan_osclass;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (405, 1, 10, 'TRUNCATE TABLE raw_enplug;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (406, 1, 10, 'TRUNCATE TABLE raw_activaire;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (406, 2, 10, 'UPDATE raw_activaire SET isplaying=\'1\' WHERE UPPER(isplaying)=\'TRUE\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (406, 2, 11, 'UPDATE raw_activaire SET isplaying=\'0\' WHERE isplaying<>\'1\';', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (407, 1, 10, 'TRUNCATE TABLE raw_snmp;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (408, 1, 10, 'TRUNCATE TABLE raw_mist;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (501, 1, 10, 'CREATE TEMPORARY TABLE tmp_src_enplug_venue (venueid VARCHAR(256) NOT NULL PRIMARY KEY, venuename VARCHAR(256) DEFAULT NULL, venue_timezone VARCHAR(100) DEFAULT NULL) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (501, 1, 11, 'CREATE TEMPORARY TABLE tmp_src_enplug_edu (eduid VARCHAR(256) NOT NULL PRIMARY KEY, venueid VARCHAR(256) NOT NULL, eduname VARCHAR(256) DEFAULT NULL, mac_eth VARCHAR(12) DEFAULT NULL, mac_wifi VARCHAR(12) DEFAULT NULL, ip VARCHAR(39) DEFAULT NULL, ip_public VARCHAR(39) DEFAULT NULL, status_code VARCHAR(20) DEFAULT NULL, status_message VARCHAR(1024) DEFAULT NULL, tvstatus VARCHAR(100) DEFAULT NULL, player_version VARCHAR(20) DEFAULT NULL, player_uptime INT DEFAULT NULL, last_player_heartbeat DATETIME DEFAULT NULL, KEY venueid (venueid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (501, 2, 10, 'TRUNCATE TABLE tmp_src_enplug_venue;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (501, 2, 11, 'TRUNCATE TABLE tmp_src_enplug_edu;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (501, 2, 20, 'INSERT IGNORE INTO tmp_src_enplug_edu (eduid, venueid) SELECT DISTINCT raw_enplug.edu_id, raw_enplug.venue_id FROM raw_enplug INNER JOIN ref_ipprefix AS rip1 ON INET_ATON(raw_enplug.ipaddress) BETWEEN rip1.startipnum AND rip1.endipnum INNER JOIN ref_ipprefix AS rip2 ON INET_ATON(raw_enplug.internalipaddress) BETWEEN rip2.startipnum AND rip2.endipnum WHERE raw_enplug.ipaddress IS NOT NULL AND raw_enplug.internalipaddress IS NOT NULL AND raw_enplug.ipaddress LIKE \'%.%.%.%\' AND raw_enplug.internalipaddress LIKE \'%.%.%.%\' AND rip1.siteid=rip2.siteid AND rip1.siteid<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (501, 2, 21, 'INSERT IGNORE INTO tmp_src_enplug_venue (venueid, venuename, venue_timezone) SELECT DISTINCT venue_id, venue_name, venue_timezone FROM raw_enplug WHERE venue_id IN (SELECT venueid FROM tmp_src_enplug_edu);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (501, 2, 30, 'UPDATE IGNORE tmp_src_enplug_edu AS tedu INNER JOIN raw_enplug AS edu ON tedu.eduid=edu.edu_id SET tedu.eduname=edu.edu_name, tedu.mac_eth=IF(edu.macaddressethernet IS NULL, NULL, REPLACE(edu.macaddressethernet, \':\', \'\')), tedu.mac_wifi=IF(edu.macaddresswifi IS NULL, NULL, REPLACE(edu.macaddresswifi, \':\', \'\')), tedu.ip=edu.internalipaddress, tedu.ip_public=edu.ipaddress, tedu.status_code=edu.statuscode, tedu.status_message=edu.statusmessage, tedu.tvstatus=edu.tvstatus, tedu.player_version=edu.playerversion, tedu.player_uptime=edu.playeruptime, tedu.last_player_heartbeat=IF(edu.lastplayerheartbeat IS NULL, NULL, FROM_UNIXTIME(CAST(SUBSTRING(edu.lastplayerheartbeat, 7, LENGTH(edu.lastplayerheartbeat)-11) AS INT)));', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (501, 2, 31, 'DELETE IGNORE FROM tmp_src_enplug_edu WHERE eduname IS NULL OR status_code IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (501, 2, 40, 'INSERT IGNORE INTO src_enplug_venue (venueid, venuename, venue_timezone) SELECT venueid, venuename, venue_timezone FROM tmp_src_enplug_venue WHERE venueid NOT IN (SELECT venueid FROM src_enplug_venue);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (501, 2, 41, 'UPDATE IGNORE src_enplug_venue INNER JOIN tmp_src_enplug_venue ON src_enplug_venue.venueid=tmp_src_enplug_venue.venueid SET src_enplug_venue.venuename=tmp_src_enplug_venue.venuename, src_enplug_venue.venue_timezone=tmp_src_enplug_venue.venue_timezone;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (501, 2, 50, 'INSERT IGNORE INTO src_enplug_edu (eduid, venueid, eduname, mac_eth, mac_wifi, ip, ip_public, status_code, status_message, tvstatus, player_version, player_uptime, last_player_heartbeat) SELECT eduid, venueid, eduname, mac_eth, mac_wifi, ip, ip_public, status_code, status_message, tvstatus, player_version, player_uptime, last_player_heartbeat FROM tmp_src_enplug_edu WHERE eduid NOT IN (SELECT eduid FROM src_enplug_edu);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (501, 2, 51, 'UPDATE IGNORE src_enplug_edu AS edu INNER JOIN tmp_src_enplug_edu AS tedu ON edu.eduid=tedu.eduid SET edu.venueid=tedu.venueid, edu.eduname=tedu.eduname, edu.mac_eth=tedu.mac_eth, edu.mac_wifi=tedu.mac_wifi, edu.ip=tedu.ip, edu.ip_public=tedu.ip_public, edu.status_code=tedu.status_code, edu.status_message=tedu.status_message, edu.tvstatus=tedu.tvstatus, edu.player_version=tedu.player_version, edu.player_uptime=tedu.player_uptime, edu.last_player_heartbeat=tedu.last_player_heartbeat;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (501, 2, 60, 'DELETE IGNORE FROM src_enplug_edu WHERE eduid NOT IN (SELECT eduid FROM tmp_src_enplug_edu);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (501, 2, 61, 'DELETE IGNORE FROM src_enplug_venue WHERE venueid NOT IN (SELECT venueid FROM tmp_src_enplug_venue);', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (502, 1, 10, 'CREATE TEMPORARY TABLE tmp_src_activaire (activaireid VARCHAR(256) NOT NULL PRIMARY KEY, activairename VARCHAR(256) DEFAULT NULL, mac VARCHAR(17) DEFAULT NULL, mac_eth VARCHAR(17) DEFAULT NULL, lastonline DATETIME DEFAULT NULL, isplaying BOOLEAN DEFAULT NULL, device_status VARCHAR(20) DEFAULT NULL, ip VARCHAR(39) DEFAULT NULL, ip_public VARCHAR(39) DEFAULT NULL, make_model VARCHAR(256) DEFAULT NULL, app_version VARCHAR(20) DEFAULT NULL, KEY ip (ip), KEY ip_public (ip_public)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (502, 2, 10, 'TRUNCATE TABLE tmp_src_activaire;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (502, 2, 20, 'INSERT IGNORE INTO tmp_src_activaire (activaireid) SELECT DISTINCT raw_activaire._id FROM raw_activaire INNER JOIN ref_ipprefix AS rip1 ON INET_ATON(raw_activaire.publicipaddress) BETWEEN rip1.startipnum AND rip1.endipnum INNER JOIN ref_ipprefix AS rip2 ON INET_ATON(raw_activaire.internalipaddress) BETWEEN rip2.startipnum AND rip2.endipnum WHERE raw_activaire.publicipaddress IS NOT NULL AND raw_activaire.internalipaddress IS NOT NULL AND raw_activaire.publicipaddress LIKE \'%.%.%.%\' AND raw_activaire.internalipaddress LIKE \'%.%.%.%\' AND rip1.siteid=rip2.siteid AND rip1.siteid<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (502, 2, 30, 'UPDATE IGNORE tmp_src_activaire AS tact INNER JOIN raw_activaire AS act ON tact.activaireid=act._id SET tact.activairename=act.name, tact.isplaying=act.isplaying, tact.device_status=act.devicestatus, tact.ip=act.internalipaddress, tact.ip_public=act.publicipaddress, tact.make_model=act.makeandmodel, tact.app_version=act.appversion, tact.lastonline=IF(act.lastonline IS NULL, NULL, FROM_UNIXTIME(act.lastonline DIV 1000));', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (502, 2, 31, 'UPDATE IGNORE tmp_src_activaire AS tact INNER JOIN raw_activaire AS act ON tact.activaireid=act._id SET tact.mac=IF(act.macaddress IS NULL, NULL, REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(UPPER(act.macaddress),\'::\', \':00:\'),\':0:\',\':00:\'),\':1:\',\':01:\'),\':2:\',\':02:\'),\':3:\',\':03:\'),\':4:\',\':04:\'),\':5:\',\':05:\'),\':6:\',\':06:\'),\':7:\',\':07:\'),\':8:\',\':08:\'),\':9:\',\':09:\'),\':A:\',\':0A:\'),\':B:\',\':0B:\'),\':C:\',\':0C:\'),\':D:\',\':0D:\'),\':E:\',\':0E:\'),\':F:\',\':0F:\')), tact.mac_eth=IF(act.ethernetmacaddress IS NULL, NULL, REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(UPPER(act.ethernetmacaddress),\'::\', \':00:\'),\':0:\',\':00:\'),\':1:\',\':01:\'),\':2:\',\':02:\'),\':3:\',\':03:\'),\':4:\',\':04:\'),\':5:\',\':05:\'),\':6:\',\':06:\'),\':7:\',\':07:\'),\':8:\',\':08:\'),\':9:\',\':09:\'),\':A:\',\':0A:\'),\':B:\',\':0B:\'),\':C:\',\':0C:\'),\':D:\',\':0D:\'),\':E:\',\':0E:\'),\':F:\',\':0F:\'));', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (502, 2, 32, 'UPDATE IGNORE tmp_src_activaire SET mac=CONCAT(\'0\', mac) WHERE mac IS NOT NULL AND mac LIKE \'_:%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (502, 2, 33, 'UPDATE IGNORE tmp_src_activaire SET mac_eth=CONCAT(\'0\', mac_eth) WHERE mac_eth IS NOT NULL AND mac_eth LIKE \'_:%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (502, 2, 34, 'UPDATE IGNORE tmp_src_activaire SET mac=CONCAT(SUBSTR(mac, 1, LENGTH(mac)-1), \'0\', SUBSTR(mac, LENGTH(mac), 1)) WHERE mac IS NOT NULL AND mac LIKE \'%:_\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (502, 2, 35, 'UPDATE IGNORE tmp_src_activaire SET mac_eth=CONCAT(SUBSTR(mac_eth, 1, LENGTH(mac_eth)-1), \'0\', SUBSTR(mac_eth, LENGTH(mac_eth), 1)) WHERE mac_eth IS NOT NULL AND mac_eth LIKE \'%:_\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (502, 2, 36, 'UPDATE IGNORE tmp_src_activaire SET mac=REPLACE(mac, \':\', \'\'), mac_eth=REPLACE(mac_eth, \':\', \'\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (502, 2, 37, 'DELETE IGNORE FROM tmp_src_activaire WHERE activairename IS NULL OR device_status IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (502, 2, 50, 'INSERT IGNORE INTO src_activaire (activaireid, activairename, mac, mac_eth, lastonline, isplaying, device_status, ip, ip_public, make_model, app_version) SELECT activaireid, activairename, mac, mac_eth, lastonline, isplaying, device_status, ip, ip_public, make_model, app_version FROM tmp_src_activaire WHERE activaireid NOT IN (SELECT activaireid FROM src_activaire);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (502, 2, 60, 'UPDATE IGNORE src_activaire AS act INNER JOIN tmp_src_activaire AS tact ON act.activaireid=tact.activaireid SET act.activairename=tact.activairename, act.mac=tact.mac, act.mac_eth=tact.mac_eth, act.lastonline=tact.lastonline, act.isplaying=tact.isplaying, act.device_status=tact.device_status, act.ip=tact.ip, act.ip_public=tact.ip_public, act.make_model=tact.make_model, act.app_version=tact.app_version;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (502, 2, 70, 'DELETE IGNORE FROM src_activaire WHERE activaireid NOT IN (SELECT activaireid FROM tmp_src_activaire);', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 1, 10, 'CREATE TEMPORARY TABLE tmp_src_scan_ip (ipid INT NOT NULL PRIMARY KEY, ip VARCHAR(39) NOT NULL UNIQUE, refid INT UNSIGNED NOT NULL, sourceid INT UNSIGNED NOT NULL, ispublic BOOLEAN NOT NULL DEFAULT TRUE, KEY sourceid (sourceid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 20, 'CREATE TEMPORARY TABLE tmp_src_snmp (snmpid INT NOT NULL PRIMARY KEY, ipid INT NOT NULL, oidid INT DEFAULT NULL, oid VARCHAR(256) NOT NULL, snmp_type VARCHAR(20) NOT NULL, value VARCHAR(1000) NOT NULL, value_hex VARCHAR(2000) NOT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, oid1 INT UNSIGNED DEFAULT NULL, oid4 VARCHAR(15) DEFAULT NULL, oid6 VARCHAR(23) DEFAULT NULL, UNIQUE KEY ipoid (ipid, oid), KEY ipid (ipid), KEY oidid (oidid), KEY oid (oid), KEY snmp_type (snmp_type), KEY vlan (vlan), KEY oid1 (oid1), KEY oid4 (oid4), KEY oid6 (oid6), KEY ipoid1 (ipid, oid1)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 1, 30, 'CREATE TEMPORARY TABLE tmp_src_scan_dhcp (dhcpid INT NOT NULL PRIMARY KEY, ip VARCHAR(39) NOT NULL, routerid INT NOT NULL, mac VARCHAR(12) NOT NULL, UNIQUE KEY routerip (routerid, ip), KEY ip (ip), KEY routerid (routerid), KEY mac (mac)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 1, 40, 'CREATE TEMPORARY TABLE tmp_src_scan_ip_info (id INT NOT NULL PRIMARY KEY, ipid INT NOT NULL, infoid INT UNSIGNED NOT NULL, value VARCHAR(256) NOT NULL, UNIQUE KEY ipinfo (ipid, infoid), KEY ipid (ipid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 50, 'CREATE TEMPORARY TABLE tmp_src_snmp_mac (macid INT NOT NULL PRIMARY KEY, mac VARCHAR(12) NOT NULL, switchid BIGINT NOT NULL, port INT UNSIGNED NOT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, UNIQUE KEY switchmacvlan (switchid, mac, vlan), KEY mac (mac), KEY switchid (switchid), KEY vlan (vlan)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 1, 60, 'CREATE TEMPORARY TABLE tmp_src_scan_osmatch (osmatchid INT NOT NULL PRIMARY KEY, ipid BIGINT NOT NULL, name VARCHAR(256) NOT NULL, accuracy INT UNSIGNED NOT NULL, KEY ipid (ipid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 70, 'CREATE TEMPORARY TABLE tmp_src_snmp_vlan (vlanid INT NOT NULL AUTO_INCREMENT PRIMARY KEY, switchid INT NOT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, active BOOLEAN NOT NULL DEFAULT TRUE, UNIQUE KEY switchvlan (switchid, vlan), KEY switchid (switchid), KEY vlan (vlan)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 1, 80, 'CREATE TEMPORARY TABLE tmp_src_scan_service (portid INT NOT NULL PRIMARY KEY, product VARCHAR(100) DEFAULT NULL, version VARCHAR(50) DEFAULT NULL, extrainfo VARCHAR(256) DEFAULT NULL, conf INT DEFAULT NULL, cpe VARCHAR(100) DEFAULT NULL, name VARCHAR(50) DEFAULT NULL) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 1, 90, 'CREATE TEMPORARY TABLE tmp_src_scan_script (id INT NOT NULL PRIMARY KEY, portid INT NOT NULL, script VARCHAR(100) NOT NULL, value VARCHAR(16100) NOT NULL, UNIQUE KEY portscript (portid, script), KEY portid (portid), KEY script (script)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 10, 'TRUNCATE TABLE tmp_src_scan_ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 20, 'INSERT IGNORE INTO tmp_src_scan_ip (ipid, ip, refid, sourceid) SELECT ipid, ip, refid, sourceid FROM raw_scan_ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 30, 'UPDATE tmp_src_scan_ip SET ispublic=FALSE WHERE ip LIKE \'10.%\' OR ip LIKE \'192.168.%\' OR ip LIKE \'127.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 31, 'UPDATE tmp_src_scan_ip SET ispublic=FALSE WHERE (INET_ATON(ip) BETWEEN INET_ATON(\'172.16.0.0\') AND INET_ATON(\'172.31.255.255\')) OR (INET_ATON(ip) BETWEEN INET_ATON(\'100.64.0.0\') AND INET_ATON(\'100.127.255.255\'));', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 40, 'TRUNCATE TABLE tmp_src_scan_arp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 41, 'TRUNCATE TABLE tmp_src_scan_dhcp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 50, 'INSERT IGNORE INTO tmp_src_scan_arp (arpid, ip, routerid, mac) SELECT arpid, ip, routerid, mac FROM raw_scan_arp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 51, 'INSERT IGNORE INTO tmp_src_scan_dhcp (dhcpid, ip, routerid, mac) SELECT dhcpid, ip, routerid, mac FROM raw_scan_dhcp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 60, 'TRUNCATE TABLE tmp_src_scan_ip_info;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 70, 'INSERT IGNORE INTO tmp_src_scan_ip_info (id, ipid, infoid, value) SELECT id, ipid, infoid, value FROM raw_scan_ip_info;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 80, 'TRUNCATE TABLE tmp_src_scan_port;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 90, 'INSERT IGNORE INTO tmp_src_scan_port (portid, ipid, type, port, state, reason) SELECT portid, ipid, type, port, state, reason FROM raw_scan_port WHERE state IN (\'up\', \'open\') OR portid IN (SELECT portid FROM raw_scan_script WHERE value<>\'ERROR: Script execution failed (use -d to debug)\') OR portid IN (SELECT portid FROM raw_scan_service);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 100, 'TRUNCATE TABLE tmp_src_scan_osmatch;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 101, 'TRUNCATE TABLE tmp_src_scan_osclass;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 110, 'INSERT IGNORE INTO tmp_src_scan_osmatch (osmatchid, ipid, name, accuracy) SELECT osmatchid, ipid, name, accuracy FROM raw_scan_osmatch;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 111, 'INSERT IGNORE INTO tmp_src_scan_osclass (osclassid, osmatchid, type, vendor, osfamily, osgen, accuracy, cpe) SELECT osclassid, osmatchid, type, vendor, osfamily, osgen, accuracy, cpe FROM raw_scan_osclass;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 120, 'TRUNCATE TABLE tmp_src_scan_service;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 121, 'TRUNCATE TABLE tmp_src_scan_script;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 130, 'INSERT IGNORE INTO tmp_src_scan_service (portid, product, version, extrainfo, conf, cpe, name) SELECT portid, product, version, extrainfo, conf, cpe, name FROM raw_scan_service;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 2, 131, 'INSERT IGNORE INTO tmp_src_scan_script (id, portid, script, value) SELECT id, portid, script, value FROM raw_scan_script WHERE value<>\'ERROR: Script execution failed (use -d to debug)\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 10, 'INSERT IGNORE INTO src_scan_ip (ip, refid, sourceid, ispublic)  SELECT ip, refid, sourceid, ispublic FROM tmp_src_scan_ip WHERE ip NOT IN (SELECT ip FROM src_scan_ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 11, 'INSERT IGNORE INTO src_scan_arp (ip, routerid, mac) SELECT tmp_src_scan_arp.ip, src_scan_ip.ipid, tmp_src_scan_arp.mac FROM tmp_src_scan_arp INNER JOIN tmp_src_scan_ip ON tmp_src_scan_arp.routerid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE (src_scan_ip.ipid, tmp_src_scan_arp.ip) NOT IN (SELECT routerid, ip FROM src_scan_arp);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 12, 'INSERT IGNORE INTO src_scan_dhcp (ip, routerid, mac) SELECT tmp_src_scan_dhcp.ip, src_scan_ip.ipid, tmp_src_scan_dhcp.mac FROM tmp_src_scan_dhcp INNER JOIN tmp_src_scan_ip ON tmp_src_scan_dhcp.routerid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE (src_scan_ip.ipid, tmp_src_scan_dhcp.ip) NOT IN (SELECT routerid, ip FROM src_scan_dhcp);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 13, 'INSERT IGNORE INTO src_scan_ip_info (ipid, infoid, value) SELECT src_scan_ip.ipid, tmp_src_scan_ip_info.infoid, tmp_src_scan_ip_info.value FROM tmp_src_scan_ip_info INNER JOIN tmp_src_scan_ip ON tmp_src_scan_ip_info.ipid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE (src_scan_ip.ipid, tmp_src_scan_ip_info.infoid) NOT IN (SELECT ipid, infoid FROM src_scan_ip_info);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 14, 'INSERT IGNORE INTO src_scan_port (ipid, type, port, state, reason) SELECT src_scan_ip.ipid, tmp_src_scan_port.type, tmp_src_scan_port.port, tmp_src_scan_port.state, tmp_src_scan_port.reason FROM tmp_src_scan_port INNER JOIN tmp_src_scan_ip ON tmp_src_scan_port.ipid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 15, 'TRUNCATE TABLE src_scan_osclass;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 16, 'DELETE FROM src_scan_osmatch;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 17, 'INSERT IGNORE INTO src_scan_osmatch (osmatchid, ipid, name, accuracy) SELECT tmp_src_scan_osmatch.osmatchid, src_scan_ip.ipid, tmp_src_scan_osmatch.name, tmp_src_scan_osmatch.accuracy FROM tmp_src_scan_osmatch INNER JOIN tmp_src_scan_ip ON tmp_src_scan_osmatch.ipid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 18, 'INSERT IGNORE INTO src_scan_osclass (osclassid, osmatchid, type, vendor, osfamily, osgen, accuracy, cpe) SELECT osclassid, osmatchid, type, vendor, osfamily, osgen, accuracy, cpe FROM tmp_src_scan_osclass;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 19, 'INSERT IGNORE INTO src_scan_service (portid, product, version, extrainfo, conf, cpe, name) SELECT src_scan_port.portid, tmp_src_scan_service.product, tmp_src_scan_service.version, tmp_src_scan_service.extrainfo, tmp_src_scan_service.conf, tmp_src_scan_service.cpe, tmp_src_scan_service.name FROM tmp_src_scan_service INNER JOIN tmp_src_scan_port ON tmp_src_scan_service.portid=tmp_src_scan_port.portid INNER JOIN tmp_src_scan_ip ON tmp_src_scan_port.ipid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid AND tmp_src_scan_port.type=src_scan_port.type AND tmp_src_scan_port.port=src_scan_port.port WHERE src_scan_port.portid NOT IN (SELECT portid FROM src_scan_service);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 20, 'INSERT IGNORE INTO src_scan_script (portid, script, value) SELECT src_scan_port.portid, tmp_src_scan_script.script, tmp_src_scan_script.value FROM tmp_src_scan_script INNER JOIN tmp_src_scan_port ON tmp_src_scan_script.portid=tmp_src_scan_port.portid INNER JOIN tmp_src_scan_ip ON tmp_src_scan_port.ipid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid AND tmp_src_scan_port.type=src_scan_port.type AND tmp_src_scan_port.port=src_scan_port.port WHERE (src_scan_port.portid, tmp_src_scan_script.script) NOT IN (SELECT portid, script FROM src_scan_script);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 50, 'UPDATE IGNORE src_scan_ip AS ssi INNER JOIN tmp_src_scan_ip AS tssi ON ssi.ip=tssi.ip SET ssi.refid=tssi.refid, ssi.sourceid=tssi.sourceid, ssi.ispublic=tssi.ispublic;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 51, 'UPDATE IGNORE src_scan_arp INNER JOIN src_scan_ip ON src_scan_arp.routerid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_scan_arp ON tmp_src_scan_ip.ipid=tmp_src_scan_arp.routerid AND src_scan_arp.ip=tmp_src_scan_arp.ip SET src_scan_arp.mac=tmp_src_scan_arp.mac;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 52, 'UPDATE IGNORE src_scan_dhcp INNER JOIN src_scan_ip ON src_scan_dhcp.routerid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_scan_dhcp ON tmp_src_scan_ip.ipid=tmp_src_scan_dhcp.routerid AND src_scan_dhcp.ip=tmp_src_scan_dhcp.ip SET src_scan_dhcp.mac=tmp_src_scan_dhcp.mac;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 53, 'UPDATE IGNORE src_scan_ip_info INNER JOIN src_scan_ip ON src_scan_ip_info.ipid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_scan_ip_info ON tmp_src_scan_ip.ipid=tmp_src_scan_ip_info.ipid AND src_scan_ip_info.infoid=tmp_src_scan_ip_info.infoid SET src_scan_ip_info.value=tmp_src_scan_ip_info.value;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 54, 'UPDATE IGNORE src_scan_port INNER JOIN src_scan_ip ON src_scan_port.ipid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_scan_port ON tmp_src_scan_ip.ipid=tmp_src_scan_port.ipid AND src_scan_port.type=tmp_src_scan_port.type AND src_scan_port.port=tmp_src_scan_port.port SET src_scan_port.state=tmp_src_scan_port.state, src_scan_port.reason=tmp_src_scan_port.reason;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 55, 'UPDATE IGNORE src_scan_service INNER JOIN src_scan_port ON src_scan_service.portid=src_scan_port.portid INNER JOIN src_scan_ip ON src_scan_port.ipid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_scan_port ON tmp_src_scan_ip.ipid=tmp_src_scan_port.ipid AND src_scan_port.type=tmp_src_scan_port.type AND src_scan_port.port=tmp_src_scan_port.port INNER JOIN tmp_src_scan_service ON tmp_src_scan_port.portid=tmp_src_scan_service.portid SET src_scan_service.product=tmp_src_scan_service.product, src_scan_service.version=tmp_src_scan_service.version, src_scan_service.extrainfo=tmp_src_scan_service.extrainfo, src_scan_service.conf=tmp_src_scan_service.conf, src_scan_service.cpe=tmp_src_scan_service.cpe, src_scan_service.name=tmp_src_scan_service.name;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 3, 56, 'UPDATE IGNORE src_scan_script INNER JOIN src_scan_port ON src_scan_script.portid=src_scan_port.portid INNER JOIN src_scan_ip ON src_scan_port.ipid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_scan_port ON tmp_src_scan_ip.ipid=tmp_src_scan_port.ipid AND src_scan_port.type=tmp_src_scan_port.type AND src_scan_port.port=tmp_src_scan_port.port INNER JOIN tmp_src_scan_script ON tmp_src_scan_port.portid=tmp_src_scan_script.portid AND src_scan_script.script=tmp_src_scan_script.script SET src_scan_script.value=tmp_src_scan_script.value;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 10, 'DELETE IGNORE src_scan_script FROM src_scan_script INNER JOIN src_scan_port ON src_scan_script.portid=src_scan_port.portid INNER JOIN src_scan_ip ON src_scan_port.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_scan_port ON tmp_src_scan_ip.ipid=tmp_src_scan_port.ipid AND src_scan_port.type=tmp_src_scan_port.type AND src_scan_port.port=tmp_src_scan_port.port LEFT JOIN tmp_src_scan_script ON tmp_src_scan_port.portid=tmp_src_scan_script.portid AND src_scan_script.script=tmp_src_scan_script.script WHERE tmp_src_scan_script.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 11, 'DELETE IGNORE src_scan_service FROM src_scan_service INNER JOIN src_scan_port ON src_scan_service.portid=src_scan_port.portid INNER JOIN src_scan_ip ON src_scan_port.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_scan_port ON tmp_src_scan_ip.ipid=tmp_src_scan_port.ipid AND src_scan_port.type=tmp_src_scan_port.type AND src_scan_port.port=tmp_src_scan_port.port LEFT JOIN tmp_src_scan_service ON tmp_src_scan_port.portid=tmp_src_scan_service.portid WHERE tmp_src_scan_service.portid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 12, 'DELETE IGNORE src_scan_port FROM src_scan_port INNER JOIN src_scan_ip ON src_scan_port.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_scan_port ON tmp_src_scan_ip.ipid=tmp_src_scan_port.ipid AND src_scan_port.type=tmp_src_scan_port.type AND src_scan_port.port=tmp_src_scan_port.port WHERE tmp_src_scan_port.portid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 30, 'DELETE IGNORE src_scan_ip_info FROM src_scan_ip_info INNER JOIN src_scan_ip ON src_scan_ip_info.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_scan_ip_info ON tmp_src_scan_ip.ipid=tmp_src_scan_ip_info.ipid AND src_scan_ip_info.infoid=tmp_src_scan_ip_info.infoid WHERE tmp_src_scan_ip_info.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 31, 'DELETE IGNORE src_scan_arp FROM src_scan_arp INNER JOIN src_scan_ip ON src_scan_arp.routerid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_scan_arp ON tmp_src_scan_ip.ipid=tmp_src_scan_arp.routerid AND src_scan_arp.ip=tmp_src_scan_arp.ip WHERE tmp_src_scan_arp.arpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 32, 'DELETE IGNORE src_scan_dhcp FROM src_scan_dhcp INNER JOIN src_scan_ip ON src_scan_dhcp.routerid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_scan_dhcp ON tmp_src_scan_ip.ipid=tmp_src_scan_dhcp.routerid AND src_scan_dhcp.ip=tmp_src_scan_dhcp.ip WHERE tmp_src_scan_dhcp.dhcpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 40, 'DELETE src_ruckussz_wap FROM src_ruckussz_wap INNER JOIN src_scan_ip ON src_ruckussz_wap.wlcid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip WHERE tmp_src_scan_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 41, 'DELETE src_ruckussz_wlc FROM src_ruckussz_wlc INNER JOIN src_scan_ip ON src_ruckussz_wlc.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip WHERE tmp_src_scan_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 42, 'DELETE src_snmp_wap FROM src_snmp_wap INNER JOIN src_scan_ip ON src_snmp_wap.wlcid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip WHERE tmp_src_scan_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 43, 'DELETE src_snmp_wlc FROM src_snmp_wlc INNER JOIN src_scan_ip ON src_snmp_wlc.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip WHERE tmp_src_scan_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 50, 'DELETE src_snmp_arp FROM src_snmp_arp INNER JOIN src_scan_ip ON src_snmp_arp.routerid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip WHERE tmp_src_scan_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 51, 'DELETE src_snmp_dhcp FROM src_snmp_dhcp INNER JOIN src_scan_ip ON src_snmp_dhcp.routerid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip WHERE tmp_src_scan_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 52, 'DELETE src_snmp_mac FROM src_snmp_mac INNER JOIN src_scan_ip ON src_snmp_mac.switchid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip WHERE tmp_src_scan_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 53, 'DELETE src_snmp_vlan FROM src_snmp_vlan INNER JOIN src_scan_ip ON src_snmp_vlan.switchid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip WHERE tmp_src_scan_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 54, 'DELETE src_snmp_if FROM src_snmp_if INNER JOIN src_scan_ip ON src_snmp_if.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip WHERE tmp_src_scan_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 55, 'DELETE src_snmp_ipaddr FROM src_snmp_ipaddr INNER JOIN src_scan_ip ON src_snmp_ipaddr.routerid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip WHERE tmp_src_scan_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 60, 'DELETE src_snmp_router FROM src_snmp_router INNER JOIN src_scan_ip ON src_snmp_router.routerid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip WHERE tmp_src_scan_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 61, 'DELETE src_snmp_system FROM src_snmp_system INNER JOIN src_scan_ip ON src_snmp_system.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip WHERE tmp_src_scan_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 62, 'DELETE src_snmp_sysor FROM src_snmp_sysor INNER JOIN src_scan_ip ON src_snmp_sysor.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip WHERE tmp_src_scan_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 70, 'DELETE src_snmp_cdp FROM src_snmp_cdp INNER JOIN src_scan_ip ON src_snmp_cdp.switchid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip WHERE tmp_src_scan_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 71, 'DELETE src_snmp_lldp FROM src_snmp_lldp INNER JOIN src_scan_ip ON src_snmp_lldp.switchid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip WHERE tmp_src_scan_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 80, 'DELETE src_snmp FROM src_snmp INNER JOIN src_scan_ip ON src_snmp.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip WHERE tmp_src_scan_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (503, 4, 100, 'DELETE IGNORE FROM src_scan_ip WHERE ip NOT IN (SELECT ip FROM tmp_src_scan_ip);', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 10, 'CREATE TEMPORARY TABLE tmp_src_scan_ip (ipid INT NOT NULL PRIMARY KEY, ip VARCHAR(39) NOT NULL UNIQUE) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 20, 'CREATE TEMPORARY TABLE tmp_src_snmp (snmpid INT NOT NULL PRIMARY KEY, ipid INT NOT NULL, oidid INT DEFAULT NULL, oid VARCHAR(256) NOT NULL, snmp_type VARCHAR(20) NOT NULL, value VARCHAR(1000) NOT NULL, value_hex VARCHAR(2000) NOT NULL, vlan INT UNSIGNED DEFAULT NULL, oid1 INT UNSIGNED DEFAULT NULL, oid4 VARCHAR(15) DEFAULT NULL, oid6 VARCHAR(23) DEFAULT NULL, UNIQUE KEY ipoid (ipid, oid), KEY ipid (ipid), KEY oidid (oidid), KEY oid (oid), KEY snmp_type (snmp_type), KEY vlan (vlan), KEY oid1 (oid1), KEY oid4 (oid4), KEY oid6 (oid6), KEY ipoid1 (ipid, oid1)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 30, 'CREATE TEMPORARY TABLE tmp_src_snmp_if (ifid INT NOT NULL PRIMARY KEY, ipid INT NOT NULL, ifindexid INT UNSIGNED NOT NULL, ifindex INT UNSIGNED NOT NULL, ifdescr VARCHAR(256) DEFAULT NULL, ifname VARCHAR(100) DEFAULT NULL, ifalias VARCHAR(256) DEFAULT NULL, ifadminstatus SMALLINT UNSIGNED NOT NULL DEFAULT 2, ifoperstatus SMALLINT UNSIGNED NOT NULL DEFAULT 4, ifphysaddress VARCHAR(12) DEFAULT NULL, ifphysaddressnum BIGINT UNSIGNED DEFAULT NULL, macvendorid VARCHAR(12) DEFAULT NULL, UNIQUE KEY ipifindexid (ipid, ifindexid), KEY ipid (ipid), KEY ifindexid (ifindexid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 40, 'CREATE TEMPORARY TABLE tmp_src_snmp_arp (arpid INT NOT NULL PRIMARY KEY, ip VARCHAR(39) NOT NULL, routerid INT NOT NULL, mac VARCHAR(12) NOT NULL, UNIQUE KEY routerip (routerid, ip), KEY ip (ip), KEY routerid (routerid), KEY mac (mac)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 50, 'CREATE TEMPORARY TABLE tmp_src_snmp_mac (macid INT NOT NULL PRIMARY KEY, mac VARCHAR(12) NOT NULL, switchid BIGINT NOT NULL, port INT UNSIGNED NOT NULL, vlan INT UNSIGNED DEFAULT NULL, UNIQUE KEY switchmacvlan (switchid, mac, vlan), KEY mac (mac), KEY switchid (switchid), KEY vlan (vlan)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 60, 'CREATE TEMPORARY TABLE tmp_src_snmp_dhcp (dhcpid INT NOT NULL PRIMARY KEY, ip VARCHAR(39) NOT NULL, routerid INT NOT NULL, mac VARCHAR(12) NOT NULL, UNIQUE KEY routerip (routerid, ip), KEY ip (ip), KEY routerid (routerid), KEY mac (mac)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 70, 'CREATE TEMPORARY TABLE tmp_src_snmp_vlan (vlanid INT NOT NULL AUTO_INCREMENT PRIMARY KEY, switchid INT NOT NULL, vlan INT UNSIGNED NOT NULL, active BOOLEAN NOT NULL DEFAULT TRUE, UNIQUE KEY switchvlan (switchid, vlan), KEY switchid (switchid), KEY vlan (vlan)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 80, 'CREATE TEMPORARY TABLE tmp_src_snmp_system (ipid BIGINT NOT NULL PRIMARY KEY, sysdescr VARCHAR(256) DEFAULT NULL, sysobjectid VARCHAR(100) DEFAULT NULL, sysuptime BIGINT UNSIGNED DEFAULT NULL, syscontact VARCHAR(100) DEFAULT NULL, sysname VARCHAR(100) DEFAULT NULL, syslocation VARCHAR(256) DEFAULT NULL, sysservices INT UNSIGNED DEFAULT NULL) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 90, 'CREATE TEMPORARY TABLE tmp_src_snmp_sysor (orid INT NOT NULL PRIMARY KEY AUTO_INCREMENT, ipid INT NOT NULL, orindex INT UNSIGNED NOT NULL, sysorid VARCHAR(100) DEFAULT NULL, sysordescr VARCHAR(1000) DEFAULT NULL, UNIQUE KEY ipindex (ipid, orindex), KEY ipid (ipid), KEY orindex (orindex)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 100, 'CREATE TEMPORARY TABLE tmp_src_snmp_router (routerid INT NOT NULL PRIMARY KEY, ipforwarding BOOLEAN DEFAULT NULL, ipcidrroutenumber INT UNSIGNED DEFAULT NULL, ipaddrnumber INT UNSIGNED DEFAULT NULL, KEY ipforwarding (ipforwarding)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 110, 'CREATE TEMPORARY TABLE tmp_src_snmp_ipaddr (ipid INT NOT NULL AUTO_INCREMENT PRIMARY KEY, routerid INT NOT NULL, ip VARCHAR(39) NOT NULL, ifindex INT UNSIGNED DEFAULT NULL, netmask VARCHAR(39) DEFAULT NULL, netnum INT UNSIGNED DEFAULT NULL, reasmmaxsize INT DEFAULT NULL, UNIQUE KEY routerip (routerid, ip), KEY routerid (routerid), KEY ip (ip)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 120, 'CREATE TEMPORARY TABLE tmp_src_snmp_wlc (ipid INT NOT NULL PRIMARY KEY, wlcid INT NOT NULL, wapnum INT UNSIGNED DEFAULT NULL, KEY wlcid (wlcid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 130, 'CREATE TEMPORARY TABLE tmp_src_snmp_wap (wapid INT NOT NULL PRIMARY KEY, wlcid INT NOT NULL, mac VARCHAR(12) NOT NULL, ip VARCHAR(39) DEFAULT NULL, hostname VARCHAR(100) DEFAULT NULL, UNIQUE KEY wlcmac (wlcid, mac), KEY wlcid (wlcid), KEY mac (mac)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 140, 'CREATE TEMPORARY TABLE tmp_src_snmp_cdp (cdpid INT NOT NULL PRIMARY KEY AUTO_INCREMENT, switchid INT NOT NULL, ifindex INT NOT NULL, suffix VARCHAR(20) DEFAULT NULL, cdpcacheaddresstype INT DEFAULT NULL, cdpcacheaddress VARCHAR(39) DEFAULT NULL, cdpcacheversion VARCHAR(512) DEFAULT NULL, cdpcachedeviceid VARCHAR(100) DEFAULT NULL, cdpcachedeviceport VARCHAR(50) DEFAULT NULL, cdpcacheplatform VARCHAR(100) DEFAULT NULL, UNIQUE KEY swif (switchid, ifindex), KEY switchid (switchid), KEY ifindex (ifindex), KEY suffix (suffix), KEY cdpcacheaddresstype (cdpcacheaddresstype)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 160, 'CREATE TEMPORARY TABLE tmp_src_snmp_lldp (lldpid INT NOT NULL PRIMARY KEY AUTO_INCREMENT, switchid INT NOT NULL, ifindex INT NOT NULL, suffix VARCHAR(20) DEFAULT NULL, lldpremchassisidsubtype INT DEFAULT NULL, lldpremchassisid VARCHAR(50) DEFAULT NULL, lldpremportidsubtype INT DEFAULT NULL, lldpremportid VARCHAR(100) DEFAULT NULL, lldpremportdesc VARCHAR(256) DEFAULT NULL, lldpremsysname VARCHAR(100) DEFAULT NULL, lldpremsysdesc VARCHAR(256) DEFAULT NULL, UNIQUE KEY switchif (switchid, ifindex), KEY switchid (switchid), KEY ifindex (ifindex), KEY lldpremchassisidsubtype (lldpremchassisidsubtype), KEY lldpremportidsubtype (lldpremportidsubtype)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 170, 'CREATE TEMPORARY TABLE tmp_src_snmp_portif_map (id INT NOT NULL PRIMARY KEY, ipid INT NOT NULL, port INT UNSIGNED NOT NULL, ifindex INT UNSIGNED NOT NULL, UNIQUE KEY ipport (ipid, port), KEY ipid (ipid), KEY port (port), KEY ifindex (ifindex)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 1, 180, 'CREATE TEMPORARY TABLE tmp_mac_map (id BIGINT NOT NULL PRIMARY KEY, mac VARCHAR(12) NOT NULL, macid VARCHAR(12) DEFAULT NULL, KEY mac (mac), KEY macid (macid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 10, 'TRUNCATE TABLE tmp_src_scan_ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 11, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 30, 'INSERT IGNORE INTO tmp_src_scan_ip (ipid, ip) SELECT ipid, ip FROM raw_scan_ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 40, 'TRUNCATE TABLE tmp_src_snmp_if;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 50, 'INSERT IGNORE INTO tmp_src_snmp_if (ifid, ipid, ifindexid, ifindex) SELECT raw_snmp.snmpid, raw_snmp.ipid, CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+)$\', \'\\\\1\') AS INTEGER) AS ifindexid, CAST(raw_snmp.value AS INTEGER) AS ifindex FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'ifIndex\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 51, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 52, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan, oid1) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan,0), CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+)$\', \'\\\\1\') AS INTEGER) AS oid1 FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'ifDescr\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 53, 'UPDATE IGNORE tmp_src_snmp_if INNER JOIN tmp_src_snmp ON tmp_src_snmp_if.ipid=tmp_src_snmp.ipid AND tmp_src_snmp_if.ifindexid=tmp_src_snmp.oid1 SET tmp_src_snmp_if.ifdescr=tmp_src_snmp.value;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 54, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 55, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan, oid1) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan,0), CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+)$\', \'\\\\1\') AS INTEGER) AS oid1 FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'ifAdminStatus\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 56, 'UPDATE IGNORE tmp_src_snmp_if INNER JOIN tmp_src_snmp ON tmp_src_snmp_if.ipid=tmp_src_snmp.ipid AND tmp_src_snmp_if.ifindexid=tmp_src_snmp.oid1 SET tmp_src_snmp_if.ifadminstatus=CAST(tmp_src_snmp.value AS INTEGER);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 57, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 58, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan, oid1) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan,0), CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+)$\', \'\\\\1\') AS INTEGER) AS oid1 FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'ifOperStatus\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 59, 'UPDATE IGNORE tmp_src_snmp_if INNER JOIN tmp_src_snmp ON tmp_src_snmp_if.ipid=tmp_src_snmp.ipid AND tmp_src_snmp_if.ifindexid=tmp_src_snmp.oid1 SET tmp_src_snmp_if.ifoperstatus=CAST(tmp_src_snmp.value AS INTEGER);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 60, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 61, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan, oid1) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan, 0), CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+)$\', \'\\\\1\') AS INTEGER) AS oid1 FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'ifName\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 62, 'UPDATE IGNORE tmp_src_snmp_if INNER JOIN tmp_src_snmp ON tmp_src_snmp_if.ipid=tmp_src_snmp.ipid AND tmp_src_snmp_if.ifindexid=tmp_src_snmp.oid1 SET tmp_src_snmp_if.ifname=tmp_src_snmp.value;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 63, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 64, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan, oid1) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan, 0), CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+)$\', \'\\\\1\') AS INTEGER) AS oid1 FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'ifAlias\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 65, 'UPDATE IGNORE tmp_src_snmp_if INNER JOIN tmp_src_snmp ON tmp_src_snmp_if.ipid=tmp_src_snmp.ipid AND tmp_src_snmp_if.ifindexid=tmp_src_snmp.oid1 SET tmp_src_snmp_if.ifalias=tmp_src_snmp.value;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 66, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 67, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan, oid1) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan, 0), CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+)$\', \'\\\\1\') AS INTEGER) AS oid1 FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'ifPhysAddress\' AND LENGTH(raw_snmp.value_hex)=12;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 68, 'UPDATE IGNORE tmp_src_snmp_if INNER JOIN tmp_src_snmp ON tmp_src_snmp_if.ipid=tmp_src_snmp.ipid AND tmp_src_snmp_if.ifindexid=tmp_src_snmp.oid1 SET tmp_src_snmp_if.ifphysaddress=UPPER(tmp_src_snmp.value_hex), tmp_src_snmp_if.ifphysaddressnum=CONV(UPPER(tmp_src_snmp.value_hex), 16, 10);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 70, 'TRUNCATE TABLE tmp_mac_map;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 71, 'INSERT IGNORE INTO tmp_mac_map (id, mac, macid) SELECT ifid, LEFT(ifphysaddress,9), NULL FROM tmp_src_snmp_if WHERE ifphysaddress IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 72, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 73, 'UPDATE IGNORE tmp_mac_map SET mac=LEFT(mac, LENGTH(mac)-1) WHERE macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 74, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment WHERE tmp_mac_map.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 75, 'UPDATE IGNORE tmp_mac_map SET mac=LEFT(mac, LENGTH(mac)-1) WHERE macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 76, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment WHERE tmp_mac_map.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 77, 'UPDATE IGNORE tmp_mac_map SET mac=LEFT(mac, LENGTH(mac)-1) WHERE macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 78, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment WHERE tmp_mac_map.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 79, 'UPDATE IGNORE tmp_src_snmp_if INNER JOIN tmp_mac_map ON tmp_src_snmp_if.ifid=tmp_mac_map.id SET tmp_src_snmp_if.macvendorid=tmp_mac_map.macid WHERE tmp_mac_map.macid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 90, 'TRUNCATE TABLE tmp_src_snmp_arp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 100, 'INSERT IGNORE INTO tmp_src_snmp_arp (arpid, ip, routerid, mac) SELECT raw_snmp.snmpid, REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+)$\', \'\\\\1\') AS ip, raw_snmp.ipid, raw_snmp.value_hex FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'ipNetToMediaPhysAddress\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 110, 'TRUNCATE TABLE tmp_src_snmp_mac;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 120, 'INSERT IGNORE INTO tmp_src_snmp_mac (macid, mac, switchid, port, vlan) SELECT raw_snmp.snmpid, CONCAT(LPAD(HEX(CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+)\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+$\', \'\\\\1\') AS INTEGER)), 2, \'0\'), LPAD(HEX(CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.\\\\d+\\\\.(\\\\d+)\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+$\', \'\\\\1\') AS INTEGER)), 2, \'0\'), LPAD(HEX(CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.\\\\d+\\\\.\\\\d+\\\\.(\\\\d+)\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+$\', \'\\\\1\') AS INTEGER)), 2, \'0\'), LPAD(HEX(CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.(\\\\d+)\\\\.\\\\d+\\\\.\\\\d+$\', \'\\\\1\') AS INTEGER)), 2, \'0\'), LPAD(HEX(CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.(\\\\d+)\\\\.\\\\d+$\', \'\\\\1\') AS INTEGER)), 2, \'0\'), LPAD(HEX(CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.(\\\\d+)$\', \'\\\\1\') AS INTEGER)), 2, \'0\')) AS mac, raw_snmp.ipid, CAST(raw_snmp.value AS INTEGER) AS port, IFNULL(raw_snmp.vlan,0) FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'dot1dTpFdbDestPortIfIndex\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 130, 'TRUNCATE TABLE tmp_src_snmp_dhcp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 140, 'INSERT IGNORE INTO tmp_src_snmp_dhcp (dhcpid, ip, routerid, mac) SELECT raw_snmp.snmpid, REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+)$\', \'\\\\1\') AS ip, raw_snmp.ipid, raw_snmp.value_hex FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'jnxJdhcpLocalServerBindingsMacAddress\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 150, 'TRUNCATE TABLE tmp_src_snmp_vlan;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 160, 'INSERT IGNORE INTO tmp_src_snmp_vlan (vlanid, switchid, vlan, active) SELECT raw_snmp.snmpid, raw_snmp.ipid, CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+)$\', \'\\\\1\') AS INTEGER) AS vlan, IF(raw_snmp.value=\'1\', TRUE, FALSE) AS active FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'vtpVlanState\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 161, 'INSERT IGNORE INTO tmp_src_snmp_vlan (vlanid, switchid, vlan, active) SELECT raw_snmp.snmpid, raw_snmp.ipid, CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+)$\', \'\\\\1\') AS INTEGER) AS vlan, IF(raw_snmp.value=\'1\', FALSE, TRUE) AS active FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'dot1qVlanStatus\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 170, 'TRUNCATE TABLE tmp_src_snmp_system;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 180, 'INSERT IGNORE INTO tmp_src_snmp_system (ipid) SELECT DISTINCT raw_snmp.ipid FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'system\' AND raw_snmp.oid NOT LIKE \'iso.3.6.1.2.1.1.8.%\' AND raw_snmp.oid NOT LIKE \'iso.3.6.1.2.1.1.9.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 181, 'UPDATE IGNORE tmp_src_snmp_system INNER JOIN raw_snmp ON tmp_src_snmp_system.ipid=raw_snmp.ipid SET tmp_src_snmp_system.sysdescr=raw_snmp.value WHERE raw_snmp.oid=\'iso.3.6.1.2.1.1.1.0\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 182, 'UPDATE IGNORE tmp_src_snmp_system INNER JOIN raw_snmp ON tmp_src_snmp_system.ipid=raw_snmp.ipid SET tmp_src_snmp_system.sysobjectid=raw_snmp.value WHERE raw_snmp.oid=\'iso.3.6.1.2.1.1.2.0\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 183, 'UPDATE IGNORE tmp_src_snmp_system INNER JOIN raw_snmp ON tmp_src_snmp_system.ipid=raw_snmp.ipid SET tmp_src_snmp_system.sysuptime=CAST(raw_snmp.value AS INTEGER) WHERE raw_snmp.oid=\'iso.3.6.1.2.1.1.3.0\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 184, 'UPDATE IGNORE tmp_src_snmp_system INNER JOIN raw_snmp ON tmp_src_snmp_system.ipid=raw_snmp.ipid SET tmp_src_snmp_system.syscontact=raw_snmp.value WHERE raw_snmp.oid=\'iso.3.6.1.2.1.1.4.0\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 185, 'UPDATE IGNORE tmp_src_snmp_system INNER JOIN raw_snmp ON tmp_src_snmp_system.ipid=raw_snmp.ipid SET tmp_src_snmp_system.sysname=raw_snmp.value WHERE raw_snmp.oid=\'iso.3.6.1.2.1.1.5.0\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 186, 'UPDATE IGNORE tmp_src_snmp_system INNER JOIN raw_snmp ON tmp_src_snmp_system.ipid=raw_snmp.ipid SET tmp_src_snmp_system.syslocation=raw_snmp.value WHERE raw_snmp.oid=\'iso.3.6.1.2.1.1.6.0\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 187, 'UPDATE IGNORE tmp_src_snmp_system INNER JOIN raw_snmp ON tmp_src_snmp_system.ipid=raw_snmp.ipid SET tmp_src_snmp_system.sysservices=CAST(raw_snmp.value AS INTEGER) WHERE raw_snmp.oid=\'iso.3.6.1.2.1.1.7.0\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 190, 'TRUNCATE TABLE tmp_src_snmp_sysor;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 200, 'INSERT IGNORE INTO tmp_src_snmp_sysor (ipid, orindex) SELECT DISTINCT raw_snmp.ipid, CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+)$\', \'\\\\1\') AS INTEGER) AS orindex FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'system\' AND (raw_snmp.oid LIKE \'iso.3.6.1.2.1.1.9.1.2.%\' OR raw_snmp.oid LIKE \'iso.3.6.1.2.1.1.9.1.3.%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 201, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 202, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan, oid1) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan,0), CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+)$\', \'\\\\1\') AS INTEGER) AS oid1 FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'system\' AND raw_snmp.oid LIKE \'iso.3.6.1.2.1.1.9.1.2.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 203, 'UPDATE IGNORE tmp_src_snmp_sysor INNER JOIN tmp_src_snmp ON tmp_src_snmp_sysor.ipid=tmp_src_snmp.ipid AND tmp_src_snmp_sysor.orindex=tmp_src_snmp.oid1 SET tmp_src_snmp_sysor.sysorid=tmp_src_snmp.value;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 204, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 205, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan, oid1) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan,0), CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+)$\', \'\\\\1\') AS INTEGER) AS oid1 FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'system\' AND raw_snmp.oid LIKE \'iso.3.6.1.2.1.1.9.1.3.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 206, 'UPDATE IGNORE tmp_src_snmp_sysor INNER JOIN tmp_src_snmp ON tmp_src_snmp_sysor.ipid=tmp_src_snmp.ipid AND tmp_src_snmp_sysor.orindex=tmp_src_snmp.oid1 SET tmp_src_snmp_sysor.sysordescr=tmp_src_snmp.value;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 210, 'TRUNCATE TABLE tmp_src_snmp_router;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 220, 'INSERT IGNORE INTO tmp_src_snmp_router (routerid) SELECT DISTINCT raw_snmp.ipid FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name IN (\'ipForwarding\', \'ipCidrRouteNumber\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 221, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 222, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan,0) FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'ipForwarding\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 223, 'UPDATE IGNORE tmp_src_snmp_router INNER JOIN tmp_src_snmp ON tmp_src_snmp_router.routerid=tmp_src_snmp.ipid SET tmp_src_snmp_router.ipforwarding=IF(tmp_src_snmp.value=\'1\', TRUE, FALSE);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 224, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 225, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan,0) FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'ipCidrRouteNumber\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 226, 'UPDATE IGNORE tmp_src_snmp_router INNER JOIN tmp_src_snmp ON tmp_src_snmp_router.routerid=tmp_src_snmp.ipid SET tmp_src_snmp_router.ipcidrroutenumber=CAST(tmp_src_snmp.value AS INTEGER) WHERE tmp_src_snmp_router.routerid=tmp_src_snmp.ipid AND tmp_src_snmp.value RLIKE \'^\\\\d+$\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 230, 'TRUNCATE TABLE tmp_src_snmp_ipaddr;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 240, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 241, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan, oid4) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan,0), REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+)$\', \'\\\\1\') AS oid4 FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'ipAddrTable\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 242, 'INSERT IGNORE INTO tmp_src_snmp_ipaddr (routerid, ip) SELECT DISTINCT ipid, oid4 FROM tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 243, 'UPDATE IGNORE tmp_src_snmp_ipaddr INNER JOIN tmp_src_snmp ON tmp_src_snmp_ipaddr.routerid=tmp_src_snmp.ipid AND tmp_src_snmp_ipaddr.ip=tmp_src_snmp.oid4 SET tmp_src_snmp_ipaddr.ifindex=CAST(tmp_src_snmp.value AS INTEGER) WHERE tmp_src_snmp.oid LIKE \'iso.3.6.1.2.1.4.20.1.2.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 244, 'UPDATE IGNORE tmp_src_snmp_ipaddr INNER JOIN tmp_src_snmp ON tmp_src_snmp_ipaddr.routerid=tmp_src_snmp.ipid AND tmp_src_snmp_ipaddr.ip=tmp_src_snmp.oid4 SET tmp_src_snmp_ipaddr.netmask=tmp_src_snmp.value WHERE tmp_src_snmp.oid LIKE \'iso.3.6.1.2.1.4.20.1.3.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 245, 'UPDATE IGNORE tmp_src_snmp_ipaddr INNER JOIN tmp_src_snmp ON tmp_src_snmp_ipaddr.routerid=tmp_src_snmp.ipid AND tmp_src_snmp_ipaddr.ip=tmp_src_snmp.oid4 SET tmp_src_snmp_ipaddr.reasmmaxsize=CAST(tmp_src_snmp.value AS INTEGER) WHERE tmp_src_snmp.oid LIKE \'iso.3.6.1.2.1.4.20.1.5.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 246, 'UPDATE IGNORE tmp_src_snmp_ipaddr SET netnum=BIT_COUNT(INET_ATON(netmask)) WHERE netmask IS NOT NULL AND netmask LIKE \'%.%.%.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 247, 'UPDATE IGNORE tmp_src_snmp_router INNER JOIN (SELECT routerid, COUNT(*) AS ipaddrnumber FROM tmp_src_snmp_ipaddr GROUP BY routerid) AS tssi ON tmp_src_snmp_router.routerid=tssi.routerid SET tmp_src_snmp_router.ipaddrnumber=tssi.ipaddrnumber;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 250, 'TRUNCATE TABLE tmp_src_snmp_wlc;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 251, 'TRUNCATE TABLE tmp_src_snmp_wap;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 260, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 261, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan, oid6) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan,0), REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+)$\', \'\\\\1\') FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name IN (\'bsnAPDot3MacAddress\', \'bsnApIpAddress\', \'bsnAPName\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 262, 'INSERT IGNORE INTO tmp_src_snmp_wlc (ipid, wlcid) SELECT DISTINCT tmp_src_snmp.ipid, ref_wlc_type.wlcid FROM tmp_src_snmp INNER JOIN ref_wlc_type ON ref_wlc_type.wlc_type=\'cisco_wlc\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 263, 'INSERT IGNORE INTO tmp_src_snmp_wap (wapid, wlcid, mac) SELECT DISTINCT tmp_src_snmp.snmpid, tmp_src_snmp.ipid, tmp_src_snmp.value_hex FROM tmp_src_snmp INNER JOIN ref_scan_snmp_oid ON tmp_src_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'bsnAPDot3MacAddress\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 264, 'UPDATE tmp_src_snmp_wap INNER JOIN tmp_src_snmp ON tmp_src_snmp_wap.wapid=tmp_src_snmp.snmpid INNER JOIN tmp_src_snmp AS tss ON tmp_src_snmp.ipid=tss.ipid AND tmp_src_snmp.oid6=tss.oid6 INNER JOIN ref_scan_snmp_oid ON tss.oidid=ref_scan_snmp_oid.oidid INNER JOIN tmp_src_snmp_wlc ON tss.ipid=tmp_src_snmp_wlc.ipid INNER JOIN ref_wlc_type ON tmp_src_snmp_wlc.wlcid=tmp_src_snmp_wlc.wlcid SET tmp_src_snmp_wap.ip=tss.value WHERE ref_wlc_type.wlc_type=\'cisco_wlc\' AND ref_scan_snmp_oid.name=\'bsnApIpAddress\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 265, 'UPDATE tmp_src_snmp_wap INNER JOIN tmp_src_snmp ON tmp_src_snmp_wap.wapid=tmp_src_snmp.snmpid INNER JOIN tmp_src_snmp AS tss ON tmp_src_snmp.ipid=tss.ipid AND tmp_src_snmp.oid6=tss.oid6 INNER JOIN ref_scan_snmp_oid ON tss.oidid=ref_scan_snmp_oid.oidid INNER JOIN tmp_src_snmp_wlc ON tss.ipid=tmp_src_snmp_wlc.ipid INNER JOIN ref_wlc_type ON tmp_src_snmp_wlc.wlcid=tmp_src_snmp_wlc.wlcid SET tmp_src_snmp_wap.hostname=tss.value WHERE ref_wlc_type.wlc_type=\'cisco_wlc\' AND ref_scan_snmp_oid.name=\'bsnAPName\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 270, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 271, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan, oid6) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan,0), REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+)$\', \'\\\\1\') FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name IN (\'ruckusZDWLANAPMacAddr\', \'ruckusZDWLANAPIPAddr\', \'ruckusZDWLANAPDescription\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 272, 'INSERT IGNORE INTO tmp_src_snmp_wlc (ipid, wlcid) SELECT DISTINCT tmp_src_snmp.ipid, ref_wlc_type.wlcid FROM tmp_src_snmp INNER JOIN ref_wlc_type ON ref_wlc_type.wlc_type=\'ruckus_zd_wlc\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 273, 'INSERT IGNORE INTO tmp_src_snmp_wap (wapid, wlcid, mac) SELECT DISTINCT tmp_src_snmp.snmpid, tmp_src_snmp.ipid, tmp_src_snmp.value_hex FROM tmp_src_snmp INNER JOIN ref_scan_snmp_oid ON tmp_src_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'ruckusZDWLANAPMacAddr\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 274, 'UPDATE tmp_src_snmp_wap INNER JOIN tmp_src_snmp ON tmp_src_snmp_wap.wapid=tmp_src_snmp.snmpid INNER JOIN tmp_src_snmp AS tss ON tmp_src_snmp.ipid=tss.ipid AND tmp_src_snmp.oid6=tss.oid6 INNER JOIN ref_scan_snmp_oid ON tss.oidid=ref_scan_snmp_oid.oidid INNER JOIN tmp_src_snmp_wlc ON tss.ipid=tmp_src_snmp_wlc.ipid INNER JOIN ref_wlc_type ON tmp_src_snmp_wlc.wlcid=tmp_src_snmp_wlc.wlcid SET tmp_src_snmp_wap.ip=tss.value WHERE ref_wlc_type.wlc_type=\'ruckus_zd_wlc\' AND ref_scan_snmp_oid.name=\'ruckusZDWLANAPIPAddr\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 275, 'UPDATE tmp_src_snmp_wap INNER JOIN tmp_src_snmp ON tmp_src_snmp_wap.wapid=tmp_src_snmp.snmpid INNER JOIN tmp_src_snmp AS tss ON tmp_src_snmp.ipid=tss.ipid AND tmp_src_snmp.oid6=tss.oid6 INNER JOIN ref_scan_snmp_oid ON tss.oidid=ref_scan_snmp_oid.oidid INNER JOIN tmp_src_snmp_wlc ON tss.ipid=tmp_src_snmp_wlc.ipid INNER JOIN ref_wlc_type ON tmp_src_snmp_wlc.wlcid=tmp_src_snmp_wlc.wlcid SET tmp_src_snmp_wap.hostname=tss.value WHERE ref_wlc_type.wlc_type=\'ruckus_zd_wlc\' AND ref_scan_snmp_oid.name=\'ruckusZDWLANAPDescription\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 280, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 281, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan, oid6) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan,0), REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+)$\', \'\\\\1\') FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name IN (\'ruckusSCGAPMac\', \'ruckusSCGAPIp\', \'ruckusSCGAPName\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 282, 'INSERT IGNORE INTO tmp_src_snmp_wlc (ipid, wlcid) SELECT DISTINCT tmp_src_snmp.ipid, ref_wlc_type.wlcid FROM tmp_src_snmp INNER JOIN ref_wlc_type ON ref_wlc_type.wlc_type=\'ruckus_scg_wlc\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 283, 'INSERT IGNORE INTO tmp_src_snmp_wap (wapid, wlcid, mac) SELECT DISTINCT tmp_src_snmp.snmpid, tmp_src_snmp.ipid, tmp_src_snmp.value_hex FROM tmp_src_snmp INNER JOIN ref_scan_snmp_oid ON tmp_src_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'ruckusSCGAPMac\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 284, 'UPDATE tmp_src_snmp_wap INNER JOIN tmp_src_snmp ON tmp_src_snmp_wap.wapid=tmp_src_snmp.snmpid INNER JOIN tmp_src_snmp AS tss ON tmp_src_snmp.ipid=tss.ipid AND tmp_src_snmp.oid6=tss.oid6 INNER JOIN ref_scan_snmp_oid ON tss.oidid=ref_scan_snmp_oid.oidid INNER JOIN tmp_src_snmp_wlc ON tss.ipid=tmp_src_snmp_wlc.ipid INNER JOIN ref_wlc_type ON tmp_src_snmp_wlc.wlcid=tmp_src_snmp_wlc.wlcid SET tmp_src_snmp_wap.ip=tss.value WHERE ref_wlc_type.wlc_type=\'ruckus_scg_wlc\' AND ref_scan_snmp_oid.name=\'ruckusSCGAPIp\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 285, 'UPDATE tmp_src_snmp_wap INNER JOIN tmp_src_snmp ON tmp_src_snmp_wap.wapid=tmp_src_snmp.snmpid INNER JOIN tmp_src_snmp AS tss ON tmp_src_snmp.ipid=tss.ipid AND tmp_src_snmp.oid6=tss.oid6 INNER JOIN ref_scan_snmp_oid ON tss.oidid=ref_scan_snmp_oid.oidid INNER JOIN tmp_src_snmp_wlc ON tss.ipid=tmp_src_snmp_wlc.ipid INNER JOIN ref_wlc_type ON tmp_src_snmp_wlc.wlcid=tmp_src_snmp_wlc.wlcid SET tmp_src_snmp_wap.hostname=tss.value WHERE ref_wlc_type.wlc_type=\'ruckus_scg_wlc\' AND ref_scan_snmp_oid.name=\'ruckusSCGAPName\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 319, 'UPDATE IGNORE tmp_src_snmp_wlc INNER JOIN (SELECT wlcid, COUNT(*) AS wapnum FROM tmp_src_snmp_wap GROUP BY wlcid) AS tssw ON tmp_src_snmp_wlc.ipid=tssw.wlcid SET tmp_src_snmp_wlc.wapnum=tssw.wapnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 320, 'TRUNCATE TABLE tmp_src_snmp_cdp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 330, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 331, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan, oid6, oid1) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan,0), REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+\\\\.\\\\d+)$\', \'\\\\1\') AS oid6, CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+)\\\\.\\\\d+$\', \'\\\\1\') AS INTEGER) AS oid1 FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'cdpCache\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 332, 'INSERT IGNORE INTO tmp_src_snmp_cdp (switchid, ifindex, suffix) SELECT DISTINCT ipid, oid1, oid6 FROM tmp_src_snmp ORDER BY oidid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 333, 'UPDATE IGNORE tmp_src_snmp_cdp INNER JOIN tmp_src_snmp ON tmp_src_snmp_cdp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_cdp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_cdp.cdpcacheaddresstype=CAST(tmp_src_snmp.value AS INTEGER) WHERE tmp_src_snmp.oid LIKE \'iso.3.6.1.4.1.9.9.23.1.2.1.1.3.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 334, 'UPDATE IGNORE tmp_src_snmp_cdp INNER JOIN tmp_src_snmp ON tmp_src_snmp_cdp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_cdp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_cdp.cdpcacheversion=tmp_src_snmp.value WHERE tmp_src_snmp.oid LIKE \'iso.3.6.1.4.1.9.9.23.1.2.1.1.5.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 335, 'UPDATE IGNORE tmp_src_snmp_cdp INNER JOIN tmp_src_snmp ON tmp_src_snmp_cdp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_cdp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_cdp.cdpcachedeviceid=tmp_src_snmp.value WHERE tmp_src_snmp.oid LIKE \'iso.3.6.1.4.1.9.9.23.1.2.1.1.6.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 336, 'UPDATE IGNORE tmp_src_snmp_cdp INNER JOIN tmp_src_snmp ON tmp_src_snmp_cdp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_cdp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_cdp.cdpcachedeviceport=tmp_src_snmp.value WHERE tmp_src_snmp.oid LIKE \'iso.3.6.1.4.1.9.9.23.1.2.1.1.7.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 337, 'UPDATE IGNORE tmp_src_snmp_cdp INNER JOIN tmp_src_snmp ON tmp_src_snmp_cdp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_cdp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_cdp.cdpcacheplatform=tmp_src_snmp.value WHERE tmp_src_snmp.oid LIKE \'iso.3.6.1.4.1.9.9.23.1.2.1.1.8.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 338, 'UPDATE IGNORE tmp_src_snmp_cdp INNER JOIN tmp_src_snmp ON tmp_src_snmp_cdp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_cdp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_cdp.cdpcacheaddress=INET_NTOA(CONV(tmp_src_snmp.value_hex, 16, 10)) WHERE tmp_src_snmp.oid LIKE \'iso.3.6.1.4.1.9.9.23.1.2.1.1.4.%\' AND tmp_src_snmp_cdp.cdpcacheaddresstype=1;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 340, 'TRUNCATE TABLE tmp_src_snmp_lldp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 341, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 342, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan, oid6, oid1) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan,0), REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+\.\\\\d+)$\', \'\\\\1\') AS oid6, CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+)\\\\.\\\\d+$\', \'\\\\1\') AS INTEGER) AS oid1 FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'lldpRemEntry\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 343, 'INSERT IGNORE INTO tmp_src_snmp_lldp (switchid, ifindex, suffix) SELECT DISTINCT ipid, oid1, oid6 FROM tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 344, 'UPDATE IGNORE tmp_src_snmp_lldp INNER JOIN tmp_src_snmp ON tmp_src_snmp_lldp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_lldp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_lldp.lldpremchassisidsubtype=CAST(tmp_src_snmp.value AS INTEGER) WHERE tmp_src_snmp.oid LIKE \'iso.0.8802.1.1.2.1.4.1.1.4.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 345, 'UPDATE IGNORE tmp_src_snmp_lldp INNER JOIN tmp_src_snmp ON tmp_src_snmp_lldp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_lldp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_lldp.lldpremportidsubtype=CAST(tmp_src_snmp.value AS INTEGER) WHERE tmp_src_snmp.oid LIKE \'iso.0.8802.1.1.2.1.4.1.1.6.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 346, 'UPDATE IGNORE tmp_src_snmp_lldp INNER JOIN tmp_src_snmp ON tmp_src_snmp_lldp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_lldp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_lldp.lldpremportdesc=tmp_src_snmp.value WHERE tmp_src_snmp.oid LIKE \'iso.0.8802.1.1.2.1.4.1.1.8.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 347, 'UPDATE IGNORE tmp_src_snmp_lldp INNER JOIN tmp_src_snmp ON tmp_src_snmp_lldp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_lldp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_lldp.lldpremsysname=tmp_src_snmp.value WHERE tmp_src_snmp.oid LIKE \'iso.0.8802.1.1.2.1.4.1.1.9.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 348, 'UPDATE IGNORE tmp_src_snmp_lldp INNER JOIN tmp_src_snmp ON tmp_src_snmp_lldp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_lldp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_lldp.lldpremsysdesc=tmp_src_snmp.value WHERE tmp_src_snmp.oid LIKE \'iso.0.8802.1.1.2.1.4.1.1.10.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 349, 'UPDATE IGNORE tmp_src_snmp_lldp INNER JOIN tmp_src_snmp ON tmp_src_snmp_lldp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_lldp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_lldp.lldpremchassisid=tmp_src_snmp.value WHERE tmp_src_snmp_lldp.lldpremchassisidsubtype IN (1,6) AND tmp_src_snmp.oid LIKE \'iso.0.8802.1.1.2.1.4.1.1.5.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 350, 'UPDATE IGNORE tmp_src_snmp_lldp INNER JOIN tmp_src_snmp ON tmp_src_snmp_lldp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_lldp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_lldp.lldpremchassisid=tmp_src_snmp.value_hex WHERE tmp_src_snmp_lldp.lldpremchassisidsubtype=4 AND tmp_src_snmp.oid LIKE \'iso.0.8802.1.1.2.1.4.1.1.5.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 351, 'UPDATE IGNORE tmp_src_snmp_lldp INNER JOIN tmp_src_snmp ON tmp_src_snmp_lldp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_lldp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_lldp.lldpremchassisid=INET_NTOA(CONV(RIGHT(tmp_src_snmp.value_hex, 8), 16, 10)) WHERE tmp_src_snmp_lldp.lldpremchassisidsubtype=5 AND tmp_src_snmp.oid LIKE \'iso.0.8802.1.1.2.1.4.1.1.5.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 352, 'UPDATE IGNORE tmp_src_snmp_lldp INNER JOIN tmp_src_snmp ON tmp_src_snmp_lldp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_lldp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_lldp.lldpremchassisid=UPPER(REPLACE(tmp_src_snmp.value, \':\', \'\')) WHERE tmp_src_snmp_lldp.lldpremchassisidsubtype=7 AND tmp_src_snmp.value LIKE \'%:%:%:%:%:%\' AND tmp_src_snmp.oid LIKE \'iso.0.8802.1.1.2.1.4.1.1.5.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 353, 'UPDATE IGNORE tmp_src_snmp_lldp INNER JOIN tmp_src_snmp ON tmp_src_snmp_lldp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_lldp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_lldp.lldpremchassisid=tmp_src_snmp.value WHERE tmp_src_snmp_lldp.lldpremchassisid IS NULL AND tmp_src_snmp.oid LIKE \'iso.0.8802.1.1.2.1.4.1.1.5.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 354, 'UPDATE IGNORE tmp_src_snmp_lldp INNER JOIN tmp_src_snmp ON tmp_src_snmp_lldp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_lldp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_lldp.lldpremportid=tmp_src_snmp.value WHERE tmp_src_snmp_lldp.lldpremportidsubtype IN (1,5,7) AND tmp_src_snmp.oid LIKE \'iso.0.8802.1.1.2.1.4.1.1.7.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 355, 'UPDATE IGNORE tmp_src_snmp_lldp INNER JOIN tmp_src_snmp ON tmp_src_snmp_lldp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_lldp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_lldp.lldpremportid=tmp_src_snmp.value_hex WHERE tmp_src_snmp_lldp.lldpremportidsubtype=3 AND tmp_src_snmp.oid LIKE \'iso.0.8802.1.1.2.1.4.1.1.7.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 356, 'UPDATE IGNORE tmp_src_snmp_lldp INNER JOIN tmp_src_snmp ON tmp_src_snmp_lldp.switchid=tmp_src_snmp.ipid AND tmp_src_snmp_lldp.ifindex=tmp_src_snmp.oid1 SET tmp_src_snmp_lldp.lldpremportid=tmp_src_snmp.value WHERE tmp_src_snmp_lldp.lldpremportid IS NULL AND tmp_src_snmp.oid LIKE \'iso.0.8802.1.1.2.1.4.1.1.7.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 370, 'TRUNCATE TABLE tmp_src_snmp_portif_map;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 371, 'INSERT IGNORE INTO tmp_src_snmp_portif_map (id, ipid, port, ifindex) SELECT raw_snmp.snmpid, raw_snmp.ipid, CAST(REGEXP_REPLACE(raw_snmp.oid, \'^.+\\\\.(\\\\d+)$\', \'\\\\1\') AS INTEGER) AS port, CAST(raw_snmp.value AS INTEGER) AS ifindex FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name=\'dot1dBasePortIfIndex\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 418, 'TRUNCATE TABLE tmp_src_snmp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 2, 419, 'INSERT IGNORE INTO tmp_src_snmp (snmpid, ipid, oidid, oid, snmp_type, value, value_hex, vlan) SELECT raw_snmp.snmpid, raw_snmp.ipid, raw_snmp.oidid, raw_snmp.oid, raw_snmp.snmp_type, raw_snmp.value, raw_snmp.value_hex, IFNULL(raw_snmp.vlan,0) FROM raw_snmp INNER JOIN ref_scan_snmp_oid ON raw_snmp.oidid=ref_scan_snmp_oid.oidid WHERE ref_scan_snmp_oid.name NOT IN (\'ipNetToMediaPhysAddress\', \'dot1dTpFdbDestPortIfIndex\', \'ifIndex\', \'ifDescr\', \'ifAdminStatus\', \'ifOperStatus\', \'ifName\', \'ifAlias\', \'vtpVlanState\', \'jnxJdhcpLocalServerBindingsMacAddress\', \'dot1qVlanStatus\', \'system\', \'ipForwarding\', \'ipCidrRouteNumber\', \'ipAddrTable\', \'bsnAPDot3MacAddress\', \'bsnApIpAddress\', \'bsnAPName\', \'ruckusZDWLANAPMacAddr\', \'ruckusZDWLANAPIPAddr\', \'ruckusZDWLANAPDescription\', \'ruckusSCGAPMac\', \'ruckusSCGAPIp\', \'ruckusSCGAPName\', \'lldpRemEntry\', \'cdpCache\', \'dot1dBasePortIfIndex\', \'ifPhysAddress\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 11, 'INSERT IGNORE INTO src_snmp_arp (ip, routerid, mac) SELECT tmp_src_snmp_arp.ip, src_scan_ip.ipid, tmp_src_snmp_arp.mac FROM tmp_src_snmp_arp INNER JOIN tmp_src_scan_ip ON tmp_src_snmp_arp.routerid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE (src_scan_ip.ipid, tmp_src_snmp_arp.ip) NOT IN (SELECT routerid, ip FROM src_snmp_arp);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 12, 'INSERT IGNORE INTO src_snmp_mac (mac, switchid, port, vlan) SELECT tmp_src_snmp_mac.mac, src_scan_ip.ipid, tmp_src_snmp_mac.port, tmp_src_snmp_mac.vlan FROM tmp_src_snmp_mac INNER JOIN tmp_src_scan_ip ON tmp_src_snmp_mac.switchid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE (src_scan_ip.ipid, tmp_src_snmp_mac.mac, tmp_src_snmp_mac.vlan) NOT IN (SELECT switchid, mac, vlan FROM src_snmp_mac);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 13, 'INSERT IGNORE INTO src_snmp_dhcp (ip, routerid, mac) SELECT tmp_src_snmp_dhcp.ip, src_scan_ip.ipid, tmp_src_snmp_dhcp.mac FROM tmp_src_snmp_dhcp INNER JOIN tmp_src_scan_ip ON tmp_src_snmp_dhcp.routerid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE (src_scan_ip.ipid, tmp_src_snmp_dhcp.ip) NOT IN (SELECT routerid, ip FROM src_snmp_dhcp);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 14, 'INSERT IGNORE INTO src_snmp_vlan (switchid, vlan, active) SELECT src_scan_ip.ipid, tmp_src_snmp_vlan.vlan, tmp_src_snmp_vlan.active FROM tmp_src_snmp_vlan INNER JOIN tmp_src_scan_ip ON tmp_src_snmp_vlan.switchid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE (src_scan_ip.ipid, tmp_src_snmp_vlan.vlan) NOT IN (SELECT switchid, vlan FROM src_snmp_vlan);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 15, 'INSERT IGNORE INTO src_snmp_if (ipid, ifindexid, ifindex, ifdescr, ifname, ifalias, ifadminstatus, ifoperstatus, ifphysaddress, ifphysaddressnum, macvendorid) SELECT src_scan_ip.ipid, tmp_src_snmp_if.ifindexid, tmp_src_snmp_if.ifindex, tmp_src_snmp_if.ifdescr, tmp_src_snmp_if.ifname, tmp_src_snmp_if.ifalias, tmp_src_snmp_if.ifadminstatus, tmp_src_snmp_if.ifoperstatus, tmp_src_snmp_if.ifphysaddress, tmp_src_snmp_if.ifphysaddressnum, tmp_src_snmp_if.macvendorid FROM tmp_src_snmp_if INNER JOIN tmp_src_scan_ip ON tmp_src_snmp_if.ipid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE (src_scan_ip.ipid, tmp_src_snmp_if.ifindexid) NOT IN (SELECT ipid, ifindexid FROM src_snmp_if);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 16, 'INSERT IGNORE INTO src_snmp_system (ipid, sysdescr, sysobjectid, sysuptime, syscontact, sysname, syslocation, sysservices) SELECT src_scan_ip.ipid, tmp_src_snmp_system.sysdescr, tmp_src_snmp_system.sysobjectid, tmp_src_snmp_system.sysuptime, tmp_src_snmp_system.syscontact, tmp_src_snmp_system.sysname, tmp_src_snmp_system.syslocation, tmp_src_snmp_system.sysservices FROM tmp_src_snmp_system INNER JOIN tmp_src_scan_ip ON tmp_src_snmp_system.ipid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE src_scan_ip.ipid NOT IN (SELECT ipid FROM src_snmp_system);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 17, 'INSERT IGNORE INTO src_snmp_sysor (ipid, orindex, sysorid, sysordescr) SELECT src_scan_ip.ipid, tmp_src_snmp_sysor.orindex, tmp_src_snmp_sysor.sysorid, tmp_src_snmp_sysor.sysordescr FROM tmp_src_snmp_sysor INNER JOIN tmp_src_scan_ip ON tmp_src_snmp_sysor.ipid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE (src_scan_ip.ipid, tmp_src_snmp_sysor.orindex) NOT IN (SELECT ipid, orindex FROM src_snmp_sysor);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 18, 'INSERT IGNORE INTO src_snmp_router (routerid, ipforwarding, ipcidrroutenumber, ipaddrnumber) SELECT src_scan_ip.ipid, tmp_src_snmp_router.ipforwarding, tmp_src_snmp_router.ipcidrroutenumber, tmp_src_snmp_router.ipaddrnumber FROM tmp_src_snmp_router INNER JOIN tmp_src_scan_ip ON tmp_src_snmp_router.routerid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE src_scan_ip.ipid NOT IN (SELECT routerid FROM src_snmp_router);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 19, 'INSERT IGNORE INTO src_snmp_ipaddr (routerid, ip, ifindex, netmask, netnum, reasmmaxsize) SELECT src_scan_ip.ipid, tmp_src_snmp_ipaddr.ip, tmp_src_snmp_ipaddr.ifindex, tmp_src_snmp_ipaddr.netmask, tmp_src_snmp_ipaddr.netnum, tmp_src_snmp_ipaddr.reasmmaxsize FROM tmp_src_snmp_ipaddr INNER JOIN tmp_src_scan_ip ON tmp_src_snmp_ipaddr.routerid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE (src_scan_ip.ipid, tmp_src_snmp_ipaddr.ip) NOT IN (SELECT routerid, ip FROM src_snmp_ipaddr);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 20, 'INSERT IGNORE INTO src_snmp_wlc (ipid, wlcid, wapnum) SELECT src_scan_ip.ipid, tmp_src_snmp_wlc.wlcid, tmp_src_snmp_wlc.wapnum FROM tmp_src_snmp_wlc INNER JOIN tmp_src_scan_ip ON tmp_src_snmp_wlc.ipid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE (src_scan_ip.ipid) NOT IN (SELECT ipid FROM src_snmp_wlc);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 21, 'INSERT IGNORE INTO src_snmp_wap (wlcid, mac, ip, hostname) SELECT src_scan_ip.ipid, tmp_src_snmp_wap.mac, tmp_src_snmp_wap.ip, tmp_src_snmp_wap.hostname FROM tmp_src_snmp_wap INNER JOIN tmp_src_scan_ip ON tmp_src_snmp_wap.wlcid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE (src_scan_ip.ipid, tmp_src_snmp_wap.mac) NOT IN (SELECT wlcid, mac FROM src_snmp_wap);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 22, 'INSERT IGNORE INTO src_snmp_cdp (switchid, ifindex, cdpcacheaddresstype, cdpcacheaddress, cdpcacheversion, cdpcachedeviceid, cdpcachedeviceport, cdpcacheplatform) SELECT src_scan_ip.ipid, tmp_src_snmp_cdp.ifindex, tmp_src_snmp_cdp.cdpcacheaddresstype, tmp_src_snmp_cdp.cdpcacheaddress, tmp_src_snmp_cdp.cdpcacheversion, tmp_src_snmp_cdp.cdpcachedeviceid, tmp_src_snmp_cdp.cdpcachedeviceport, tmp_src_snmp_cdp.cdpcacheplatform FROM tmp_src_snmp_cdp INNER JOIN tmp_src_scan_ip ON tmp_src_snmp_cdp.switchid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE (src_scan_ip.ipid, tmp_src_snmp_cdp.ifindex) NOT IN (SELECT switchid, ifindex FROM src_snmp_cdp);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 23, 'INSERT IGNORE INTO src_snmp_lldp (switchid, ifindex, lldpremchassisidsubtype, lldpremchassisid, lldpremportidsubtype, lldpremportid, lldpremportdesc, lldpremsysname, lldpremsysdesc) SELECT src_scan_ip.ipid, tssl.ifindex, tssl.lldpremchassisidsubtype, tssl.lldpremchassisid, tssl.lldpremportidsubtype, tssl.lldpremportid, tssl.lldpremportdesc, tssl.lldpremsysname, tssl.lldpremsysdesc FROM tmp_src_snmp_lldp AS tssl INNER JOIN tmp_src_scan_ip ON tssl.switchid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip LEFT JOIN src_snmp_lldp ON src_scan_ip.ipid=src_snmp_lldp.switchid AND tssl.ifindex=src_snmp_lldp.ifindex WHERE src_snmp_lldp.lldpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 24, 'INSERT IGNORE INTO src_snmp (ipid, oidid, oid, snmp_type, value, value_hex, vlan) SELECT src_scan_ip.ipid, tmp_src_snmp.oidid, tmp_src_snmp.oid, tmp_src_snmp.snmp_type, tmp_src_snmp.value, tmp_src_snmp.value_hex, tmp_src_snmp.vlan FROM tmp_src_snmp INNER JOIN tmp_src_scan_ip ON tmp_src_snmp.ipid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip LEFT JOIN src_snmp ON src_scan_ip.ipid=src_snmp.ipid AND tmp_src_snmp.oid=src_snmp.oid WHERE src_snmp.snmpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 25, 'INSERT IGNORE INTO src_snmp_portif_map (ipid, port, ifindex) SELECT src_scan_ip.ipid, tmp_src_snmp_portif_map.port, tmp_src_snmp_portif_map.ifindex FROM tmp_src_snmp_portif_map INNER JOIN tmp_src_scan_ip ON tmp_src_snmp_portif_map.ipid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip LEFT JOIN src_snmp_portif_map ON src_scan_ip.ipid=src_snmp_portif_map.ipid AND tmp_src_snmp_portif_map.port=src_snmp_portif_map.port WHERE src_snmp_portif_map.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 51, 'UPDATE IGNORE src_snmp_arp INNER JOIN src_scan_ip ON src_snmp_arp.routerid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_snmp_arp ON tmp_src_scan_ip.ipid=tmp_src_snmp_arp.routerid AND src_snmp_arp.ip=tmp_src_snmp_arp.ip SET src_snmp_arp.mac=tmp_src_snmp_arp.mac;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 52, 'UPDATE IGNORE src_snmp_mac INNER JOIN src_scan_ip ON src_snmp_mac.switchid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_snmp_mac ON tmp_src_scan_ip.ipid=tmp_src_snmp_mac.switchid AND src_snmp_mac.mac=tmp_src_snmp_mac.mac AND src_snmp_mac.vlan=tmp_src_snmp_mac.vlan SET src_snmp_mac.port=tmp_src_snmp_mac.port;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 53, 'UPDATE IGNORE src_snmp_dhcp INNER JOIN src_scan_ip ON src_snmp_dhcp.routerid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_snmp_dhcp ON tmp_src_scan_ip.ipid=tmp_src_snmp_dhcp.routerid AND src_snmp_dhcp.ip=tmp_src_snmp_dhcp.ip SET src_snmp_dhcp.mac=tmp_src_snmp_dhcp.mac;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 54, 'UPDATE IGNORE src_snmp_vlan INNER JOIN src_scan_ip ON src_snmp_vlan.switchid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_snmp_vlan ON tmp_src_scan_ip.ipid=tmp_src_snmp_vlan.switchid AND src_snmp_vlan.vlan=tmp_src_snmp_vlan.vlan SET src_snmp_vlan.active=tmp_src_snmp_vlan.active;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 55, 'UPDATE IGNORE src_snmp_if INNER JOIN src_scan_ip ON src_snmp_if.ipid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_snmp_if ON tmp_src_scan_ip.ipid=tmp_src_snmp_if.ipid AND src_snmp_if.ifindexid=tmp_src_snmp_if.ifindexid SET src_snmp_if.ifdescr=tmp_src_snmp_if.ifdescr, src_snmp_if.ifname=tmp_src_snmp_if.ifname, src_snmp_if.ifalias=tmp_src_snmp_if.ifalias, src_snmp_if.ifadminstatus=tmp_src_snmp_if.ifadminstatus, src_snmp_if.ifoperstatus=tmp_src_snmp_if.ifoperstatus, src_snmp_if.ifindex=tmp_src_snmp_if.ifindex, src_snmp_if.ifphysaddress=tmp_src_snmp_if.ifphysaddress, src_snmp_if.ifphysaddressnum=tmp_src_snmp_if.ifphysaddressnum, src_snmp_if.macvendorid=tmp_src_snmp_if.macvendorid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 56, 'UPDATE IGNORE src_snmp_system INNER JOIN src_scan_ip ON src_snmp_system.ipid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_snmp_system ON tmp_src_scan_ip.ipid=tmp_src_snmp_system.ipid SET src_snmp_system.sysdescr=tmp_src_snmp_system.sysdescr, src_snmp_system.sysobjectid=tmp_src_snmp_system.sysobjectid, src_snmp_system.sysuptime=tmp_src_snmp_system.sysuptime, src_snmp_system.syscontact=tmp_src_snmp_system.syscontact, src_snmp_system.sysname=tmp_src_snmp_system.sysname, src_snmp_system.syslocation=tmp_src_snmp_system.syslocation, src_snmp_system.sysservices=tmp_src_snmp_system.sysservices;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 57, 'UPDATE IGNORE src_snmp_sysor INNER JOIN src_scan_ip ON src_snmp_sysor.ipid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_snmp_sysor ON tmp_src_scan_ip.ipid=tmp_src_snmp_sysor.ipid AND src_snmp_sysor.orindex=tmp_src_snmp_sysor.orindex SET src_snmp_sysor.sysorid=tmp_src_snmp_sysor.sysorid, src_snmp_sysor.sysordescr=tmp_src_snmp_sysor.sysordescr;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 58, 'UPDATE IGNORE src_snmp_router INNER JOIN src_scan_ip ON src_snmp_router.routerid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_snmp_router ON tmp_src_scan_ip.ipid=tmp_src_snmp_router.routerid SET src_snmp_router.ipforwarding=tmp_src_snmp_router.ipforwarding, src_snmp_router.ipcidrroutenumber=tmp_src_snmp_router.ipcidrroutenumber, src_snmp_router.ipaddrnumber=tmp_src_snmp_router.ipcidrroutenumber;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 59, 'UPDATE IGNORE src_snmp_ipaddr INNER JOIN src_scan_ip ON src_snmp_ipaddr.routerid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_snmp_ipaddr ON tmp_src_scan_ip.ipid=tmp_src_snmp_ipaddr.routerid AND src_snmp_ipaddr.ip=tmp_src_snmp_ipaddr.ip SET src_snmp_ipaddr.ifindex=tmp_src_snmp_ipaddr.ifindex, src_snmp_ipaddr.netmask=tmp_src_snmp_ipaddr.netmask, src_snmp_ipaddr.netnum=tmp_src_snmp_ipaddr.netnum, src_snmp_ipaddr.reasmmaxsize=tmp_src_snmp_ipaddr.reasmmaxsize;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 60, 'UPDATE IGNORE src_snmp_wlc INNER JOIN src_scan_ip ON src_snmp_wlc.ipid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_snmp_wlc ON tmp_src_scan_ip.ipid=tmp_src_snmp_wlc.ipid SET src_snmp_wlc.wlcid=tmp_src_snmp_wlc.wlcid, src_snmp_wlc.wapnum=tmp_src_snmp_wlc.wapnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 61, 'UPDATE IGNORE src_snmp_wap INNER JOIN src_scan_ip ON src_snmp_wap.wlcid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_snmp_wap ON tmp_src_scan_ip.ipid=tmp_src_snmp_wap.wlcid AND src_snmp_wap.mac=tmp_src_snmp_wap.mac SET src_snmp_wap.ip=tmp_src_snmp_wap.ip, src_snmp_wap.hostname=tmp_src_snmp_wap.hostname;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 62, 'UPDATE IGNORE src_snmp_cdp INNER JOIN src_scan_ip ON src_snmp_cdp.switchid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_snmp_cdp ON tmp_src_scan_ip.ipid=tmp_src_snmp_cdp.switchid AND src_snmp_cdp.ifindex=tmp_src_snmp_cdp.ifindex SET src_snmp_cdp.cdpcacheaddresstype=tmp_src_snmp_cdp.cdpcacheaddresstype, src_snmp_cdp.cdpcacheaddress=tmp_src_snmp_cdp.cdpcacheaddress, src_snmp_cdp.cdpcacheversion=tmp_src_snmp_cdp.cdpcacheversion, src_snmp_cdp.cdpcachedeviceid=tmp_src_snmp_cdp.cdpcachedeviceid, src_snmp_cdp.cdpcachedeviceport=tmp_src_snmp_cdp.cdpcachedeviceport, src_snmp_cdp.cdpcacheplatform=tmp_src_snmp_cdp.cdpcacheplatform;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 63, 'UPDATE IGNORE src_snmp_lldp INNER JOIN src_scan_ip ON src_snmp_lldp.switchid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_snmp_lldp AS tssl ON tmp_src_scan_ip.ipid=tssl.switchid AND src_snmp_lldp.ifindex=tssl.ifindex SET src_snmp_lldp.lldpremchassisidsubtype=tssl.lldpremchassisidsubtype, src_snmp_lldp.lldpremchassisid=tssl.lldpremchassisid, src_snmp_lldp.lldpremportidsubtype=tssl.lldpremportidsubtype, src_snmp_lldp.lldpremportid=tssl.lldpremportid, src_snmp_lldp.lldpremportdesc=tssl.lldpremportdesc, src_snmp_lldp.lldpremsysname=tssl.lldpremsysname, src_snmp_lldp.lldpremsysdesc=tssl.lldpremsysdesc;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 64, 'UPDATE IGNORE src_snmp INNER JOIN src_scan_ip ON src_snmp.ipid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_snmp ON tmp_src_scan_ip.ipid=tmp_src_snmp.ipid AND src_snmp.oid=tmp_src_snmp.oid SET src_snmp.snmp_type=tmp_src_snmp.snmp_type, src_snmp.value=tmp_src_snmp.value, src_snmp.value_hex=tmp_src_snmp.value_hex, src_snmp.vlan=tmp_src_snmp.vlan;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 3, 65, 'UPDATE IGNORE src_snmp_portif_map INNER JOIN src_scan_ip ON src_snmp_portif_map.ipid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_snmp_portif_map ON tmp_src_scan_ip.ipid=tmp_src_snmp_portif_map.ipid AND src_snmp_portif_map.port=tmp_src_snmp_portif_map.port SET src_snmp_portif_map.ifindex=tmp_src_snmp_portif_map.ifindex;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 4, 10, 'DELETE IGNORE src_snmp FROM src_snmp INNER JOIN src_scan_ip ON src_snmp.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_snmp ON tmp_src_scan_ip.ipid=tmp_src_snmp.ipid AND src_snmp.oid=tmp_src_snmp.oid WHERE tmp_src_snmp.snmpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 4, 11, 'DELETE IGNORE src_snmp_arp FROM src_snmp_arp INNER JOIN src_scan_ip ON src_snmp_arp.routerid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_snmp_arp ON tmp_src_scan_ip.ipid=tmp_src_snmp_arp.routerid AND src_snmp_arp.ip=tmp_src_snmp_arp.ip WHERE tmp_src_snmp_arp.arpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 4, 12, 'DELETE IGNORE src_snmp_mac FROM src_snmp_mac INNER JOIN src_scan_ip ON src_snmp_mac.switchid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_snmp_mac ON tmp_src_scan_ip.ipid=tmp_src_snmp_mac.switchid AND src_snmp_mac.mac=tmp_src_snmp_mac.mac AND src_snmp_mac.vlan=tmp_src_snmp_mac.vlan WHERE tmp_src_snmp_mac.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 4, 13, 'DELETE IGNORE src_snmp_dhcp FROM src_snmp_dhcp INNER JOIN src_scan_ip ON src_snmp_dhcp.routerid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_snmp_dhcp ON tmp_src_scan_ip.ipid=tmp_src_snmp_dhcp.routerid AND src_snmp_dhcp.ip=tmp_src_snmp_dhcp.ip WHERE tmp_src_snmp_dhcp.dhcpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 4, 14, 'DELETE IGNORE src_snmp_vlan FROM src_snmp_vlan INNER JOIN src_scan_ip ON src_snmp_vlan.switchid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_snmp_vlan ON tmp_src_scan_ip.ipid=tmp_src_snmp_vlan.switchid AND src_snmp_vlan.vlan=tmp_src_snmp_vlan.vlan WHERE tmp_src_snmp_vlan.vlanid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 4, 15, 'DELETE IGNORE src_snmp_if FROM src_snmp_if INNER JOIN src_scan_ip ON src_snmp_if.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_snmp_if ON tmp_src_scan_ip.ipid=tmp_src_snmp_if.ipid AND src_snmp_if.ifindexid=tmp_src_snmp_if.ifindexid WHERE tmp_src_snmp_if.ifid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 4, 16, 'DELETE IGNORE src_snmp_system FROM src_snmp_system INNER JOIN src_scan_ip ON src_snmp_system.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_snmp_system ON tmp_src_scan_ip.ipid=src_snmp_system.ipid WHERE src_snmp_system.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 4, 17, 'DELETE IGNORE src_snmp_sysor FROM src_snmp_sysor INNER JOIN src_scan_ip ON src_snmp_sysor.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_snmp_sysor ON tmp_src_scan_ip.ipid=tmp_src_snmp_sysor.ipid AND src_snmp_sysor.orindex=tmp_src_snmp_sysor.orindex WHERE tmp_src_snmp_sysor.orid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 4, 18, 'DELETE IGNORE src_snmp_router FROM src_snmp_router INNER JOIN src_scan_ip ON src_snmp_router.routerid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_snmp_router ON tmp_src_scan_ip.ipid=tmp_src_snmp_router.routerid WHERE tmp_src_snmp_router.routerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 4, 19, 'DELETE IGNORE src_snmp_ipaddr FROM src_snmp_ipaddr INNER JOIN src_scan_ip ON src_snmp_ipaddr.routerid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_snmp_ipaddr ON tmp_src_scan_ip.ipid=tmp_src_snmp_ipaddr.routerid AND src_snmp_ipaddr.ip=tmp_src_snmp_ipaddr.ip WHERE tmp_src_snmp_ipaddr.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 4, 20, 'DELETE IGNORE src_snmp_wap FROM src_snmp_wap INNER JOIN src_scan_ip ON src_snmp_wap.wlcid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_snmp_wap ON tmp_src_scan_ip.ipid=tmp_src_snmp_wap.wlcid AND src_snmp_wap.mac=tmp_src_snmp_wap.mac WHERE tmp_src_snmp_wap.wapid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 4, 21, 'DELETE IGNORE src_snmp_wlc FROM src_snmp_wlc INNER JOIN src_scan_ip ON src_snmp_wlc.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_snmp_wlc ON tmp_src_scan_ip.ipid=tmp_src_snmp_wlc.ipid WHERE tmp_src_snmp_wlc.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 4, 22, 'DELETE IGNORE src_snmp_cdp FROM src_snmp_cdp INNER JOIN src_scan_ip ON src_snmp_cdp.switchid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_snmp_cdp ON tmp_src_scan_ip.ipid=tmp_src_snmp_cdp.switchid AND src_snmp_cdp.ifindex=tmp_src_snmp_cdp.ifindex WHERE tmp_src_snmp_cdp.cdpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 4, 23, 'DELETE IGNORE src_snmp_lldp FROM src_snmp_lldp INNER JOIN src_scan_ip ON src_snmp_lldp.switchid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_snmp_lldp ON tmp_src_scan_ip.ipid=tmp_src_snmp_lldp.switchid AND src_snmp_lldp.ifindex=tmp_src_snmp_lldp.ifindex WHERE tmp_src_snmp_lldp.lldpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (504, 4, 25, 'DELETE IGNORE src_snmp_portif_map FROM src_snmp_portif_map INNER JOIN src_scan_ip ON src_snmp_portif_map.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_snmp_portif_map ON tmp_src_scan_ip.ipid=tmp_src_snmp_portif_map.ipid AND src_snmp_portif_map.port=tmp_src_snmp_portif_map.port WHERE tmp_src_snmp_portif_map.id IS NULL;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (505, 1, 10, 'CREATE TEMPORARY TABLE tmp_src_mist (mistid INT NOT NULL PRIMARY KEY, mac VARCHAR(12) NOT NULL UNIQUE, ip VARCHAR(39) DEFAULT NULL, ext_ip VARCHAR(39) DEFAULT NULL, status VARCHAR(20) DEFAULT NULL, type VARCHAR(20) DEFAULT NULL, last_seen BIGINT DEFAULT NULL, uptime BIGINT DEFAULT NULL, name VARCHAR(100) DEFAULT NULL, model VARCHAR(20) DEFAULT NULL, lldp_stat_chassis_id VARCHAR(17) DEFAULT NULL, lldp_stat_system_name VARCHAR(100) DEFAULT NULL, lldp_stat_system_desc VARCHAR(256) DEFAULT NULL, lldp_stat_port_desc VARCHAR(100) DEFAULT NULL, lldp_stat_port_id VARCHAR(50) DEFAULT NULL, KEY ip (ip), KEY ext_ip (ext_ip), KEY status (status), KEY last_seen (last_seen)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (505, 2, 10, 'TRUNCATE TABLE tmp_src_mist;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (505, 2, 20, 'INSERT IGNORE INTO tmp_src_mist (mistid, mac) SELECT DISTINCT raw_mist.mistid, UPPER(raw_mist.mac) FROM raw_mist INNER JOIN ref_ipprefix AS rip1 ON INET_ATON(raw_mist.ext_ip) BETWEEN rip1.startipnum AND rip1.endipnum INNER JOIN ref_ipprefix AS rip2 ON INET_ATON(raw_mist.ip) BETWEEN rip2.startipnum AND rip2.endipnum WHERE raw_mist.ext_ip IS NOT NULL AND raw_mist.ip IS NOT NULL AND raw_mist.ext_ip LIKE \'%.%.%.%\' AND raw_mist.ip LIKE \'%.%.%.%\' AND rip1.siteid=rip2.siteid AND rip1.siteid<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (505, 2, 21, 'INSERT IGNORE INTO tmp_src_mist (mistid, mac) SELECT DISTINCT raw_mist.mistid, UPPER(raw_mist.mac) FROM raw_mist WHERE (raw_mist.ext_ip IS NULL OR raw_mist.ip IS NULL OR raw_mist.ext_ip NOT LIKE \'%.%.%.%\' OR raw_mist.ip NOT LIKE \'%.%.%.%\') AND UPPER(mac) NOT IN (SELECT mac FROM tmp_src_mist) AND UPPER(mac) IN (SELECT mac FROM src_mist);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (505, 2, 22, 'UPDATE IGNORE tmp_src_mist AS tsm INNER JOIN raw_mist AS rm ON tsm.mistid=rm.mistid SET tsm.ip=rm.ip, tsm.ext_ip=rm.ext_ip, tsm.status=rm.status, tsm.type=rm.type, tsm.last_seen=rm.last_seen, tsm.uptime=rm.uptime, tsm.name=rm.name, tsm.model=rm.model, tsm.lldp_stat_chassis_id=rm.lldp_stat_chassis_id, tsm.lldp_stat_system_name=rm.lldp_stat_system_name, tsm.lldp_stat_system_desc=rm.lldp_stat_system_desc, tsm.lldp_stat_port_desc=rm.lldp_stat_port_desc, tsm.lldp_stat_port_id=rm.lldp_stat_port_id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (505, 2, 30, 'INSERT IGNORE INTO src_mist (mac, ip, ext_ip, status, type, last_seen, uptime, name, model, lldp_stat_chassis_id, lldp_stat_system_name, lldp_stat_system_desc, lldp_stat_port_desc, lldp_stat_port_id) SELECT mac, ip, ext_ip, status, type, last_seen, uptime, name, model, lldp_stat_chassis_id, lldp_stat_system_name, lldp_stat_system_desc, lldp_stat_port_desc, lldp_stat_port_id FROM tmp_src_mist WHERE mac NOT IN (SELECT mac FROM src_mist);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (505, 2, 40, 'UPDATE IGNORE src_mist AS sm INNER JOIN tmp_src_mist AS tsm ON sm.mac=tsm.mac SET sm.ip=tsm.ip, sm.ext_ip=tsm.ext_ip, sm.status=tsm.status, sm.type=tsm.type, sm.last_seen=tsm.last_seen, sm.uptime=tsm.uptime, sm.name=tsm.name, sm.model=tsm.model, sm.lldp_stat_chassis_id=tsm.lldp_stat_chassis_id, sm.lldp_stat_system_name=tsm.lldp_stat_system_name, sm.lldp_stat_system_desc=tsm.lldp_stat_system_desc, sm.lldp_stat_port_desc=tsm.lldp_stat_port_desc, sm.lldp_stat_port_id=tsm.lldp_stat_port_id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (505, 2, 50, 'DELETE IGNORE src_mist FROM src_mist WHERE mac NOT IN (SELECT mac FROM tmp_src_mist);', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 1, 10, 'CREATE TEMPORARY TABLE tmp_src_ruckussz_wlc (ipid INT NOT NULL PRIMARY KEY, wapnum INT UNSIGNED DEFAULT NULL) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 1, 20, 'CREATE TEMPORARY TABLE tmp_src_ruckussz_wap (wapid INT NOT NULL PRIMARY KEY, wlcid INT NOT NULL, mac VARCHAR(12) NOT NULL, ip VARCHAR(39) DEFAULT NULL, externalip VARCHAR(39) DEFAULT NULL, name VARCHAR(100) DEFAULT NULL, model VARCHAR(20) DEFAULT NULL, location VARCHAR(100) DEFAULT NULL, administrativestate VARCHAR(20) DEFAULT NULL, countrycode VARCHAR(20) DEFAULT NULL, configstate VARCHAR(20) DEFAULT NULL, connectionstate VARCHAR(20) DEFAULT NULL, registrationstate VARCHAR(20) DEFAULT NULL, lastseentime BIGINT UNSIGNED DEFAULT NULL, approvedtime BIGINT UNSIGNED DEFAULT NULL, uptime BIGINT UNSIGNED DEFAULT NULL, clientcount INT UNSIGNED DEFAULT NULL, UNIQUE KEY wlcmac (wlcid, mac), KEY wlcid (wlcid), KEY mac (mac), KEY ip (ip), KEY externalip (externalip), KEY connectionstate (connectionstate)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 1, 30, 'CREATE TEMPORARY TABLE tmp_src_scan_ip (ipid INT NOT NULL PRIMARY KEY, ip VARCHAR(39) NOT NULL UNIQUE) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 2, 10, 'TRUNCATE TABLE tmp_src_ruckussz_wlc;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 2, 11, 'TRUNCATE TABLE tmp_src_ruckussz_wap;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 2, 12, 'TRUNCATE TABLE tmp_src_scan_ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 2, 13, 'INSERT IGNORE INTO tmp_src_scan_ip (ipid, ip) SELECT ipid, ip FROM raw_scan_ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 2, 20, 'INSERT IGNORE INTO tmp_src_ruckussz_wlc (ipid) SELECT DISTINCT tmp_src_scan_ip.ipid FROM raw_ruckussz INNER JOIN tmp_src_scan_ip ON raw_ruckussz.wlcip=tmp_src_scan_ip.ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 2, 21, 'INSERT IGNORE INTO tmp_src_ruckussz_wap (wapid, wlcid, mac) SELECT DISTINCT raw_ruckussz.wapid, tmp_src_scan_ip.ipid, UPPER(REPLACE(raw_ruckussz.mac, \':\', \'\')) FROM raw_ruckussz INNER JOIN tmp_src_scan_ip ON raw_ruckussz.wlcip=tmp_src_scan_ip.ip INNER JOIN ref_ipprefix AS rip1 ON INET_ATON(raw_ruckussz.externalip) BETWEEN rip1.startipnum AND rip1.endipnum INNER JOIN ref_ipprefix AS rip2 ON INET_ATON(raw_ruckussz.ip) BETWEEN rip2.startipnum AND rip2.endipnum WHERE raw_ruckussz.externalip IS NOT NULL AND raw_ruckussz.ip IS NOT NULL AND raw_ruckussz.externalip LIKE \'%.%.%.%\' AND raw_ruckussz.ip LIKE \'%.%.%.%\' AND rip1.siteid=rip2.siteid AND rip1.siteid<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 2, 22, 'INSERT IGNORE INTO tmp_src_ruckussz_wap (wapid, wlcid, mac) SELECT DISTINCT raw_ruckussz.wapid, tmp_src_scan_ip.ipid, UPPER(REPLACE(raw_ruckussz.mac, \':\', \'\')) FROM raw_ruckussz INNER JOIN tmp_src_scan_ip ON raw_ruckussz.wlcip=tmp_src_scan_ip.ip WHERE (raw_ruckussz.externalip IS NULL OR raw_ruckussz.ip IS NULL OR raw_ruckussz.externalip NOT LIKE \'%.%.%.%\' OR raw_ruckussz.ip NOT LIKE \'%.%.%.%\') AND UPPER(REPLACE(raw_ruckussz.mac, \':\', \'\')) NOT IN (SELECT mac FROM tmp_src_ruckussz_wap) AND UPPER(REPLACE(raw_ruckussz.mac, \':\', \'\')) IN (SELECT mac FROM src_ruckussz_wap);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 2, 23, 'UPDATE IGNORE tmp_src_ruckussz_wap AS tsrw INNER JOIN raw_ruckussz AS rr ON tsrw.wapid=rr.wapid SET tsrw.ip=rr.ip, tsrw.externalip=rr.externalip, tsrw.name=rr.name, tsrw.model=rr.model, tsrw.location=rr.location, tsrw.administrativestate=rr.administrativestate, tsrw.countrycode=rr.countrycode, tsrw.configstate=rr.configstate, tsrw.connectionstate=rr.connectionstate, tsrw.registrationstate=rr.registrationstate, tsrw.lastseentime=rr.lastseentime, tsrw.approvedtime=rr.approvedtime, tsrw.uptime=IF(rr.uptime IS NULL OR rr.uptime<0, NULL, rr.uptime), tsrw.clientcount=rr.clientcount;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 2, 24, 'UPDATE IGNORE tmp_src_ruckussz_wlc INNER JOIN (SELECT wlcid, COUNT(*) AS wapnum FROM tmp_src_ruckussz_wap GROUP BY wlcid) AS tsrw ON tmp_src_ruckussz_wlc.ipid=tsrw.wlcid SET tmp_src_ruckussz_wlc.wapnum=tsrw.wapnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 2, 30, 'INSERT IGNORE INTO src_ruckussz_wlc (ipid, wapnum) SELECT src_scan_ip.ipid, tmp_src_ruckussz_wlc.wapnum FROM tmp_src_ruckussz_wlc INNER JOIN tmp_src_scan_ip ON tmp_src_ruckussz_wlc.ipid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE src_scan_ip.ipid NOT IN (SELECT ipid FROM src_ruckussz_wlc);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 2, 31, 'INSERT IGNORE INTO src_ruckussz_wap (wlcid, mac, ip, externalip, name, model, location, administrativestate, countrycode, configstate, connectionstate, registrationstate, lastseentime, approvedtime, uptime, clientcount) SELECT src_scan_ip.ipid, tmp_src_ruckussz_wap.mac, tmp_src_ruckussz_wap.ip, tmp_src_ruckussz_wap.externalip, tmp_src_ruckussz_wap.name, tmp_src_ruckussz_wap.model, tmp_src_ruckussz_wap.location, tmp_src_ruckussz_wap.administrativestate, tmp_src_ruckussz_wap.countrycode, tmp_src_ruckussz_wap.configstate, tmp_src_ruckussz_wap.connectionstate, tmp_src_ruckussz_wap.registrationstate, tmp_src_ruckussz_wap.lastseentime, tmp_src_ruckussz_wap.approvedtime, tmp_src_ruckussz_wap.uptime, tmp_src_ruckussz_wap.clientcount FROM tmp_src_ruckussz_wap INNER JOIN tmp_src_scan_ip ON tmp_src_ruckussz_wap.wlcid=tmp_src_scan_ip.ipid INNER JOIN src_scan_ip ON tmp_src_scan_ip.ip=src_scan_ip.ip WHERE (src_scan_ip.ipid, tmp_src_ruckussz_wap.mac) NOT IN (SELECT wlcid, mac FROM tmp_src_ruckussz_wap);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 2, 40, 'UPDATE IGNORE src_ruckussz_wlc INNER JOIN src_scan_ip ON src_ruckussz_wlc.ipid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip INNER JOIN tmp_src_ruckussz_wlc ON tmp_src_scan_ip.ipid=tmp_src_ruckussz_wlc.ipid SET src_ruckussz_wlc.wapnum=tmp_src_ruckussz_wlc.wapnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 2, 41, 'UPDATE IGNORE src_ruckussz_wap AS srw INNER JOIN src_scan_ip ON srw.wlcid=src_scan_ip.ipid INNER JOIN tmp_src_scan_ip ON src_scan_ip.ipid=tmp_src_scan_ip.ip INNER JOIN tmp_src_ruckussz_wap AS tsrw ON tmp_src_scan_ip.ipid=tsrw.wlcid AND srw.mac=tsrw.mac SET srw.ip=tsrw.ip, srw.externalip=tsrw.externalip, srw.name=tsrw.name, srw.model=tsrw.model, srw.location=tsrw.location, srw.administrativestate=tsrw.administrativestate, srw.countrycode=tsrw.countrycode, srw.configstate=tsrw.configstate, srw.connectionstate=tsrw.connectionstate, srw.registrationstate=tsrw.registrationstate, srw.lastseentime=tsrw.lastseentime, srw.approvedtime=tsrw.approvedtime, srw.uptime=tsrw.uptime, srw.clientcount=tsrw.clientcount;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 2, 50, 'DELETE IGNORE src_ruckussz_wlc FROM src_ruckussz_wlc INNER JOIN src_scan_ip ON src_ruckussz_wlc.ipid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_ruckussz_wlc ON tmp_src_scan_ip.ipid=tmp_src_ruckussz_wlc.ipid WHERE tmp_src_ruckussz_wlc.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (506, 2, 51, 'DELETE IGNORE src_ruckussz_wap FROM src_ruckussz_wap INNER JOIN src_scan_ip ON src_ruckussz_wap.wlcid=src_scan_ip.ipid LEFT JOIN tmp_src_scan_ip ON src_scan_ip.ip=tmp_src_scan_ip.ip LEFT JOIN tmp_src_ruckussz_wap ON tmp_src_scan_ip.ipid=tmp_src_ruckussz_wap.wlcid AND src_ruckussz_wap.mac=tmp_src_ruckussz_wap.mac WHERE tmp_src_ruckussz_wap.wapid IS NULL;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 10, 'CREATE TEMPORARY TABLE tmp_src_arp_device (arpid INT NOT NULL PRIMARY KEY AUTO_INCREMENT, device VARCHAR(39) NOT NULL, ip VARCHAR(39) NOT NULL, ipnum BIGINT UNSIGNED NOT NULL, mac VARCHAR(12) NOT NULL, vlanid INT UNSIGNED DEFAULT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, siteid INT UNSIGNED NOT NULL DEFAULT 0, ipprefixid INT UNSIGNED DEFAULT NULL, ifindex INT UNSIGNED DEFAULT NULL, ispublic BOOLEAN DEFAULT TRUE, UNIQUE KEY deviceip (device,ip), KEY device (device), KEY ip (ip), KEY mac (mac), KEY vlanid (vlanid), KEY vlan (vlan), KEY roleid (roleid), KEY siteid (siteid), KEY ipprefixid (ipprefixid), KEY ifindex (ifindex)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 20, 'CREATE TEMPORARY TABLE tmp_intid (id INT NOT NULL PRIMARY KEY) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 30, 'CREATE TEMPORARY TABLE tmp_arp_prefix (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, arpid BIGINT NOT NULL, ipprefixid INT NOT NULL, size INT UNSIGNED, UNIQUE KEY arpprefix (arpid,ipprefixid), KEY arpid (arpid), KEY ipprefixid (ipprefixid), KEY size (size)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 40, 'CREATE TEMPORARY TABLE tmp_src_arp_site (arpid INT NOT NULL PRIMARY KEY AUTO_INCREMENT, siteid INT UNSIGNED NOT NULL DEFAULT 0, ip VARCHAR(39) NOT NULL, ipnum BIGINT UNSIGNED NOT NULL, mac VARCHAR(12) NOT NULL, vlanid INT UNSIGNED DEFAULT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, ipprefixid INT UNSIGNED DEFAULT NULL, ispublic BOOLEAN DEFAULT TRUE, UNIQUE KEY ipsite (ip, siteid), KEY ip (ip), KEY mac (mac), KEY vlanid (vlanid), KEY vlan (vlan), KEY roleid (roleid), KEY siteid (siteid), KEY ipprefixid (ipprefixid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 50, 'CREATE TEMPORARY TABLE tmp_src_arp (arpid INT NOT NULL PRIMARY KEY AUTO_INCREMENT, ip VARCHAR(39) NOT NULL UNIQUE, ipnum BIGINT UNSIGNED NOT NULL UNIQUE, mac VARCHAR(12) NOT NULL, vlanid INT UNSIGNED DEFAULT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, ipprefixid INT UNSIGNED DEFAULT NULL, siteid INT UNSIGNED NOT NULL DEFAULT 0, ispublic BOOLEAN DEFAULT TRUE, KEY mac (mac), KEY vlanid (vlanid), KEY vlan (vlan), KEY roleid (roleid), KEY ipprefixid (ipprefixid), KEY siteid (siteid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 60, 'CREATE TEMPORARY TABLE tmp_src_arp_siteip_mac (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, siteid INT UNSIGNED NOT NULL DEFAULT 0, ip VARCHAR(39) NOT NULL, mac VARCHAR(12) NOT NULL, nr INT UNSIGNED NOT NULL, UNIQUE KEY ur (ip, siteid, mac), KEY ipsite (ip, siteid), KEY siteid (siteid), KEY ip (ip), KEY mac (mac), KEY nr (nr)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 70, 'CREATE TEMPORARY TABLE tmp_src_arp_siteip_vlanid (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, siteid INT UNSIGNED NOT NULL DEFAULT 0, ip VARCHAR(39) NOT NULL, vlanid INT UNSIGNED DEFAULT NULL, nr INT UNSIGNED NOT NULL, UNIQUE KEY ur (ip, siteid, vlanid), KEY ipsite (ip, siteid), KEY siteid (siteid), KEY ip (ip), KEY vlanid (vlanid), KEY nr (nr)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 80, 'CREATE TEMPORARY TABLE tmp_src_arp_siteip_vlan (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, siteid INT UNSIGNED NOT NULL DEFAULT 0, ip VARCHAR(39) NOT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, nr INT UNSIGNED NOT NULL, UNIQUE KEY ur (ip, siteid, vlan), KEY ipsite (ip, siteid), KEY siteid (siteid), KEY ip (ip), KEY vlan (vlan), KEY nr (nr)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 90, 'CREATE TEMPORARY TABLE tmp_src_arp_siteip_roleid (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, siteid INT UNSIGNED NOT NULL DEFAULT 0, ip VARCHAR(39) NOT NULL, roleid INT UNSIGNED DEFAULT NULL, nr INT UNSIGNED NOT NULL, UNIQUE KEY ur (ip, siteid, roleid), KEY ipsite (ip, siteid), KEY siteid (siteid), KEY ip (ip), KEY roleid (roleid), KEY nr (nr)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 100, 'CREATE TEMPORARY TABLE tmp_src_vlan_device (vlid INT NOT NULL AUTO_INCREMENT PRIMARY KEY, device VARCHAR(39) NOT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, active BOOLEAN NOT NULL DEFAULT TRUE, siteid INT UNSIGNED NOT NULL DEFAULT 0, vlanid INT UNSIGNED DEFAULT NULL, roleid INT UNSIGNED DEFAULT NULL, UNIQUE KEY devicevlan (device, vlan), KEY device (device), KEY vlan (vlan), KEY siteid (siteid), KEY vlanid (vlanid), KEY roleid (roleid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 110, 'CREATE TEMPORARY TABLE tmp_src_if (ifid INT NOT NULL PRIMARY KEY AUTO_INCREMENT, device VARCHAR(39) NOT NULL, ifindex INT UNSIGNED NOT NULL, ifdescr VARCHAR(256) DEFAULT NULL, ifname VARCHAR(100) DEFAULT NULL, ifalias VARCHAR(256) DEFAULT NULL, ifadminstatus SMALLINT UNSIGNED NOT NULL DEFAULT 2, ifoperstatus SMALLINT UNSIGNED NOT NULL DEFAULT 4, ip VARCHAR(39) DEFAULT NULL, netmask VARCHAR(39) DEFAULT NULL, netnum INT UNSIGNED DEFAULT NULL, siteid INT UNSIGNED NOT NULL DEFAULT 0, vlanid INT UNSIGNED DEFAULT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, macs INT UNSIGNED NOT NULL DEFAULT 0, connectedto BIGINT DEFAULT NULL, ifphysaddress VARCHAR(12) DEFAULT NULL, ifphysaddressnum BIGINT UNSIGNED DEFAULT NULL, macvendorid VARCHAR(12) DEFAULT NULL, UNIQUE KEY deviceifindex (device, ifindex), KEY device (device), KEY ifindex (ifindex), KEY siteid (siteid), KEY vlanid (vlanid), KEY vlan (vlan), KEY roleid (roleid), KEY macs (macs), KEY connectedto (connectedto), KEY ifphysaddress (ifphysaddress), KEY ifphysaddressnum (ifphysaddressnum), KEY macvendorid (macvendorid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 120, 'CREATE TEMPORARY TABLE tmp_src_mac_device (macid INT NOT NULL AUTO_INCREMENT PRIMARY KEY, device VARCHAR(39) NOT NULL, mac VARCHAR(12) NOT NULL, macnum BIGINT UNSIGNED NOT NULL, port INT UNSIGNED NOT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, siteid INT UNSIGNED NOT NULL DEFAULT 0, vlanid INT UNSIGNED DEFAULT NULL, roleid INT UNSIGNED DEFAULT NULL, vendorid VARCHAR(12) DEFAULT NULL, UNIQUE KEY devicemacvlan (device, mac, vlan), KEY devicemac (device, mac), KEY mac (mac), KEY macnum (macnum), KEY device (device), KEY port (port), KEY vlan (vlan), KEY siteid (siteid), KEY vlanid (vlanid), KEY roleid (roleid), KEY vendorid (vendorid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 130, 'CREATE TEMPORARY TABLE tmp_src_arp_siteip_ipprefixid (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, siteid INT UNSIGNED NOT NULL DEFAULT 0, ip VARCHAR(39) NOT NULL, ipprefixid INT UNSIGNED DEFAULT NULL, nr INT UNSIGNED NOT NULL, UNIQUE KEY ur (ip, siteid, ipprefixid), KEY ipsite (ip, siteid), KEY siteid (siteid), KEY ip (ip), KEY ipprefixid (ipprefixid), KEY nr (nr)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 140, 'CREATE TEMPORARY TABLE tmp_src_arp_siteip (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, siteid INT UNSIGNED NOT NULL DEFAULT 0, ip VARCHAR(39) NOT NULL, nr INT UNSIGNED NOT NULL, UNIQUE KEY ur (ip, siteid), KEY siteid (siteid), KEY ip (ip), KEY nr (nr)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 150, 'CREATE TEMPORARY TABLE tmp_src_mac_sitevlan_vlanid (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, siteid INT UNSIGNED NOT NULL DEFAULT 0, vlan INT UNSIGNED NOT NULL DEFAULT 0, vlanid INT UNSIGNED DEFAULT NULL, nr INT UNSIGNED NOT NULL, UNIQUE KEY ur (siteid, vlan, vlanid), KEY ipsite (siteid, vlan), KEY siteid (siteid), KEY vlan (vlan), KEY vlanid (vlanid), KEY nr (nr)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 160, 'CREATE TEMPORARY TABLE tmp_src_mac_sitevlan_roleid (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, siteid INT UNSIGNED NOT NULL DEFAULT 0, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, nr INT UNSIGNED NOT NULL, UNIQUE KEY ur (siteid, vlan, roleid), KEY ipsite (siteid, vlan), KEY siteid (siteid), KEY vlan (vlan), KEY roleid (roleid), KEY nr (nr)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 170, 'CREATE TEMPORARY TABLE tmp_src_vlan_site (vlid INT NOT NULL AUTO_INCREMENT PRIMARY KEY, siteid INT UNSIGNED NOT NULL DEFAULT 0, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, UNIQUE KEY devicevlan (siteid, vlan), KEY vlan (vlan), KEY siteid (siteid), KEY roleid (roleid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 180, 'CREATE TEMPORARY TABLE tmp_src_vlan (vlid INT NOT NULL AUTO_INCREMENT PRIMARY KEY, vlan INT UNSIGNED NOT NULL UNIQUE, roleid INT UNSIGNED DEFAULT NULL, KEY roleid (roleid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 190, 'CREATE TEMPORARY TABLE tmp_src_mac_site (macid INT NOT NULL AUTO_INCREMENT PRIMARY KEY, device VARCHAR(39) NOT NULL, mac VARCHAR(12) NOT NULL, macnum BIGINT UNSIGNED DEFAULT NULL, port INT UNSIGNED NOT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, siteid INT UNSIGNED NOT NULL DEFAULT 0, vlanid INT UNSIGNED DEFAULT NULL, roleid INT UNSIGNED DEFAULT NULL, vendorid VARCHAR(12) DEFAULT NULL, UNIQUE KEY siteemacvlan (siteid, mac, vlan), KEY sitemac (siteid, mac), KEY mac (mac), KEY macnum (macnum), KEY device (device), KEY port (port), KEY vlan (vlan), KEY siteid (siteid), KEY vlanid (vlanid), KEY roleid (roleid), KEY vendorid (vendorid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 200, 'CREATE TEMPORARY TABLE tmp_src_mac (macid INT NOT NULL AUTO_INCREMENT PRIMARY KEY, device VARCHAR(39) NOT NULL, mac VARCHAR(12) NOT NULL, macnum BIGINT UNSIGNED DEFAULT NULL, port INT UNSIGNED NOT NULL, siteid INT UNSIGNED NOT NULL DEFAULT 0, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, vendorid VARCHAR(12) DEFAULT NULL, UNIQUE KEY macvlan (mac, vlan), KEY mac (mac), KEY macnum (macnum), KEY device (device), KEY port (port), KEY vlan (vlan), KEY siteid (siteid), KEY roleid (roleid), KEY vendorid (vendorid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 210, 'CREATE TEMPORARY TABLE tmp_src_mac_site_roleid (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, siteid INT UNSIGNED NOT NULL DEFAULT 0, mac VARCHAR(12) NOT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, nr INT UNSIGNED NOT NULL, UNIQUE KEY sitemacvlan (siteid, mac, vlan), KEY macvlan (mac, vlan), KEY siteid (siteid), KEY mac (mac), KEY vlan (vlan), KEY roleid (roleid), KEY nr (nr)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 220, 'CREATE TEMPORARY TABLE tmp_src_mac_site_vlanid (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, siteid INT UNSIGNED NOT NULL DEFAULT 0, mac VARCHAR(12) NOT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, vlanid INT UNSIGNED DEFAULT NULL, nr INT UNSIGNED NOT NULL, UNIQUE KEY sitemacvlan (siteid, mac, vlan), KEY macvlan (mac, vlan), KEY siteid (siteid), KEY mac (mac), KEY vlan (vlan), KEY vlanid (vlanid), KEY nr (nr)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 230, 'CREATE TEMPORARY TABLE tmp_src_mac_site_deviceport (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, siteid INT UNSIGNED NOT NULL DEFAULT 0, mac VARCHAR(12) NOT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, device VARCHAR(39) NOT NULL, port INT UNSIGNED NOT NULL, nr INT UNSIGNED NOT NULL, UNIQUE KEY sitemacvlandeviceport (siteid, mac, vlan, device, port), KEY sitemacvlan (siteid, mac, vlan), KEY macvlan (mac, vlan), KEY deviceport (device, port), KEY siteid (siteid), KEY mac (mac), KEY vlan (vlan), KEY device (device), KEY port (port), KEY nr (nr)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 240, 'CREATE TEMPORARY TABLE tmp_src_ip (ipid BIGINT NOT NULL PRIMARY KEY, ip VARCHAR(39) NOT NULL UNIQUE, mac VARCHAR(12) DEFAULT NULL, parent_ipid BIGINT DEFAULT NULL, refid INT UNSIGNED NOT NULL, sourceid INT UNSIGNED NOT NULL, ispublic BOOLEAN NOT NULL DEFAULT FALSE, siteid INT UNSIGNED NOT NULL DEFAULT 0, ipprefixid INT UNSIGNED DEFAULT NULL, roleid INT UNSIGNED DEFAULT NULL, vlanid INT UNSIGNED DEFAULT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, ipnum BIGINT UNSIGNED NOT NULL, macnum BIGINT UNSIGNED DEFAULT NULL, macvendorid VARCHAR(12) DEFAULT NULL, KEY mac(mac), KEY parent_ipid (parent_ipid), KEY sourceid (sourceid), KEY refid (refid), KEY siteid (siteid), KEY ipprefixid (ipprefixid), KEY roleid (roleid), KEY vlanid (vlanid), KEY vlan (vlan), KEY ipnum (ipnum), KEY macnum (macnum), KEY macvendorid (macvendorid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 250, 'CREATE TEMPORARY TABLE tmp_src_ip_info (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, ipid BIGINT NOT NULL, infoid INT UNSIGNED NOT NULL, value VARCHAR(256) NOT NULL, UNIQUE KEY ipinfo (ipid, infoid), KEY ipid (ipid), KEY infoid (infoid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 1, 260, 'CREATE TEMPORARY TABLE tmp_mac_map (id BIGINT NOT NULL PRIMARY KEY, mac VARCHAR(12) NOT NULL, macid VARCHAR(12) DEFAULT NULL, KEY mac (mac), KEY macid (macid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 10, 'TRUNCATE TABLE tmp_src_ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 11, 'TRUNCATE TABLE tmp_src_ip_info;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 12, 'INSERT IGNORE INTO tmp_src_ip (ipid, ip, ispublic, sourceid, refid, ipnum) SELECT ipid, ip, ispublic, sourceid, refid, INET_ATON(ip) AS ipnum FROM src_scan_ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 13, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT ipid, infoid, value FROM src_scan_ip_info;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 30, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT src_snmp_system.ipid, ref_scan_ip_info.infoid, src_snmp_system.sysname FROM src_snmp_system INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'hostname\' WHERE src_snmp_system.sysname IS NOT NULL AND src_snmp_system.sysname<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 31, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT src_scan_port.ipid, ref_scan_ip_info.infoid, REGEXP_REPLACE(REGEXP_SUBSTR(src_scan_script.value, \'SRV\\\\=\\\\d+\\\\:\\\\d+\\\\:\\\\d+\\\\:(.+)\'), \'^.*SRV\\\\=\\\\d+\\\\:\\\\d+\\\\:\\\\d+\\\\:(.*)$\', \'\\\\1\') AS hostname FROM src_scan_port INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'hostname\' WHERE src_scan_script.script=\'mdns-service-discovery\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 32, 'DELETE IGNORE tmp_src_ip_info FROM tmp_src_ip_info INNER JOIN ref_scan_ip_info ON tmp_src_ip_info.infoid=ref_scan_ip_info.infoid WHERE ref_scan_ip_info.info=\'hostname\' AND tmp_src_ip_info.value=\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 33, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT src_scan_port.ipid, ref_scan_ip_info.infoid, REGEXP_REPLACE(REGEXP_SUBSTR(src_scan_script.value, \'UTF8 Server Name: ((?!true).+)\'), \'^.+: (.+)$\', \'\\\\1\') AS name FROM src_scan_port INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'name\' WHERE src_scan_script.script=\'afp-serverinfo\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 34, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT src_scan_port.ipid, ref_scan_ip_info.infoid, REGEXP_REPLACE(REGEXP_SUBSTR(src_scan_script.value, \'(?!UTF8) Server Name: ((?!true).+)\'), \'^.+: (.+)$\', \'\\\\1\') AS hostname FROM src_scan_port INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'hostname\' WHERE src_scan_script.script=\'afp-serverinfo\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 35, 'DELETE IGNORE tmp_src_ip_info FROM tmp_src_ip_info INNER JOIN ref_scan_ip_info ON tmp_src_ip_info.infoid=ref_scan_ip_info.infoid WHERE ref_scan_ip_info.info=\'hostname\' AND tmp_src_ip_info.value=\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 36, 'DELETE IGNORE tmp_src_ip_info FROM tmp_src_ip_info INNER JOIN ref_scan_ip_info ON tmp_src_ip_info.infoid=ref_scan_ip_info.infoid WHERE ref_scan_ip_info.info=\'name\' AND tmp_src_ip_info.value=\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 37, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT src_scan_port.ipid, ref_scan_ip_info.infoid, REGEXP_REPLACE(REGEXP_SUBSTR(src_scan_script.value, \'dnsHostName: (.+)\'), \'^.*dnsHostName: (.+)$\', \'\\\\1\') AS hostname FROM src_scan_port INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'hostname\' WHERE src_scan_script.script=\'ldap-rootdse\' AND src_scan_script.value LIKE \'%dnsHostName:%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 38, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT src_scan_port.ipid, ref_scan_ip_info.infoid, REGEXP_REPLACE(REGEXP_SUBSTR(src_scan_script.value, \'serverName: (.+)\'), \'^.*serverName: (.+)$\', \'\\\\1\') AS name FROM src_scan_port INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'name\' WHERE src_scan_script.script=\'ldap-rootdse\' AND src_scan_script.value LIKE \'%serverName:%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 39, 'DELETE IGNORE tmp_src_ip_info FROM tmp_src_ip_info INNER JOIN ref_scan_ip_info ON tmp_src_ip_info.infoid=ref_scan_ip_info.infoid WHERE ref_scan_ip_info.info=\'hostname\' AND tmp_src_ip_info.value=\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 40, 'DELETE IGNORE tmp_src_ip_info FROM tmp_src_ip_info INNER JOIN ref_scan_ip_info ON tmp_src_ip_info.infoid=ref_scan_ip_info.infoid WHERE ref_scan_ip_info.info=\'name\' AND tmp_src_ip_info.value=\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 41, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT src_scan_port.ipid, ref_scan_ip_info.infoid, REGEXP_REPLACE(extrainfo, \'^name:([^\;]+)\;.*$\', \'\\\\1\') AS hostname FROM src_scan_port INNER JOIN src_scan_service ON src_scan_port.portid=src_scan_service.portid INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'hostname\' WHERE src_scan_service.extrainfo RLIKE \'^name:[^\;]+\;.*$\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 42, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT src_scan_port.ipid, ref_scan_ip_info.infoid, REGEXP_REPLACE(extrainfo, \'^name:(.+)$\', \'\\\\1\') AS hostname FROM src_scan_port INNER JOIN src_scan_service ON src_scan_port.portid=src_scan_service.portid INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'hostname\' WHERE src_scan_service.extrainfo LIKE \'name:%\' AND src_scan_service.extrainfo NOT RLIKE \'^name:[^\;]+;.*$\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 43, 'DELETE IGNORE tmp_src_ip_info FROM tmp_src_ip_info INNER JOIN ref_scan_ip_info ON tmp_src_ip_info.infoid=ref_scan_ip_info.infoid WHERE ref_scan_ip_info.info=\'hostname\' AND tmp_src_ip_info.value=\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 100, 'UPDATE IGNORE tmp_src_ip INNER JOIN ref_ipaddress_source ON tmp_src_ip.sourceid=ref_ipaddress_source.sourceid INNER JOIN ref_ipprefix ON tmp_src_ip.refid=ref_ipprefix.ipprefixid SET tmp_src_ip.ipprefixid=ref_ipprefix.ipprefixid, tmp_src_ip.siteid=ref_ipprefix.siteid WHERE tmp_src_ip.ipprefixid IS NULL AND ref_ipaddress_source.tablename=\'ref_ipprefix\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 101, 'UPDATE IGNORE tmp_src_ip INNER JOIN ref_ipaddress_source ON tmp_src_ip.sourceid=ref_ipaddress_source.sourceid INNER JOIN ref_iprange ON tmp_src_ip.refid=ref_iprange.iprangeid SET tmp_src_ip.roleid=ref_iprange.roleid WHERE tmp_src_ip.roleid IS NULL AND ref_ipaddress_source.tablename=\'ref_iprange\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 102, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 103, 'INSERT IGNORE INTO tmp_intid (id) SELECT DISTINCT tmp_src_ip.refid FROM tmp_src_ip INNER JOIN ref_ipaddress_source ON tmp_src_ip.sourceid=ref_ipaddress_source.sourceid WHERE ref_ipaddress_source.tablename=\'ref_ipprefix\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 104, 'UPDATE IGNORE tmp_src_ip INNER JOIN ref_ipprefix ON tmp_src_ip.siteid=ref_ipprefix.siteid SET tmp_src_ip.ipprefixid=ref_ipprefix.ipprefixid WHERE tmp_src_ip.ipprefixid IS NULL AND tmp_src_ip.siteid<>0 AND ref_ipprefix.ipprefixid IN (SELECT id FROM tmp_intid) AND tmp_src_ip.ipnum BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 105, 'UPDATE IGNORE tmp_src_ip INNER JOIN ref_ipprefix ON tmp_src_ip.siteid=ref_ipprefix.siteid SET tmp_src_ip.ipprefixid=ref_ipprefix.ipprefixid WHERE tmp_src_ip.ipprefixid IS NULL AND tmp_src_ip.siteid<>0 AND ref_ipprefix.siteid<>0 AND ref_ipprefix.vlanid IS NOT NULL AND ref_ipprefix.roleid IS NOT NULL AND tmp_src_ip.ipnum BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 106, 'UPDATE IGNORE tmp_src_ip INNER JOIN ref_ipprefix ON tmp_src_ip.siteid=ref_ipprefix.siteid SET tmp_src_ip.ipprefixid=ref_ipprefix.ipprefixid WHERE tmp_src_ip.ipprefixid IS NULL AND tmp_src_ip.siteid<>0 AND ref_ipprefix.siteid<>0 AND ref_ipprefix.vlanid IS NOT NULL AND tmp_src_ip.ipnum BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 107, 'UPDATE IGNORE tmp_src_ip INNER JOIN ref_ipprefix ON tmp_src_ip.siteid=ref_ipprefix.siteid SET tmp_src_ip.ipprefixid=ref_ipprefix.ipprefixid WHERE tmp_src_ip.ipprefixid IS NULL AND tmp_src_ip.siteid<>0 AND ref_ipprefix.siteid<>0 AND ref_ipprefix.roleid IS NOT NULL AND tmp_src_ip.ipnum BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 108, 'UPDATE IGNORE tmp_src_ip INNER JOIN ref_ipprefix ON tmp_src_ip.siteid=ref_ipprefix.siteid SET tmp_src_ip.ipprefixid=ref_ipprefix.ipprefixid WHERE tmp_src_ip.ipprefixid IS NULL AND tmp_src_ip.siteid<>0 AND ref_ipprefix.siteid<>0 AND tmp_src_ip.ipnum BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 109, 'UPDATE IGNORE tmp_src_ip INNER JOIN ref_ipprefix ON tmp_src_ip.siteid=ref_ipprefix.siteid SET tmp_src_ip.ipprefixid=ref_ipprefix.ipprefixid WHERE tmp_src_ip.ipprefixid IS NULL AND tmp_src_ip.siteid<>0 AND ref_ipprefix.vlanid IS NOT NULL AND tmp_src_ip.ipnum BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 110, 'UPDATE IGNORE tmp_src_ip INNER JOIN ref_ipprefix ON tmp_src_ip.siteid=ref_ipprefix.siteid SET tmp_src_ip.ipprefixid=ref_ipprefix.ipprefixid WHERE tmp_src_ip.ipprefixid IS NULL AND tmp_src_ip.siteid<>0 AND ref_ipprefix.roleid IS NOT NULL AND tmp_src_ip.ipnum BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 111, 'TRUNCATE TABLE tmp_arp_prefix;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 112, 'INSERT IGNORE INTO tmp_arp_prefix (arpid, ipprefixid, size) SELECT tmp_src_ip.ipid, ref_ipprefix.ipprefixid, ref_ipprefix.endipnum-ref_ipprefix.startipnum-1 AS size FROM tmp_src_ip INNER JOIN ref_ipprefix ON tmp_src_ip.ipnum BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum WHERE tmp_src_ip.ipprefixid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 113, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 114, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_arp_prefix WHERE (arpid, size) IN (SELECT arpid, MIN(size) FROM tmp_arp_prefix GROUP BY arpid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 115, 'DELETE IGNORE tmp_arp_prefix FROM tmp_arp_prefix WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 116, 'UPDATE IGNORE tmp_src_ip INNER JOIN tmp_arp_prefix ON tmp_src_ip.ipid=tmp_arp_prefix.arpid SET tmp_src_ip.ipprefixid=tmp_arp_prefix.ipprefixid WHERE tmp_src_ip.ipprefixid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 117, 'UPDATE IGNORE tmp_src_ip INNER JOIN ref_ipprefix ON tmp_src_ip.ipprefixid=ref_ipprefix.ipprefixid SET tmp_src_ip.siteid=ref_ipprefix.siteid WHERE tmp_src_ip.siteid=0 AND ref_ipprefix.siteid<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 130, 'UPDATE IGNORE tmp_src_ip INNER JOIN ref_ipprefix ON tmp_src_ip.ipprefixid=ref_ipprefix.ipprefixid INNER JOIN ref_vlan ON ref_ipprefix.vlanid=ref_vlan.vlanid SET tmp_src_ip.vlanid=ref_vlan.vlanid, tmp_src_ip.vlan=ref_vlan.vid, tmp_src_ip.roleid=ref_vlan.roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 2, 131, 'UPDATE IGNORE tmp_src_ip INNER JOIN ref_ipprefix ON tmp_src_ip.ipprefixid=ref_ipprefix.ipprefixid SET tmp_src_ip.roleid=ref_ipprefix.roleid WHERE tmp_src_ip.roleid IS NULL AND ref_ipprefix.roleid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 3, 10, 'INSERT IGNORE tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip_info.ipid, rssi.infoid, REGEXP_REPLACE(tmp_src_ip_info.value, \'^([^\\\\.]+)\\\\..*$\', \'\\\\1\') AS name FROM tmp_src_ip_info INNER JOIN ref_scan_ip_info ON tmp_src_ip_info.infoid=ref_scan_ip_info.infoid INNER JOIN ref_scan_ip_info AS rssi ON rssi.info=\'name\' LEFT JOIN tmp_src_ip_info AS tssii ON tmp_src_ip_info.ipid=tssii.ipid AND rssi.infoid=tssii.infoid WHERE ref_scan_ip_info.info=\'hostname\' AND tssii.id IS NULL AND tmp_src_ip_info.value LIKE \'%.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 3, 11, 'INSERT IGNORE tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip_info.ipid, rssi.infoid, tmp_src_ip_info.value FROM tmp_src_ip_info INNER JOIN ref_scan_ip_info ON tmp_src_ip_info.infoid=ref_scan_ip_info.infoid INNER JOIN ref_scan_ip_info AS rssi ON rssi.info=\'name\' LEFT JOIN tmp_src_ip_info AS tssii ON tmp_src_ip_info.ipid=tssii.ipid AND rssi.infoid=tssii.infoid WHERE ref_scan_ip_info.info=\'hostname\' AND tssii.id IS NULL AND tmp_src_ip_info.value NOT LIKE \'%.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 3, 12, 'INSERT IGNORE tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip_info.ipid, rssi.infoid, REGEXP_REPLACE(lower(tmp_src_ip_info.value), \'^[^,]*CN=([^,]+),.*$\', \'\\\\1\') AS hostname FROM tmp_src_ip_info INNER JOIN ref_scan_ip_info ON tmp_src_ip_info.infoid=ref_scan_ip_info.infoid INNER JOIN ref_scan_ip_info AS rssi ON rssi.info=\'hostname\' LEFT JOIN tmp_src_ip_info AS tssii ON tmp_src_ip_info.ipid=tssii.ipid AND rssi.infoid=tssii.infoid WHERE ref_scan_ip_info.info=\'name\' AND tssii.id IS NULL AND lower(tmp_src_ip_info.value) LIKE \'cn=%,%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 3, 13, 'INSERT IGNORE tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip_info.ipid, rssi.infoid, tmp_src_ip_info.value FROM tmp_src_ip_info INNER JOIN ref_scan_ip_info ON tmp_src_ip_info.infoid=ref_scan_ip_info.infoid INNER JOIN ref_scan_ip_info AS rssi ON rssi.info=\'hostname\' LEFT JOIN tmp_src_ip_info AS tssii ON tmp_src_ip_info.ipid=tssii.ipid AND rssi.infoid=tssii.infoid WHERE ref_scan_ip_info.info=\'name\' AND tssii.id IS NULL AND tmp_src_ip_info.value NOT LIKE \'% %\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 3, 20, 'INSERT IGNORE INTO src_ip (ip, refid, sourceid, ispublic, ipnum, siteid, ipprefixid, roleid, vlanid, vlan) SELECT tmp_src_ip.ip, tmp_src_ip.refid, tmp_src_ip.sourceid, tmp_src_ip.ispublic, tmp_src_ip.ipnum, tmp_src_ip.siteid, tmp_src_ip.ipprefixid, tmp_src_ip.roleid, tmp_src_ip.vlanid, tmp_src_ip.vlan FROM tmp_src_ip LEFT JOIN src_ip ON tmp_src_ip.ip=src_ip.ip WHERE src_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 3, 21, 'INSERT IGNORE INTO src_ip_info (ipid, infoid, value) SELECT src_ip.ipid, tmp_src_ip_info.infoid, tmp_src_ip_info.value FROM tmp_src_ip_info INNER JOIN tmp_src_ip ON tmp_src_ip_info.ipid=tmp_src_ip.ipid INNER JOIN src_ip ON tmp_src_ip.ip=src_ip.ip LEFT JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid AND tmp_src_ip_info.infoid=src_ip_info.infoid WHERE src_ip_info.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 3, 50, 'UPDATE IGNORE src_ip INNER JOIN tmp_src_ip ON src_ip.ip=tmp_src_ip.ip SET src_ip.refid=tmp_src_ip.refid, src_ip.sourceid=tmp_src_ip.sourceid, src_ip.ispublic=tmp_src_ip.ispublic, src_ip.ipnum=tmp_src_ip.ipnum, src_ip.siteid=tmp_src_ip.siteid, src_ip.ipprefixid=tmp_src_ip.ipprefixid, src_ip.roleid=tmp_src_ip.roleid, src_ip.vlanid=tmp_src_ip.vlanid, src_ip.vlan=tmp_src_ip.vlan;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 3, 51, 'UPDATE IGNORE src_ip_info INNER JOIN src_ip ON src_ip_info.ipid=src_ip.ipid INNER JOIN tmp_src_ip ON src_ip.ip=tmp_src_ip.ip INNER JOIN tmp_src_ip_info ON tmp_src_ip.ipid=tmp_src_ip_info.ipid AND src_ip_info.infoid=tmp_src_ip_info.infoid SET src_ip_info.value=tmp_src_ip_info.value;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 4, 10, 'DELETE IGNORE src_ip_info FROM src_ip_info INNER JOIN src_ip ON src_ip_info.ipid=src_ip.ipid LEFT JOIN tmp_src_ip ON src_ip.ip=tmp_src_ip.ip WHERE tmp_src_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 4, 99, 'DELETE IGNORE src_ip FROM src_ip LEFT JOIN tmp_src_ip ON src_ip.ip=tmp_src_ip.ip WHERE tmp_src_ip.ipid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 10, 'TRUNCATE TABLE tmp_src_arp_device;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 11, 'INSERT IGNORE INTO tmp_src_arp_device (device, ip, ipnum, mac) SELECT tmp_src_ip.ip, src_snmp_arp.ip, INET_ATON(src_snmp_arp.ip), src_snmp_arp.mac FROM src_snmp_arp INNER JOIN tmp_src_ip ON src_snmp_arp.routerid=tmp_src_ip.ipid LEFT JOIN tmp_src_arp_device ON tmp_src_ip.ip=tmp_src_arp_device.device AND src_snmp_arp.ip=tmp_src_arp_device.ip WHERE tmp_src_arp_device.arpid IS NULL AND src_snmp_arp.mac<>\'000000000000\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 12, 'INSERT IGNORE INTO tmp_src_arp_device (device, ip, ipnum, mac) SELECT tmp_src_ip.ip, src_scan_arp.ip, INET_ATON(src_scan_arp.ip), src_scan_arp.mac FROM src_scan_arp INNER JOIN tmp_src_ip ON src_scan_arp.routerid=tmp_src_ip.ipid LEFT JOIN tmp_src_arp_device ON tmp_src_ip.ip=tmp_src_arp_device.device AND src_scan_arp.ip=tmp_src_arp_device.ip WHERE tmp_src_arp_device.arpid IS NULL AND src_scan_arp.mac<>\'000000000000\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 13, 'INSERT IGNORE INTO tmp_src_arp_device (device, ip, ipnum, mac) SELECT tmp_src_ip.ip, src_snmp_dhcp.ip, INET_ATON(src_snmp_dhcp.ip), src_snmp_dhcp.mac FROM src_snmp_dhcp INNER JOIN tmp_src_ip ON src_snmp_dhcp.routerid=tmp_src_ip.ipid LEFT JOIN tmp_src_arp_device ON tmp_src_ip.ip=tmp_src_arp_device.device AND src_snmp_dhcp.ip=tmp_src_arp_device.ip WHERE tmp_src_arp_device.arpid IS NULL AND src_snmp_dhcp.mac<>\'000000000000\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 14, 'INSERT IGNORE INTO tmp_src_arp_device (device, ip, ipnum, mac) SELECT tmp_src_ip.ip, src_scan_dhcp.ip, INET_ATON(src_scan_dhcp.ip), src_scan_dhcp.mac FROM src_scan_dhcp INNER JOIN tmp_src_ip ON src_scan_dhcp.routerid=tmp_src_ip.ipid LEFT JOIN tmp_src_arp_device ON tmp_src_ip.ip=tmp_src_arp_device.device AND src_scan_dhcp.ip=tmp_src_arp_device.ip WHERE tmp_src_arp_device.arpid IS NULL AND src_scan_dhcp.mac<>\'000000000000\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 15, 'INSERT IGNORE INTO tmp_src_arp_device (device, ip, ipnum, mac) SELECT \'mist\', ip, INET_ATON(ip), mac FROM src_mist WHERE status=\'connected\' AND ip IS NOT NULL AND mac IS NOT NULL AND mac<>\'000000000000\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 16, 'INSERT IGNORE INTO tmp_src_arp_device (device, ip, ipnum, mac) SELECT tmp_src_ip.ip, src_ruckussz_wap.ip, INET_ATON(src_ruckussz_wap.ip), src_ruckussz_wap.mac FROM src_ruckussz_wap INNER JOIN tmp_src_ip ON src_ruckussz_wap.wlcid=tmp_src_ip.ipid LEFT JOIN tmp_src_arp_device ON tmp_src_ip.ip=tmp_src_arp_device.device AND src_ruckussz_wap.ip=tmp_src_arp_device.ip WHERE src_ruckussz_wap.connectionstate=\'Connect\' AND tmp_src_arp_device.arpid IS NULL AND src_ruckussz_wap.ip IS NOT NULL AND src_ruckussz_wap.mac IS NOT NULL AND src_ruckussz_wap.mac<>\'000000000000\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 17, 'INSERT IGNORE INTO tmp_src_arp_device (device, ip, ipnum, mac) SELECT tmp_src_ip.ip, src_snmp_wap.ip, INET_ATON(src_snmp_wap.ip), src_snmp_wap.mac FROM src_snmp_wap INNER JOIN tmp_src_ip ON src_snmp_wap.wlcid=tmp_src_ip.ipid LEFT JOIN tmp_src_arp_device ON tmp_src_ip.ip=tmp_src_arp_device.device AND src_snmp_wap.ip=tmp_src_arp_device.ip WHERE tmp_src_arp_device.arpid IS NULL AND src_snmp_wap.ip IS NOT NULL AND src_snmp_wap.mac IS NOT NULL AND src_snmp_wap.mac<>\'000000000000\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 18, 'INSERT IGNORE INTO tmp_src_arp_device (device, ip, ipnum, mac) SELECT \'enplug\', ip, INET_ATON(ip), mac_eth FROM src_enplug_edu WHERE status_code IN (\'Ok\', \'Error\') AND ip IS NOT NULL AND mac_eth IS NOT NULL AND mac_eth<>\'000000000000\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 19, 'INSERT IGNORE INTO tmp_src_arp_device (device, ip, ipnum, mac) SELECT \'activaire\', ip, INET_ATON(ip), mac FROM src_activaire WHERE device_status=\'ACTIVE\' AND ip IS NOT NULL AND mac IS NOT NULL AND mac<>\'000000000000\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 29, 'DELETE IGNORE tmp_src_arp_device FROM tmp_src_arp_device WHERE mac=\'000000000000\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 30, 'UPDATE IGNORE tmp_src_arp_device INNER JOIN src_ip ON tmp_src_arp_device.ip=src_ip.ip SET tmp_src_arp_device.ipprefixid=src_ip.ipprefixid, tmp_src_arp_device.siteid=src_ip.siteid, tmp_src_arp_device.vlanid=src_ip.vlanid, tmp_src_arp_device.vlan=src_ip.vlan, tmp_src_arp_device.roleid=src_ip.roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 31, 'UPDATE IGNORE tmp_src_arp_device INNER JOIN src_ip ON tmp_src_arp_device.device=src_ip.ip SET tmp_src_arp_device.siteid=src_ip.siteid WHERE tmp_src_arp_device.siteid=0 AND src_ip.siteid<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 32, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 33, 'INSERT IGNORE INTO tmp_intid (id) SELECT DISTINCT ipprefixid FROM src_ip WHERE ipprefixid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 34, 'UPDATE IGNORE tmp_src_arp_device INNER JOIN ref_ipprefix ON tmp_src_arp_device.siteid=ref_ipprefix.siteid SET tmp_src_arp_device.ipprefixid=ref_ipprefix.ipprefixid WHERE tmp_src_arp_device.ipprefixid IS NULL AND tmp_src_arp_device.siteid<>0 AND ref_ipprefix.ipprefixid IN (SELECT id FROM tmp_intid) AND tmp_src_arp_device.ipnum BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 35, 'UPDATE IGNORE tmp_src_arp_device INNER JOIN ref_ipprefix ON tmp_src_arp_device.siteid=ref_ipprefix.siteid SET tmp_src_arp_device.ipprefixid=ref_ipprefix.ipprefixid WHERE tmp_src_arp_device.ipprefixid IS NULL AND tmp_src_arp_device.siteid<>0 AND ref_ipprefix.siteid<>0 AND ref_ipprefix.vlanid IS NOT NULL AND ref_ipprefix.roleid IS NOT NULL AND tmp_src_arp_device.ipnum BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 36, 'UPDATE IGNORE tmp_src_arp_device INNER JOIN ref_ipprefix ON tmp_src_arp_device.siteid=ref_ipprefix.siteid SET tmp_src_arp_device.ipprefixid=ref_ipprefix.ipprefixid WHERE tmp_src_arp_device.ipprefixid IS NULL AND tmp_src_arp_device.siteid<>0 AND ref_ipprefix.siteid<>0 AND ref_ipprefix.vlanid IS NOT NULL AND tmp_src_arp_device.ipnum BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 37, 'UPDATE IGNORE tmp_src_arp_device INNER JOIN ref_ipprefix ON tmp_src_arp_device.siteid=ref_ipprefix.siteid SET tmp_src_arp_device.ipprefixid=ref_ipprefix.ipprefixid WHERE tmp_src_arp_device.ipprefixid IS NULL AND tmp_src_arp_device.siteid<>0 AND ref_ipprefix.siteid<>0 AND ref_ipprefix.roleid IS NOT NULL AND tmp_src_arp_device.ipnum BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 38, 'UPDATE IGNORE tmp_src_arp_device INNER JOIN ref_ipprefix ON tmp_src_arp_device.siteid=ref_ipprefix.siteid SET tmp_src_arp_device.ipprefixid=ref_ipprefix.ipprefixid WHERE tmp_src_arp_device.ipprefixid IS NULL AND tmp_src_arp_device.siteid<>0 AND ref_ipprefix.siteid<>0 AND tmp_src_arp_device.ipnum BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 39, 'UPDATE IGNORE tmp_src_arp_device INNER JOIN ref_ipprefix ON tmp_src_arp_device.siteid=ref_ipprefix.siteid SET tmp_src_arp_device.ipprefixid=ref_ipprefix.ipprefixid WHERE tmp_src_arp_device.ipprefixid IS NULL AND tmp_src_arp_device.siteid<>0 AND ref_ipprefix.vlanid IS NOT NULL AND tmp_src_arp_device.ipnum BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 40, 'UPDATE IGNORE tmp_src_arp_device INNER JOIN ref_ipprefix ON tmp_src_arp_device.siteid=ref_ipprefix.siteid SET tmp_src_arp_device.ipprefixid=ref_ipprefix.ipprefixid WHERE tmp_src_arp_device.ipprefixid IS NULL AND tmp_src_arp_device.siteid<>0 AND ref_ipprefix.roleid IS NOT NULL AND tmp_src_arp_device.ipnum BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 41, 'TRUNCATE TABLE tmp_arp_prefix;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 42, 'INSERT IGNORE INTO tmp_arp_prefix (arpid, ipprefixid, size) SELECT tmp_src_arp_device.arpid, ref_ipprefix.ipprefixid, ref_ipprefix.endipnum-ref_ipprefix.startipnum-1 FROM tmp_src_arp_device INNER JOIN ref_ipprefix ON tmp_src_arp_device.ipnum BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum WHERE tmp_src_arp_device.ipprefixid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 43, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 44, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_arp_prefix WHERE (arpid, size) IN (SELECT arpid, MIN(size) FROM tmp_arp_prefix GROUP BY arpid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 45, 'DELETE IGNORE tmp_arp_prefix FROM tmp_arp_prefix WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 46, 'UPDATE IGNORE tmp_src_arp_device INNER JOIN tmp_arp_prefix ON tmp_src_arp_device.arpid=tmp_arp_prefix.arpid SET tmp_src_arp_device.ipprefixid=tmp_arp_prefix.ipprefixid WHERE tmp_src_arp_device.ipprefixid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 47, 'UPDATE IGNORE tmp_src_arp_device INNER JOIN ref_ipprefix ON tmp_src_arp_device.ipprefixid=ref_ipprefix.ipprefixid SET tmp_src_arp_device.siteid=ref_ipprefix.siteid WHERE tmp_src_arp_device.siteid=0 AND ref_ipprefix.siteid<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 70, 'UPDATE IGNORE tmp_src_arp_device INNER JOIN ref_ipprefix ON tmp_src_arp_device.ipprefixid=ref_ipprefix.ipprefixid INNER JOIN ref_vlan ON ref_ipprefix.vlanid=ref_vlan.vlanid SET tmp_src_arp_device.vlanid=ref_vlan.vlanid, tmp_src_arp_device.vlan=ref_vlan.vid, tmp_src_arp_device.roleid=ref_vlan.roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 71, 'UPDATE IGNORE tmp_src_arp_device INNER JOIN ref_ipprefix ON tmp_src_arp_device.ipprefixid=ref_ipprefix.ipprefixid SET tmp_src_arp_device.roleid=ref_ipprefix.roleid WHERE tmp_src_arp_device.roleid IS NULL AND ref_ipprefix.roleid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 80, 'UPDATE IGNORE tmp_src_arp_device SET ispublic=FALSE WHERE ip LIKE \'192.168.%.%\' OR ip LIKE \'10.%.%.%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 81, 'UPDATE IGNORE tmp_src_arp_device SET ispublic=FALSE WHERE (INET_ATON(ip) BETWEEN INET_ATON(\'172.16.0.0\') AND INET_ATON(\'172.31.255.255\')) OR (INET_ATON(ip) BETWEEN INET_ATON(\'100.64.0.0\') AND INET_ATON(\'100.127.255.255\'));', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 90, 'UPDATE IGNORE tmp_src_arp_device INNER JOIN src_scan_ip ON tmp_src_arp_device.device=src_scan_ip.ip INNER JOIN src_snmp_ipaddr ON src_scan_ip.ipid=src_snmp_ipaddr.routerid SET tmp_src_arp_device.ifindex=src_snmp_ipaddr.ifindex WHERE tmp_src_arp_device.device LIKE \'%.%.%.%\' AND INET_ATON(tmp_src_arp_device.ip) BETWEEN (INET_ATON(src_snmp_ipaddr.ip) & (POWER(2,32)-POWER(2,32-src_snmp_ipaddr.netnum))) AND (INET_ATON(src_snmp_ipaddr.ip) & (POWER(2,32)-POWER(2,32-src_snmp_ipaddr.netnum)))+POWER(2,32-src_snmp_ipaddr.netnum)-1;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 100, 'TRUNCATE TABLE tmp_src_arp_site;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 101, 'TRUNCATE TABLE tmp_src_arp_siteip_mac;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 102, 'INSERT IGNORE INTO tmp_src_arp_siteip_mac (siteid, ip, mac, nr) SELECT siteid, ip, mac, COUNT(*) AS nr FROM tmp_src_arp_device GROUP BY siteid, ip, mac;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 103, 'TRUNCATE TABLE tmp_src_arp_siteip_vlanid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 104, 'INSERT IGNORE INTO tmp_src_arp_siteip_vlanid (siteid, ip, vlanid, nr) SELECT siteid, ip, vlanid, COUNT(*) AS nr FROM tmp_src_arp_device WHERE vlanid IS NOT NULL GROUP BY siteid, ip, vlanid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 105, 'TRUNCATE TABLE tmp_src_arp_siteip_vlan;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 106, 'INSERT IGNORE INTO tmp_src_arp_siteip_vlan (siteid, ip, vlan, nr) SELECT siteid, ip, vlan, COUNT(*) AS nr FROM tmp_src_arp_device WHERE vlan<>0 GROUP BY siteid, ip, vlan;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 107, 'TRUNCATE TABLE tmp_src_arp_siteip_roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 108, 'INSERT IGNORE INTO tmp_src_arp_siteip_roleid (siteid, ip, roleid, nr) SELECT siteid, ip, roleid, COUNT(*) AS nr FROM tmp_src_arp_device WHERE roleid IS NOT NULL GROUP BY siteid, ip, roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 109, 'TRUNCATE TABLE tmp_src_arp_siteip_ipprefixid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 110, 'INSERT IGNORE INTO tmp_src_arp_siteip_ipprefixid (siteid, ip, ipprefixid, nr) SELECT siteid, ip, ipprefixid, COUNT(*) AS nr FROM tmp_src_arp_device WHERE ipprefixid IS NOT NULL GROUP BY siteid, ip, ipprefixid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 120, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 121, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_arp_siteip_mac WHERE (siteid, ip, nr) IN (SELECT siteid, ip, MAX(nr) FROM tmp_src_arp_siteip_mac GROUP BY siteid, ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 123, 'DELETE IGNORE tmp_src_arp_siteip_mac FROM tmp_src_arp_siteip_mac WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 124, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 125, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_arp_siteip_vlanid WHERE (siteid, ip, nr) IN (SELECT siteid, ip, MAX(nr) FROM tmp_src_arp_siteip_vlanid GROUP BY siteid, ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 127, 'DELETE IGNORE tmp_src_arp_siteip_vlanid FROM tmp_src_arp_siteip_vlanid WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 128, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 129, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_arp_siteip_vlan WHERE (siteid, ip, nr) IN (SELECT siteid, ip, MAX(nr) FROM tmp_src_arp_siteip_vlan GROUP BY siteid, ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 131, 'DELETE IGNORE tmp_src_arp_siteip_vlan FROM tmp_src_arp_siteip_vlan WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 132, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 133, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_arp_siteip_roleid WHERE (siteid, ip, nr) IN (SELECT siteid, ip, MAX(nr) FROM tmp_src_arp_siteip_roleid GROUP BY siteid, ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 135, 'DELETE IGNORE tmp_src_arp_siteip_roleid FROM tmp_src_arp_siteip_roleid WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 136, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 137, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_arp_siteip_ipprefixid WHERE (siteid, ip, nr) IN (SELECT siteid, ip, MAX(nr) FROM tmp_src_arp_siteip_ipprefixid GROUP BY siteid, ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 139, 'DELETE IGNORE tmp_src_arp_siteip_ipprefixid FROM tmp_src_arp_siteip_ipprefixid WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 140, 'INSERT IGNORE INTO tmp_src_arp_site (siteid, ip, ipnum, mac) SELECT siteid, ip, INET_ATON(ip) AS ipnum, mac FROM tmp_src_arp_siteip_mac;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 141, 'UPDATE IGNORE tmp_src_arp_site INNER JOIN tmp_src_arp_siteip_vlanid ON tmp_src_arp_site.siteid=tmp_src_arp_siteip_vlanid.siteid AND tmp_src_arp_site.ip=tmp_src_arp_siteip_vlanid.ip SET tmp_src_arp_site.vlanid=tmp_src_arp_siteip_vlanid.vlanid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 143, 'UPDATE IGNORE tmp_src_arp_site INNER JOIN tmp_src_arp_siteip_vlan ON tmp_src_arp_site.siteid=tmp_src_arp_siteip_vlan.siteid AND tmp_src_arp_site.ip=tmp_src_arp_siteip_vlan.ip SET tmp_src_arp_site.vlan=tmp_src_arp_siteip_vlan.vlan;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 145, 'UPDATE IGNORE tmp_src_arp_site INNER JOIN tmp_src_arp_siteip_roleid ON tmp_src_arp_site.siteid=tmp_src_arp_siteip_roleid.siteid AND tmp_src_arp_site.ip=tmp_src_arp_siteip_roleid.ip SET tmp_src_arp_site.roleid=tmp_src_arp_siteip_roleid.roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 147, 'UPDATE IGNORE tmp_src_arp_site INNER JOIN tmp_src_arp_siteip_ipprefixid ON tmp_src_arp_site.siteid=tmp_src_arp_siteip_ipprefixid.siteid AND tmp_src_arp_site.ip=tmp_src_arp_siteip_ipprefixid.ip SET tmp_src_arp_site.ipprefixid=tmp_src_arp_siteip_ipprefixid.ipprefixid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 149, 'UPDATE IGNORE tmp_src_arp_site INNER JOIN tmp_src_arp_device ON tmp_src_arp_site.ip=tmp_src_arp_device.ip SET tmp_src_arp_site.ispublic=tmp_src_arp_device.ispublic;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 160, 'TRUNCATE TABLE tmp_src_arp;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 161, 'TRUNCATE TABLE tmp_src_arp_siteip_mac;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 162, 'INSERT IGNORE INTO tmp_src_arp_siteip_mac (siteid, ip, mac, nr) SELECT NULL, ip, mac, COUNT(*) AS nr FROM tmp_src_arp_device GROUP BY ip, mac;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 163, 'TRUNCATE TABLE tmp_src_arp_siteip_vlanid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 164, 'INSERT IGNORE INTO tmp_src_arp_siteip_vlanid (siteid, ip, vlanid, nr) SELECT NULL, ip, vlanid, COUNT(*) AS nr FROM tmp_src_arp_device WHERE vlanid IS NOT NULL GROUP BY ip, vlanid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 165, 'TRUNCATE TABLE tmp_src_arp_siteip_vlan;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 166, 'INSERT IGNORE INTO tmp_src_arp_siteip_vlan (siteid, ip, vlan, nr) SELECT NULL, ip, vlan, COUNT(*) AS nr FROM tmp_src_arp_device WHERE vlan<>0 GROUP BY ip, vlan;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 167, 'TRUNCATE TABLE tmp_src_arp_siteip_roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 168, 'INSERT IGNORE INTO tmp_src_arp_siteip_roleid (siteid, ip, roleid, nr) SELECT NULL, ip, roleid, COUNT(*) AS nr FROM tmp_src_arp_device WHERE roleid IS NOT NULL GROUP BY ip, roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 169, 'TRUNCATE TABLE tmp_src_arp_siteip_ipprefixid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 170, 'INSERT IGNORE INTO tmp_src_arp_siteip_ipprefixid (siteid, ip, ipprefixid, nr) SELECT NULL, ip, ipprefixid, COUNT(*) AS nr FROM tmp_src_arp_device WHERE ipprefixid IS NOT NULL GROUP BY ip, ipprefixid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 171, 'TRUNCATE TABLE tmp_src_arp_siteip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 172, 'INSERT IGNORE INTO tmp_src_arp_siteip (siteid, ip, nr) SELECT siteid, ip, COUNT(*) AS nr FROM tmp_src_arp_device WHERE ipprefixid IS NOT NULL GROUP BY siteid, ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 180, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 181, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_arp_siteip_mac WHERE (ip, nr) IN (SELECT ip, MAX(nr) FROM tmp_src_arp_siteip_mac GROUP BY ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 182, 'DELETE IGNORE tmp_src_arp_siteip_mac FROM tmp_src_arp_siteip_mac WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 183, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 184, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_arp_siteip_vlanid WHERE (ip, nr) IN (SELECT ip, MAX(nr) FROM tmp_src_arp_siteip_vlanid GROUP BY ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 185, 'DELETE IGNORE tmp_src_arp_siteip_vlanid FROM tmp_src_arp_siteip_vlanid WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 186, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 187, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_arp_siteip_vlan WHERE (ip, nr) IN (SELECT ip, MAX(nr) FROM tmp_src_arp_siteip_vlan GROUP BY ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 188, 'DELETE IGNORE tmp_src_arp_siteip_vlan FROM tmp_src_arp_siteip_vlan WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 189, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 190, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_arp_siteip_roleid WHERE (ip, nr) IN (SELECT ip, MAX(nr) FROM tmp_src_arp_siteip_roleid GROUP BY ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 191, 'DELETE IGNORE tmp_src_arp_siteip_roleid FROM tmp_src_arp_siteip_roleid WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 192, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 193, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_arp_siteip_ipprefixid WHERE (ip, nr) IN (SELECT ip, MAX(nr) FROM tmp_src_arp_siteip_ipprefixid GROUP BY ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 194, 'DELETE IGNORE tmp_src_arp_siteip_ipprefixid FROM tmp_src_arp_siteip_ipprefixid WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 195, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 196, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_arp_siteip_ipprefixid WHERE (ip, nr) IN (SELECT ip, MAX(nr) FROM tmp_src_arp_siteip GROUP BY ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 197, 'DELETE IGNORE tmp_src_arp_siteip FROM tmp_src_arp_siteip WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 200, 'INSERT IGNORE INTO tmp_src_arp (ip, ipnum, mac) SELECT ip, INET_ATON(ip) AS ipnum, mac FROM tmp_src_arp_siteip_mac;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 201, 'UPDATE IGNORE tmp_src_arp INNER JOIN tmp_src_arp_siteip_vlanid ON tmp_src_arp.ip=tmp_src_arp_siteip_vlanid.ip SET tmp_src_arp.vlanid=tmp_src_arp_siteip_vlanid.vlanid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 202, 'UPDATE IGNORE tmp_src_arp INNER JOIN tmp_src_arp_siteip_vlan ON tmp_src_arp.ip=tmp_src_arp_siteip_vlan.ip SET tmp_src_arp.vlan=tmp_src_arp_siteip_vlan.vlan;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 203, 'UPDATE IGNORE tmp_src_arp INNER JOIN tmp_src_arp_siteip_roleid ON tmp_src_arp.ip=tmp_src_arp_siteip_roleid.ip SET tmp_src_arp.roleid=tmp_src_arp_siteip_roleid.roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 204, 'UPDATE IGNORE tmp_src_arp INNER JOIN tmp_src_arp_siteip_ipprefixid ON tmp_src_arp.ip=tmp_src_arp_siteip_ipprefixid.ip SET tmp_src_arp.ipprefixid=tmp_src_arp_siteip_ipprefixid.ipprefixid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 205, 'UPDATE IGNORE tmp_src_arp INNER JOIN tmp_src_arp_siteip ON tmp_src_arp.ip=tmp_src_arp_siteip.ip SET tmp_src_arp.siteid=tmp_src_arp_siteip.siteid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 206, 'UPDATE IGNORE tmp_src_arp INNER JOIN tmp_src_arp_device ON tmp_src_arp.ip=tmp_src_arp_device.ip SET tmp_src_arp.ispublic=tmp_src_arp_device.ispublic;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 250, 'UPDATE IGNORE tmp_src_ip INNER JOIN tmp_src_arp_site ON tmp_src_ip.ip=tmp_src_arp_site.ip AND tmp_src_ip.siteid=tmp_src_arp_site.siteid SET tmp_src_ip.mac=tmp_src_arp_site.mac WHERE tmp_src_ip.mac IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 252, 'UPDATE IGNORE tmp_src_ip INNER JOIN tmp_src_arp ON tmp_src_ip.ip=tmp_src_arp.ip SET tmp_src_ip.mac=tmp_src_arp.mac WHERE tmp_src_ip.mac IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 259, 'UPDATE IGNORE tmp_src_ip SET macnum=CONV(mac, 16, 10) WHERE mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 260, 'TRUNCATE TABLE tmp_mac_map;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 261, 'INSERT IGNORE INTO tmp_mac_map (id, mac, macid) SELECT ipid, LEFT(mac,9), NULL FROM tmp_src_ip WHERE mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 262, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 263, 'UPDATE IGNORE tmp_mac_map SET mac=LEFT(mac, LENGTH(mac)-1) WHERE macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 264, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment WHERE tmp_mac_map.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 265, 'UPDATE IGNORE tmp_mac_map SET mac=LEFT(mac, LENGTH(mac)-1) WHERE macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 266, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment WHERE tmp_mac_map.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 267, 'UPDATE IGNORE tmp_mac_map SET mac=LEFT(mac, LENGTH(mac)-1) WHERE macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 268, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment WHERE tmp_mac_map.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 5, 269, 'UPDATE IGNORE tmp_src_ip INNER JOIN tmp_mac_map ON tmp_src_ip.ipid=tmp_mac_map.id SET tmp_src_ip.macvendorid=tmp_mac_map.macid WHERE tmp_mac_map.macid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 6, 10, 'UPDATE IGNORE src_ip INNER JOIN tmp_src_ip ON src_ip.ip=tmp_src_ip.ip SET src_ip.mac=tmp_src_ip.mac, src_ip.macnum=tmp_src_ip.macnum, src_ip.macvendorid=tmp_src_ip.macvendorid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 6, 20, 'INSERT IGNORE INTO src_arp_device (device, ip, ipnum, mac, vlanid, vlan, roleid, siteid, ipprefixid, ifindex, ispublic) SELECT tmp_src_arp_device.device, tmp_src_arp_device.ip, tmp_src_arp_device.ipnum, tmp_src_arp_device.mac, tmp_src_arp_device.vlanid, tmp_src_arp_device.vlan, tmp_src_arp_device.roleid, tmp_src_arp_device.siteid, tmp_src_arp_device.ipprefixid, tmp_src_arp_device.ifindex, tmp_src_arp_device.ispublic FROM tmp_src_arp_device LEFT JOIN src_arp_device ON tmp_src_arp_device.device=src_arp_device.device AND tmp_src_arp_device.ip=src_arp_device.ip WHERE src_arp_device.arpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 6, 21, 'INSERT IGNORE INTO src_arp_site (siteid, ip, ipnum, mac, vlanid, vlan, roleid, ipprefixid, ispublic) SELECT tmp_src_arp_site.siteid, tmp_src_arp_site.ip, tmp_src_arp_site.ipnum, tmp_src_arp_site.mac, tmp_src_arp_site.vlanid, tmp_src_arp_site.vlan, tmp_src_arp_site.roleid, tmp_src_arp_site.ipprefixid, tmp_src_arp_site.ispublic FROM tmp_src_arp_site LEFT JOIN src_arp_site ON tmp_src_arp_site.siteid=src_arp_site.siteid AND tmp_src_arp_site.ip=src_arp_site.ip WHERE src_arp_site.arpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 6, 23, 'INSERT IGNORE INTO src_arp (ip, ipnum, mac, vlanid, vlan, roleid, ipprefixid, ispublic) SELECT tmp_src_arp.ip, tmp_src_arp.ipnum, tmp_src_arp.mac, tmp_src_arp.vlanid, tmp_src_arp.vlan, tmp_src_arp.roleid, tmp_src_arp.ipprefixid, tmp_src_arp.ispublic FROM tmp_src_arp LEFT JOIN src_arp ON tmp_src_arp.ip=src_arp.ip WHERE src_arp.arpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 6, 50, 'UPDATE IGNORE src_arp_device INNER JOIN tmp_src_arp_device ON src_arp_device.device=tmp_src_arp_device.device AND src_arp_device.ip=tmp_src_arp_device.ip SET src_arp_device.ipnum=tmp_src_arp_device.ipnum, src_arp_device.mac=tmp_src_arp_device.mac, src_arp_device.vlanid=tmp_src_arp_device.vlanid, src_arp_device.vlan=tmp_src_arp_device.vlan, src_arp_device.roleid=tmp_src_arp_device.roleid, src_arp_device.siteid=tmp_src_arp_device.siteid, src_arp_device.ipprefixid=tmp_src_arp_device.ipprefixid, src_arp_device.ifindex=tmp_src_arp_device.ifindex, src_arp_device.ispublic=tmp_src_arp_device.ispublic;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 6, 51, 'UPDATE IGNORE src_arp_site INNER JOIN tmp_src_arp_site ON src_arp_site.siteid=tmp_src_arp_site.siteid AND src_arp_site.ip=tmp_src_arp_site.ip SET src_arp_site.ipnum=tmp_src_arp_site.ipnum, src_arp_site.mac=tmp_src_arp_site.mac, src_arp_site.vlanid=tmp_src_arp_site.vlanid, src_arp_site.vlan=tmp_src_arp_site.vlan, src_arp_site.roleid=tmp_src_arp_site.roleid, src_arp_site.ipprefixid=tmp_src_arp_site.ipprefixid, src_arp_site.ispublic=tmp_src_arp_site.ispublic;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 6, 53, 'UPDATE IGNORE src_arp INNER JOIN tmp_src_arp ON src_arp.ip=tmp_src_arp.ip SET src_arp.ipnum=tmp_src_arp.ipnum, src_arp.mac=tmp_src_arp.mac, src_arp.vlanid=tmp_src_arp.vlanid, src_arp.vlan=tmp_src_arp.vlan, src_arp.roleid=tmp_src_arp.roleid, src_arp.ipprefixid=tmp_src_arp.ipprefixid, src_arp.ispublic=tmp_src_arp.ispublic;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 7, 10, 'DELETE IGNORE src_arp_device FROM src_arp_device LEFT JOIN tmp_src_arp_device ON src_arp_device.device=tmp_src_arp_device.device AND src_arp_device.ip=tmp_src_arp_device.ip WHERE tmp_src_arp_device.arpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 7, 11, 'DELETE IGNORE src_arp_site FROM src_arp_site LEFT JOIN tmp_src_arp_site ON src_arp_site.siteid=tmp_src_arp_site.siteid AND src_arp_site.ip=tmp_src_arp_site.ip WHERE tmp_src_arp_site.arpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 7, 13, 'DELETE IGNORE src_arp FROM src_arp LEFT JOIN tmp_src_arp ON src_arp.ip=tmp_src_arp.ip WHERE tmp_src_arp.arpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 10, 'TRUNCATE TABLE tmp_src_vlan_device;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 11, 'INSERT IGNORE INTO tmp_src_vlan_device (device, vlan, active) SELECT tmp_src_ip.ip, src_snmp_vlan.vlan, src_snmp_vlan.active FROM src_snmp_vlan INNER JOIN tmp_src_ip ON src_snmp_vlan.switchid=tmp_src_ip.ipid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 12, 'INSERT IGNORE INTO tmp_src_vlan_device (device, vlan, active) SELECT tmp_src_ip.ip, src_snmp_mac.vlan, TRUE FROM src_snmp_mac INNER JOIN tmp_src_ip ON src_snmp_mac.switchid=tmp_src_ip.ipid WHERE src_snmp_mac.vlan<>0 AND (tmp_src_ip.ip, src_snmp_mac.vlan) NOT IN (SELECT device, vlan FROM tmp_src_vlan_device) GROUP BY tmp_src_ip.ip, src_snmp_mac.vlan;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 20, 'UPDATE IGNORE tmp_src_vlan_device INNER JOIN src_ip ON tmp_src_vlan_device.device=src_ip.ip SET tmp_src_vlan_device.siteid=src_ip.siteid WHERE tmp_src_vlan_device.siteid=0 AND src_ip.siteid<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 21, 'UPDATE IGNORE tmp_src_vlan_device INNER JOIN ref_vlan ON tmp_src_vlan_device.siteid=ref_vlan.siteid SET tmp_src_vlan_device.vlanid=ref_vlan.vlanid, tmp_src_vlan_device.roleid=ref_vlan.roleid WHERE tmp_src_vlan_device.vlanid IS NULL AND tmp_src_vlan_device.siteid<>0 AND tmp_src_vlan_device.vlan<>0 AND tmp_src_vlan_device.vlan=ref_vlan.vid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 22, 'UPDATE IGNORE tmp_src_vlan_device STRAIGHT_JOIN ref_ipprefix ON tmp_src_vlan_device.siteid=ref_ipprefix.siteid STRAIGHT_JOIN ref_vlan ON ref_ipprefix.vlanid=ref_vlan.vlanid SET tmp_src_vlan_device.vlanid=ref_vlan.vlanid, tmp_src_vlan_device.roleid=ref_vlan.roleid WHERE tmp_src_vlan_device.vlanid IS NULL AND tmp_src_vlan_device.siteid<>0 AND tmp_src_vlan_device.vlan<>0 AND tmp_src_vlan_device.vlan=ref_vlan.vid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 30, 'TRUNCATE TABLE tmp_src_if;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 31, 'INSERT IGNORE INTO tmp_src_if (device, ifindex, ifdescr, ifname, ifalias, ifadminstatus, ifoperstatus, ifphysaddress, ifphysaddressnum, macvendorid) SELECT tmp_src_ip.ip, src_snmp_if.ifindex, src_snmp_if.ifdescr, src_snmp_if.ifname, src_snmp_if.ifalias, src_snmp_if.ifadminstatus, src_snmp_if.ifoperstatus, src_snmp_if.ifphysaddress, src_snmp_if.ifphysaddressnum, src_snmp_if.macvendorid FROM src_snmp_if INNER JOIN tmp_src_ip ON src_snmp_if.ipid=tmp_src_ip.ipid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 40, 'UPDATE IGNORE tmp_src_if INNER JOIN tmp_src_ip ON tmp_src_if.device=tmp_src_ip.ip INNER JOIN src_snmp_ipaddr ON tmp_src_ip.ipid=src_snmp_ipaddr.routerid AND tmp_src_if.ifindex=src_snmp_ipaddr.ifindex SET tmp_src_if.ip=src_snmp_ipaddr.ip, tmp_src_if.netmask=src_snmp_ipaddr.netmask, tmp_src_if.netnum=src_snmp_ipaddr.netnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 41, 'UPDATE IGNORE tmp_src_if INNER JOIN src_ip ON tmp_src_if.device=src_ip.ip SET tmp_src_if.siteid=src_ip.siteid WHERE tmp_src_if.siteid=0 AND src_ip.siteid<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 42, 'UPDATE IGNORE tmp_src_if INNER JOIN ref_ipprefix ON tmp_src_if.siteid=ref_ipprefix.siteid INNER JOIN ref_vlan ON ref_ipprefix.vlanid=ref_vlan.vlanid SET tmp_src_if.vlanid=ref_ipprefix.vlanid, tmp_src_if.vlan=ref_vlan.vid, tmp_src_if.roleid=ref_vlan.roleid WHERE tmp_src_if.siteid<>0 AND tmp_src_if.ip IS NOT NULL AND INET_ATON(tmp_src_if.ip) BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 43, 'UPDATE IGNORE tmp_src_if INNER JOIN ref_ipprefix ON tmp_src_if.siteid=ref_ipprefix.siteid SET tmp_src_if.roleid=ref_ipprefix.roleid WHERE tmp_src_if.siteid<>0 AND tmp_src_if.ip IS NOT NULL AND tmp_src_if.roleid IS NULL AND INET_ATON(tmp_src_if.ip) BETWEEN ref_ipprefix.startipnum AND ref_ipprefix.endipnum;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 60, 'TRUNCATE TABLE tmp_src_mac_device;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 61, 'INSERT IGNORE INTO tmp_src_mac_device (device, mac, macnum, port, vlan) SELECT tmp_src_ip.ip, src_snmp_mac.mac, CONV(src_snmp_mac.mac, 16, 10), src_snmp_mac.port, src_snmp_mac.vlan FROM src_snmp_mac INNER JOIN tmp_src_ip ON src_snmp_mac.switchid=tmp_src_ip.ipid WHERE src_snmp_mac.vlan=0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 62, 'INSERT IGNORE INTO tmp_src_mac_device (device, mac, macnum, port, vlan) SELECT tmp_src_ip.ip, src_snmp_mac.mac, CONV(src_snmp_mac.mac, 16, 10), src_snmp_portif_map.ifindex, src_snmp_mac.vlan FROM src_snmp_mac STRAIGHT_JOIN tmp_src_ip ON src_snmp_mac.switchid=tmp_src_ip.ipid STRAIGHT_JOIN src_snmp_portif_map ON src_snmp_mac.switchid=src_snmp_portif_map.ipid AND src_snmp_mac.port=src_snmp_portif_map.port WHERE src_snmp_mac.vlan<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 70, 'UPDATE IGNORE tmp_src_mac_device INNER JOIN src_ip ON tmp_src_mac_device.device=src_ip.ip SET tmp_src_mac_device.siteid=src_ip.siteid WHERE tmp_src_mac_device.siteid=0 AND src_ip.siteid<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 71, 'UPDATE IGNORE tmp_src_mac_device FORCE INDEX (siteid) INNER JOIN ref_vlan ON tmp_src_mac_device.siteid=ref_vlan.siteid SET tmp_src_mac_device.vlanid=ref_vlan.vlanid, tmp_src_mac_device.roleid=ref_vlan.roleid WHERE tmp_src_mac_device.siteid<>0 AND tmp_src_mac_device.vlan<>0 AND tmp_src_mac_device.vlan=ref_vlan.vid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 72, 'UPDATE IGNORE tmp_src_mac_device FORCE INDEX (siteid) INNER JOIN ref_ipprefix ON tmp_src_mac_device.siteid=ref_ipprefix.siteid INNER JOIN ref_vlan ON ref_ipprefix.vlanid=ref_vlan.vlanid SET tmp_src_mac_device.vlanid=ref_ipprefix.vlanid, tmp_src_mac_device.roleid=ref_vlan.roleid WHERE tmp_src_mac_device.siteid<>0 AND tmp_src_mac_device.vlan<>0 AND tmp_src_mac_device.vlanid IS NULL AND tmp_src_mac_device.vlan=ref_vlan.vid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 73, 'UPDATE IGNORE tmp_src_mac_device FORCE INDEX (siteid) INNER JOIN ref_ipprefix ON tmp_src_mac_device.siteid=ref_ipprefix.siteid INNER JOIN ref_vlan ON ref_ipprefix.vlanid=ref_vlan.vlanid SET tmp_src_mac_device.roleid=ref_ipprefix.roleid WHERE tmp_src_mac_device.siteid<>0 AND tmp_src_mac_device.vlan<>0 AND tmp_src_mac_device.roleid IS NULL AND ref_ipprefix.roleid IS NOT NULL AND tmp_src_mac_device.vlan=ref_vlan.vid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 80, 'TRUNCATE TABLE tmp_mac_map;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 81, 'INSERT IGNORE INTO tmp_mac_map (id, mac, macid) SELECT macid, LEFT(mac,9), NULL FROM tmp_src_mac_device;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 82, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 83, 'UPDATE IGNORE tmp_mac_map SET mac=LEFT(mac, LENGTH(mac)-1) WHERE macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 84, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment WHERE tmp_mac_map.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 85, 'UPDATE IGNORE tmp_mac_map SET mac=LEFT(mac, LENGTH(mac)-1) WHERE macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 86, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment WHERE tmp_mac_map.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 87, 'UPDATE IGNORE tmp_mac_map SET mac=LEFT(mac, LENGTH(mac)-1) WHERE macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 88, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment WHERE tmp_mac_map.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 89, 'UPDATE IGNORE tmp_src_mac_device INNER JOIN tmp_mac_map ON tmp_src_mac_device.macid=tmp_mac_map.id SET tmp_src_mac_device.vendorid=tmp_mac_map.macid WHERE tmp_mac_map.macid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 90, 'TRUNCATE TABLE tmp_src_mac_sitevlan_vlanid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 91, 'INSERT IGNORE INTO tmp_src_mac_sitevlan_vlanid (siteid, vlan, vlanid, nr) SELECT siteid, vlan, vlanid, COUNT(*) AS nr FROM tmp_src_vlan_device WHERE vlan<>0 AND vlanid IS NOT NULL GROUP BY siteid, vlan, vlanid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 92, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 93, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_mac_sitevlan_vlanid WHERE (siteid, vlan, nr) IN (SELECT siteid, vlan, MAX(nr) FROM tmp_src_mac_sitevlan_vlanid GROUP BY siteid, vlan);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 95, 'DELETE IGNORE tmp_src_mac_sitevlan_vlanid FROM tmp_src_mac_sitevlan_vlanid WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 96, 'TRUNCATE TABLE tmp_src_mac_sitevlan_roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 97, 'INSERT IGNORE INTO tmp_src_mac_sitevlan_roleid (siteid, vlan, roleid, nr) SELECT siteid, vlan, roleid, COUNT(*) AS nr FROM tmp_src_vlan_device WHERE vlan<>0 AND roleid IS NOT NULL GROUP BY siteid, vlan, roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 98, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 99, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_mac_sitevlan_roleid WHERE (siteid, vlan, nr) IN (SELECT siteid, vlan, MAX(nr) FROM tmp_src_mac_sitevlan_roleid GROUP BY siteid, vlan);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 101, 'DELETE IGNORE tmp_src_mac_sitevlan_roleid FROM tmp_src_mac_sitevlan_roleid WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 102, 'UPDATE IGNORE tmp_src_vlan_device INNER JOIN tmp_src_mac_sitevlan_vlanid ON tmp_src_vlan_device.siteid=tmp_src_mac_sitevlan_vlanid.siteid AND tmp_src_vlan_device.vlan=tmp_src_mac_sitevlan_vlanid.vlan SET tmp_src_vlan_device.vlanid=tmp_src_mac_sitevlan_vlanid.vlanid WHERE tmp_src_vlan_device.vlanid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 104, 'UPDATE IGNORE tmp_src_vlan_device INNER JOIN tmp_src_mac_sitevlan_roleid ON tmp_src_vlan_device.siteid=tmp_src_mac_sitevlan_roleid.siteid AND tmp_src_vlan_device.vlan=tmp_src_mac_sitevlan_roleid.vlan SET tmp_src_vlan_device.roleid=tmp_src_mac_sitevlan_roleid.roleid WHERE tmp_src_vlan_device.roleid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 110, 'TRUNCATE TABLE tmp_src_mac_sitevlan_vlanid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 111, 'INSERT IGNORE INTO tmp_src_mac_sitevlan_vlanid (siteid, vlan, vlanid, nr) SELECT siteid, vlan, vlanid, COUNT(*) AS nr FROM tmp_src_mac_device WHERE vlan<>0 AND vlanid IS NOT NULL GROUP BY siteid, vlan, vlanid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 112, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 113, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_mac_sitevlan_vlanid WHERE (siteid, vlan, nr) IN (SELECT siteid, vlan, MAX(nr) FROM tmp_src_mac_sitevlan_vlanid GROUP BY siteid, vlan);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 115, 'DELETE IGNORE tmp_src_mac_sitevlan_vlanid FROM tmp_src_mac_sitevlan_vlanid WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 116, 'TRUNCATE TABLE tmp_src_mac_sitevlan_roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 117, 'INSERT IGNORE INTO tmp_src_mac_sitevlan_roleid (siteid, vlan, roleid, nr) SELECT siteid, vlan, roleid, COUNT(*) AS nr FROM tmp_src_mac_device WHERE vlan<>0 AND roleid IS NOT NULL GROUP BY siteid, vlan, roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 118, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 119, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_mac_sitevlan_roleid WHERE (siteid, vlan, nr) IN (SELECT siteid, vlan, MAX(nr) FROM tmp_src_mac_sitevlan_roleid GROUP BY siteid, vlan);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 121, 'DELETE IGNORE tmp_src_mac_sitevlan_roleid FROM tmp_src_mac_sitevlan_roleid WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 122, 'UPDATE IGNORE tmp_src_mac_device INNER JOIN tmp_src_mac_sitevlan_vlanid ON tmp_src_mac_device.siteid=tmp_src_mac_sitevlan_vlanid.siteid AND tmp_src_mac_device.vlan=tmp_src_mac_sitevlan_vlanid.vlan SET tmp_src_mac_device.vlanid=tmp_src_mac_sitevlan_vlanid.vlanid WHERE tmp_src_mac_device.vlanid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 124, 'UPDATE IGNORE tmp_src_mac_device INNER JOIN tmp_src_mac_sitevlan_roleid ON tmp_src_mac_device.siteid=tmp_src_mac_sitevlan_roleid.siteid AND tmp_src_mac_device.vlan=tmp_src_mac_sitevlan_roleid.vlan SET tmp_src_mac_device.roleid=tmp_src_mac_sitevlan_roleid.roleid WHERE tmp_src_mac_device.roleid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 130, 'UPDATE IGNORE tmp_src_if INNER JOIN (SELECT device, port, COUNT(*) AS nr FROM tmp_src_mac_device GROUP BY device, port) AS smd ON tmp_src_if.device=smd.device AND tmp_src_if.ifindex=smd.port SET tmp_src_if.macs=smd.nr;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 140, 'TRUNCATE TABLE tmp_src_vlan_site;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 141, 'TRUNCATE TABLE tmp_src_vlan;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 142, 'TRUNCATE TABLE tmp_src_mac_sitevlan_roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 143, 'INSERT IGNORE INTO tmp_src_mac_sitevlan_roleid (siteid, vlan, roleid, nr) SELECT siteid, vlan, roleid, COUNT(*) AS nr FROM tmp_src_vlan_device WHERE vlan<>0 AND roleid IS NOT NULL GROUP BY siteid, vlan, roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 144, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 145, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_mac_sitevlan_roleid WHERE (siteid, vlan, nr) IN (SELECT siteid, vlan, MAX(nr) FROM tmp_src_mac_sitevlan_roleid GROUP BY siteid, vlan);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 147, 'DELETE IGNORE tmp_src_mac_sitevlan_roleid FROM tmp_src_mac_sitevlan_roleid WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 148, 'INSERT IGNORE INTO tmp_src_vlan_site (siteid, vlan, roleid) SELECT siteid, vlan, roleid FROM tmp_src_mac_sitevlan_roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 149, 'TRUNCATE TABLE tmp_src_mac_sitevlan_roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 150, 'INSERT IGNORE INTO tmp_src_mac_sitevlan_roleid (siteid, vlan, roleid, nr) SELECT 0, vlan, roleid, COUNT(*) AS nr FROM tmp_src_vlan_device WHERE vlan<>0 AND roleid IS NOT NULL GROUP BY vlan, roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 151, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 152, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_mac_sitevlan_roleid WHERE (vlan, nr) IN (SELECT vlan, MAX(nr) FROM tmp_src_mac_sitevlan_roleid GROUP BY vlan);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 153, 'DELETE IGNORE tmp_src_mac_sitevlan_roleid FROM tmp_src_mac_sitevlan_roleid WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 154, 'INSERT IGNORE INTO tmp_src_vlan (vlan, roleid) SELECT vlan, roleid FROM tmp_src_mac_sitevlan_roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 170, 'TRUNCATE TABLE tmp_src_mac_site;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 171, 'TRUNCATE TABLE tmp_src_mac;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 172, 'TRUNCATE TABLE tmp_src_mac_site_roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 173, 'INSERT IGNORE INTO tmp_src_mac_site_roleid (siteid, mac, vlan, roleid, nr) SELECT siteid, mac, vlan, roleid, COUNT(*) AS nr FROM tmp_src_mac_device WHERE roleid IS NOT NULL GROUP BY siteid, mac, vlan, roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 174, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 175, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_mac_site_roleid WHERE (siteid, mac, vlan, nr) IN (SELECT siteid, mac, vlan, MAX(nr) FROM tmp_src_mac_site_roleid GROUP BY siteid, mac, vlan);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 179, 'DELETE IGNORE tmp_src_mac_site_roleid FROM tmp_src_mac_site_roleid WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 180, 'TRUNCATE TABLE tmp_src_mac_site_vlanid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 181, 'INSERT IGNORE INTO tmp_src_mac_site_vlanid (siteid, mac, vlan, vlanid, nr) SELECT siteid, mac, vlan, vlanid, COUNT(*) AS nr FROM tmp_src_mac_device WHERE vlanid IS NOT NULL GROUP BY siteid, mac, vlan, vlanid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 182, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 183, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_mac_site_vlanid WHERE (siteid, mac, vlan, nr) IN (SELECT siteid, mac, vlan, MAX(nr) FROM tmp_src_mac_site_vlanid GROUP BY siteid, mac, vlan);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 187, 'DELETE IGNORE tmp_src_mac_site_vlanid FROM tmp_src_mac_site_vlanid WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 188, 'TRUNCATE TABLE tmp_src_mac_site_deviceport;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 189, 'INSERT IGNORE INTO tmp_src_mac_site_deviceport (siteid, mac, vlan, device, port, nr) SELECT tmp_src_mac_device.siteid, tmp_src_mac_device.mac, tmp_src_mac_device.vlan, tmp_src_mac_device.device, tmp_src_mac_device.port, SUM(IFNULL(tmp_src_if.macs,0)) AS nr FROM tmp_src_mac_device LEFT JOIN tmp_src_if ON tmp_src_mac_device.device=tmp_src_if.device AND tmp_src_mac_device.port=tmp_src_if.ifindex GROUP BY tmp_src_mac_device.siteid, tmp_src_mac_device.mac, tmp_src_mac_device.vlan, tmp_src_mac_device.device, tmp_src_mac_device.port;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 190, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 191, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_mac_site_deviceport WHERE (siteid, mac, vlan, nr) IN (SELECT siteid, mac, vlan, MIN(nr) FROM tmp_src_mac_site_deviceport GROUP BY siteid, mac, vlan);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 195, 'DELETE IGNORE tmp_src_mac_site_deviceport FROM tmp_src_mac_site_deviceport WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 200, 'INSERT IGNORE INTO tmp_src_mac_site (device, mac, port, vlan, siteid) SELECT device, mac, port, vlan, siteid FROM tmp_src_mac_site_deviceport;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 201, 'UPDATE IGNORE tmp_src_mac_site INNER JOIN tmp_src_mac_site_roleid ON tmp_src_mac_site.siteid=tmp_src_mac_site_roleid.siteid AND tmp_src_mac_site.mac=tmp_src_mac_site_roleid.mac AND tmp_src_mac_site.vlan=tmp_src_mac_site_roleid.vlan SET tmp_src_mac_site.roleid=tmp_src_mac_site_roleid.roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 202, 'UPDATE IGNORE tmp_src_mac_site SET macnum=CONV(mac, 16, 10);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 203, 'TRUNCATE TABLE tmp_mac_map;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 204, 'INSERT IGNORE INTO tmp_mac_map (id, mac, macid) SELECT macid, LEFT(mac,9), NULL FROM tmp_src_mac_site;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 205, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 206, 'UPDATE IGNORE tmp_mac_map SET mac=LEFT(mac, LENGTH(mac)-1) WHERE macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 207, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment WHERE tmp_mac_map.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 208, 'UPDATE IGNORE tmp_mac_map SET mac=LEFT(mac, LENGTH(mac)-1) WHERE macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 209, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment WHERE tmp_mac_map.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 210, 'UPDATE IGNORE tmp_mac_map SET mac=LEFT(mac, LENGTH(mac)-1) WHERE macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 211, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment WHERE tmp_mac_map.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 212, 'UPDATE IGNORE tmp_src_mac_site INNER JOIN tmp_mac_map ON tmp_src_mac_site.macid=tmp_mac_map.id SET tmp_src_mac_site.vendorid=tmp_mac_map.macid WHERE tmp_mac_map.macid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 220, 'TRUNCATE TABLE tmp_src_mac_site_deviceport;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 221, 'INSERT IGNORE INTO tmp_src_mac_site_deviceport (siteid, mac, vlan, device, port, nr) SELECT 0, tmp_src_mac_site.mac, tmp_src_mac_site.vlan, tmp_src_mac_site.device, tmp_src_mac_site.port, SUM(IFNULL(tmp_src_if.macs,0)) AS nr FROM tmp_src_mac_site LEFT JOIN tmp_src_if ON tmp_src_mac_site.device=tmp_src_if.device AND tmp_src_mac_site.port=tmp_src_if.ifindex GROUP BY tmp_src_mac_site.mac, tmp_src_mac_site.vlan, tmp_src_mac_site.device, tmp_src_mac_site.port;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 222, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 223, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_mac_site_deviceport WHERE (mac, vlan, nr) IN (SELECT mac, vlan, MIN(nr) FROM tmp_src_mac_site_deviceport GROUP BY mac, vlan);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 225, 'DELETE IGNORE tmp_src_mac_site_deviceport FROM tmp_src_mac_site_deviceport WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 226, 'UPDATE IGNORE tmp_src_mac_site_deviceport INNER JOIN (SELECT DISTINCT device, siteid FROM tmp_src_mac_site) AS tsms ON tmp_src_mac_site_deviceport.device=tsms.device SET tmp_src_mac_site_deviceport.siteid=tsms.siteid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 230, 'TRUNCATE TABLE tmp_src_mac_site_roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 231, 'INSERT IGNORE INTO tmp_src_mac_site_roleid (siteid, mac, vlan, roleid, nr) SELECT 0, mac, vlan, roleid, COUNT(*) AS nr FROM tmp_src_mac_device WHERE roleid IS NOT NULL GROUP BY mac, vlan, roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 232, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 233, 'INSERT IGNORE INTO tmp_intid (id) SELECT id FROM tmp_src_mac_site_roleid WHERE (mac, vlan, nr) IN (SELECT mac, vlan, MAX(nr) FROM tmp_src_mac_site_roleid GROUP BY mac, vlan);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 235, 'DELETE IGNORE tmp_src_mac_site_roleid FROM tmp_src_mac_site_roleid WHERE id NOT IN (SELECT id FROM tmp_intid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 240, 'INSERT IGNORE INTO tmp_src_mac (device, mac, port, vlan, siteid) SELECT device, mac, port, vlan, siteid FROM tmp_src_mac_site_deviceport;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 241, 'UPDATE IGNORE tmp_src_mac INNER JOIN tmp_src_mac_site_roleid ON tmp_src_mac.mac=tmp_src_mac_site_roleid.mac AND tmp_src_mac.vlan=tmp_src_mac_site_roleid.vlan SET tmp_src_mac.roleid=tmp_src_mac_site_roleid.roleid WHERE tmp_src_mac.vlan<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 242, 'UPDATE IGNORE tmp_src_mac SET macnum=CONV(mac, 16, 10);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 243, 'TRUNCATE TABLE tmp_mac_map;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 244, 'INSERT IGNORE INTO tmp_mac_map (id, mac, macid) SELECT macid, LEFT(mac,9), NULL FROM tmp_src_mac;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 245, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 246, 'UPDATE IGNORE tmp_mac_map SET mac=LEFT(mac, LENGTH(mac)-1) WHERE macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 247, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment WHERE tmp_mac_map.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 248, 'UPDATE IGNORE tmp_mac_map SET mac=LEFT(mac, LENGTH(mac)-1) WHERE macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 249, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment WHERE tmp_mac_map.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 250, 'UPDATE IGNORE tmp_mac_map SET mac=LEFT(mac, LENGTH(mac)-1) WHERE macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 251, 'UPDATE IGNORE tmp_mac_map INNER JOIN info_mac ON tmp_mac_map.mac=info_mac.assignment SET tmp_mac_map.macid=info_mac.assignment WHERE tmp_mac_map.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 8, 252, 'UPDATE IGNORE tmp_src_mac INNER JOIN tmp_mac_map ON tmp_src_mac.macid=tmp_mac_map.id SET tmp_src_mac.vendorid=tmp_mac_map.macid WHERE tmp_mac_map.macid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 9, 10, 'INSERT IGNORE INTO src_vlan_device (device, vlan, active, siteid, vlanid, roleid) SELECT tmp_src_vlan_device.device, tmp_src_vlan_device.vlan, tmp_src_vlan_device.active, tmp_src_vlan_device.siteid, tmp_src_vlan_device.vlanid, tmp_src_vlan_device.roleid FROM tmp_src_vlan_device LEFT JOIN src_vlan_device ON tmp_src_vlan_device.device=src_vlan_device.device AND tmp_src_vlan_device.vlan=src_vlan_device.vlan WHERE src_vlan_device.vlid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 9, 11, 'INSERT IGNORE INTO src_if (device, ifindex, ifdescr, ifname, ifalias, ifadminstatus, ifoperstatus, ip, netmask, netnum, siteid, vlanid, vlan, roleid, macs, ifphysaddress, ifphysaddressnum, macvendorid) SELECT tmp_src_if.device, tmp_src_if.ifindex, tmp_src_if.ifdescr, tmp_src_if.ifname, tmp_src_if.ifalias, tmp_src_if.ifadminstatus, tmp_src_if.ifoperstatus, tmp_src_if.ip, tmp_src_if.netmask, tmp_src_if.netnum, tmp_src_if.siteid, tmp_src_if.vlanid, tmp_src_if.vlan, tmp_src_if.roleid, tmp_src_if.macs, tmp_src_if.ifphysaddress, tmp_src_if.ifphysaddressnum, tmp_src_if.macvendorid FROM tmp_src_if LEFT JOIN src_if ON tmp_src_if.device=src_if.device AND tmp_src_if.ifindex=src_if.ifindex WHERE src_if.ifid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 9, 12, 'INSERT IGNORE INTO src_mac_device (device, mac, macnum, port, vlan, siteid, vlanid, roleid, vendorid) SELECT tmp_src_mac_device.device, tmp_src_mac_device.mac, tmp_src_mac_device.macnum, tmp_src_mac_device.port, tmp_src_mac_device.vlan, tmp_src_mac_device.siteid, tmp_src_mac_device.vlanid, tmp_src_mac_device.roleid, tmp_src_mac_device.vendorid FROM tmp_src_mac_device LEFT JOIN src_mac_device ON tmp_src_mac_device.device=src_mac_device.device AND tmp_src_mac_device.mac=src_mac_device.mac AND tmp_src_mac_device.vlan=src_mac_device.vlan WHERE src_mac_device.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 9, 14, 'INSERT IGNORE INTO src_vlan_site (siteid, vlan, roleid) SELECT tmp_src_vlan_site.siteid, tmp_src_vlan_site.vlan, tmp_src_vlan_site.roleid FROM tmp_src_vlan_site LEFT JOIN src_vlan_site ON tmp_src_vlan_site.siteid=src_vlan_site.siteid AND tmp_src_vlan_site.vlan=src_vlan_site.vlan WHERE src_vlan_site.vlid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 9, 16, 'INSERT IGNORE INTO src_vlan (vlan, roleid) SELECT tmp_src_vlan.vlan, tmp_src_vlan.roleid FROM tmp_src_vlan LEFT JOIN src_vlan ON tmp_src_vlan.vlan=src_vlan.vlan WHERE src_vlan.vlid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 9, 17, 'INSERT IGNORE INTO src_mac_site (device, mac, macnum, port, vlan, siteid, vlanid, roleid, vendorid) SELECT tmp_src_mac_site.device, tmp_src_mac_site.mac, tmp_src_mac_site.macnum, tmp_src_mac_site.port, tmp_src_mac_site.vlan, tmp_src_mac_site.siteid, tmp_src_mac_site.vlanid, tmp_src_mac_site.roleid, tmp_src_mac_site.vendorid FROM tmp_src_mac_site LEFT JOIN src_mac_site ON tmp_src_mac_site.siteid=src_mac_site.siteid AND tmp_src_mac_site.mac=src_mac_site.mac AND tmp_src_mac_site.vlan=src_mac_site.vlan WHERE src_mac_site.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 9, 21, 'INSERT IGNORE INTO src_mac (device, mac, macnum, port, siteid, vlan, roleid, vendorid) SELECT tmp_src_mac.device, tmp_src_mac.mac, tmp_src_mac.macnum, tmp_src_mac.port, tmp_src_mac.siteid, tmp_src_mac.vlan, tmp_src_mac.roleid, tmp_src_mac.vendorid FROM tmp_src_mac LEFT JOIN src_mac ON tmp_src_mac.mac=src_mac.mac AND tmp_src_mac.vlan=src_mac.vlan WHERE src_mac.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 9, 50, 'UPDATE IGNORE src_vlan_device INNER JOIN tmp_src_vlan_device ON src_vlan_device.device=src_vlan_device.device AND src_vlan_device.vlan=tmp_src_vlan_device.vlan SET src_vlan_device.active=tmp_src_vlan_device.active, src_vlan_device.siteid=tmp_src_vlan_device.siteid, src_vlan_device.vlanid=tmp_src_vlan_device.vlanid, src_vlan_device.vlan=tmp_src_vlan_device.vlan, src_vlan_device.roleid=tmp_src_vlan_device.roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 9, 51, 'UPDATE IGNORE src_if INNER JOIN tmp_src_if ON src_if.device=tmp_src_if.device AND src_if.ifindex=tmp_src_if.ifindex SET src_if.ifdescr=tmp_src_if.ifdescr, src_if.ifname=tmp_src_if.ifname, src_if.ifalias=tmp_src_if.ifalias, src_if.ifadminstatus=tmp_src_if.ifadminstatus, src_if.ifoperstatus=tmp_src_if.ifoperstatus, src_if.ip=tmp_src_if.ip, src_if.netmask=tmp_src_if.netmask, src_if.netnum=tmp_src_if.netnum, src_if.siteid=tmp_src_if.siteid, src_if.vlanid=tmp_src_if.vlanid, src_if.vlan=tmp_src_if.vlan, src_if.roleid=tmp_src_if.roleid, src_if.macs=tmp_src_if.macs, src_if.ifphysaddress=tmp_src_if.ifphysaddress, src_if.ifphysaddressnum=tmp_src_if.ifphysaddressnum, src_if.macvendorid=tmp_src_if.macvendorid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 9, 52, 'UPDATE IGNORE src_mac_device INNER JOIN tmp_src_mac_device ON src_mac_device.device=tmp_src_mac_device.device AND src_mac_device.mac=tmp_src_mac_device.mac AND src_mac_device.vlan=tmp_src_mac_device.vlan SET src_mac_device.macnum=tmp_src_mac_device.macnum, src_mac_device.port=tmp_src_mac_device.port, src_mac_device.siteid=tmp_src_mac_device.siteid, src_mac_device.vlanid=tmp_src_mac_device.vlanid, src_mac_device.roleid=tmp_src_mac_device.roleid, src_mac_device.vendorid=tmp_src_mac_device.vendorid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 9, 54, 'UPDATE IGNORE src_vlan_site INNER JOIN tmp_src_vlan_site ON src_vlan_site.siteid=tmp_src_vlan_site.siteid AND src_vlan_site.vlan=tmp_src_vlan_site.vlan SET src_vlan_site.roleid=tmp_src_vlan_site.roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 9, 56, 'UPDATE IGNORE src_vlan INNER JOIN tmp_src_vlan ON src_vlan.vlan=tmp_src_vlan.vlan SET src_vlan.roleid=tmp_src_vlan.roleid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 9, 57, 'UPDATE IGNORE src_mac_site INNER JOIN tmp_src_mac_site ON src_mac_site.siteid=tmp_src_mac_site.siteid AND src_mac_site.vlan=tmp_src_mac_site.vlan AND src_mac_site.mac=tmp_src_mac_site.mac SET src_mac_site.device=tmp_src_mac_site.device, src_mac_site.macnum=tmp_src_mac_site.macnum, src_mac_site.port=tmp_src_mac_site.port, src_mac_site.vlanid=tmp_src_mac_site.vlanid, src_mac_site.roleid=tmp_src_mac_site.roleid, src_mac_site.vendorid=tmp_src_mac_site.vendorid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 9, 61, 'UPDATE IGNORE src_mac INNER JOIN tmp_src_mac ON src_mac.mac=tmp_src_mac.mac AND src_mac.vlan=tmp_src_mac.vlan SET src_mac.device=tmp_src_mac.device, src_mac.macnum=tmp_src_mac.macnum, src_mac.port=tmp_src_mac.port, src_mac.siteid=tmp_src_mac.siteid, src_mac.roleid=tmp_src_mac.roleid, src_mac.vendorid=tmp_src_mac.vendorid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 10, 10, 'DELETE IGNORE src_vlan_device FROM src_vlan_device LEFT JOIN tmp_src_vlan_device ON src_vlan_device.device=tmp_src_vlan_device.device AND src_vlan_device.vlan=tmp_src_vlan_device.vlan WHERE tmp_src_vlan_device.vlid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 10, 11, 'DELETE IGNORE src_if FROM src_if LEFT JOIN tmp_src_if ON src_if.device=tmp_src_if.device AND src_if.ifindex=tmp_src_if.ifindex WHERE tmp_src_if.ifid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 10, 12, 'DELETE IGNORE src_mac_device FROM src_mac_device LEFT JOIN tmp_src_mac_device ON src_mac_device.device=tmp_src_mac_device.device AND src_mac_device.mac=tmp_src_mac_device.mac AND src_mac_device.vlan=tmp_src_mac_device.vlan WHERE tmp_src_mac_device.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 10, 14, 'DELETE IGNORE src_vlan_site FROM src_vlan_site LEFT JOIN tmp_src_vlan_site ON src_vlan_site.siteid=tmp_src_vlan_site.siteid AND src_vlan_site.vlan=tmp_src_vlan_site.vlan WHERE tmp_src_vlan_site.vlid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 10, 16, 'DELETE IGNORE src_vlan FROM src_vlan LEFT JOIN tmp_src_vlan ON src_vlan.vlan=tmp_src_vlan.vlan WHERE tmp_src_vlan.vlid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 10, 17, 'DELETE IGNORE src_mac_site FROM src_mac_site LEFT JOIN tmp_src_mac_site ON src_mac_site.siteid=tmp_src_mac_site.siteid AND src_mac_site.vlan=tmp_src_mac_site.vlan AND src_mac_site.mac=tmp_src_mac_site.mac WHERE tmp_src_mac_site.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 10, 21, 'DELETE IGNORE src_mac FROM src_mac LEFT JOIN tmp_src_mac ON src_mac.mac=tmp_src_mac.mac AND src_mac.vlan=tmp_src_mac.vlan WHERE src_mac.vlan<>0 AND tmp_src_mac.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 10, 22, 'DELETE IGNORE src_mac FROM src_mac LEFT JOIN tmp_src_mac ON src_mac.mac=tmp_src_mac.mac WHERE src_mac.vlan=0 AND tmp_src_mac.vlan=0 AND tmp_src_mac.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 10, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_activaire.activaireid FROM src_activaire INNER JOIN tmp_src_ip ON src_activaire.mac=tmp_src_ip.mac INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'activaireid\' WHERE src_activaire.activaireid IS NOT NULL AND src_activaire.activaireid<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 11, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_activaire.activaireid FROM src_activaire INNER JOIN tmp_src_ip ON src_activaire.mac_eth=tmp_src_ip.mac INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'activaireid\' WHERE src_activaire.activaireid IS NOT NULL AND src_activaire.activaireid<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 12, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_activaire.activaireid FROM src_activaire INNER JOIN tmp_src_ip ON src_activaire.ip=tmp_src_ip.ip INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'activaireid\' WHERE src_activaire.activaireid IS NOT NULL AND src_activaire.activaireid<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 13, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_activaire.mac_eth FROM src_activaire INNER JOIN tmp_src_ip ON src_activaire.mac=tmp_src_ip.mac INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'mac_internal\' WHERE src_activaire.mac_eth IS NOT NULL AND src_activaire.mac_eth<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 14, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_activaire.mac FROM src_activaire INNER JOIN tmp_src_ip ON src_activaire.mac_eth=tmp_src_ip.mac INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'mac_internal\' WHERE src_activaire.mac IS NOT NULL AND src_activaire.mac<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 15, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_activaire.mac FROM src_activaire INNER JOIN tmp_src_ip ON src_activaire.ip=tmp_src_ip.ip INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'mac_internal\' WHERE src_activaire.mac IS NOT NULL AND src_activaire.mac<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 16, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_activaire.mac_eth FROM src_activaire INNER JOIN tmp_src_ip ON src_activaire.ip=tmp_src_ip.ip INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'mac_internal\' WHERE src_activaire.mac_eth IS NOT NULL AND src_activaire.mac_eth<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 17, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_activaire.activairename FROM src_activaire INNER JOIN tmp_src_ip ON src_activaire.mac=tmp_src_ip.mac INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'name\' WHERE src_activaire.activairename IS NOT NULL AND src_activaire.activairename<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 18, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_activaire.activairename FROM src_activaire INNER JOIN tmp_src_ip ON src_activaire.mac_eth=tmp_src_ip.mac INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'name\' WHERE src_activaire.activairename IS NOT NULL AND src_activaire.activairename<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 19, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_activaire.activairename FROM src_activaire INNER JOIN tmp_src_ip ON src_activaire.ip=tmp_src_ip.ip INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'name\' WHERE src_activaire.activairename IS NOT NULL AND src_activaire.activairename<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 20, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_enplug_edu.eduid FROM src_enplug_edu INNER JOIN tmp_src_ip ON src_enplug_edu.mac_eth=tmp_src_ip.mac INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'eduid\' WHERE src_enplug_edu.eduid IS NOT NULL AND src_enplug_edu.eduid<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 10, 12, 'DELETE IGNORE src_mac_device FROM src_mac_device LEFT JOIN tmp_src_mac_device ON src_mac_device.device=tmp_src_mac_device.device AND src_mac_device.mac=tmp_src_mac_device.mac AND src_mac_device.vlan=tmp_src_mac_device.vlan WHERE tmp_src_mac_device.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 10, 21, 'DELETE IGNORE src_mac FROM src_mac LEFT JOIN tmp_src_mac ON src_mac.mac=tmp_src_mac.mac AND src_mac.vlan=tmp_src_mac.vlan WHERE tmp_src_mac.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 23, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_enplug_edu.eduname FROM src_enplug_edu INNER JOIN tmp_src_ip ON src_enplug_edu.ip=tmp_src_ip.ip INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'name\' WHERE src_enplug_edu.eduname IS NOT NULL AND src_enplug_edu.eduname<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 24, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_mist.name FROM src_mist INNER JOIN tmp_src_ip ON src_mist.mac=tmp_src_ip.mac INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'hostname\' WHERE src_mist.name IS NOT NULL AND src_mist.name<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 25, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_mist.name FROM src_mist INNER JOIN tmp_src_ip ON src_mist.ip=tmp_src_ip.ip INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'hostname\' WHERE src_mist.name IS NOT NULL AND src_mist.name<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 26, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, \'mist\' FROM src_mist INNER JOIN tmp_src_ip ON src_mist.mac=tmp_src_ip.mac INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'controller\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 27, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, \'mist\' FROM src_mist INNER JOIN tmp_src_ip ON src_mist.ip=tmp_src_ip.ip INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'controller\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 28, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_ruckussz_wap.name FROM src_ruckussz_wap INNER JOIN tmp_src_ip ON src_ruckussz_wap.mac=tmp_src_ip.mac INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'hostname\' WHERE src_ruckussz_wap.name IS NOT NULL AND src_ruckussz_wap.name<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 29, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_ruckussz_wap.name FROM src_ruckussz_wap INNER JOIN tmp_src_ip ON src_ruckussz_wap.ip=tmp_src_ip.ip INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'hostname\' WHERE src_ruckussz_wap.name IS NOT NULL AND src_ruckussz_wap.name<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 30, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, tssi.ip FROM src_ruckussz_wap INNER JOIN tmp_src_ip ON src_ruckussz_wap.mac=tmp_src_ip.mac INNER JOIN tmp_src_ip AS tssi ON src_ruckussz_wap.wlcid=tssi.ipid INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'controller\' ORDER BY tssi.ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 31, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, tssi.ip FROM src_ruckussz_wap INNER JOIN tmp_src_ip ON src_ruckussz_wap.ip=tmp_src_ip.ip INNER JOIN tmp_src_ip AS tssi ON src_ruckussz_wap.wlcid=tssi.ipid INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'controller\' ORDER BY tssi.ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 32, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_snmp_wap.hostname FROM src_snmp_wap INNER JOIN tmp_src_ip ON src_snmp_wap.mac=tmp_src_ip.mac INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'hostname\' WHERE src_snmp_wap.hostname IS NOT NULL AND src_snmp_wap.hostname<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 33, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, src_snmp_wap.hostname FROM src_snmp_wap INNER JOIN tmp_src_ip ON src_snmp_wap.ip=tmp_src_ip.ip INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'hostname\' WHERE src_snmp_wap.hostname IS NOT NULL AND src_snmp_wap.hostname<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 34, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, tssi.ip FROM src_snmp_wap INNER JOIN tmp_src_ip ON src_snmp_wap.mac=tmp_src_ip.mac INNER JOIN tmp_src_ip AS tssi ON src_snmp_wap.wlcid=tssi.ipid INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'controller\' ORDER BY tssi.ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 11, 35, 'INSERT IGNORE INTO tmp_src_ip_info (ipid, infoid, value) SELECT tmp_src_ip.ipid, ref_scan_ip_info.infoid, tssi.ip FROM src_snmp_wap INNER JOIN tmp_src_ip ON src_snmp_wap.ip=tmp_src_ip.ip INNER JOIN tmp_src_ip AS tssi ON src_snmp_wap.wlcid=tssi.ipid INNER JOIN ref_scan_ip_info ON ref_scan_ip_info.info=\'controller\' ORDER BY tssi.ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 12, 10, 'INSERT IGNORE INTO src_ip_info (ipid, infoid, value) SELECT src_ip.ipid, tmp_src_ip_info.infoid, tmp_src_ip_info.value FROM tmp_src_ip_info INNER JOIN tmp_src_ip ON tmp_src_ip_info.ipid=tmp_src_ip.ipid INNER JOIN src_ip ON tmp_src_ip.ip=src_ip.ip LEFT JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid AND tmp_src_ip_info.infoid=src_ip_info.infoid WHERE src_ip_info.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 12, 20, 'UPDATE IGNORE src_ip_info INNER JOIN src_ip ON src_ip_info.ipid=src_ip.ipid INNER JOIN tmp_src_ip ON src_ip.ip=tmp_src_ip.ip INNER JOIN tmp_src_ip_info ON tmp_src_ip.ipid=tmp_src_ip_info.ipid AND src_ip_info.infoid=tmp_src_ip_info.infoid SET src_ip_info.value=tmp_src_ip_info.value;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 12, 30, 'DELETE IGNORE src_ip_info FROM src_ip_info INNER JOIN src_ip ON src_ip_info.ipid=src_ip.ipid LEFT JOIN tmp_src_ip ON src_ip.ip=tmp_src_ip.ip LEFT JOIN tmp_src_ip_info ON tmp_src_ip.ipid=tmp_src_ip_info.ipid AND src_ip_info.infoid=tmp_src_ip_info.infoid WHERE tmp_src_ip_info.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 13, 10, 'UPDATE IGNORE src_ip INNER JOIN tmp_src_ip ON src_ip.ip=tmp_src_ip.ip SET src_ip.parent_ipid=tmp_src_ip.parent_ipid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (507, 13, 11, 'UPDATE IGNORE tmp_src_ip INNER JOIN src_ip ON tmp_src_ip.parent_ipid=src_ip.ipid INNER JOIN src_scan_ip ON src_ip.ip=src_scan_ip.ip SET tmp_src_ip.parent_ipid=src_scan_ip.ipid WHERE tmp_src_ip.parent_ipid IS NOT NULL;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 1, 9, 'UPDATE IGNORE nnml_ip SET label_manufacturerid=NULL, predict_manufacturerid=NULL, predict_manufacturerid_prob=NULL, label_devicetypeid=NULL, predict_devicetypeid=NULL, predict_devicetypeid_prob=NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 1, 10, 'CREATE TEMPORARY TABLE tmp_nnml_ip (ipid INT NOT NULL PRIMARY KEY AUTO_INCREMENT, ip VARCHAR(39) NOT NULL UNIQUE, mac VARCHAR(12) DEFAULT NULL, macvendorid VARCHAR(12) DEFAULT NULL, ispublic BOOLEAN NOT NULL DEFAULT FALSE, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, netnum smallint(6) NOT NULL DEFAULT 32,  label_manufacturerid INT UNSIGNED DEFAULT NULL, predict_manufacturerid INT UNSIGNED DEFAULT NULL, label_devicetypeid INT UNSIGNED DEFAULT NULL, predict_devicetypeid INT UNSIGNED DEFAULT NULL, ipprefixid INT UNSIGNED DEFAULT NULL, predict_manufacturerid_prob FLOAT UNSIGNED DEFAULT NULL, predict_devicetypeid_prob FLOAT UNSIGNED DEFAULT NULL, KEY mac (mac)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 1, 20, 'CREATE TEMPORARY TABLE tmp_nnml_input (inputid INT NOT NULL PRIMARY KEY AUTO_INCREMENT, input_typeid INT UNSIGNED NOT NULL, typeid INT NOT NULL DEFAULT 0, UNIQUE KEY inputtypeid (input_typeid, typeid), KEY input_typeid (input_typeid), KEY typeid (typeid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 1, 30, 'CREATE TEMPORARY TABLE tmp_intid (id INT NOT NULL PRIMARY KEY) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 1, 40, 'CREATE TEMPORARY TABLE tmp_nnml_ip_input (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, ipid INT NOT NULL , inputid INT NOT NULL, value FLOAT NOT NULL, UNIQUE KEY ipinput (ipid, inputid), KEY ipid (ipid), KEY inputid (inputid), KEY value(value)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 1, 50, 'CREATE TEMPORARY TABLE tmp_src_scan_script (id BIGINT NOT NULL PRIMARY KEY, portid BIGINT NOT NULL, script VARCHAR(100) NOT NULL, value VARCHAR(600) NOT NULL, UNIQUE KEY portscript (portid, script), KEY scriptvalue (script, value), KEY portid (portid), KEY script (script), KEY value (value)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 1, 60, 'CREATE TEMPORARY TABLE tmp_bigintid (id BIGINT NOT NULL PRIMARY KEY);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 1, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 2, 'INSERT IGNORE INTO tmp_intid (id) SELECT src_ip.ipprefixid FROM src_ip INNER JOIN ref_ipprefix ON src_ip.ipprefixid=ref_ipprefix.ipprefixid WHERE src_ip.ipprefixid IS NOT NULL AND src_ip.ispublic=0 AND ref_ipprefix.netnum<27 GROUP BY src_ip.ipprefixid HAVING COUNT(*)=SUM(IF(src_ip.mac IS NULL,1,0));', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 3, 'INSERT IGNORE INTO tmp_intid (id) SELECT ippref.ipprefixid FROM (SELECT src_ip.ipprefixid, (ref_ipprefix.endipnum-ref_ipprefix.startipnum+1) AS netsize FROM src_ip INNER JOIN ref_ipprefix ON src_ip.ipprefixid=ref_ipprefix.ipprefixid WHERE src_ip.ipprefixid IS NOT NULL AND src_ip.ispublic=0 AND ref_ipprefix.netnum=26 GROUP BY src_ip.ipprefixid HAVING netsize-COUNT(*)<8) AS ippref;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 4, 'INSERT IGNORE INTO tmp_intid (id) SELECT ippref.ipprefixid FROM (SELECT src_ip.ipprefixid, (ref_ipprefix.endipnum-ref_ipprefix.startipnum+1) AS netsize FROM src_ip INNER JOIN ref_ipprefix ON src_ip.ipprefixid=ref_ipprefix.ipprefixid WHERE src_ip.ipprefixid IS NOT NULL AND src_ip.ispublic=0 AND ref_ipprefix.netnum=25 GROUP BY src_ip.ipprefixid HAVING netsize-COUNT(*)<12) AS ippref;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 5, 'INSERT IGNORE INTO tmp_intid (id) SELECT ippref.ipprefixid FROM (SELECT src_ip.ipprefixid, (ref_ipprefix.endipnum-ref_ipprefix.startipnum+1) AS netsize FROM src_ip INNER JOIN ref_ipprefix ON src_ip.ipprefixid=ref_ipprefix.ipprefixid WHERE src_ip.ipprefixid IS NOT NULL AND src_ip.ispublic=0 AND ref_ipprefix.netnum=24 GROUP BY src_ip.ipprefixid HAVING netsize-COUNT(*)<16) AS ippref;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 6, 'INSERT IGNORE INTO tmp_intid (id) SELECT ippref.ipprefixid FROM (SELECT src_ip.ipprefixid, (ref_ipprefix.endipnum-ref_ipprefix.startipnum+1) AS netsize FROM src_ip INNER JOIN ref_ipprefix ON src_ip.ipprefixid=ref_ipprefix.ipprefixid WHERE src_ip.ipprefixid IS NOT NULL AND src_ip.ispublic=0 AND ref_ipprefix.netnum<24 GROUP BY src_ip.ipprefixid HAVING netsize-COUNT(*)<24) AS ippref;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 10, 'INSERT IGNORE INTO tmp_nnml_ip (ip, mac, macvendorid, ispublic, vlan, roleid, netnum, label_manufacturerid, predict_manufacturerid, label_devicetypeid, predict_devicetypeid, ipprefixid, predict_manufacturerid_prob, predict_devicetypeid_prob) SELECT ip, mac, macvendorid, ispublic, vlan, roleid, 32, NULL, NULL, NULL, NULL, ipprefixid, NULL, NULL FROM src_ip WHERE parent_ipid IS NULL AND (ipprefixid IS NULL OR mac IS NOT NULL OR (mac IS NULL AND NOT EXISTS (SELECT NULL FROM tmp_intid WHERE tmp_intid.id=ipprefixid)));', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 11, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_ip ON tmp_nnml_ip.ip=src_ip.ip INNER JOIN ref_ipprefix ON src_ip.ipprefixid=ref_ipprefix.ipprefixid SET tmp_nnml_ip.netnum=ref_ipprefix.netnum WHERE tmp_nnml_ip.netnum=32;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 12, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_if ON tmp_nnml_ip.ip=src_if.ip SET tmp_nnml_ip.netnum=src_if.netnum WHERE tmp_nnml_ip.netnum=32;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 20, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT typeid, 0 FROM ref_nnml_input_type WHERE input_type=\'ispublic\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 21, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT typeid, ref_nnml_ip_exists_table.id FROM ref_nnml_ip_exists_table INNER JOIN ref_nnml_input_type ON input_type=\'ip_exists\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 22, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT typeid, ref_nnml_mac_exists_table.id FROM ref_nnml_mac_exists_table INNER JOIN ref_nnml_input_type ON input_type=\'mac_exists\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 23, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT typeid, ref_scan_ip_info.infoid FROM ref_scan_ip_info INNER JOIN ref_nnml_input_type ON input_type=\'ip_info_exists\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 30, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT DISTINCT ref_nnml_input_type.typeid, tmp_nnml_ip.roleid FROM tmp_nnml_ip INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'roleid\' WHERE tmp_nnml_ip.roleid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 31, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT DISTINCT ref_nnml_input_type.typeid, tmp_nnml_ip.vlan FROM tmp_nnml_ip INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'vlan\' WHERE tmp_nnml_ip.roleid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 40, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 41, 'INSERT IGNORE INTO tmp_intid (id) SELECT info_mac.assignmentid FROM tmp_nnml_ip INNER JOIN info_mac ON tmp_nnml_ip.macvendorid=info_mac.assignment GROUP BY info_mac.assignmentid HAVING COUNT(*)>4;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 42, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT DISTINCT ref_nnml_input_type.typeid, info_mac.assignmentid FROM tmp_nnml_ip INNER JOIN info_mac ON tmp_nnml_ip.macvendorid=info_mac.assignment INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'macvendorid\' WHERE EXISTS (SELECT NULL FROM tmp_intid WHERE tmp_intid.id=info_mac.assignmentid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 50, 'INSERT IGNORE INTO info_nnml_script_exists (type, port, script) SELECT DISTINCT src_scan_port.type, src_scan_port.port, src_scan_script.script FROM src_scan_script INNER JOIN src_scan_port ON src_scan_script.portid=src_scan_port.portid WHERE (src_scan_port.type, src_scan_port.port, src_scan_script.script) NOT IN (SELECT type, port, script FROM info_nnml_script_exists);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 51, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT DISTINCT ref_nnml_input_type.typeid, src_scan_port.port FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'tcp_port\' WHERE src_scan_port.type=\'tcp\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 52, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT DISTINCT ref_nnml_input_type.typeid, src_scan_port.port FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'udp_port\' WHERE src_scan_port.type=\'udp\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 53, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT DISTINCT ref_nnml_input_type.typeid, src_scan_port.port FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'icmp\' WHERE src_scan_port.type=\'icmp\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 54, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT DISTINCT ref_nnml_input_type.typeid, info_nnml_script_exists.id FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN info_nnml_script_exists ON src_scan_port.type=info_nnml_script_exists.type AND src_scan_port.port=info_nnml_script_exists.port AND src_scan_script.script=info_nnml_script_exists.script INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_script_exists\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 55, 'INSERT IGNORE INTO info_nnml_osmatch_exists (name) SELECT DISTINCT name FROM src_scan_osmatch WHERE name NOT IN (SELECT name FROM info_nnml_osmatch_exists);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 56, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT ref_nnml_input_type.typeid, info_nnml_osmatch_exists.id FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_osmatch ON src_scan_ip.ipid=src_scan_osmatch.ipid INNER JOIN info_nnml_osmatch_exists ON src_scan_osmatch.name=info_nnml_osmatch_exists.name INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_osmatch_exists\' GROUP BY ref_nnml_input_type.typeid, info_nnml_osmatch_exists.id HAVING COUNT(*)>2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 57, 'TRUNCATE TABLE tmp_src_scan_script;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 58, 'INSERT IGNORE INTO tmp_src_scan_script (id, portid, script, value) SELECT src_scan_script.id, src_scan_script.portid, src_scan_script.script, LEFT(src_scan_script.value,600) AS v FROM src_scan_script INNER JOIN src_scan_port ON src_scan_script.portid=src_scan_port.portid INNER JOIN src_scan_ip ON src_scan_port.ipid=src_scan_ip.ipid INNER JOIN tmp_nnml_ip ON src_scan_ip.ip=tmp_nnml_ip.ip WHERE src_scan_script.script NOT IN (\'http-date\', \'http-headers\', \'http-security-headers\', \'ntp-info\', \'snmp-interfaces\', \'ssh-hostkey\', \'ssl-cert\', \'ssl-date\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 59, 'INSERT IGNORE INTO info_nnml_script_value_exists (script, value) SELECT script, value FROM tmp_src_scan_script WHERE NOT EXISTS (SELECT NULL FROM info_nnml_script_value_exists WHERE info_nnml_script_value_exists.script=tmp_src_scan_script.script AND info_nnml_script_value_exists.value=tmp_src_scan_script.value) GROUP BY script, value HAVING COUNT(*)>4;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 60, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT ref_nnml_input_type.typeid, info_nnml_script_value_exists.id FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN tmp_src_scan_script ON src_scan_port.portid=tmp_src_scan_script.portid INNER JOIN info_nnml_script_value_exists ON tmp_src_scan_script.script=info_nnml_script_value_exists.script AND tmp_src_scan_script.value=info_nnml_script_value_exists.value INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_script_value_exists\' GROUP BY tmp_src_scan_script.script, tmp_src_scan_script.value, ref_nnml_input_type.typeid, info_nnml_script_value_exists.id HAVING COUNT(*)>4;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 70, 'INSERT IGNORE INTO info_nnml_service_product (type, port, product) SELECT src_scan_port.type, src_scan_port.port, src_scan_service.product FROM src_scan_service INNER JOIN src_scan_port ON src_scan_service.portid=src_scan_port.portid INNER JOIN src_scan_ip ON src_scan_port.ipid=src_scan_ip.ipid INNER JOIN nnml_ip ON src_scan_ip.ip=nnml_ip.ip WHERE src_scan_service.product IS NOT NULL AND NOT (UPPER(src_scan_service.product) RLIKE \'^.*[0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F]$\') AND NOT EXISTS (SELECT NULL FROM info_nnml_service_product WHERE info_nnml_service_product.type=src_scan_port.type AND info_nnml_service_product.port=src_scan_port.port AND info_nnml_service_product.product=src_scan_service.product) GROUP BY src_scan_port.type, src_scan_port.port, src_scan_service.product HAVING COUNT(*)>2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 71, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT ref_nnml_input_type.typeid, info_nnml_service_product.id FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_service ON src_scan_port.portid=src_scan_service.portid INNER JOIN info_nnml_service_product ON src_scan_port.type=info_nnml_service_product.type AND src_scan_port.port=info_nnml_service_product.port AND src_scan_service.product=info_nnml_service_product.product INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_service_product_exists\' GROUP BY src_scan_port.type, src_scan_port.port, src_scan_service.product, ref_nnml_input_type.typeid, info_nnml_service_product.id HAVING COUNT(*)>2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 72, 'INSERT IGNORE INTO info_nnml_service_extrainfo (type, port, extrainfo) SELECT src_scan_port.type, src_scan_port.port, src_scan_service.extrainfo FROM src_scan_service INNER JOIN src_scan_port ON src_scan_service.portid=src_scan_port.portid INNER JOIN src_scan_ip ON src_scan_port.ipid=src_scan_ip.ipid INNER JOIN nnml_ip ON src_scan_ip.ip=nnml_ip.ip WHERE src_scan_service.extrainfo IS NOT NULL AND NOT (UPPER(src_scan_service.extrainfo) RLIKE \'^.*[0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F][0-9,A-F]$\') AND LOWER(src_scan_service.extrainfo) NOT LIKE \'name:%\' AND LOWER(src_scan_service.extrainfo) NOT LIKE \'server time:%\' AND LOWER(src_scan_service.extrainfo) NOT LIKE \'domain:%\' AND NOT EXISTS (SELECT NULL FROM info_nnml_service_extrainfo WHERE info_nnml_service_extrainfo.type=src_scan_port.type AND info_nnml_service_extrainfo.port=src_scan_port.port AND info_nnml_service_extrainfo.extrainfo=src_scan_service.extrainfo) GROUP BY src_scan_port.type, src_scan_port.port, src_scan_service.extrainfo HAVING COUNT(*)>2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 73, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT ref_nnml_input_type.typeid, info_nnml_service_extrainfo.id FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_service ON src_scan_port.portid=src_scan_service.portid INNER JOIN info_nnml_service_extrainfo ON src_scan_port.type=info_nnml_service_extrainfo.type AND src_scan_port.port=info_nnml_service_extrainfo.port AND src_scan_service.extrainfo=info_nnml_service_extrainfo.extrainfo INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_service_extrainfo_exists\' GROUP BY src_scan_port.type, src_scan_port.port, src_scan_service.extrainfo, ref_nnml_input_type.typeid, info_nnml_service_extrainfo.id HAVING COUNT(*)>2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 74, 'INSERT IGNORE INTO info_nnml_service_cpe (type, port, cpe) SELECT src_scan_port.type, src_scan_port.port, src_scan_service.cpe FROM src_scan_service INNER JOIN src_scan_port ON src_scan_service.portid=src_scan_port.portid INNER JOIN src_scan_ip ON src_scan_port.ipid=src_scan_ip.ipid INNER JOIN nnml_ip ON src_scan_ip.ip=nnml_ip.ip WHERE src_scan_service.cpe IS NOT NULL AND NOT EXISTS (SELECT NULL FROM info_nnml_service_cpe WHERE info_nnml_service_cpe.type=src_scan_port.type AND info_nnml_service_cpe.port=src_scan_port.port AND info_nnml_service_cpe.cpe=src_scan_service.cpe) GROUP BY src_scan_port.type, src_scan_port.port, src_scan_service.cpe HAVING COUNT(*)>2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 75, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT ref_nnml_input_type.typeid, info_nnml_service_cpe.id FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_service ON src_scan_port.portid=src_scan_service.portid INNER JOIN info_nnml_service_cpe ON src_scan_port.type=info_nnml_service_cpe.type AND src_scan_port.port=info_nnml_service_cpe.port AND src_scan_service.cpe=info_nnml_service_cpe.cpe INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_service_cpe_exists\' GROUP BY src_scan_port.type, src_scan_port.port, src_scan_service.cpe, ref_nnml_input_type.typeid, info_nnml_service_cpe.id HAVING COUNT(*)>2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 80, 'INSERT IGNORE INTO info_nnml_osclass_type (type) SELECT src_scan_osclass.type FROM src_scan_osclass INNER JOIN src_scan_osmatch ON src_scan_osclass.osmatchid=src_scan_osmatch.osmatchid INNER JOIN src_scan_ip ON src_scan_osmatch.ipid=src_scan_ip.ipid INNER JOIN nnml_ip ON src_scan_ip.ip=nnml_ip.ip WHERE src_scan_osclass.type IS NOT NULL AND NOT EXISTS (SELECT NULL FROM info_nnml_osclass_type WHERE info_nnml_osclass_type.type=src_scan_osclass.type) GROUP BY src_scan_osclass.type HAVING COUNT(*)>2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 81, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT ref_nnml_input_type.typeid, info_nnml_osclass_type.id FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_osmatch ON src_scan_ip.ipid=src_scan_osmatch.ipid INNER JOIN src_scan_osclass ON src_scan_osmatch.osmatchid=src_scan_osclass.osmatchid INNER JOIN info_nnml_osclass_type ON src_scan_osclass.type=info_nnml_osclass_type.type INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_osclass_type_exists\' GROUP BY src_scan_osclass.type, ref_nnml_input_type.typeid, info_nnml_osclass_type.id HAVING COUNT(*)>2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 82, 'INSERT IGNORE INTO info_nnml_osclass_vendor (vendor) SELECT src_scan_osclass.vendor FROM src_scan_osclass INNER JOIN src_scan_osmatch ON src_scan_osclass.osmatchid=src_scan_osmatch.osmatchid INNER JOIN src_scan_ip ON src_scan_osmatch.ipid=src_scan_ip.ipid INNER JOIN nnml_ip ON src_scan_ip.ip=nnml_ip.ip WHERE src_scan_osclass.vendor IS NOT NULL AND NOT EXISTS (SELECT NULL FROM info_nnml_osclass_vendor WHERE info_nnml_osclass_vendor.vendor=src_scan_osclass.vendor) GROUP BY src_scan_osclass.vendor HAVING COUNT(*)>2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 83, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT ref_nnml_input_type.typeid, info_nnml_osclass_vendor.id FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_osmatch ON src_scan_ip.ipid=src_scan_osmatch.ipid INNER JOIN src_scan_osclass ON src_scan_osmatch.osmatchid=src_scan_osclass.osmatchid INNER JOIN info_nnml_osclass_vendor ON src_scan_osclass.vendor=info_nnml_osclass_vendor.vendor INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_osclass_vendor_exists\' GROUP BY src_scan_osclass.vendor, ref_nnml_input_type.typeid, info_nnml_osclass_vendor.id HAVING COUNT(*)>2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 84, 'INSERT IGNORE INTO info_nnml_osclass_osfamily (osfamily) SELECT src_scan_osclass.osfamily FROM src_scan_osclass INNER JOIN src_scan_osmatch ON src_scan_osclass.osmatchid=src_scan_osmatch.osmatchid INNER JOIN src_scan_ip ON src_scan_osmatch.ipid=src_scan_ip.ipid INNER JOIN nnml_ip ON src_scan_ip.ip=nnml_ip.ip WHERE src_scan_osclass.osfamily IS NOT NULL AND NOT EXISTS (SELECT NULL FROM info_nnml_osclass_osfamily WHERE info_nnml_osclass_osfamily.osfamily=src_scan_osclass.osfamily) GROUP BY src_scan_osclass.osfamily HAVING COUNT(*)>2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 85, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT ref_nnml_input_type.typeid, info_nnml_osclass_osfamily.id FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_osmatch ON src_scan_ip.ipid=src_scan_osmatch.ipid INNER JOIN src_scan_osclass ON src_scan_osmatch.osmatchid=src_scan_osclass.osmatchid INNER JOIN info_nnml_osclass_osfamily ON src_scan_osclass.osfamily=info_nnml_osclass_osfamily.osfamily INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_osclass_osfamily_exists\' GROUP BY src_scan_osclass.osfamily, ref_nnml_input_type.typeid, info_nnml_osclass_osfamily.id HAVING COUNT(*)>2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 86, 'INSERT IGNORE INTO info_nnml_osclass_cpe (cpe) SELECT src_scan_osclass.cpe FROM src_scan_osclass INNER JOIN src_scan_osmatch ON src_scan_osclass.osmatchid=src_scan_osmatch.osmatchid INNER JOIN src_scan_ip ON src_scan_osmatch.ipid=src_scan_ip.ipid INNER JOIN nnml_ip ON src_scan_ip.ip=nnml_ip.ip WHERE src_scan_osclass.cpe IS NOT NULL AND NOT EXISTS (SELECT NULL FROM info_nnml_osclass_cpe WHERE info_nnml_osclass_cpe.cpe=src_scan_osclass.cpe) GROUP BY src_scan_osclass.cpe HAVING COUNT(*)>2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 2, 87, 'INSERT IGNORE INTO tmp_nnml_input (input_typeid, typeid) SELECT ref_nnml_input_type.typeid, info_nnml_osclass_cpe.id FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_osmatch ON src_scan_ip.ipid=src_scan_osmatch.ipid INNER JOIN src_scan_osclass ON src_scan_osmatch.osmatchid=src_scan_osclass.osmatchid INNER JOIN info_nnml_osclass_cpe ON src_scan_osclass.cpe=info_nnml_osclass_cpe.cpe INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_osclass_cpe_exists\' GROUP BY src_scan_osclass.cpe, ref_nnml_input_type.typeid, info_nnml_osclass_cpe.id HAVING COUNT(*)>2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 10, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ispublic\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=0 WHERE tmp_nnml_ip.ispublic=1;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 11, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'vlan\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=tmp_nnml_ip.vlan WHERE tmp_nnml_ip.vlan<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 12, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'roleid\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=tmp_nnml_ip.roleid WHERE tmp_nnml_ip.roleid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 13, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN info_mac ON tmp_nnml_ip.macvendorid=info_mac.assignment INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'macvendorid\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=info_mac.assignmentid WHERE tmp_nnml_ip.macvendorid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 20, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_activaire ON tmp_nnml_ip.ip=src_activaire.ip INNER JOIN ref_nnml_ip_exists_table ON ref_nnml_ip_exists_table.tablename=\'src_activaire\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ip_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_ip_exists_table.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 21, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_arp ON tmp_nnml_ip.ip=src_arp.ip INNER JOIN ref_nnml_ip_exists_table ON ref_nnml_ip_exists_table.tablename=\'src_arp\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ip_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_ip_exists_table.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 22, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_enplug_edu ON tmp_nnml_ip.ip=src_enplug_edu.ip INNER JOIN ref_nnml_ip_exists_table ON ref_nnml_ip_exists_table.tablename=\'src_enplug_edu\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ip_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_ip_exists_table.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 23, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_if ON tmp_nnml_ip.ip=src_if.ip INNER JOIN ref_nnml_ip_exists_table ON ref_nnml_ip_exists_table.tablename=\'src_if\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ip_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_ip_exists_table.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 24, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_if ON tmp_nnml_ip.ip=src_if.device INNER JOIN ref_nnml_ip_exists_table ON ref_nnml_ip_exists_table.tablename=\'src_if\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ip_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_ip_exists_table.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 25, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_mist ON tmp_nnml_ip.ip=src_mist.ip INNER JOIN ref_nnml_ip_exists_table ON ref_nnml_ip_exists_table.tablename=\'src_mist\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ip_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_ip_exists_table.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 26, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_ruckussz_wap ON tmp_nnml_ip.ip=src_ruckussz_wap.ip INNER JOIN ref_nnml_ip_exists_table ON ref_nnml_ip_exists_table.tablename=\'src_ruckussz_wap\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ip_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_ip_exists_table.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 27, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_ruckussz_wlc ON src_scan_ip.ipid=src_ruckussz_wlc.ipid INNER JOIN ref_nnml_ip_exists_table ON ref_nnml_ip_exists_table.tablename=\'src_ruckussz_wlc\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ip_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_ip_exists_table.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 28, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_snmp_cdp ON src_scan_ip.ipid=src_snmp_cdp.switchid INNER JOIN ref_nnml_ip_exists_table ON ref_nnml_ip_exists_table.tablename=\'src_snmp_cdp\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ip_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_ip_exists_table.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 29, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_snmp_lldp ON src_scan_ip.ipid=src_snmp_lldp.switchid INNER JOIN ref_nnml_ip_exists_table ON ref_nnml_ip_exists_table.tablename=\'src_snmp_lldp\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ip_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_ip_exists_table.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 30, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_snmp_router ON src_scan_ip.ipid=src_snmp_router.routerid INNER JOIN ref_nnml_ip_exists_table ON ref_nnml_ip_exists_table.tablename=\'src_snmp_router\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ip_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_ip_exists_table.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 31, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_snmp_sysor ON src_scan_ip.ipid=src_snmp_sysor.ipid INNER JOIN ref_nnml_ip_exists_table ON ref_nnml_ip_exists_table.tablename=\'src_snmp_sysor\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ip_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_ip_exists_table.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 32, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_snmp_system ON src_scan_ip.ipid=src_snmp_system.ipid INNER JOIN ref_nnml_ip_exists_table ON ref_nnml_ip_exists_table.tablename=\'src_snmp_system\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ip_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_ip_exists_table.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 33, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_snmp_wap ON tmp_nnml_ip.ip=src_snmp_wap.ip INNER JOIN ref_nnml_ip_exists_table ON ref_nnml_ip_exists_table.tablename=\'src_snmp_wap\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ip_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_ip_exists_table.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 34, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_snmp_wlc ON src_scan_ip.ipid=src_snmp_wlc.ipid INNER JOIN ref_nnml_ip_exists_table ON ref_nnml_ip_exists_table.tablename=\'src_snmp_wlc\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ip_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_ip_exists_table.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 50, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_activaire ON tmp_nnml_ip.mac=src_activaire.mac_eth INNER JOIN ref_nnml_mac_exists_table ON ref_nnml_mac_exists_table.tablename=\'src_activaire\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'mac_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_mac_exists_table.id WHERE tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 51, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_arp ON tmp_nnml_ip.mac=src_arp.mac INNER JOIN ref_nnml_mac_exists_table ON ref_nnml_mac_exists_table.tablename=\'src_arp\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'mac_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_mac_exists_table.id WHERE tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 52, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_enplug_edu ON tmp_nnml_ip.mac=src_enplug_edu.mac_eth INNER JOIN ref_nnml_mac_exists_table ON ref_nnml_mac_exists_table.tablename=\'src_enplug_edu\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'mac_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_mac_exists_table.id WHERE tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 53, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_mac ON tmp_nnml_ip.mac=src_mac.mac INNER JOIN ref_nnml_mac_exists_table ON ref_nnml_mac_exists_table.tablename=\'src_mac\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'mac_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_mac_exists_table.id WHERE tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 54, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_mist ON tmp_nnml_ip.mac=src_mist.mac INNER JOIN ref_nnml_mac_exists_table ON ref_nnml_mac_exists_table.tablename=\'src_mist\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'mac_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_mac_exists_table.id WHERE tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 55, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_ruckussz_wap ON tmp_nnml_ip.mac=src_ruckussz_wap.mac INNER JOIN ref_nnml_mac_exists_table ON ref_nnml_mac_exists_table.tablename=\'src_ruckussz_wap\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'mac_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_mac_exists_table.id WHERE tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 56, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_snmp_wap ON tmp_nnml_ip.mac=src_snmp_wap.mac INNER JOIN ref_nnml_mac_exists_table ON ref_nnml_mac_exists_table.tablename=\'src_snmp_wap\' INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'mac_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=ref_nnml_mac_exists_table.id WHERE tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 60, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_ip ON tmp_nnml_ip.ip=src_ip.ip INNER JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'ip_info_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=src_ip_info.infoid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 70, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'tcp_port\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=src_scan_port.port WHERE src_scan_port.type=\'tcp\' AND src_scan_port.state=\'open\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 71, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'udp_port\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=src_scan_port.port WHERE src_scan_port.type=\'udp\' AND src_scan_port.state=\'open\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 72, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'icmp\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=src_scan_port.port WHERE src_scan_port.type=\'icmp\' AND src_scan_port.state=\'up\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 73, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN info_nnml_script_exists ON src_scan_port.type=info_nnml_script_exists.type AND src_scan_port.port=info_nnml_script_exists.port AND src_scan_script.script=info_nnml_script_exists.script INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_script_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=info_nnml_script_exists.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 74, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, CAST(src_scan_osmatch.accuracy AS FLOAT)/100 AS value FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_osmatch ON src_scan_ip.ipid=src_scan_osmatch.ipid INNER JOIN info_nnml_osmatch_exists ON src_scan_osmatch.name=info_nnml_osmatch_exists.name INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_osmatch_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=info_nnml_osmatch_exists.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 75, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM tmp_src_scan_script STRAIGHT_JOIN src_scan_port ON tmp_src_scan_script.portid=src_scan_port.portid STRAIGHT_JOIN src_scan_ip ON src_scan_port.ipid=src_scan_ip.ipid STRAIGHT_JOIN tmp_nnml_ip ON src_scan_ip.ip=tmp_nnml_ip.ip STRAIGHT_JOIN info_nnml_script_value_exists ON tmp_src_scan_script.script=info_nnml_script_value_exists.script AND tmp_src_scan_script.value=info_nnml_script_value_exists.value STRAIGHT_JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_script_value_exists\' STRAIGHT_JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=info_nnml_script_value_exists.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 80, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM src_scan_service INNER JOIN src_scan_port ON src_scan_service.portid=src_scan_port.portid INNER JOIN src_scan_ip ON src_scan_port.ipid=src_scan_ip.ipid INNER JOIN tmp_nnml_ip ON src_scan_ip.ip=tmp_nnml_ip.ip INNER JOIN info_nnml_service_product ON src_scan_port.type=info_nnml_service_product.type AND src_scan_port.port=info_nnml_service_product.port AND src_scan_service.product=info_nnml_service_product.product INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_service_product_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=info_nnml_service_product.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 81, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM src_scan_service INNER JOIN src_scan_port ON src_scan_service.portid=src_scan_port.portid INNER JOIN src_scan_ip ON src_scan_port.ipid=src_scan_ip.ipid INNER JOIN tmp_nnml_ip ON src_scan_ip.ip=tmp_nnml_ip.ip INNER JOIN info_nnml_service_extrainfo ON src_scan_port.type=info_nnml_service_extrainfo.type AND src_scan_port.port=info_nnml_service_extrainfo.port AND src_scan_service.extrainfo=info_nnml_service_extrainfo.extrainfo INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_service_extrainfo_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=info_nnml_service_extrainfo.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 82, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, 1 FROM src_scan_service INNER JOIN src_scan_port ON src_scan_service.portid=src_scan_port.portid INNER JOIN src_scan_ip ON src_scan_port.ipid=src_scan_ip.ipid INNER JOIN tmp_nnml_ip ON src_scan_ip.ip=tmp_nnml_ip.ip INNER JOIN info_nnml_service_cpe ON src_scan_port.type=info_nnml_service_cpe.type AND src_scan_port.port=info_nnml_service_cpe.port AND src_scan_service.cpe=info_nnml_service_cpe.cpe INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_service_cpe_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=info_nnml_service_cpe.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 90, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, CAST(src_scan_osclass.accuracy AS FLOAT)/100 FROM src_scan_osclass INNER JOIN src_scan_osmatch ON src_scan_osclass.osmatchid=src_scan_osmatch.osmatchid INNER JOIN src_scan_ip ON src_scan_osmatch.ipid=src_scan_ip.ipid INNER JOIN tmp_nnml_ip ON src_scan_ip.ip=tmp_nnml_ip.ip INNER JOIN info_nnml_osclass_type ON src_scan_osclass.type=info_nnml_osclass_type.type INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_osclass_type_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=info_nnml_osclass_type.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 91, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, CAST(src_scan_osclass.accuracy AS FLOAT)/100 FROM src_scan_osclass INNER JOIN src_scan_osmatch ON src_scan_osclass.osmatchid=src_scan_osmatch.osmatchid INNER JOIN src_scan_ip ON src_scan_osmatch.ipid=src_scan_ip.ipid INNER JOIN tmp_nnml_ip ON src_scan_ip.ip=tmp_nnml_ip.ip INNER JOIN info_nnml_osclass_vendor ON src_scan_osclass.vendor=info_nnml_osclass_vendor.vendor INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_osclass_vendor_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=info_nnml_osclass_vendor.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 92, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, CAST(src_scan_osclass.accuracy AS FLOAT)/100 FROM src_scan_osclass INNER JOIN src_scan_osmatch ON src_scan_osclass.osmatchid=src_scan_osmatch.osmatchid INNER JOIN src_scan_ip ON src_scan_osmatch.ipid=src_scan_ip.ipid INNER JOIN tmp_nnml_ip ON src_scan_ip.ip=tmp_nnml_ip.ip INNER JOIN info_nnml_osclass_osfamily ON src_scan_osclass.osfamily=info_nnml_osclass_osfamily.osfamily INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_osclass_osfamily_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=info_nnml_osclass_osfamily.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 93, 'INSERT IGNORE INTO tmp_nnml_ip_input (ipid, inputid, value) SELECT tmp_nnml_ip.ipid, tmp_nnml_input.inputid, CAST(src_scan_osclass.accuracy AS FLOAT)/100 FROM src_scan_osclass INNER JOIN src_scan_osmatch ON src_scan_osclass.osmatchid=src_scan_osmatch.osmatchid INNER JOIN src_scan_ip ON src_scan_osmatch.ipid=src_scan_ip.ipid INNER JOIN tmp_nnml_ip ON src_scan_ip.ip=tmp_nnml_ip.ip INNER JOIN info_nnml_osclass_cpe ON src_scan_osclass.cpe=info_nnml_osclass_cpe.cpe INNER JOIN ref_nnml_input_type ON ref_nnml_input_type.input_type=\'nmap_osclass_cpe_exists\' INNER JOIN tmp_nnml_input ON ref_nnml_input_type.typeid=tmp_nnml_input.input_typeid AND tmp_nnml_input.typeid=info_nnml_osclass_cpe.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 3, 199, 'DELETE IGNORE tmp_nnml_ip_input FROM tmp_nnml_ip_input WHERE value=0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 10, 10, 'INSERT IGNORE INTO nnml_ip (ip, mac, macvendorid, ispublic, vlan, roleid, netnum, label_manufacturerid, predict_manufacturerid, label_devicetypeid, predict_devicetypeid, ipprefixid, predict_manufacturerid_prob, predict_devicetypeid_prob) SELECT ip, mac, macvendorid, ispublic, vlan, roleid, netnum, label_manufacturerid, predict_manufacturerid, label_devicetypeid, predict_devicetypeid, ipprefixid, predict_manufacturerid_prob, predict_devicetypeid_prob FROM tmp_nnml_ip WHERE NOT EXISTS (SELECT NULL FROM nnml_ip WHERE nnml_ip.ip=tmp_nnml_ip.ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 10, 11, 'INSERT IGNORE INTO nnml_input (input_typeid, typeid) SELECT input_typeid, typeid FROM tmp_nnml_input WHERE NOT EXISTS (SELECT NULL FROM nnml_input WHERE nnml_input.input_typeid=tmp_nnml_input.input_typeid AND nnml_input.typeid=tmp_nnml_input.typeid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 10, 12, 'INSERT IGNORE INTO nnml_ip_input (ipid, inputid, value) SELECT nnml_ip.ipid, nnml_input.inputid, tmp_nnml_ip_input.value FROM tmp_nnml_ip_input INNER JOIN tmp_nnml_ip ON tmp_nnml_ip_input.ipid=tmp_nnml_ip.ipid INNER JOIN nnml_ip ON tmp_nnml_ip.ip=nnml_ip.ip INNER JOIN tmp_nnml_input ON tmp_nnml_ip_input.inputid=tmp_nnml_input.inputid INNER JOIN nnml_input ON tmp_nnml_input.input_typeid=nnml_input.input_typeid AND tmp_nnml_input.typeid=nnml_input.typeid WHERE NOT EXISTS (SELECT NULL FROM nnml_ip_input WHERE nnml_ip_input.ipid=nnml_ip.ipid AND nnml_ip_input.inputid=nnml_input.inputid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 10, 50, 'UPDATE IGNORE nnml_ip INNER JOIN tmp_nnml_ip ON nnml_ip.ip=tmp_nnml_ip.ip SET nnml_ip.mac=tmp_nnml_ip.mac, nnml_ip.macvendorid=tmp_nnml_ip.macvendorid, nnml_ip.ispublic=tmp_nnml_ip.ispublic, nnml_ip.vlan=tmp_nnml_ip.vlan, nnml_ip.roleid=tmp_nnml_ip.roleid, nnml_ip.netnum=tmp_nnml_ip.netnum, nnml_ip.ipprefixid=tmp_nnml_ip.ipprefixid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 10, 51, 'UPDATE IGNORE nnml_ip_input INNER JOIN nnml_ip ON nnml_ip_input.ipid=nnml_ip.ipid INNER JOIN tmp_nnml_ip ON nnml_ip.ip=tmp_nnml_ip.ip INNER JOIN nnml_input ON nnml_ip_input.inputid=nnml_input.inputid INNER JOIN tmp_nnml_input ON nnml_input.input_typeid=tmp_nnml_input.input_typeid AND nnml_input.typeid=tmp_nnml_input.typeid INNER JOIN tmp_nnml_ip_input ON tmp_nnml_ip.ipid=tmp_nnml_ip_input.ipid AND tmp_nnml_input.inputid=tmp_nnml_ip_input.inputid SET nnml_ip_input.value=tmp_nnml_ip_input.value WHERE nnml_ip_input.value<>tmp_nnml_ip_input.value;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 11, 10, 'DELETE IGNORE nnml_ip_input FROM nnml_ip_input INNER JOIN nnml_ip ON nnml_ip_input.ipid=nnml_ip.ipid WHERE NOT EXISTS (SELECT NULL FROM tmp_nnml_ip WHERE tmp_nnml_ip.ip=nnml_ip.ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 11, 11, 'DELETE IGNORE nnml_ip_input FROM nnml_ip_input INNER JOIN nnml_input ON nnml_ip_input.inputid=nnml_input.inputid WHERE NOT EXISTS (SELECT NULL FROM tmp_nnml_input WHERE tmp_nnml_input.input_typeid=nnml_input.input_typeid AND tmp_nnml_input.typeid=nnml_input.typeid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 11, 12, 'DELETE IGNORE nnml_ip_input FROM nnml_ip_input INNER JOIN nnml_ip ON nnml_ip_input.ipid=nnml_ip.ipid INNER JOIN tmp_nnml_ip ON nnml_ip.ip=tmp_nnml_ip.ip INNER JOIN nnml_input ON nnml_ip_input.inputid=nnml_input.inputid INNER JOIN tmp_nnml_input ON nnml_input.input_typeid=tmp_nnml_input.input_typeid AND nnml_input.typeid=tmp_nnml_input.typeid LEFT JOIN tmp_nnml_ip_input ON tmp_nnml_ip.ipid=tmp_nnml_ip_input.ipid AND tmp_nnml_input.inputid=tmp_nnml_ip_input.inputid WHERE tmp_nnml_ip_input.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 11, 13, 'DELETE IGNORE nnml_ip_input FROM nnml_ip_input WHERE value=0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 11, 48, 'DELETE IGNORE nnml_input FROM nnml_input WHERE NOT EXISTS (SELECT NULL FROM tmp_nnml_input WHERE tmp_nnml_input.input_typeid=nnml_input.input_typeid AND tmp_nnml_input.typeid=nnml_input.typeid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (701, 11, 49, 'DELETE IGNORE nnml_ip FROM nnml_ip WHERE NOT EXISTS (SELECT NULL FROM tmp_nnml_ip WHERE tmp_nnml_ip.ip=nnml_ip.ip);', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 1, 10, 'CREATE TEMPORARY TABLE tmp_nnml_ip (ipid BIGINT NOT NULL PRIMARY KEY, ip VARCHAR(39) NOT NULL UNIQUE, mac VARCHAR(12) DEFAULT NULL, macvendorid VARCHAR(12) DEFAULT NULL, ispublic BOOLEAN NOT NULL DEFAULT FALSE, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, netnum SMALLINT NOT NULL DEFAULT 32, label_manufacturerid INT UNSIGNED DEFAULT NULL, predict_manufacturerid INT UNSIGNED DEFAULT NULL, label_devicetypeid INT UNSIGNED DEFAULT NULL, predict_devicetypeid INT UNSIGNED DEFAULT NULL, model VARCHAR(100) DEFAULT NULL, ipprefixid INT UNSIGNED DEFAULT NULL, predict_manufacturerid_prob FLOAT UNSIGNED DEFAULT NULL, predict_devicetypeid_prob FLOAT UNSIGNED DEFAULT NULL, KEY macvendorid (macvendorid), KEY roleid (roleid), KEY vlan (vlan), KEY ispublic (ispublic), KEY netnum (netnum), KEY label_manufacturerid (label_manufacturerid), KEY label_devicetypeid (label_devicetypeid), KEY model (model), KEY ipprefixid (ipprefixid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 1, 20, 'CREATE TEMPORARY TABLE tmp_src_scan_osmatch (osmatchid INT NOT NULL PRIMARY KEY, ipid BIGINT NOT NULL, accuracy INT UNSIGNED NOT NULL, KEY ipid (ipid), KEY accuracy (accuracy)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 1, 30, 'CREATE TEMPORARY TABLE tmp_src_scan_osclass (osclassid INT NOT NULL PRIMARY KEY, osmatchid INT NOT NULL, ipid BIGINT NOT NULL, accuracy INT UNSIGNED NOT NULL, vendor VARCHAR(50) DEFAULT NULL, KEY osmatchid (osmatchid), KEY ipid (ipid), KEY accuracy (accuracy), KEY vendor(vendor)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 1, 40, 'CREATE TEMPORARY TABLE tmp_intid (id INT NOT NULL PRIMARY KEY) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 1, 41, 'CREATE TEMPORARY TABLE tmp_intid1 (id INT NOT NULL PRIMARY KEY) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 2, 10, 'INSERT IGNORE INTO tmp_nnml_ip (ipid, ip, mac, macvendorid, ispublic, vlan, roleid, netnum, label_manufacturerid, predict_manufacturerid, label_devicetypeid, predict_devicetypeid, ipprefixid, predict_manufacturerid_prob, predict_devicetypeid_prob) SELECT ipid, ip, mac, macvendorid, ispublic, vlan, roleid, netnum, NULL, NULL, NULL, NULL, ipprefixid, predict_manufacturerid_prob, predict_devicetypeid_prob FROM nnml_ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 2, 20, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_enplug_edu ON tmp_nnml_ip.mac=src_enplug_edu.mac_eth INNER JOIN ref_manufacturer ON manufacturer_alias=\'enplug\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 2, 21, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_enplug_edu ON tmp_nnml_ip.ip=src_enplug_edu.ip INNER JOIN ref_manufacturer ON manufacturer_alias=\'enplug\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_enplug_edu.status_code IN (\'Ok\', \'Error\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 2, 22, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_activaire ON tmp_nnml_ip.mac=src_activaire.mac INNER JOIN ref_manufacturer ON manufacturer_alias=\'activaire\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 2, 23, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_activaire ON tmp_nnml_ip.mac=src_activaire.mac_eth INNER JOIN ref_manufacturer ON manufacturer_alias=\'activaire\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 2, 24, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_activaire ON tmp_nnml_ip.ip=src_activaire.ip INNER JOIN ref_manufacturer ON manufacturer_alias=\'activaire\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_activaire.device_status=\'ACTIVE\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 2, 40, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_mist ON tmp_nnml_ip.mac=src_mist.mac INNER JOIN ref_manufacturer ON manufacturer_alias=\'juniper\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 2, 41, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_mist ON tmp_nnml_ip.ip=src_mist.ip INNER JOIN ref_manufacturer ON manufacturer_alias=\'juniper\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_mist.status=\'connected\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 2, 42, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_ruckussz_wap ON tmp_nnml_ip.mac=src_ruckussz_wap.mac INNER JOIN ref_manufacturer ON manufacturer_alias=\'ruckus\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 2, 43, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_ruckussz_wap ON tmp_nnml_ip.ip=src_ruckussz_wap.ip INNER JOIN ref_manufacturer ON manufacturer_alias=\'ruckus\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_ruckussz_wap.connectionstate IN (\'Connect\', \'Discovery\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 2, 44, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_snmp_wap ON tmp_nnml_ip.mac=src_snmp_wap.mac INNER JOIN src_snmp_wlc ON src_snmp_wap.wlcid=src_snmp_wlc.ipid INNER JOIN ref_wlc_type ON src_snmp_wlc.wlcid=ref_wlc_type.wlcid INNER JOIN ref_manufacturer ON manufacturer_alias=\'ruckus\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND tmp_nnml_ip.mac IS NOT NULL AND ref_wlc_type.wlc_type IN (\'ruckus_zd_wlc\', \'ruckus_scg_wlc\', \'ruckus_sz_wlc\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 2, 45, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_snmp_wap ON tmp_nnml_ip.mac=src_snmp_wap.mac INNER JOIN src_snmp_wlc ON src_snmp_wap.wlcid=src_snmp_wlc.ipid INNER JOIN ref_wlc_type ON src_snmp_wlc.wlcid=ref_wlc_type.wlcid INNER JOIN ref_manufacturer ON manufacturer_alias=\'cisco\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND tmp_nnml_ip.mac IS NOT NULL AND ref_wlc_type.wlc_type=\'cisco_wlc\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 2, 46, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_snmp_wap ON tmp_nnml_ip.ip=src_snmp_wap.ip INNER JOIN src_snmp_wlc ON src_snmp_wap.wlcid=src_snmp_wlc.ipid INNER JOIN ref_wlc_type ON src_snmp_wlc.wlcid=ref_wlc_type.wlcid INNER JOIN ref_manufacturer ON manufacturer_alias=\'ruckus\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND ref_wlc_type.wlc_type IN (\'ruckus_zd_wlc\', \'ruckus_scg_wlc\', \'ruckus_sz_wlc\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 2, 47, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_snmp_wap ON tmp_nnml_ip.ip=src_snmp_wap.ip INNER JOIN src_snmp_wlc ON src_snmp_wap.wlcid=src_snmp_wlc.ipid INNER JOIN ref_wlc_type ON src_snmp_wlc.wlcid=ref_wlc_type.wlcid INNER JOIN ref_manufacturer ON manufacturer_alias=\'cisco\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND ref_wlc_type.wlc_type=\'cisco_wlc\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 6, 10, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'cisco\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_ip.ipid IN (SELECT ipid FROM src_scan_port WHERE type=\'tcp\' AND state=\'open\' AND port=2000) AND src_scan_ip.ipid IN (SELECT ipid FROM src_scan_port WHERE type=\'tcp\' AND state=\'open\' AND port=5060) AND src_scan_ip.ipid IN (SELECT ipid FROM src_scan_port WHERE type=\'tcp\' AND state=\'open\' AND port=8008);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 6, 11, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'cisco\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_ip.ipid IN (SELECT ipid FROM src_scan_port WHERE type=\'tcp\' AND state=\'open\' AND port=2000) AND src_scan_ip.ipid IN (SELECT ipid FROM src_scan_port WHERE type=\'tcp\' AND state=\'open\' AND port=8008);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 10, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN nnml_ip_input ON tmp_nnml_ip.ipid=nnml_ip_input.ipid INNER JOIN nnml_input ON nnml_ip_input.inputid=nnml_input.inputid INNER JOIN ref_nnml_input_type ON nnml_input.input_typeid=ref_nnml_input_type.typeid INNER JOIN info_nnml_word ON nnml_input.typeid=info_nnml_word.id INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'dell\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND ref_nnml_input_type.input_type=\'word\' AND info_nnml_word.word LIKE \'%idrac%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 11, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'synology\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'mdns-service-discovery\' AND src_scan_script.value LIKE \'%Synology%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 12, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'biamp\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'mdns-service-discovery\' AND src_scan_script.value LIKE \'%TesiraForte%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 13, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'juniper\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'ntp-info\' AND src_scan_script.value LIKE \'%FreeBSDJNPR%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 14, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'cisco\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'snmp-info\' AND src_scan_script.value LIKE \'%ciscoSystems%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 15, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'sonicwall\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'snmp-info\' AND src_scan_script.value LIKE \'%SonicWALL%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 16, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'opengear\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'snmp-interfaces\' AND src_scan_script.value LIKE \'%OpenGear%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 17, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'yealink\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'ssl-cert\' AND src_scan_script.value LIKE \'%Yealink Network%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 18, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'loytec-electronics\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'ssl-cert\' AND src_scan_script.value LIKE \'%LOYTEC electronics%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 19, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'ava-video-security\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'ssl-cert\' AND src_scan_script.value LIKE \'%Ava UK%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 20, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'intelbras\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'ssl-cert\' AND src_scan_script.value LIKE \'%Intelbras Wireless%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 21, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'palo-alto\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'ssl-cert\' AND src_scan_script.value LIKE \'%Palo Alto Networks%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 22, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'fortinet\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'ssl-cert\' AND src_scan_script.value LIKE \'%Fortinet Ltd%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 23, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'arcules\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'ssl-cert\' AND src_scan_script.value LIKE \'%Arcules Inc%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 24, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'ribbon\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'ssl-cert\' AND src_scan_script.value LIKE \'%edgewaternetworks%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 25, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'avocent\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'ssl-cert\' AND src_scan_script.value LIKE \'%Avocent Corporation%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 26, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'watch-guard\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'ssl-cert\' AND src_scan_script.value LIKE \'%Fireware web%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 7, 27, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'cradlepoint\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND src_scan_script.script=\'ssl-cert\' AND src_scan_script.value LIKE \'%Cradlepoint%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 10, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN info_mac ON tmp_nnml_ip.macvendorid=info_mac.assignment INNER JOIN ref_mac_manufacturer_map ON LOWER(info_mac.organization)=LOWER(ref_mac_manufacturer_map.organization) SET tmp_nnml_ip.label_manufacturerid=ref_mac_manufacturer_map.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 20, 'TRUNCATE TABLE tmp_src_scan_osmatch;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 21, 'TRUNCATE TABLE tmp_src_scan_osmatch;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 22, 'INSERT IGNORE INTO tmp_src_scan_osmatch(ipid, osmatchid, accuracy) SELECT tmp_nnml_ip.ipid, src_scan_osmatch.osmatchid, src_scan_osmatch.accuracy FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_osmatch ON src_scan_ip.ipid=src_scan_osmatch.ipid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 23, 'INSERT IGNORE INTO tmp_src_scan_osclass(ipid, osmatchid, osclassid, accuracy, vendor) SELECT tmp_nnml_ip.ipid, src_scan_osclass.osmatchid, src_scan_osclass.osclassid, src_scan_osclass.accuracy, src_scan_osclass.vendor FROM tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_osmatch ON src_scan_ip.ipid=src_scan_osmatch.ipid INNER JOIN src_scan_osclass ON src_scan_osmatch.osmatchid=src_scan_osclass.osmatchid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 24, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 25, 'TRUNCATE TABLE tmp_intid1;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 26, 'INSERT IGNORE INTO tmp_intid (id) SELECT osmatchid FROM tmp_src_scan_osmatch WHERE (ipid, accuracy) IN (SELECT ipid, MAX(accuracy) FROM tmp_src_scan_osmatch GROUP BY ipid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 27, 'DELETE IGNORE tmp_src_scan_osmatch FROM tmp_src_scan_osmatch LEFT JOIN tmp_intid ON tmp_src_scan_osmatch.osmatchid=tmp_intid.id WHERE tmp_intid.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 28, 'INSERT IGNORE INTO tmp_intid1 (id) SELECT tmp_src_scan_osclass.osclassid FROM tmp_src_scan_osclass INNER JOIN tmp_src_scan_osmatch ON tmp_src_scan_osclass.osmatchid=tmp_src_scan_osmatch.osmatchid WHERE (tmp_src_scan_osmatch.ipid, tmp_src_scan_osclass.accuracy) IN (SELECT tmp_src_scan_osmatch.ipid, MAX(tmp_src_scan_osclass.accuracy) FROM tmp_src_scan_osmatch INNER JOIN tmp_src_scan_osclass ON tmp_src_scan_osmatch.osmatchid=tmp_src_scan_osclass.osmatchid GROUP BY tmp_src_scan_osmatch.ipid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 29, 'DELETE IGNORE tmp_src_scan_osclass FROM tmp_src_scan_osclass LEFT JOIN tmp_intid1 ON tmp_src_scan_osclass.osclassid=tmp_intid1.id WHERE tmp_intid1.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 30, 'UPDATE IGNORE tmp_src_scan_osclass SET vendor=LOWER(vendor) WHERE vendor IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 40, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN tmp_src_scan_osmatch ON tmp_nnml_ip.ipid=tmp_src_scan_osmatch.ipid INNER JOIN tmp_src_scan_osclass ON tmp_src_scan_osmatch.osmatchid=tmp_src_scan_osclass.osmatchid INNER JOIN ref_osclass_manufacturer_map ON tmp_src_scan_osclass.vendor=ref_osclass_manufacturer_map.vendor SET tmp_nnml_ip.label_manufacturerid=ref_osclass_manufacturer_map.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 41, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN tmp_src_scan_osmatch ON tmp_nnml_ip.ipid=tmp_src_scan_osmatch.ipid INNER JOIN tmp_src_scan_osclass ON tmp_src_scan_osmatch.osmatchid=tmp_src_scan_osclass.osmatchid INNER JOIN ref_manufacturer ON tmp_src_scan_osclass.vendor=ref_manufacturer.manufacturer_alias SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 42, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN tmp_src_scan_osmatch ON tmp_nnml_ip.ipid=tmp_src_scan_osmatch.ipid INNER JOIN tmp_src_scan_osclass ON tmp_src_scan_osmatch.osmatchid=tmp_src_scan_osclass.osmatchid INNER JOIN ref_manufacturer ON REPLACE(tmp_src_scan_osclass.vendor,\' \',\'-\')=ref_manufacturer.manufacturer_alias SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 43, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN tmp_src_scan_osmatch ON tmp_nnml_ip.ipid=tmp_src_scan_osmatch.ipid INNER JOIN tmp_src_scan_osclass ON tmp_src_scan_osmatch.osmatchid=tmp_src_scan_osclass.osmatchid INNER JOIN ref_manufacturer ON REPLACE(tmp_src_scan_osclass.vendor,\' \',\'_\')=ref_manufacturer.manufacturer_alias SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 44, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_osmatch ON src_scan_ip.ipid=src_scan_osmatch.ipid INNER JOIN src_scan_osclass ON src_scan_osmatch.osmatchid=src_scan_osclass.osmatchid INNER JOIN ref_osclass_manufacturer_map ON LOWER(src_scan_osclass.vendor)=ref_osclass_manufacturer_map.vendor SET tmp_nnml_ip.label_manufacturerid=ref_osclass_manufacturer_map.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 45, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_osmatch ON src_scan_ip.ipid=src_scan_osmatch.ipid INNER JOIN src_scan_osclass ON src_scan_osmatch.osmatchid=src_scan_osclass.osmatchid INNER JOIN ref_manufacturer ON LOWER(src_scan_osclass.vendor)=ref_manufacturer.manufacturer_alias SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 46, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_osmatch ON src_scan_ip.ipid=src_scan_osmatch.ipid INNER JOIN src_scan_osclass ON src_scan_osmatch.osmatchid=src_scan_osclass.osmatchid INNER JOIN ref_manufacturer ON LOWER(REPLACE(src_scan_osclass.vendor,\' \',\'-\'))=ref_manufacturer.manufacturer_alias SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 47, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_osmatch ON src_scan_ip.ipid=src_scan_osmatch.ipid INNER JOIN src_scan_osclass ON src_scan_osmatch.osmatchid=src_scan_osclass.osmatchid INNER JOIN ref_manufacturer ON LOWER(REPLACE(src_scan_osclass.vendor,\' \',\'_\'))=ref_manufacturer.manufacturer_alias SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 50, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN nnml_ip_input ON tmp_nnml_ip.ipid=nnml_ip_input.ipid INNER JOIN nnml_input ON nnml_ip_input.inputid=nnml_input.inputid INNER JOIN ref_nnml_input_type ON nnml_input.input_typeid=ref_nnml_input_type.typeid INNER JOIN info_nnml_word ON nnml_input.typeid=info_nnml_word.id INNER JOIN ref_manufacturer ON info_nnml_word.word=ref_manufacturer.manufacturer_alias SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND ref_nnml_input_type.input_type=\'word\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 100, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_enplug_edu ON tmp_nnml_ip.ip=src_enplug_edu.ip INNER JOIN ref_manufacturer ON manufacturer_alias=\'enplug\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 101, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_activaire ON tmp_nnml_ip.ip=src_activaire.ip INNER JOIN ref_manufacturer ON manufacturer_alias=\'activaire\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 102, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_mist ON tmp_nnml_ip.ip=src_mist.ip INNER JOIN ref_manufacturer ON manufacturer_alias=\'juniper\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 8, 103, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_ruckussz_wap ON tmp_nnml_ip.ip=src_ruckussz_wap.ip INNER JOIN ref_manufacturer ON manufacturer_alias=\'ruckus\' SET tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 10, 10, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_enplug_edu ON tmp_nnml_ip.mac=src_enplug_edu.mac_eth INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'digital-signage\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 10, 11, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_enplug_edu ON tmp_nnml_ip.ip=src_enplug_edu.ip INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'digital-signage\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_enplug_edu.status_code IN (\'Ok\', \'Error\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 10, 12, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_activaire ON tmp_nnml_ip.mac=src_activaire.mac INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'bgm-player\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid, tmp_nnml_ip.model=src_activaire.make_model WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 10, 13, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_activaire ON tmp_nnml_ip.mac=src_activaire.mac_eth INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'bgm-player\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid, tmp_nnml_ip.model=src_activaire.make_model WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 10, 14, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_activaire ON tmp_nnml_ip.ip=src_activaire.ip INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'bgm-player\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid, tmp_nnml_ip.model=src_activaire.make_model WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_activaire.device_status=\'ACTIVE\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 10, 20, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_mist ON tmp_nnml_ip.mac=src_mist.mac INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'wap\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid, tmp_nnml_ip.model=src_mist.model WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 10, 21, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_mist ON tmp_nnml_ip.ip=src_mist.ip INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'wap\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid, tmp_nnml_ip.model=src_mist.model WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_mist.status=\'connected\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 10, 22, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_ruckussz_wap ON tmp_nnml_ip.mac=src_ruckussz_wap.mac INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'wap\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid, tmp_nnml_ip.model=src_ruckussz_wap.model WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 10, 23, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_ruckussz_wap ON tmp_nnml_ip.ip=src_ruckussz_wap.ip INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'wap\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid, tmp_nnml_ip.model=src_ruckussz_wap.model WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_ruckussz_wap.connectionstate IN (\'Connect\', \'Discovery\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 10, 24, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_snmp_wap ON tmp_nnml_ip.mac=src_snmp_wap.mac INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'wap\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND tmp_nnml_ip.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 10, 25, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_snmp_wap ON tmp_nnml_ip.ip=src_snmp_wap.ip INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'wap\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 10, 26, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wlc\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'juniper\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'mist\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND tmp_nnml_ip.ip=\'52.9.8.62\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 10, 27, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_ruckussz_wlc ON src_scan_ip.ipid=src_ruckussz_wlc.ipid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wlc\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'ruckus\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'sz\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 10, 28, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_snmp_wlc ON src_scan_ip.ipid=src_snmp_wlc.ipid INNER JOIN ref_wlc_type ON src_snmp_wlc.wlcid=ref_wlc_type.wlcid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wlc\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'cisco\' AND rdt1.devicetypeid=rdt2.parentid SET tmp_nnml_ip.label_devicetypeid=rdt2.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_wlc_type.wlc_type=\'cisco_wlc\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 10, 29, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_snmp_wlc ON src_scan_ip.ipid=src_snmp_wlc.ipid INNER JOIN ref_wlc_type ON src_snmp_wlc.wlcid=ref_wlc_type.wlcid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wlc\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'ruckus\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'zd\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_wlc_type.wlc_type=\'ruckus_zd_wlc\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 10, 30, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_snmp_wlc ON src_scan_ip.ipid=src_snmp_wlc.ipid INNER JOIN ref_wlc_type ON src_snmp_wlc.wlcid=ref_wlc_type.wlcid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wlc\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'ruckus\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'scg\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_wlc_type.wlc_type=\'ruckus_scg_wlc\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 10, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_snmp_router ON src_scan_ip.ipid=src_snmp_router.routerid INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_ipprefix ON tmp_nnml_ip.ipprefixid=ref_ipprefix.ipprefixid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'router\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'mgmt\' AND tmp_nnml_ip.ipprefixid IS NOT NULL AND src_snmp_router.ipforwarding=1 AND (INET_ATON(tmp_nnml_ip.ip)=ref_ipprefix.startipnum+1 OR INET_ATON(tmp_nnml_ip.ip)=ref_ipprefix.endipnum-1) AND src_snmp_router.ipcidrroutenumber IS NOT NULL AND src_snmp_router.ipcidrroutenumber>2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 20, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN (SELECT device FROM src_if GROUP BY device HAVING COUNT(*)>=8) AS si ON tmp_nnml_ip.ip=si.device INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'switch\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'mgmt\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 30, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'room-controller\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'banner\' AND (src_scan_script.value IN (\'RMC3 Console\', \'DMPS3-300-C Console\', \'DMPS-300-C Control Console\', \'DMPS3-4K-150-C Console\', \'CP3 Console\', \'CP3N Console\', \'DIN-AP3\', \'DIN-CENCN-2 Control Console\') OR src_scan_script.value LIKE \'%RMC3 Console%\' OR src_scan_script.value LIKE \'%DMPS3-200-C Console%\' OR src_scan_script.value LIKE \'%CP3 Console%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 31, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'amplifier\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'banner\' AND (src_scan_script.value IN (\'AMP-8150 Control Console\') OR src_scan_script.value LIKE \'%BSS Soundweb%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 32, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'video-switcher\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'banner\' AND (src_scan_script.value IN (\'C2I-DMPS-300-AUDIO Console\', \'DM-RMC Control Console\', \'DM-RMC-4K-SCALER-C Control Console\', \'DM-TX-200-C-2G Control Console\', \'DM-TX-4K-202-C Control Console\', \'DM-MD8x8 Control Console\', \'DM-MD32x32 Control Console\') OR src_scan_script.value LIKE \'%C2I-DMPS-300-VIDEO Control Console%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 33, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'projector\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'banner\' AND src_scan_script.value IN (\'Projector>\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 34, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'control-panel\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'banner\' AND (src_scan_script.value IN (\'TSW-1060 Control Console\', \'TSW-1052 Control Console\', \'TSW-1050 Console\', \'TSW-760 Control Console\', \'TSW-752 Control Console\', \'TSW-750 Console\', \'TSS-10 Control Console\') OR src_scan_script.value LIKE \'%TSW-1060 Control Console%\' OR src_scan_script.value LIKE \'%TSW-760 Control Console%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 35, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'dsp\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'banner\' AND (src_scan_script.value IN (\'DSP-1280 Control Console\', \'DSP-1281 Control Console\', \'DSP-1282 Control Console\', \'DSP-1283 Control Console\', \'DSP-860 Control Console\') OR src_scan_script.value LIKE \'%DSP-1281 Control Console%\' OR src_scan_script.value LIKE \'%DSP-860 Control Console%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 40, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'nas\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'dns-service-discovery\' AND src_scan_script.value LIKE \'%vendor=Synology%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 50, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'amplifier\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ftp-syst\' AND src_scan_script.value LIKE \'%BIAMP%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 60, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'building-management\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND (src_scan_script.value IN (\'LG ACSmart Premium\', \'NX5-NET  [www.paginasprodigy.com/rikmed].\', \'KMC Conquest\', \'MITSUBISHI Air Conditioning Control System\', \'Building Operation WebStation\', \'Netlink signal assignment\') OR src_scan_script.value LIKE \'Tracer Synchrony%\' OR src_scan_script.value LIKE \'Tracer SC%\' OR src_scan_script.value LIKE \'Vive%\' OR src_scan_script.value LIKE \'Lutron%\' OR src_scan_script.value LIKE \'%BACnet%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 61, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'server\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'hypervisor\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'vmware\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND src_scan_script.value LIKE \'%ID_EESX_Welcome%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 62, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'access-control\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND (src_scan_script.value IN (\'S2 Network Node\', \'S2 Netbox Login\') OR src_scan_script.value LIKE \'2N% Indoor Touch 2.0\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 63, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'console-server\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND src_scan_script.value LIKE \'%Opengear Management Console%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 64, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'projector\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND (src_scan_script.value IN (\'Projector LAN Control\', \'Projector\') OR src_scan_script.value LIKE \'Projector%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 65, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'voip-adapter\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND src_scan_script.value=\'OBi300\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 66, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'camera\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND (src_scan_script.value IN (\'AXIS\', \'Ava Camera\') OR src_scan_script.value LIKE \'WV-% Network Camera\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 67, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'phone\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND (src_scan_script.value IN (\'Cisco IP Phone\', \'Grandstream Device Configuration\', \'Polycom - Configuration Utility\', \'Poly - Configuration Utility\') OR src_scan_script.value LIKE \'%Avaya%Phone%\' OR src_scan_script.value LIKE \'SPA% Configuration Utility\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 68, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'ups\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND src_scan_script.value=\'Eaton UPS Web Card\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 69, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'pdu\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND src_scan_script.value=\'Eaton ePDU G3\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 70, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'router\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND src_scan_script.value IN (\'EdgeOS\', \'Router\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 71, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'projector\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'av\' AND src_scan_script.script=\'http-title\' AND src_scan_script.value IN (\'Epson Web Control\', \'NEC Web Management\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 72, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'firewall\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND (src_scan_script.value IN (\'FortiGate\') OR src_scan_script.value LIKE \'Dell SonicWALL%\' OR src_scan_script.value LIKE \'SonicWall%\' OR src_scan_script.value LIKE \'ZyWALL%\' OR src_scan_script.value LIKE \'Cisco ASDM%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 73, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'print-server\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND src_scan_script.value LIKE \'Home - CUPS%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 74, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'digital-signage\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND src_scan_script.value=\'LG Signage\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 75, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'switch\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND (src_scan_script.value IN (\'Cisco Systems Login\') OR src_scan_script.value LIKE \'NETGEAR GS%\' OR src_scan_script.value LIKE \'Cisco Systems, Inc.%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 76, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'nas\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND src_scan_script.value LIKE \'NETGEAR ReadyNAS%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 77, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'q-sys\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'core\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'qsc\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND LOWER(src_scan_script.value) IN (\'q-sys core manager\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 78, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'q-sys\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'device\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'qsc\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND LOWER(src_scan_script.value) IN (\'q-sys peripheral manager\', \'q-sys device homepage\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 79, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'pbx\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND src_scan_script.value IN (\'Cisco UCS KVM Direct\', \'Cisco UCS Manager\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 80, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'printer\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND (src_scan_script.value IN (\'HP &raquo; Device Status\') OR src_scan_script.value LIKE \'Brother MFC%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 81, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'video-switcher\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND src_scan_script.value=\'HD-MD4x2-4K-E\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 82, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'room-controller\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND src_scan_script.value=\'HD-RX-201-C-E\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 83, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'control-panel\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'http-title\' AND src_scan_script.value=\'XPanel\' AND ref_manufacturer.manufacturer_alias=\'crestron\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 84, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'control-panel\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND src_scan_script.value LIKE \'%Crestron%\' AND (src_scan_script.value LIKE \'%TS1070%\' OR src_scan_script.value LIKE \'%TS-1070%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 85, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'control-panel\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'banner\' AND src_scan_script.value IN (\'AV3 Console\', \'DIN-AP3 Console\', \'DMPS3-4K-350-C Console\', \'MC3 Console\') ;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 100, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'screen-share\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%commonName=Solstice%\' OR src_scan_script.value LIKE \'%commonName=Crestron%\' OR src_scan_script.value LIKE \'%organizationName=AWiND%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 101, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'nas\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%commonName=QNAP NAS%\' OR src_scan_script.value LIKE \'%organizationName=emc%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 102, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wlc\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'ruckus\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'zd\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%commonName=Ruckus Wireless ZoneDirector%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 103, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'phone\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%commonName=Yealink Equipment Issuing%\' OR src_scan_script.value LIKE \'%organizationName=Dolby Laboratories%\' OR src_scan_script.value LIKE \'%commonName=Polycom Equipment%\' OR src_scan_script.value LIKE \'%organizationName=Polycom%\' OR src_scan_script.value LIKE \'%organizationName=Grandstream%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 104, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'digital-signage\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%organizationName=LGE/%\' OR src_scan_script.value LIKE \'%BRAVIA%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 105, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'server\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'ipmi\' AND rdt1.devicetypeid=rdt2.parentid SET tmp_nnml_ip.label_devicetypeid=rdt2.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND ((src_scan_script.value LIKE \'%commonName=iDRAC%\' AND src_scan_script.value LIKE \'%organizationName=Dell%\') OR (src_scan_script.value LIKE \'%commonName=iLO%\' AND src_scan_script.value LIKE \'%organizationName=Hewlett-Packard%\') OR src_scan_script.value LIKE \'%commonName=IPMI/%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 106, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'access-control\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%2N Telekomunikace%\' OR src_scan_script.value LIKE \'%2N Telecommunications%\' OR src_scan_script.value LIKE \'%organizationName=braXos Security%\' OR src_scan_script.value LIKE \'%organizationName=AIPHONE%\' OR src_scan_script.value LIKE \'%organizationName=Mercury Security%\' OR src_scan_script.value LIKE \'%organizationName=Zenitel%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 107, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'firewall\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%organizationName=Palo Alto Networks%\' OR src_scan_script.value LIKE \'%SonicWALL%\' OR src_scan_script.value LIKE \'%organizationName=Fortinet%\' OR src_scan_script.value LIKE \'%commonName=ASA %\' OR src_scan_script.value LIKE \'%commonName=Fireware web%\' OR src_scan_script.value LIKE \'%Barracuda CloudGen Firewall%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 108, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'q-sys\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'core\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'qsc\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND ((src_scan_script.value LIKE \'%commonName=Core%\' AND src_scan_script.value LIKE \'%organizationName=QSC%\'));', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 109, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'q-sys\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'device\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'qsc\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%/organizationName=QSC%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 110, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'wlc\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%commonName=Aruba7024%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 111, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'building-management\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%organizationName=Acuity Brands%\' OR src_scan_script.value LIKE \'%commonName=ACS5/organizationName=LG%\' OR src_scan_script.value LIKE \'%organizationName=Distech Controls%\' OR src_scan_script.value LIKE \'%organizationName=Tridium%\' OR src_scan_script.value LIKE \'%organizationName=CAREL Industries%\' OR src_scan_script.value LIKE \'%organizationName=LOYTEC electronics%\' OR src_scan_script.value LIKE \'%organizationName=Vertiv%\' OR src_scan_script.value LIKE \'%organizationName=Lutron%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 112, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'projector\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%organizationName=SEIKO EPSON%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 113, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'dvr\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%organizationName=Arcules%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 114, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'ups\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%organizationName=American Power Conversion%\' OR src_scan_script.value LIKE \'%commonName=EATON%\' OR src_scan_script.value LIKE \'%organizationName=Eaton%\' OR src_scan_script.value LIKE \'%organizationName=Lifesafety Power%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 115, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'server\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'hypervisor\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'vmware\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%organizationName=VM-VCENTER%\' OR src_scan_script.value LIKE \'%organizationName=VMware%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 116, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'switch\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%commonName=IOS-Self-Signed-Certificate%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 117, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'printer\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%organizationName=Lexmark%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 118, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'console-server\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND ((src_scan_script.value LIKE \'%commonName=SLC%\' AND src_scan_script.value LIKE \'%organizationName=Lantronix%\') OR src_scan_script.value LIKE \'%organizationName=Avocent Corporation%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 119, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'router\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%Vigor Router%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 120, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'camera\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%organizationName=bosch%\' OR src_scan_script.value LIKE \'%organizationName=Bosch Sicherheitssysteme%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 11, 121, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'environmental-monitor\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'ssl-cert\' AND (src_scan_script.value LIKE \'%organizationName=Geist%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 12, 10, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'camera\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'cctv\' AND src_scan_script.script=\'rtsp-url-brute\' AND LOWER(src_scan_script.value) LIKE \'%onvif%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 12, 11, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'phone\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'voice\' AND src_scan_script.script=\'sip-methods\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 12, 12, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'printer\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'print\' AND src_scan_script.script=\'pjl-ready-message\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 12, 13, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'print-server\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'print\' AND src_scan_script.script=\'http-title\' AND src_scan_script.value LIKE \'%CUPS%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 10, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'environmental-monitor\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND (LOWER(src_scan_script.value) LIKE \'%watchdog%\' OR LOWER(src_scan_script.value) LIKE \'%temp monitor%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 11, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'nas\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND LOWER(src_scan_script.value) LIKE \'%storageworks%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 12, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'printer\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND LOWER(src_scan_script.value) LIKE \'%toshiba e-studio%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 13, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wap\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'standalone\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'apple\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND LOWER(src_scan_script.value) LIKE \'%apple airport%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 14, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'server\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND (LOWER(src_scan_script.value) LIKE \'%ccproxy%\' OR LOWER(src_scan_script.value) LIKE \'%microsoft ftp%\' OR LOWER(src_scan_script.value) LIKE \'%rfb %\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 15, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'server\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'hypervisor\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'vmware\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND LOWER(src_scan_script.value) LIKE \'%vmware authentication%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 16, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'server\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'os\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'microsoft\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND (LOWER(src_scan_script.value) LIKE \'%iis windows%\' OR LOWER(src_scan_script.value) LIKE \'%iis7%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 17, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'room-controller\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND (LOWER(src_scan_script.value) LIKE \'%crestron roomview%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 18, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'building-management\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND (LOWER(src_scan_script.value) LIKE \'%nx5-net%\' OR LOWER(src_scan_script.value) LIKE \'%basrt-b%\' OR LOWER(src_scan_script.value) LIKE \'%itach ip2cc %\' OR LOWER(src_scan_script.value) LIKE \'%gsm-2000-smp%\' OR LOWER(src_scan_script.value) LIKE \'%ic-ii%\' OR LOWER(src_scan_script.value) LIKE \'%webrelay quad%\' OR LOWER(src_scan_script.value) LIKE \'%xytronix relay%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 19, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'video-switcher\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND (LOWER(src_scan_script.value) LIKE \'%at-hdvs-%\' OR LOWER(src_scan_script.value) LIKE \'%barix barionet%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 20, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'ups\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND (LOWER(src_scan_script.value) LIKE \'%ac smart%\' OR LOWER(src_scan_script.value) LIKE \'%poweralert device%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 21, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'server\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND (LOWER(src_scan_script.value) LIKE \'%eclipse glassfish%\' OR LOWER(src_scan_script.value) LIKE \'%thinkserver management%\' OR LOWER(src_scan_script.value) LIKE \'%macos server%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 22, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'router\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND (LOWER(src_scan_script.value) LIKE \'%ibr600%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 23, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'access-control\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND (LOWER(src_scan_script.value) LIKE \'%s2 netbox%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 24, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'switch\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND (LOWER(src_scan_script.value) LIKE \'%smc%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 25, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'firewall\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND (LOWER(src_scan_script.value) LIKE \'%usg60%\' OR LOWER(src_scan_script.value) LIKE \'%vpn100%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 26, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'server\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'hypervisor\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'hp\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND (LOWER(src_scan_script.value) LIKE \'%commonname=ilo%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 27, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'printer\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'hp\' AND rdt1.devicetypeid=rdt2.parentid SET tmp_nnml_ip.label_devicetypeid=rdt2.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND (LOWER(src_scan_script.value) LIKE \'%hp officejet%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 16, 28, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'screen-share\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'mersive\' AND rdt1.devicetypeid=rdt2.parentid SET tmp_nnml_ip.label_devicetypeid=rdt2.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND (LOWER(src_scan_script.value) LIKE \'%solstice%\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 10, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'access-control\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'security\' AND ref_manufacturer.manufacturer_alias IN (\'2n-telekomunikace\', \'aiphone\', \'mercury-security\', \'pcs-systemtechnik\', \'s2-security\', \'ti\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 11, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'camera\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'cctv\' AND ref_manufacturer.manufacturer_alias IN (\'advidia\', \'axis\', \'panasonic\', \'philips\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 12, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'phone\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'voice\' AND ref_manufacturer.manufacturer_alias IN (\'alcatel-lucent\', \'avaya\', \'cisco\', \'digium\', \'grandstream\', \'mitel\', \'polycom\', \'yealink\', \'rtx-telecom\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 13, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'ups\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'hvacups\' AND ref_manufacturer.manufacturer_alias IN (\'apc\', \'eaton\', \'tripp-lite\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 14, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'print-server\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'print\' AND ref_manufacturer.manufacturer_alias IN (\'apple\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 15, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'amplifier\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'av\' AND ref_manufacturer.manufacturer_alias IN (\'ashly\', \'biamp\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 16, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'switch\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'mgmt\' AND ref_manufacturer.manufacturer_alias IN (\'brocade\', \'cisco\', \'linksys\', \'netgear\', \'ruckus\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 17, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'printer\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'print\' AND ref_manufacturer.manufacturer_alias IN (\'brother\', \'canon\', \'epson\', \'kyocera\', \'lexmark\', \'hp\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 18, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'firewall\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'mgmt\' AND ref_manufacturer.manufacturer_alias IN (\'check-point\', \'fortinet\', \'palo-alto\', \'sonicwall\', \'sophos\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 19, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'firewall\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'wan\' AND ref_manufacturer.manufacturer_alias IN (\'check-point\', \'fortinet\', \'cisco\', \'palo-alto\', \'sonicwall\', \'sophos\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 20, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'nas\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'corp\' AND ref_manufacturer.manufacturer_alias IN (\'emc\', \'qnap\', \'synology\', \'wd\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 21, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'digital-signage\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'av\' AND ref_manufacturer.manufacturer_alias IN (\'enplug\', \'lg\', \'samsung\', \'enplug\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 22, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'projector\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'av\' AND ref_manufacturer.manufacturer_alias IN (\'epson\', \'nec\', \'hitachi\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 23, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'building-management\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'hvacups\' AND ref_manufacturer.manufacturer_alias IN (\'hitachi\', \'kmc-controls\', \'lg\', \'mitsubishi\', \'moxa\', \'osram\', \'panasonic\', \'samsung\', \'alerton\', \'nest-labs\', \'ti\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 24, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wap\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'standalone\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'juniper\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'wap\' AND ref_manufacturer.manufacturer_alias=\'juniper\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 25, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wap\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'standalone\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'cisco\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'wap\' AND ref_manufacturer.manufacturer_alias=\'cisco\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 26, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wap\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'standalone\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'ruckus\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'wap\' AND ref_manufacturer.manufacturer_alias=\'ruckus\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 27, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'router\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'mgmt\' AND ref_manufacturer.manufacturer_alias IN (\'juniper\', \'ubiquiti\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 28, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'switch\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'wan\' AND ref_manufacturer.manufacturer_alias IN (\'juniper\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 29, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'console-server\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'mgmt\' AND ref_manufacturer.manufacturer_alias IN (\'lantronix\', \'opengear\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 30, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'console-server\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'wan\' AND ref_manufacturer.manufacturer_alias IN (\'lantronix\', \'opengear\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 31, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'console-server\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'corp\' AND ref_manufacturer.manufacturer_alias IN (\'lantronix\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 32, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'computer\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'corp\' AND ref_manufacturer.manufacturer_alias IN (\'lenovo\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 33, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'voip-adapter\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'voice\' AND ref_manufacturer.manufacturer_alias IN (\'linksys\', \'obihai\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 34, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wap\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'standalone\' AND rdt1.devicetypeid=rdt2.parentid SET tmp_nnml_ip.label_devicetypeid=rdt2.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'wap\' AND ref_manufacturer.manufacturer_alias IN (\'mikrotik\', \'ubiquiti\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 35, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'router\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'wan\' AND ref_manufacturer.manufacturer_alias IN (\'mikrotik\', \'ubiquiti\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 36, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'bgm-player\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'av\' AND ref_manufacturer.manufacturer_alias IN (\'minix\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 17, 37, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'dvr\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'cctv\' AND ref_manufacturer.manufacturer_alias IN (\'dell\', \'hp\', \'gigabyte\', \'intel\', \'vmware\', \'microsoft\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 10, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'phone\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'yealink\', \'grandstream\', \'polycom\', \'konftel\', \'avaya\', \'aiphone\', \'digium\', \'mitel\', \'neatframe\', \'viavideo\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 11, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'digital-signage\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'enplug\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 12, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'access-control\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'2n-telekomunikace\', \'pcs-systemtechnik\', \'mercury-security\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 13, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'firewall\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'palo-alto\', \'watchguard\', \'sonicwall\', \'check-point\', \'fortinet\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 14, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'ups\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'tripp-lite\', \'apc\', \'eaton\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 15, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'computer\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'raspberry-pi\', \'lenovo\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 16, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'nas\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'qnap\', \'synology\', \'wd\', \'emc\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 17, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'console-server\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'opengear\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 18, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'switch\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'netgear\', \'brocade\', \'cisco\', \'d-link\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 19, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'projector\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'nec\', \'epson\', \'konica-minolta\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 20, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'bgm-player\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'minix\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 21, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'printer\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'lexmark\', \'brother\', \'canon\', \'kyocera\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 22, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'camera\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'advidia\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 23, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'amplifier\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'ashly\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 24, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'building-management\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'moxa\', \'chamberlain-group\', \'delta-controls\', \'3par-data\', \'alerton\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 25, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'server\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'microsoft\', \'vmware\', \'super-micro\', \'dell\', \'gigabyte\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 26, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'voip-adapter\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'obihai\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 27, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'dante-device\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'audinate\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 28, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'room-controller\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'extron\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 29, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'screen-share\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias IN (\'mersive\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 30, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'q-sys\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'device\' AND rdt1.devicetypeid=rdt2.parentid SET tmp_nnml_ip.label_devicetypeid=rdt2.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias=\'qsc\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 31, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'microphone\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'receiver\' AND rdt1.devicetypeid=rdt2.parentid SET tmp_nnml_ip.label_devicetypeid=rdt2.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias=\'shure\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 32, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wap\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'standalone\' AND rdt1.devicetypeid=rdt2.parentid SET tmp_nnml_ip.label_devicetypeid=rdt2.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias=\'ubiquiti\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 50, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_ipprefix ON tmp_nnml_ip.ipprefixid=ref_ipprefix.ipprefixid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'router\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias=\'juniper\' AND (INET_ATON(tmp_nnml_ip.ip)=ref_ipprefix.startipnum+1 OR INET_ATON(tmp_nnml_ip.ip)=ref_ipprefix.endipnum-1);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 51, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_ipprefix ON tmp_nnml_ip.ipprefixid=ref_ipprefix.ipprefixid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'switch\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias=\'juniper\';', 1) ;
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 52, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_manufacturer ON tmp_nnml_ip.label_manufacturerid=ref_manufacturer.manufacturerid INNER JOIN ref_ipprefix ON tmp_nnml_ip.ipprefixid=ref_ipprefix.ipprefixid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'screen-share\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_manufacturer.manufacturer_alias=\'crestron\';', 1) ;
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 60, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'camera\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND LOWER(src_scan_script.value) LIKE \'%onvif%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 61, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'phone\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'sip-methods\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 62, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'printer\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_script.script=\'pjl-ready-message\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 63, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'print-server\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND LOWER(src_scan_script.value) LIKE \'%cups%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 100, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'building-management\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_port.state=\'open\' AND src_scan_port.type=\'tcp\' AND src_scan_port.port=502;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 101, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'printer\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_port.state=\'open\' AND src_scan_port.type=\'tcp\' AND src_scan_port.port IN (515, 631, 9100);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 102, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'phone\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_port.state=\'open\' AND ((src_scan_port.type=\'tcp\' AND src_scan_port.port IN (2000, 5060, 5061)) OR (src_scan_port.type=\'udp\' AND src_scan_port.port IN (5060, 5061)));', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 103, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'video-switcher\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_port.state=\'open\' AND src_scan_port.type=\'tcp\' AND src_scan_port.port=41794;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 104, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'server\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'os\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'microsoft\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_port.state=\'open\' AND src_scan_port.type=\'tcp\' AND src_scan_port.port IN (1433, 3389, 5357);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 105, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'server\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'os\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'linux\' AND rdt2.devicetypeid=rdt3.parentid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND src_scan_port.state=\'open\' AND src_scan_port.type=\'tcp\' AND src_scan_port.port IN (3306, 5432);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 150, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'phone\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND LOWER(src_scan_script.value) LIKE \'%phone%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 151, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'printer\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND LOWER(src_scan_script.value) LIKE \'%printer%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 152, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'camera\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND LOWER(src_scan_script.value) LIKE \'%camera%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 153, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'switch\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND LOWER(src_scan_script.value) LIKE \'%switch%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 154, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'server\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND LOWER(src_scan_script.value) LIKE \'%server%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 155, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN src_scan_ip ON tmp_nnml_ip.ip=src_scan_ip.ip INNER JOIN src_scan_port ON src_scan_ip.ipid=src_scan_port.ipid INNER JOIN src_scan_script ON src_scan_port.portid=src_scan_script.portid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'router\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND LOWER(src_scan_script.value) LIKE \'%router%\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 200, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'phone\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'voice\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 201, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'printer\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'print\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 202, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wap\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt1.model_alias=\'standalone\' AND rdt1.devicetypeid=rdt2.parentid SET tmp_nnml_ip.label_devicetypeid=rdt2.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'wap\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 203, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'server\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'server\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 18, 204, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_subnet_role ON tmp_nnml_ip.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_devicetype ON ref_devicetype.model_alias=\'camera\' AND ref_devicetype.parentid=0 SET tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NULL AND ref_subnet_role.subnet_role_alias=\'cctv\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 19, 10, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_devicetype AS rdt1 ON tmp_nnml_ip.label_devicetypeid=rdt1.devicetypeid INNER JOIN ref_devicetype AS rdt2 ON rdt1.devicetypeid=rdt2.parentid AND tmp_nnml_ip.label_manufacturerid=rdt2.manufacturerid SET tmp_nnml_ip.label_devicetypeid=rdt2.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NOT NULL AND tmp_nnml_ip.label_manufacturerid IS NOT NULL AND rdt1.manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 19, 11, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_devicetype AS rdt1 ON tmp_nnml_ip.label_devicetypeid=rdt1.devicetypeid INNER JOIN ref_devicetype AS rdt2 ON rdt1.devicetypeid=rdt2.parentid AND rdt2.model_alias=\'\' INNER JOIN ref_devicetype AS rdt3 ON rdt2.devicetypeid=rdt3.parentid AND tmp_nnml_ip.label_manufacturerid=rdt2.manufacturerid SET tmp_nnml_ip.label_devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NOT NULL AND tmp_nnml_ip.label_manufacturerid IS NOT NULL AND rdt1.manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 19, 12, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_devicetype AS rdt1 ON tmp_nnml_ip.label_devicetypeid=rdt1.devicetypeid INNER JOIN ref_devicetype AS rdt2 ON rdt1.devicetypeid=rdt2.parentid AND rdt2.model_alias=\'\' SET tmp_nnml_ip.label_devicetypeid=rdt2.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NOT NULL AND rdt1.manufacturerid IS NOT NULL AND rdt1.manufacturerid=rdt2.manufacturerid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 19, 13, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_devicetype AS rdt1 ON tmp_nnml_ip.label_devicetypeid=rdt1.devicetypeid INNER JOIN ref_devicetype AS rdt2 ON rdt1.devicetypeid=rdt2.parentid AND rdt2.model_alias=\'\' SET tmp_nnml_ip.label_devicetypeid=rdt2.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NOT NULL AND rdt1.manufacturerid IS NULL AND rdt2.manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 19, 20, 'UPDATE IGNORE tmp_nnml_ip SET model=LOWER(model) WHERE model IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 19, 21, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_devicetype AS rdt1 ON tmp_nnml_ip.label_devicetypeid=rdt1.devicetypeid INNER JOIN ref_devicetype AS rdt2 ON rdt1.devicetypeid=rdt2.parentid AND rdt1.manufacturerid=rdt2.manufacturerid SET tmp_nnml_ip.label_devicetypeid=rdt2.devicetypeid WHERE tmp_nnml_ip.label_devicetypeid IS NOT NULL AND rdt1.manufacturerid IS NULL AND tmp_nnml_ip.model IS NOT NULL AND tmp_nnml_ip.model=rdt2.model_alias;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 19, 30, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_devicetype ON tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid SET tmp_nnml_ip.label_manufacturerid=ref_devicetype.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NULL AND ref_devicetype.manufacturerid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 19, 31, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_devicetype ON tmp_nnml_ip.label_devicetypeid=ref_devicetype.devicetypeid SET tmp_nnml_ip.label_manufacturerid=ref_devicetype.manufacturerid WHERE tmp_nnml_ip.label_manufacturerid IS NOT NULL AND ref_devicetype.manufacturerid IS NOT NULL AND tmp_nnml_ip.label_manufacturerid<>ref_devicetype.manufacturerid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 20, 10, 'UPDATE IGNORE nnml_ip INNER JOIN tmp_nnml_ip ON nnml_ip.ipid=tmp_nnml_ip.ipid SET nnml_ip.label_devicetypeid=tmp_nnml_ip.label_devicetypeid, nnml_ip.label_manufacturerid=tmp_nnml_ip.label_manufacturerid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 21, 10, 'DELETE IGNORE nnml_train_ip_input FROM nnml_train_ip_input INNER JOIN nnml_train_ip ON nnml_train_ip_input.ipid=nnml_train_ip.ipid WHERE NOT EXISTS (SELECT NULL FROM tmp_intid WHERE tmp_intid.id=nnml_train_ip.trainid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 21, 11, 'DELETE IGNORE nnml_train_ip FROM nnml_train_ip WHERE NOT EXISTS (SELECT NULL FROM tmp_intid WHERE tmp_intid.id=nnml_train_ip.trainid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 21, 12, 'DELETE IGNORE nnml_train FROM nnml_train WHERE NOT EXISTS (SELECT NULL FROM tmp_intid WHERE tmp_intid.id=nnml_train.trainid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 21, 20, 'INSERT IGNORE INTO nnml_train_input (input_typeid, typeid) SELECT input_typeid, typeid FROM nnml_input WHERE NOT EXISTS (SELECT NULL FROM nnml_train_input WHERE nnml_train_input.input_typeid=nnml_input.input_typeid AND nnml_train_input.typeid=nnml_input.typeid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 21, 21, 'INSERT IGNORE INTO nnml_train (created) SELECT NOW();', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 21, 22, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 21, 23, 'INSERT IGNORE INTO tmp_intid(id) SELECT trainid FROM nnml_train WHERE created=(SELECT MAX(created) FROM nnml_train);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 21, 24, 'INSERT IGNORE INTO nnml_train_ip (trainid, ip, mac, macvendorid, ispublic, vlan, roleid, netnum, manufacturerid, devicetypeid, ipprefixid) SELECT tmp_intid.id AS trainid, ip, mac, macvendorid, ispublic, vlan, roleid, netnum, label_manufacturerid, label_devicetypeid, ipprefixid FROM nnml_ip CROSS JOIN tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 21, 25, 'INSERT IGNORE INTO nnml_train_ip_input (ipid, inputid, value) SELECT nnml_train_ip.ipid,  nnml_train_input.inputid, nnml_ip_input.value FROM nnml_ip_input INNER JOIN nnml_ip ON nnml_ip_input.ipid=nnml_ip.ipid INNER JOIN nnml_train_ip ON nnml_ip.ip=nnml_train_ip.ip INNER JOIN tmp_intid ON nnml_train_ip.trainid=tmp_intid.id INNER JOIN nnml_input ON nnml_ip_input.inputid=nnml_input.inputid INNER JOIN nnml_train_input ON nnml_input.input_typeid=nnml_train_input.input_typeid AND nnml_input.typeid=nnml_train_input.typeid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 21, 30, 'DELETE IGNORE nnml_train_input FROM nnml_train_input WHERE NOT EXISTS (SELECT NULL FROM nnml_train_ip_input WHERE nnml_train_input.inputid=nnml_train_ip_input.inputid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 22, 10, 'UPDATE IGNORE nnml_train_ip INNER JOIN nnml_ip ON nnml_train_ip.ip=nnml_ip.ip SET nnml_train_ip.devicetypeid=nnml_ip.label_devicetypeid WHERE nnml_train_ip.mac IS NOT NULL AND nnml_train_ip.mac=nnml_ip.mac AND nnml_train_ip.devicetypeid IS NULL AND nnml_ip.label_devicetypeid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 22, 11, 'UPDATE IGNORE nnml_train_ip INNER JOIN nnml_ip ON nnml_train_ip.ip=nnml_ip.ip SET nnml_train_ip.manufacturerid=nnml_ip.label_manufacturerid WHERE nnml_train_ip.mac IS NOT NULL AND nnml_train_ip.mac=nnml_ip.mac AND nnml_train_ip.manufacturerid IS NULL AND nnml_ip.label_manufacturerid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 22, 20, 'UPDATE IGNORE nnml_train_ip INNER JOIN nnml_ip ON nnml_train_ip.ip=nnml_ip.ip SET nnml_train_ip.devicetypeid=nnml_ip.label_devicetypeid WHERE nnml_train_ip.mac IS NOT NULL AND nnml_train_ip.mac=nnml_ip.mac AND nnml_train_ip.devicetypeid IS NOT NULL AND nnml_ip.label_devicetypeid IS NOT NULL AND nnml_train_ip.devicetypeid<>nnml_ip.label_devicetypeid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (702, 22, 21, 'UPDATE IGNORE nnml_train_ip INNER JOIN nnml_ip ON nnml_train_ip.ip=nnml_ip.ip SET nnml_train_ip.manufacturerid=nnml_ip.label_manufacturerid WHERE nnml_train_ip.mac IS NOT NULL AND nnml_train_ip.mac=nnml_ip.mac AND nnml_train_ip.manufacturerid IS NOT NULL AND nnml_ip.label_manufacturerid IS NOT NULL AND nnml_train_ip.manufacturerid<>nnml_ip.label_manufacturerid;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (703, 1, 10, 'CREATE TEMPORARY TABLE tmp_intid (id INT NOT NULL PRIMARY KEY) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (703, 2, 10, 'DELETE IGNORE nnml_model_devicetype_map FROM nnml_model_devicetype_map WHERE NOT EXISTS (SELECT NULL FROM tmp_intid WHERE tmp_intid.id=nnml_model_devicetype_map.modelid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (703, 2, 11, 'DELETE IGNORE nnml_model_manufacturer_map FROM nnml_model_manufacturer_map WHERE NOT EXISTS (SELECT NULL FROM tmp_intid WHERE tmp_intid.id=nnml_model_manufacturer_map.modelid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (703, 2, 12, 'DELETE IGNORE nnml_model_input_map FROM nnml_model_input_map WHERE NOT EXISTS (SELECT NULL FROM tmp_intid WHERE tmp_intid.id=nnml_model_input_map.modelid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (703, 2, 19, 'DELETE IGNORE nnml_model FROM nnml_model WHERE NOT EXISTS (SELECT NULL FROM tmp_intid WHERE tmp_intid.id=nnml_model.modelid);', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (704, 1, 10, 'CREATE TEMPORARY TABLE tmp_nnml_ip (ipid BIGINT NOT NULL PRIMARY KEY, manufacturerid INT UNSIGNED DEFAULT NULL, manufacturerid_value FLOAT DEFAULT NULL, devicetypeid INT UNSIGNED DEFAULT NULL, devicetypeid_value FLOAT DEFAULT NULL, KEY manufacturerid (manufacturerid), KEY devicetypeid (devicetypeid), KEY manufacturerid_value (manufacturerid_value), KEY devicetypeid_value (devicetypeid_value)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (704, 2, 10, 'INSERT IGNORE INTO tmp_nnml_ip (ipid, manufacturerid, manufacturerid_value, devicetypeid, devicetypeid_value) SELECT ipid, NULL, NULL, NULL, NULL FROM nnml_ip;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (704, 3, 10, 'UPDATE IGNORE tmp_nnml_ip SET manufacturerid_value=0.0 WHERE manufacturerid_value IS NOT NULL AND manufacturerid_value<0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (704, 3, 11, 'UPDATE IGNORE tmp_nnml_ip SET manufacturerid_value=1.0 WHERE manufacturerid_value IS NOT NULL AND manufacturerid_value>1.0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (704, 3, 12, 'UPDATE IGNORE tmp_nnml_ip SET devicetypeid_value=0.0 WHERE devicetypeid_value IS NOT NULL AND devicetypeid_value<0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (704, 3, 13, 'UPDATE IGNORE tmp_nnml_ip SET devicetypeid_value=1.0 WHERE devicetypeid_value IS NOT NULL AND devicetypeid_value>1.0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (704, 3, 20, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_devicetype AS rdt1 ON tmp_nnml_ip.devicetypeid=rdt1.devicetypeid INNER JOIN ref_devicetype AS rdt2 ON rdt1.devicetypeid=rdt2.parentid AND tmp_nnml_ip.manufacturerid=rdt2.manufacturerid SET tmp_nnml_ip.devicetypeid=rdt2.devicetypeid WHERE tmp_nnml_ip.devicetypeid IS NOT NULL AND tmp_nnml_ip.manufacturerid IS NOT NULL AND rdt1.manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (704, 3, 21, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_devicetype AS rdt1 ON tmp_nnml_ip.devicetypeid=rdt1.devicetypeid INNER JOIN ref_devicetype AS rdt2 ON rdt1.devicetypeid=rdt2.parentid AND rdt2.model_alias=\'\' INNER JOIN ref_devicetype AS rdt3 ON rdt2.devicetypeid=rdt3.parentid AND tmp_nnml_ip.manufacturerid=rdt2.manufacturerid SET tmp_nnml_ip.devicetypeid=rdt3.devicetypeid WHERE tmp_nnml_ip.devicetypeid IS NOT NULL AND tmp_nnml_ip.manufacturerid IS NOT NULL AND rdt1.manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (704, 3, 22, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_devicetype AS rdt1 ON tmp_nnml_ip.devicetypeid=rdt1.devicetypeid INNER JOIN ref_devicetype AS rdt2 ON rdt1.devicetypeid=rdt2.parentid AND rdt2.model_alias=\'\' SET tmp_nnml_ip.devicetypeid=rdt2.devicetypeid WHERE tmp_nnml_ip.devicetypeid IS NOT NULL AND rdt1.manufacturerid IS NOT NULL AND rdt1.manufacturerid=rdt2.manufacturerid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (704, 3, 23, 'UPDATE IGNORE tmp_nnml_ip INNER JOIN ref_devicetype AS rdt1 ON tmp_nnml_ip.devicetypeid=rdt1.devicetypeid INNER JOIN ref_devicetype AS rdt2 ON rdt1.devicetypeid=rdt2.parentid AND rdt2.model_alias=\'\' SET tmp_nnml_ip.devicetypeid=rdt2.devicetypeid WHERE tmp_nnml_ip.devicetypeid IS NOT NULL AND rdt1.manufacturerid IS NULL AND rdt2.manufacturerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (704, 4, 10, 'UPDATE IGNORE nnml_ip INNER JOIN tmp_nnml_ip ON nnml_ip.ipid=tmp_nnml_ip.ipid SET nnml_ip.predict_manufacturerid=tmp_nnml_ip.manufacturerid, nnml_ip.predict_devicetypeid=tmp_nnml_ip.devicetypeid, nnml_ip.predict_manufacturerid_prob=tmp_nnml_ip.manufacturerid_value, nnml_ip.predict_devicetypeid_prob=tmp_nnml_ip.devicetypeid_value;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 1, 10, 'CREATE TEMPORARY TABLE tmp_shot_host_option (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, optionid INT UNSIGNED NOT NULL, hostuuid VARCHAR(256) NOT NULL, idtype INT UNSIGNED NOT NULL, ip VARCHAR(39) DEFAULT NULL, mac VARCHAR(12) DEFAULT NULL, name varchar(256) DEFAULT NULL, hostname varchar(100) DEFAULT NULL, manufacturerid INT UNSIGNED DEFAULT NULL, devicetypeid INT UNSIGNED NOT NULL, weight FLOAT NOT NULL, controllerid INT DEFAULT NULL, idoncontroller VARCHAR(256) DEFAULT NULL, ipprefixid INT UNSIGNED DEFAULT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, ispublic BOOLEAN DEFAULT NULL, macvendorid VARCHAR(12) DEFAULT NULL, UNIQUE KEY hostoptiontype (hostuuid, optionid, idtype), KEY hosttype (hostuuid, idtype), KEY optionid (optionid), KEY hostuuid (hostuuid), KEY ip (ip), KEY mac (mac), KEY controllerid (controllerid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 1, 20, 'CREATE TEMPORARY TABLE tmp_shot_host_option_uuid (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, hostid INT NOT NULL, optionid INT UNSIGNED NOT NULL, uuid_type INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY optionuuidtype (optionid, uuid_type, uuid), KEY uuidtype (uuid_type, uuid), KEY optionid (optionid), KEY uuid_type (uuid_type), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 1, 30, 'CREATE TEMPORARY TABLE tmp_shot_host_option_link (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, hostid INT NOT NULL, optionid INT UNSIGNED NOT NULL, linkid INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY optionhostlink (optionid, hostid, linkid), KEY hostlink (hostid, linkid), KEY linkid (linkid), KEY optionid (optionid), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 2, 10, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname, name) SELECT ref_host_option.optionid, src_enplug_edu.eduid, ref_host_idtype.id, src_enplug_edu.ip, src_enplug_edu.mac_eth, ref_manufacturer.manufacturerid, rdt2.devicetypeid, ref_host_option.weight, NULL, NULL, NULL, 0, NULL, False, NULL, NULL, src_enplug_edu.eduname FROM src_enplug_edu INNER JOIN ref_host_option ON ref_host_option.option=\'enplug\' INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'enplug_eduid\' INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'enplug\' INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'digital-signage\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'enplug\' AND rdt1.devicetypeid=rdt2.parentid WHERE src_enplug_edu.status_code IN (\'Ok\', \'Error\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 2, 11, 'INSERT IGNORE INTO tmp_shot_host_option_uuid (hostid, optionid, uuid_type, uuid) SELECT tmp_shot_host_option.id, tmp_shot_host_option.optionid, ref_host_uuid.id, tmp_shot_host_option.hostuuid FROM tmp_shot_host_option INNER JOIN ref_host_uuid ON ref_host_uuid.uuid=\'enplug_eduid\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 2, 12, 'INSERT IGNORE INTO tmp_shot_host_option_link (hostid, optionid, linkid, uuid) SELECT tmp_shot_host_option.id, tmp_shot_host_option.optionid, ref_host_link.linkid, src_enplug_edu.venueid FROM tmp_shot_host_option INNER JOIN src_enplug_edu ON tmp_shot_host_option.hostuuid=src_enplug_edu.eduid INNER JOIN ref_host_link ON ref_host_link.link=\'enplug_venue\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 2, 20, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.ip=src_ip.ip SET tmp_shot_host_option.ipprefixid=src_ip.ipprefixid, tmp_shot_host_option.vlan=src_ip.vlan, tmp_shot_host_option.roleid=src_ip.roleid, tmp_shot_host_option.macvendorid=src_ip.macvendorid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 2, 21, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.mac=src_ip.mac SET tmp_shot_host_option.ipprefixid=src_ip.ipprefixid, tmp_shot_host_option.vlan=src_ip.vlan, tmp_shot_host_option.roleid=src_ip.roleid, tmp_shot_host_option.macvendorid=src_ip.macvendorid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 2, 22, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.ip=src_ip.ip INNER JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid INNER JOIN ref_scan_ip_info ON src_ip_info.infoid=ref_scan_ip_info.infoid SET tmp_shot_host_option.hostname=src_ip_info.value WHERE ref_scan_ip_info.info=\'hostname\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 2, 23, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.mac=src_ip.mac INNER JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid INNER JOIN ref_scan_ip_info ON src_ip_info.infoid=ref_scan_ip_info.infoid SET tmp_shot_host_option.hostname=src_ip_info.value WHERE ref_scan_ip_info.info=\'hostname\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 3, 10, 'INSERT IGNORE INTO shot_host_option (optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid) SELECT optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid FROM tmp_shot_host_option WHERE tmp_shot_host_option.controllerid IS NULL AND NOT EXISTS (SELECT NULL FROM shot_host_option WHERE shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 3, 11, 'INSERT IGNORE INTO shot_host_option (optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid) SELECT tmp_shot_host_option.optionid, tmp_shot_host_option.hostuuid, tmp_shot_host_option.idtype, tmp_shot_host_option.ip, tmp_shot_host_option.mac, tmp_shot_host_option.name, tmp_shot_host_option.hostname, tmp_shot_host_option.manufacturerid, tmp_shot_host_option.devicetypeid, tmp_shot_host_option.weight, shot_host_option.id, tmp_shot_host_option.idoncontroller, tmp_shot_host_option.ipprefixid, tmp_shot_host_option.vlan, tmp_shot_host_option.roleid, tmp_shot_host_option.ispublic, tmp_shot_host_option.macvendorid FROM tmp_shot_host_option INNER JOIN tmp_shot_host_option AS tsho ON tmp_shot_host_option.controllerid=tsho.id INNER JOIN shot_host_option ON tsho.optionid=shot_host_option.optionid AND tsho.hostuuid=shot_host_option.hostuuid AND tsho.idtype=shot_host_option.idtype WHERE tmp_shot_host_option.controllerid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM shot_host_option WHERE shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 3, 12, 'INSERT IGNORE INTO shot_host_option_uuid (hostid, optionid, uuid_type, uuid) SELECT shot_host_option.id, tmp_shot_host_option_uuid.optionid, tmp_shot_host_option_uuid.uuid_type, tmp_shot_host_option_uuid.uuid FROM tmp_shot_host_option_uuid INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_uuid.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid WHERE NOT EXISTS (SELECT NULL FROM shot_host_option_uuid WHERE shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 3, 13, 'INSERT IGNORE INTO shot_host_option_link (hostid, optionid, linkid, uuid) SELECT shot_host_option.id, tmp_shot_host_option_link.optionid, tmp_shot_host_option_link.linkid, tmp_shot_host_option_link.uuid FROM tmp_shot_host_option_link INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_link.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid WHERE NOT EXISTS (SELECT NULL FROM shot_host_option_link WHERE shot_host_option_link.hostid=shot_host_option.id AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 3, 20, 'UPDATE IGNORE shot_host_option INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype SET shot_host_option.ip=tmp_shot_host_option.ip, shot_host_option.mac=tmp_shot_host_option.mac, shot_host_option.name=tmp_shot_host_option.name, shot_host_option.hostname=tmp_shot_host_option.hostname, shot_host_option.manufacturerid=tmp_shot_host_option.manufacturerid, shot_host_option.devicetypeid=tmp_shot_host_option.devicetypeid, shot_host_option.weight=tmp_shot_host_option.weight, shot_host_option.controllerid=tmp_shot_host_option.controllerid, shot_host_option.idoncontroller=tmp_shot_host_option.idoncontroller, shot_host_option.ipprefixid=tmp_shot_host_option.ipprefixid, shot_host_option.vlan=tmp_shot_host_option.vlan, shot_host_option.roleid=tmp_shot_host_option.roleid, shot_host_option.ispublic=tmp_shot_host_option.ispublic, shot_host_option.macvendorid=tmp_shot_host_option.macvendorid WHERE tmp_shot_host_option.controllerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 3, 21, 'UPDATE IGNORE shot_host_option INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype INNER JOIN tmp_shot_host_option AS tsho ON tmp_shot_host_option.controllerid=tsho.id INNER JOIN shot_host_option AS sho ON tsho.optionid=sho.optionid AND tsho.hostuuid=sho.hostuuid AND tsho.idtype=sho.idtype SET shot_host_option.ip=tmp_shot_host_option.ip, shot_host_option.mac=tmp_shot_host_option.mac, shot_host_option.name=tmp_shot_host_option.name, shot_host_option.hostname=tmp_shot_host_option.hostname, shot_host_option.manufacturerid=tmp_shot_host_option.manufacturerid, shot_host_option.devicetypeid=tmp_shot_host_option.devicetypeid, shot_host_option.weight=tmp_shot_host_option.weight, shot_host_option.controllerid=sho.id, shot_host_option.idoncontroller=tmp_shot_host_option.idoncontroller, shot_host_option.ipprefixid=tmp_shot_host_option.ipprefixid, shot_host_option.vlan=tmp_shot_host_option.vlan, shot_host_option.roleid=tmp_shot_host_option.roleid, shot_host_option.ispublic=tmp_shot_host_option.ispublic, shot_host_option.macvendorid=tmp_shot_host_option.macvendorid WHERE tmp_shot_host_option.controllerid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 3, 22, 'UPDATE IGNORE shot_host_option_uuid INNER JOIN tmp_shot_host_option_uuid ON shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_uuid.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid SET shot_host_option_uuid.hostid=shot_host_option.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 3, 23, 'UPDATE IGNORE shot_host_option_link INNER JOIN shot_host_option ON shot_host_option_link.hostid=shot_host_option.id INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.idtype=tmp_shot_host_option.idtype AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid INNER JOIN tmp_shot_host_option_link ON tmp_shot_host_option.id=tmp_shot_host_option_link.hostid AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid SET shot_host_option_link.uuid=tmp_shot_host_option_link.uuid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 4, 10, 'DELETE IGNORE shot_host_option_uuid FROM shot_host_option_uuid INNER JOIN ref_host_option ON shot_host_option_uuid.optionid=ref_host_option.optionid LEFT JOIN tmp_shot_host_option_uuid ON shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid WHERE ref_host_option.option=\'enplug\' AND tmp_shot_host_option_uuid.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 4, 11, 'DELETE IGNORE shot_host_option_link FROM shot_host_option_link INNER JOIN ref_host_option ON shot_host_option_link.optionid=ref_host_option.optionid INNER JOIN shot_host_option ON shot_host_option_link.hostid=shot_host_option.id LEFT JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype LEFT JOIN tmp_shot_host_option_link ON tmp_shot_host_option.id=tmp_shot_host_option_link.hostid AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid WHERE ref_host_option.option=\'enplug\' AND tmp_shot_host_option_link.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1501, 4, 12, 'DELETE IGNORE shot_host_option FROM shot_host_option INNER JOIN ref_host_option ON shot_host_option.optionid=ref_host_option.optionid LEFT JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype WHERE ref_host_option.option=\'enplug\' AND tmp_shot_host_option.id IS NULL;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 1, 10, 'CREATE TEMPORARY TABLE tmp_shot_host_option (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, optionid INT UNSIGNED NOT NULL, hostuuid VARCHAR(256) NOT NULL, idtype INT UNSIGNED NOT NULL, ip VARCHAR(39) DEFAULT NULL, mac VARCHAR(12) DEFAULT NULL, name varchar(256) DEFAULT NULL, hostname varchar(100) DEFAULT NULL, manufacturerid INT UNSIGNED DEFAULT NULL, devicetypeid INT UNSIGNED NOT NULL, weight FLOAT NOT NULL, controllerid INT DEFAULT NULL, idoncontroller VARCHAR(256) DEFAULT NULL, ipprefixid INT UNSIGNED DEFAULT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, ispublic BOOLEAN DEFAULT NULL, macvendorid VARCHAR(12) DEFAULT NULL, UNIQUE KEY hostoptiontype (hostuuid, optionid, idtype), KEY hosttype (hostuuid, idtype), KEY optionid (optionid), KEY hostuuid (hostuuid), KEY ip (ip), KEY mac (mac), KEY controllerid (controllerid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 1, 20, 'CREATE TEMPORARY TABLE tmp_shot_host_option_uuid (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, hostid INT NOT NULL, optionid INT UNSIGNED NOT NULL, uuid_type INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY optionuuidtype (optionid, uuid_type, uuid), KEY uuidtype (uuid_type, uuid), KEY optionid (optionid), KEY uuid_type (uuid_type), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 1, 30, 'CREATE TEMPORARY TABLE tmp_shot_host_option_link (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, hostid INT NOT NULL, optionid INT UNSIGNED NOT NULL, linkid INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY optionhostlink (optionid, hostid, linkid), KEY hostlink (hostid, linkid), KEY linkid (linkid), KEY optionid (optionid), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 1, 40, 'CREATE TEMPORARY TABLE tmp_intid (id INT NOT NULL PRIMARY KEY) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 2, 10, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 2, 11, 'INSERT IGNORE INTO tmp_intid (id) SELECT devicetypeid FROM ref_devicetype WHERE model_alias IN (\'router\', \'firewall\') AND parentid=0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled, nrepeat) VALUES (1506, 2, 12, 'INSERT IGNORE INTO tmp_intid (id) SELECT devicetypeid FROM ref_devicetype WHERE parentid IN (SELECT id FROM tmp_intid);', 1, 10);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 2, 20, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname) SELECT ref_host_option.optionid, nnml_ip.mac, ref_host_idtype.id, nnml_ip.ip, nnml_ip.mac, nnml_ip.label_manufacturerid, nnml_ip.label_devicetypeid, ref_host_option.weight, NULL, NULL, nnml_ip.ipprefixid, nnml_ip.vlan, nnml_ip.roleid, nnml_ip.ispublic, nnml_ip.macvendorid, NULL FROM nnml_ip INNER JOIN ref_host_option ON ref_host_option.option=\'nnml_label\' INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'mac\' WHERE nnml_ip.label_devicetypeid NOT IN (SELECT id FROM tmp_intid) AND nnml_ip.mac IS NOT NULL AND nnml_ip.macvendorid IS NOT NULL AND nnml_ip.label_devicetypeid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled, parameter) VALUES (1506, 2, 21, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname) SELECT ref_host_option.optionid, nnml_ip.mac, ref_host_idtype.id, nnml_ip.ip, nnml_ip.mac, nnml_ip.predict_manufacturerid, nnml_ip.predict_devicetypeid, ref_host_option.weight*nnml_ip.predict_devicetypeid_prob AS wgt, NULL, NULL, nnml_ip.ipprefixid, nnml_ip.vlan, nnml_ip.roleid, nnml_ip.ispublic, nnml_ip.macvendorid, NULL FROM nnml_ip INNER JOIN ref_host_option ON ref_host_option.option=\'nnml_predict\' INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'mac\' WHERE nnml_ip.predict_devicetypeid NOT IN (SELECT id FROM tmp_intid) AND nnml_ip.mac IS NOT NULL AND nnml_ip.macvendorid IS NOT NULL AND nnml_ip.predict_devicetypeid_prob>{0};', 1, 'nnml_devicetypeid_threshold');
INSERT INTO code_program_query (programid, stage, priority, query, enabled, parameter) VALUES (1506, 2, 22, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN ref_host_option ON tmp_shot_host_option.optionid=ref_host_option.optionid INNER JOIN nnml_ip ON tmp_shot_host_option.ip=nnml_ip.ip SET tmp_shot_host_option.manufacturerid=NULL WHERE ref_host_option.option=\'nnml_predict\' AND nnml_ip.predict_manufacturerid_prob<={0};', 1, 'nnml_manufacturerid_threshold');
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 2, 30, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.ip=src_ip.ip INNER JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid INNER JOIN ref_scan_ip_info ON src_ip_info.infoid=ref_scan_ip_info.infoid SET tmp_shot_host_option.hostname=src_ip_info.value WHERE ref_scan_ip_info.info=\'hostname\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 2, 31, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.ip=src_ip.ip INNER JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid INNER JOIN ref_scan_ip_info ON src_ip_info.infoid=ref_scan_ip_info.infoid SET tmp_shot_host_option.name=src_ip_info.value WHERE ref_scan_ip_info.info=\'name\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 3, 10, 'INSERT IGNORE INTO shot_host_option (optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid) SELECT optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid FROM tmp_shot_host_option WHERE tmp_shot_host_option.controllerid IS NULL AND NOT EXISTS (SELECT NULL FROM shot_host_option WHERE shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 3, 11, 'INSERT IGNORE INTO shot_host_option (optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid) SELECT tmp_shot_host_option.optionid, tmp_shot_host_option.hostuuid, tmp_shot_host_option.idtype, tmp_shot_host_option.ip, tmp_shot_host_option.mac, tmp_shot_host_option.name, tmp_shot_host_option.hostname, tmp_shot_host_option.manufacturerid, tmp_shot_host_option.devicetypeid, tmp_shot_host_option.weight, shot_host_option.id, tmp_shot_host_option.idoncontroller, tmp_shot_host_option.ipprefixid, tmp_shot_host_option.vlan, tmp_shot_host_option.roleid, tmp_shot_host_option.ispublic, tmp_shot_host_option.macvendorid FROM tmp_shot_host_option INNER JOIN tmp_shot_host_option AS tsho ON tmp_shot_host_option.controllerid=tsho.id INNER JOIN shot_host_option ON tsho.optionid=shot_host_option.optionid AND tsho.hostuuid=shot_host_option.hostuuid AND tsho.idtype=shot_host_option.idtype WHERE tmp_shot_host_option.controllerid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM shot_host_option WHERE shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 3, 12, 'INSERT IGNORE INTO shot_host_option_uuid (hostid, optionid, uuid_type, uuid) SELECT shot_host_option.id, tmp_shot_host_option_uuid.optionid, tmp_shot_host_option_uuid.uuid_type, tmp_shot_host_option_uuid.uuid FROM tmp_shot_host_option_uuid INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_uuid.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid WHERE NOT EXISTS (SELECT NULL FROM shot_host_option_uuid WHERE shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 3, 13, 'INSERT IGNORE INTO shot_host_option_link (hostid, optionid, linkid, uuid) SELECT shot_host_option.id, tmp_shot_host_option_link.optionid, tmp_shot_host_option_link.linkid, tmp_shot_host_option_link.uuid FROM tmp_shot_host_option_link INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_link.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid WHERE NOT EXISTS (SELECT NULL FROM shot_host_option_link WHERE shot_host_option_link.hostid=shot_host_option.id AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 3, 20, 'UPDATE IGNORE shot_host_option INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype SET shot_host_option.ip=tmp_shot_host_option.ip, shot_host_option.mac=tmp_shot_host_option.mac, shot_host_option.name=tmp_shot_host_option.name, shot_host_option.hostname=tmp_shot_host_option.hostname, shot_host_option.manufacturerid=tmp_shot_host_option.manufacturerid, shot_host_option.devicetypeid=tmp_shot_host_option.devicetypeid, shot_host_option.weight=tmp_shot_host_option.weight, shot_host_option.controllerid=tmp_shot_host_option.controllerid, shot_host_option.idoncontroller=tmp_shot_host_option.idoncontroller, shot_host_option.ipprefixid=tmp_shot_host_option.ipprefixid, shot_host_option.vlan=tmp_shot_host_option.vlan, shot_host_option.roleid=tmp_shot_host_option.roleid, shot_host_option.ispublic=tmp_shot_host_option.ispublic, shot_host_option.macvendorid=tmp_shot_host_option.macvendorid WHERE tmp_shot_host_option.controllerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 3, 21, 'UPDATE IGNORE shot_host_option INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype INNER JOIN tmp_shot_host_option AS tsho ON tmp_shot_host_option.controllerid=tsho.id INNER JOIN shot_host_option AS sho ON tsho.optionid=sho.optionid AND tsho.hostuuid=sho.hostuuid AND tsho.idtype=sho.idtype SET shot_host_option.ip=tmp_shot_host_option.ip, shot_host_option.mac=tmp_shot_host_option.mac, shot_host_option.name=tmp_shot_host_option.name, shot_host_option.hostname=tmp_shot_host_option.hostname, shot_host_option.manufacturerid=tmp_shot_host_option.manufacturerid, shot_host_option.devicetypeid=tmp_shot_host_option.devicetypeid, shot_host_option.weight=tmp_shot_host_option.weight, shot_host_option.controllerid=sho.id, shot_host_option.idoncontroller=tmp_shot_host_option.idoncontroller, shot_host_option.ipprefixid=tmp_shot_host_option.ipprefixid, shot_host_option.vlan=tmp_shot_host_option.vlan, shot_host_option.roleid=tmp_shot_host_option.roleid, shot_host_option.ispublic=tmp_shot_host_option.ispublic, shot_host_option.macvendorid=tmp_shot_host_option.macvendorid WHERE tmp_shot_host_option.controllerid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 3, 22, 'UPDATE IGNORE shot_host_option_uuid INNER JOIN tmp_shot_host_option_uuid ON shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_uuid.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid SET shot_host_option_uuid.hostid=shot_host_option.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 3, 23, 'UPDATE IGNORE shot_host_option_link INNER JOIN shot_host_option ON shot_host_option_link.hostid=shot_host_option.id INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.idtype=tmp_shot_host_option.idtype AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid INNER JOIN tmp_shot_host_option_link ON tmp_shot_host_option.id=tmp_shot_host_option_link.hostid AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid SET shot_host_option_link.uuid=tmp_shot_host_option_link.uuid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 4, 10, 'DELETE IGNORE shot_host_option_uuid FROM shot_host_option_uuid INNER JOIN ref_host_option ON shot_host_option_uuid.optionid=ref_host_option.optionid LEFT JOIN tmp_shot_host_option_uuid ON shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid WHERE ref_host_option.option IN (\'nnml_label\', \'nnml_predict\') AND tmp_shot_host_option_uuid.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 4, 11, 'DELETE IGNORE shot_host_option_link FROM shot_host_option_link INNER JOIN ref_host_option ON shot_host_option_link.optionid=ref_host_option.optionid INNER JOIN shot_host_option ON shot_host_option_link.hostid=shot_host_option.id LEFT JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype LEFT JOIN tmp_shot_host_option_link ON tmp_shot_host_option.id=tmp_shot_host_option_link.hostid AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid WHERE ref_host_option.option IN (\'nnml_label\', \'nnml_predict\') AND tmp_shot_host_option_link.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1506, 4, 12, 'DELETE IGNORE shot_host_option FROM shot_host_option INNER JOIN ref_host_option ON shot_host_option.optionid=ref_host_option.optionid LEFT JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype WHERE ref_host_option.option IN (\'nnml_label\', \'nnml_predict\') AND tmp_shot_host_option.id IS NULL;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 1, 10, 'CREATE TEMPORARY TABLE tmp_shot_host_option (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, optionid INT UNSIGNED NOT NULL, hostuuid VARCHAR(256) NOT NULL, idtype INT UNSIGNED NOT NULL, ip VARCHAR(39) DEFAULT NULL, mac VARCHAR(12) DEFAULT NULL, name varchar(256) DEFAULT NULL, hostname varchar(100) DEFAULT NULL, manufacturerid INT UNSIGNED DEFAULT NULL, devicetypeid INT UNSIGNED NOT NULL, weight FLOAT NOT NULL, controllerid INT DEFAULT NULL, idoncontroller VARCHAR(256) DEFAULT NULL, ipprefixid INT UNSIGNED DEFAULT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, ispublic BOOLEAN DEFAULT NULL, macvendorid VARCHAR(12) DEFAULT NULL, UNIQUE KEY hostoptiontype (hostuuid, optionid, idtype), KEY hosttype (hostuuid, idtype), KEY optionid (optionid), KEY hostuuid (hostuuid), KEY ip (ip), KEY mac (mac), KEY controllerid (controllerid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 1, 20, 'CREATE TEMPORARY TABLE tmp_shot_host_option_uuid (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, hostid INT NOT NULL, optionid INT UNSIGNED NOT NULL, uuid_type INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY optionuuidtype (optionid, uuid_type, uuid), KEY uuidtype (uuid_type, uuid), KEY optionid (optionid), KEY uuid_type (uuid_type), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 1, 30, 'CREATE TEMPORARY TABLE tmp_shot_host_option_link (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, hostid INT NOT NULL, optionid INT UNSIGNED NOT NULL, linkid INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY optionhostlink (optionid, hostid, linkid), KEY hostlink (hostid, linkid), KEY linkid (linkid), KEY optionid (optionid), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 2, 10, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname, name) SELECT ref_host_option.optionid, src_activaire.activaireid, ref_host_idtype.id, src_activaire.ip, NULL, ref_manufacturer.manufacturerid, rdt3.devicetypeid, ref_host_option.weight, NULL, NULL, NULL, 0, NULL, False, NULL, NULL, src_activaire.activairename FROM src_activaire INNER JOIN ref_host_option ON ref_host_option.option=\'activaire\' INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'activaire_uuid\' INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'minix\' INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'bgm-player\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'minix\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON CONCAT(rdt2.model_alias, \' \', rdt3.model_alias)=LOWER(src_activaire.make_model) AND rdt2.devicetypeid=rdt3.parentid WHERE src_activaire.device_status IN (\'ACTIVE\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 2, 11, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname, name) SELECT ref_host_option.optionid, src_activaire.activaireid, ref_host_idtype.id, src_activaire.ip, NULL, ref_manufacturer.manufacturerid, rdt2.devicetypeid, ref_host_option.weight, NULL, NULL, NULL, 0, NULL, False, NULL, NULL, src_activaire.activairename FROM src_activaire INNER JOIN ref_host_option ON ref_host_option.option=\'activaire\' INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'activaire_uuid\' INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'minix\' INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'bgm-player\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'minix\' AND rdt1.devicetypeid=rdt2.parentid WHERE src_activaire.device_status IN (\'ACTIVE\') AND NOT EXISTS ( SELECT NULL FROM tmp_shot_host_option WHERE tmp_shot_host_option.hostuuid=src_activaire.activaireid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 2, 12, 'INSERT IGNORE INTO tmp_shot_host_option_uuid (hostid, optionid, uuid_type, uuid) SELECT tmp_shot_host_option.id, tmp_shot_host_option.optionid, ref_host_uuid.id, tmp_shot_host_option.hostuuid FROM tmp_shot_host_option INNER JOIN ref_host_uuid ON ref_host_uuid.uuid=\'activaire_uuid\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 2, 20, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.ip=src_ip.ip INNER JOIN src_activaire ON tmp_shot_host_option.hostuuid=src_activaire.activaireid SET tmp_shot_host_option.mac=src_ip.mac WHERE tmp_shot_host_option.mac IS NULL AND src_ip.mac IS NOT NULL AND src_ip.mac=src_activaire.mac_eth;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 2, 21, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.ip=src_ip.ip INNER JOIN src_activaire ON tmp_shot_host_option.hostuuid=src_activaire.activaireid SET tmp_shot_host_option.mac=src_ip.mac WHERE tmp_shot_host_option.mac IS NULL AND src_ip.mac IS NOT NULL AND src_ip.mac=src_activaire.mac;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 2, 22, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_activaire ON tmp_shot_host_option.hostuuid=src_activaire.activaireid SET tmp_shot_host_option.mac=src_activaire.mac_eth WHERE tmp_shot_host_option.mac IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 2, 30, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.ip=src_ip.ip SET tmp_shot_host_option.ipprefixid=src_ip.ipprefixid, tmp_shot_host_option.vlan=src_ip.vlan, tmp_shot_host_option.roleid=src_ip.roleid, tmp_shot_host_option.macvendorid=src_ip.macvendorid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 2, 31, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.mac=src_ip.mac SET tmp_shot_host_option.ipprefixid=src_ip.ipprefixid, tmp_shot_host_option.vlan=src_ip.vlan, tmp_shot_host_option.roleid=src_ip.roleid, tmp_shot_host_option.macvendorid=src_ip.macvendorid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 2, 32, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.ip=src_ip.ip INNER JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid INNER JOIN ref_scan_ip_info ON src_ip_info.infoid=ref_scan_ip_info.infoid SET tmp_shot_host_option.hostname=src_ip_info.value WHERE ref_scan_ip_info.info=\'hostname\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 2, 33, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.mac=src_ip.mac INNER JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid INNER JOIN ref_scan_ip_info ON src_ip_info.infoid=ref_scan_ip_info.infoid SET tmp_shot_host_option.hostname=src_ip_info.value WHERE ref_scan_ip_info.info=\'hostname\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 3, 10, 'INSERT IGNORE INTO shot_host_option (optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid) SELECT optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid FROM tmp_shot_host_option WHERE tmp_shot_host_option.controllerid IS NULL AND NOT EXISTS (SELECT NULL FROM shot_host_option WHERE shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 3, 11, 'INSERT IGNORE INTO shot_host_option (optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid) SELECT tmp_shot_host_option.optionid, tmp_shot_host_option.hostuuid, tmp_shot_host_option.idtype, tmp_shot_host_option.ip, tmp_shot_host_option.mac, tmp_shot_host_option.name, tmp_shot_host_option.hostname, tmp_shot_host_option.manufacturerid, tmp_shot_host_option.devicetypeid, tmp_shot_host_option.weight, shot_host_option.id, tmp_shot_host_option.idoncontroller, tmp_shot_host_option.ipprefixid, tmp_shot_host_option.vlan, tmp_shot_host_option.roleid, tmp_shot_host_option.ispublic, tmp_shot_host_option.macvendorid FROM tmp_shot_host_option INNER JOIN tmp_shot_host_option AS tsho ON tmp_shot_host_option.controllerid=tsho.id INNER JOIN shot_host_option ON tsho.optionid=shot_host_option.optionid AND tsho.hostuuid=shot_host_option.hostuuid AND tsho.idtype=shot_host_option.idtype WHERE tmp_shot_host_option.controllerid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM shot_host_option WHERE shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 3, 12, 'INSERT IGNORE INTO shot_host_option_uuid (hostid, optionid, uuid_type, uuid) SELECT shot_host_option.id, tmp_shot_host_option_uuid.optionid, tmp_shot_host_option_uuid.uuid_type, tmp_shot_host_option_uuid.uuid FROM tmp_shot_host_option_uuid INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_uuid.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid WHERE NOT EXISTS (SELECT NULL FROM shot_host_option_uuid WHERE shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 3, 13, 'INSERT IGNORE INTO shot_host_option_link (hostid, optionid, linkid, uuid) SELECT shot_host_option.id, tmp_shot_host_option_link.optionid, tmp_shot_host_option_link.linkid, tmp_shot_host_option_link.uuid FROM tmp_shot_host_option_link INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_link.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid WHERE NOT EXISTS (SELECT NULL FROM shot_host_option_link WHERE shot_host_option_link.hostid=shot_host_option.id AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 3, 20, 'UPDATE IGNORE shot_host_option INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype SET shot_host_option.ip=tmp_shot_host_option.ip, shot_host_option.mac=tmp_shot_host_option.mac, shot_host_option.name=tmp_shot_host_option.name, shot_host_option.hostname=tmp_shot_host_option.hostname, shot_host_option.manufacturerid=tmp_shot_host_option.manufacturerid, shot_host_option.devicetypeid=tmp_shot_host_option.devicetypeid, shot_host_option.weight=tmp_shot_host_option.weight, shot_host_option.controllerid=tmp_shot_host_option.controllerid, shot_host_option.idoncontroller=tmp_shot_host_option.idoncontroller, shot_host_option.ipprefixid=tmp_shot_host_option.ipprefixid, shot_host_option.vlan=tmp_shot_host_option.vlan, shot_host_option.roleid=tmp_shot_host_option.roleid, shot_host_option.ispublic=tmp_shot_host_option.ispublic, shot_host_option.macvendorid=tmp_shot_host_option.macvendorid WHERE tmp_shot_host_option.controllerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 3, 21, 'UPDATE IGNORE shot_host_option INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype INNER JOIN tmp_shot_host_option AS tsho ON tmp_shot_host_option.controllerid=tsho.id INNER JOIN shot_host_option AS sho ON tsho.optionid=sho.optionid AND tsho.hostuuid=sho.hostuuid AND tsho.idtype=sho.idtype SET shot_host_option.ip=tmp_shot_host_option.ip, shot_host_option.mac=tmp_shot_host_option.mac, shot_host_option.name=tmp_shot_host_option.name, shot_host_option.hostname=tmp_shot_host_option.hostname, shot_host_option.manufacturerid=tmp_shot_host_option.manufacturerid, shot_host_option.devicetypeid=tmp_shot_host_option.devicetypeid, shot_host_option.weight=tmp_shot_host_option.weight, shot_host_option.controllerid=sho.id, shot_host_option.idoncontroller=tmp_shot_host_option.idoncontroller, shot_host_option.ipprefixid=tmp_shot_host_option.ipprefixid, shot_host_option.vlan=tmp_shot_host_option.vlan, shot_host_option.roleid=tmp_shot_host_option.roleid, shot_host_option.ispublic=tmp_shot_host_option.ispublic, shot_host_option.macvendorid=tmp_shot_host_option.macvendorid WHERE tmp_shot_host_option.controllerid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 3, 22, 'UPDATE IGNORE shot_host_option_uuid INNER JOIN tmp_shot_host_option_uuid ON shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_uuid.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid SET shot_host_option_uuid.hostid=shot_host_option.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 3, 23, 'UPDATE IGNORE shot_host_option_link INNER JOIN shot_host_option ON shot_host_option_link.hostid=shot_host_option.id INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.idtype=tmp_shot_host_option.idtype AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid INNER JOIN tmp_shot_host_option_link ON tmp_shot_host_option.id=tmp_shot_host_option_link.hostid AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid SET shot_host_option_link.uuid=tmp_shot_host_option_link.uuid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 4, 10, 'DELETE IGNORE shot_host_option_uuid FROM shot_host_option_uuid INNER JOIN ref_host_option ON shot_host_option_uuid.optionid=ref_host_option.optionid LEFT JOIN tmp_shot_host_option_uuid ON shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid WHERE ref_host_option.option=\'activaire\' AND tmp_shot_host_option_uuid.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 4, 11, 'DELETE IGNORE shot_host_option_link FROM shot_host_option_link INNER JOIN ref_host_option ON shot_host_option_link.optionid=ref_host_option.optionid INNER JOIN shot_host_option ON shot_host_option_link.hostid=shot_host_option.id LEFT JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype LEFT JOIN tmp_shot_host_option_link ON tmp_shot_host_option.id=tmp_shot_host_option_link.hostid AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid WHERE ref_host_option.option=\'activaire\' AND tmp_shot_host_option_link.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1502, 4, 12, 'DELETE IGNORE shot_host_option FROM shot_host_option INNER JOIN ref_host_option ON shot_host_option.optionid=ref_host_option.optionid LEFT JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype WHERE ref_host_option.option=\'activaire\' AND tmp_shot_host_option.id IS NULL;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 1, 10, 'CREATE TEMPORARY TABLE tmp_shot_host_option (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, optionid INT UNSIGNED NOT NULL, hostuuid VARCHAR(256) NOT NULL, idtype INT UNSIGNED NOT NULL, ip VARCHAR(39) DEFAULT NULL, mac VARCHAR(12) DEFAULT NULL, name varchar(256) DEFAULT NULL, hostname varchar(100) DEFAULT NULL, manufacturerid INT UNSIGNED DEFAULT NULL, devicetypeid INT UNSIGNED NOT NULL, weight FLOAT NOT NULL, controllerid INT DEFAULT NULL, idoncontroller VARCHAR(256) DEFAULT NULL, ipprefixid INT UNSIGNED DEFAULT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, ispublic BOOLEAN DEFAULT NULL, macvendorid VARCHAR(12) DEFAULT NULL, UNIQUE KEY hostoptiontype (hostuuid, optionid, idtype), KEY hosttype (hostuuid, idtype), KEY optionid (optionid), KEY hostuuid (hostuuid), KEY ip (ip), KEY mac (mac), KEY controllerid (controllerid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 1, 20, 'CREATE TEMPORARY TABLE tmp_shot_host_option_uuid (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, hostid INT NOT NULL, optionid INT UNSIGNED NOT NULL, uuid_type INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY optionuuidtype (optionid, uuid_type, uuid), KEY uuidtype (uuid_type, uuid), KEY optionid (optionid), KEY uuid_type (uuid_type), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 1, 30, 'CREATE TEMPORARY TABLE tmp_shot_host_option_link (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, hostid INT NOT NULL, optionid INT UNSIGNED NOT NULL, linkid INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY optionhostlink (optionid, hostid, linkid), KEY hostlink (hostid, linkid), KEY linkid (linkid), KEY optionid (optionid), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 2, 10, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname, name) SELECT ref_host_option.optionid, \'52.9.8.62\', ref_host_idtype.id, \'52.9.8.62\', NULL, ref_manufacturer.manufacturerid, rdt3.devicetypeid, ref_host_option.weight, NULL, NULL, NULL, 0, NULL, True, NULL, NULL, NULL FROM ref_host_option INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'ip\' INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'juniper\' INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wlc\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'juniper\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'mist\' AND rdt2.devicetypeid=rdt3.parentid WHERE ref_host_option.option=\'mist\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 2, 11, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname, name) SELECT ref_host_option.optionid, src_mist.mac, ref_host_idtype.id, src_mist.ip, src_mist.mac, ref_manufacturer.manufacturerid, rdt4.devicetypeid, ref_host_option.weight, tmp_shot_host_option.id, src_mist.mac, NULL, 0, NULL, False, NULL, src_mist.name, NULL FROM src_mist INNER JOIN tmp_shot_host_option ON tmp_shot_host_option.hostuuid=\'52.9.8.62\' INNER JOIN ref_host_option ON ref_host_option.option=\'mist\' INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'mac\' INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'juniper\' INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wap\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'wlc-based\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'juniper\' AND rdt2.devicetypeid=rdt3.parentid INNER JOIN ref_devicetype AS rdt4 ON rdt4.model_alias=LOWER(src_mist.model) AND rdt3.devicetypeid=rdt4.parentid WHERE src_mist.status=\'connected\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 2, 12, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname, name) SELECT ref_host_option.optionid, src_mist.mac, ref_host_idtype.id, src_mist.ip, src_mist.mac, ref_manufacturer.manufacturerid, rdt3.devicetypeid, ref_host_option.weight, tmp_shot_host_option.id, src_mist.mac, NULL, 0, NULL, False, NULL, src_mist.name, NULL FROM src_mist INNER JOIN tmp_shot_host_option ON tmp_shot_host_option.hostuuid=\'52.9.8.62\' INNER JOIN ref_host_option ON ref_host_option.option=\'mist\' INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'mac\' INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'juniper\' INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wap\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'wlc-based\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'juniper\' AND rdt2.devicetypeid=rdt3.parentid WHERE src_mist.status=\'connected\' AND NOT EXISTS (SELECT NULL FROM tmp_shot_host_option WHERE tmp_shot_host_option.hostuuid=src_mist.mac);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 2, 20, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.ip=src_ip.ip SET tmp_shot_host_option.ipprefixid=src_ip.ipprefixid, tmp_shot_host_option.vlan=src_ip.vlan, tmp_shot_host_option.roleid=src_ip.roleid, tmp_shot_host_option.macvendorid=src_ip.macvendorid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 2, 21, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.mac=src_ip.mac SET tmp_shot_host_option.ipprefixid=src_ip.ipprefixid, tmp_shot_host_option.vlan=src_ip.vlan, tmp_shot_host_option.roleid=src_ip.roleid, tmp_shot_host_option.macvendorid=src_ip.macvendorid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 2, 22, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.ip=src_ip.ip INNER JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid INNER JOIN ref_scan_ip_info ON src_ip_info.infoid=ref_scan_ip_info.infoid SET tmp_shot_host_option.name=src_ip_info.value WHERE ref_scan_ip_info.info=\'name\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 2, 23, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.mac=src_ip.mac INNER JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid INNER JOIN ref_scan_ip_info ON src_ip_info.infoid=ref_scan_ip_info.infoid SET tmp_shot_host_option.name=src_ip_info.value WHERE ref_scan_ip_info.info=\'name\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 2, 24, 'UPDATE IGNORE tmp_shot_host_option SET name=\'MIST controller\' WHERE ip=\'52.9.8.62\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 3, 10, 'INSERT IGNORE INTO shot_host_option (optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid) SELECT optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid FROM tmp_shot_host_option WHERE tmp_shot_host_option.controllerid IS NULL AND NOT EXISTS (SELECT NULL FROM shot_host_option WHERE shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 3, 11, 'INSERT IGNORE INTO shot_host_option (optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid) SELECT tmp_shot_host_option.optionid, tmp_shot_host_option.hostuuid, tmp_shot_host_option.idtype, tmp_shot_host_option.ip, tmp_shot_host_option.mac, tmp_shot_host_option.name, tmp_shot_host_option.hostname, tmp_shot_host_option.manufacturerid, tmp_shot_host_option.devicetypeid, tmp_shot_host_option.weight, shot_host_option.id, tmp_shot_host_option.idoncontroller, tmp_shot_host_option.ipprefixid, tmp_shot_host_option.vlan, tmp_shot_host_option.roleid, tmp_shot_host_option.ispublic, tmp_shot_host_option.macvendorid FROM tmp_shot_host_option INNER JOIN tmp_shot_host_option AS tsho ON tmp_shot_host_option.controllerid=tsho.id INNER JOIN shot_host_option ON tsho.optionid=shot_host_option.optionid AND tsho.hostuuid=shot_host_option.hostuuid AND tsho.idtype=shot_host_option.idtype WHERE tmp_shot_host_option.controllerid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM shot_host_option WHERE shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 3, 12, 'INSERT IGNORE INTO shot_host_option_uuid (hostid, optionid, uuid_type, uuid) SELECT shot_host_option.id, tmp_shot_host_option_uuid.optionid, tmp_shot_host_option_uuid.uuid_type, tmp_shot_host_option_uuid.uuid FROM tmp_shot_host_option_uuid INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_uuid.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid WHERE NOT EXISTS (SELECT NULL FROM shot_host_option_uuid WHERE shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 3, 13, 'INSERT IGNORE INTO shot_host_option_link (hostid, optionid, linkid, uuid) SELECT shot_host_option.id, tmp_shot_host_option_link.optionid, tmp_shot_host_option_link.linkid, tmp_shot_host_option_link.uuid FROM tmp_shot_host_option_link INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_link.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid WHERE NOT EXISTS (SELECT NULL FROM shot_host_option_link WHERE shot_host_option_link.hostid=shot_host_option.id AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 3, 20, 'UPDATE IGNORE shot_host_option INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype SET shot_host_option.ip=tmp_shot_host_option.ip, shot_host_option.mac=tmp_shot_host_option.mac, shot_host_option.name=tmp_shot_host_option.name, shot_host_option.hostname=tmp_shot_host_option.hostname, shot_host_option.manufacturerid=tmp_shot_host_option.manufacturerid, shot_host_option.devicetypeid=tmp_shot_host_option.devicetypeid, shot_host_option.weight=tmp_shot_host_option.weight, shot_host_option.controllerid=tmp_shot_host_option.controllerid, shot_host_option.idoncontroller=tmp_shot_host_option.idoncontroller, shot_host_option.ipprefixid=tmp_shot_host_option.ipprefixid, shot_host_option.vlan=tmp_shot_host_option.vlan, shot_host_option.roleid=tmp_shot_host_option.roleid, shot_host_option.ispublic=tmp_shot_host_option.ispublic, shot_host_option.macvendorid=tmp_shot_host_option.macvendorid WHERE tmp_shot_host_option.controllerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 3, 21, 'UPDATE IGNORE shot_host_option INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype INNER JOIN tmp_shot_host_option AS tsho ON tmp_shot_host_option.controllerid=tsho.id INNER JOIN shot_host_option AS sho ON tsho.optionid=sho.optionid AND tsho.hostuuid=sho.hostuuid AND tsho.idtype=sho.idtype SET shot_host_option.ip=tmp_shot_host_option.ip, shot_host_option.mac=tmp_shot_host_option.mac, shot_host_option.name=tmp_shot_host_option.name, shot_host_option.hostname=tmp_shot_host_option.hostname, shot_host_option.manufacturerid=tmp_shot_host_option.manufacturerid, shot_host_option.devicetypeid=tmp_shot_host_option.devicetypeid, shot_host_option.weight=tmp_shot_host_option.weight, shot_host_option.controllerid=sho.id, shot_host_option.idoncontroller=tmp_shot_host_option.idoncontroller, shot_host_option.ipprefixid=tmp_shot_host_option.ipprefixid, shot_host_option.vlan=tmp_shot_host_option.vlan, shot_host_option.roleid=tmp_shot_host_option.roleid, shot_host_option.ispublic=tmp_shot_host_option.ispublic, shot_host_option.macvendorid=tmp_shot_host_option.macvendorid WHERE tmp_shot_host_option.controllerid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 3, 22, 'UPDATE IGNORE shot_host_option_uuid INNER JOIN tmp_shot_host_option_uuid ON shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_uuid.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid SET shot_host_option_uuid.hostid=shot_host_option.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 3, 23, 'UPDATE IGNORE shot_host_option_link INNER JOIN shot_host_option ON shot_host_option_link.hostid=shot_host_option.id INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.idtype=tmp_shot_host_option.idtype AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid INNER JOIN tmp_shot_host_option_link ON tmp_shot_host_option.id=tmp_shot_host_option_link.hostid AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid SET shot_host_option_link.uuid=tmp_shot_host_option_link.uuid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 4, 10, 'DELETE IGNORE shot_host_option_uuid FROM shot_host_option_uuid INNER JOIN ref_host_option ON shot_host_option_uuid.optionid=ref_host_option.optionid LEFT JOIN tmp_shot_host_option_uuid ON shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid WHERE ref_host_option.option=\'mist\' AND tmp_shot_host_option_uuid.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 4, 11, 'DELETE IGNORE shot_host_option_link FROM shot_host_option_link INNER JOIN ref_host_option ON shot_host_option_link.optionid=ref_host_option.optionid INNER JOIN shot_host_option ON shot_host_option_link.hostid=shot_host_option.id LEFT JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype LEFT JOIN tmp_shot_host_option_link ON tmp_shot_host_option.id=tmp_shot_host_option_link.hostid AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid WHERE ref_host_option.option=\'mist\' AND tmp_shot_host_option_link.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1503, 4, 12, 'DELETE IGNORE shot_host_option FROM shot_host_option INNER JOIN ref_host_option ON shot_host_option.optionid=ref_host_option.optionid LEFT JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype WHERE ref_host_option.option=\'mist\' AND tmp_shot_host_option.id IS NULL;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 1, 10, 'CREATE TEMPORARY TABLE tmp_shot_host_option (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, optionid INT UNSIGNED NOT NULL, hostuuid VARCHAR(256) NOT NULL, idtype INT UNSIGNED NOT NULL, ip VARCHAR(39) DEFAULT NULL, mac VARCHAR(12) DEFAULT NULL, name varchar(256) DEFAULT NULL, hostname varchar(100) DEFAULT NULL, manufacturerid INT UNSIGNED DEFAULT NULL, devicetypeid INT UNSIGNED NOT NULL, weight FLOAT NOT NULL, controllerid INT DEFAULT NULL, idoncontroller VARCHAR(256) DEFAULT NULL, ipprefixid INT UNSIGNED DEFAULT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, ispublic BOOLEAN DEFAULT NULL, macvendorid VARCHAR(12) DEFAULT NULL, UNIQUE KEY hostoptiontype (hostuuid, optionid, idtype), KEY hosttype (hostuuid, idtype), KEY optionid (optionid), KEY hostuuid (hostuuid), KEY ip (ip), KEY mac (mac), KEY controllerid (controllerid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 1, 20, 'CREATE TEMPORARY TABLE tmp_shot_host_option_uuid (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, hostid INT NOT NULL, optionid INT UNSIGNED NOT NULL, uuid_type INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY optionuuidtype (optionid, uuid_type, uuid), KEY uuidtype (uuid_type, uuid), KEY optionid (optionid), KEY uuid_type (uuid_type), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 1, 30, 'CREATE TEMPORARY TABLE tmp_shot_host_option_link (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, hostid INT NOT NULL, optionid INT UNSIGNED NOT NULL, linkid INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY optionhostlink (optionid, hostid, linkid), KEY hostlink (hostid, linkid), KEY linkid (linkid), KEY optionid (optionid), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 2, 10, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname, name) SELECT ref_host_option.optionid, src_ip.ip, ref_host_idtype.id, src_ip.ip, src_ip.mac, ref_manufacturer.manufacturerid, rdt3.devicetypeid, ref_host_option.weight, NULL, NULL, NULL, 0, NULL, src_ip.ispublic, src_ip.macvendorid, NULL, NULL FROM src_ruckussz_wlc INNER JOIN src_scan_ip ON src_ruckussz_wlc.ipid=src_scan_ip.ipid INNER JOIN src_ip ON src_scan_ip.ip=src_ip.ip INNER JOIN ref_host_option ON ref_host_option.option=\'ruckussz\' INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'ip\' INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'ruckus\' INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wlc\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'ruckus\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'sz\' AND rdt2.devicetypeid=rdt3.parentid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 2, 11, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname, name) SELECT ref_host_option.optionid, src_ruckussz_wap.mac, ref_host_idtype.id, src_ruckussz_wap.ip, src_ruckussz_wap.mac, ref_manufacturer.manufacturerid, rdt5.devicetypeid, ref_host_option.weight, tmp_shot_host_option.id, src_ruckussz_wap.mac, NULL, 0, NULL, src_ip.ispublic, NULL, src_ruckussz_wap.name, NULL FROM src_ruckussz_wap INNER JOIN src_scan_ip ON src_ruckussz_wap.wlcid=src_scan_ip.ipid INNER JOIN src_ip ON src_scan_ip.ip=src_ip.ip INNER JOIN tmp_shot_host_option ON tmp_shot_host_option.hostuuid=src_ip.ip INNER JOIN ref_host_option ON ref_host_option.option=\'ruckussz\' INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'mac\' INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'ruckus\' INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wap\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'wlc-based\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'ruckus\' AND rdt2.devicetypeid=rdt3.parentid INNER JOIN ref_devicetype AS rdt4 ON rdt4.model_alias=\'sz\' AND rdt3.devicetypeid=rdt4.parentid INNER JOIN ref_devicetype AS rdt5 ON rdt5.model_alias=LOWER(src_ruckussz_wap.model) AND rdt4.devicetypeid=rdt5.parentid WHERE src_ruckussz_wap.connectionstate=\'Connect\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 2, 12, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname, name) SELECT ref_host_option.optionid, src_ruckussz_wap.mac, ref_host_idtype.id, src_ruckussz_wap.ip, src_ruckussz_wap.mac, ref_manufacturer.manufacturerid, rdt4.devicetypeid, ref_host_option.weight, tmp_shot_host_option.id, src_ruckussz_wap.mac, NULL, 0, NULL, src_ip.ispublic, NULL, src_ruckussz_wap.name, NULL FROM src_ruckussz_wap INNER JOIN src_scan_ip ON src_ruckussz_wap.wlcid=src_scan_ip.ipid INNER JOIN src_ip ON src_scan_ip.ip=src_ip.ip INNER JOIN tmp_shot_host_option ON tmp_shot_host_option.hostuuid=src_ip.ip INNER JOIN ref_host_option ON ref_host_option.option=\'ruckussz\' INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'mac\' INNER JOIN ref_manufacturer ON ref_manufacturer.manufacturer_alias=\'ruckus\' INNER JOIN ref_devicetype AS rdt1 ON rdt1.model_alias=\'wap\' AND rdt1.parentid=0 INNER JOIN ref_devicetype AS rdt2 ON rdt2.model_alias=\'wlc-based\' AND rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_devicetype AS rdt3 ON rdt3.model_alias=\'ruckus\' AND rdt2.devicetypeid=rdt3.parentid INNER JOIN ref_devicetype AS rdt4 ON rdt4.model_alias=\'sz\' AND rdt3.devicetypeid=rdt4.parentid WHERE src_ruckussz_wap.connectionstate=\'Connect\' AND NOT EXISTS (SELECT NULL FROM tmp_shot_host_option WHERE tmp_shot_host_option.hostuuid=src_ruckussz_wap.mac);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 2, 20, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.ip=src_ip.ip SET tmp_shot_host_option.ipprefixid=src_ip.ipprefixid, tmp_shot_host_option.vlan=src_ip.vlan, tmp_shot_host_option.roleid=src_ip.roleid, tmp_shot_host_option.macvendorid=src_ip.macvendorid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 2, 21, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.mac=src_ip.mac SET tmp_shot_host_option.ipprefixid=src_ip.ipprefixid, tmp_shot_host_option.vlan=src_ip.vlan, tmp_shot_host_option.roleid=src_ip.roleid, tmp_shot_host_option.macvendorid=src_ip.macvendorid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 2, 22, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.ip=src_ip.ip INNER JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid INNER JOIN ref_scan_ip_info ON src_ip_info.infoid=ref_scan_ip_info.infoid SET tmp_shot_host_option.name=src_ip_info.value WHERE ref_scan_ip_info.info=\'name\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 2, 23, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.mac=src_ip.mac INNER JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid INNER JOIN ref_scan_ip_info ON src_ip_info.infoid=ref_scan_ip_info.infoid SET tmp_shot_host_option.name=src_ip_info.value WHERE ref_scan_ip_info.info=\'name\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 3, 10, 'INSERT IGNORE INTO shot_host_option (optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid) SELECT optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid FROM tmp_shot_host_option WHERE tmp_shot_host_option.controllerid IS NULL AND NOT EXISTS (SELECT NULL FROM shot_host_option WHERE shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 3, 11, 'INSERT IGNORE INTO shot_host_option (optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid) SELECT tmp_shot_host_option.optionid, tmp_shot_host_option.hostuuid, tmp_shot_host_option.idtype, tmp_shot_host_option.ip, tmp_shot_host_option.mac, tmp_shot_host_option.name, tmp_shot_host_option.hostname, tmp_shot_host_option.manufacturerid, tmp_shot_host_option.devicetypeid, tmp_shot_host_option.weight, shot_host_option.id, tmp_shot_host_option.idoncontroller, tmp_shot_host_option.ipprefixid, tmp_shot_host_option.vlan, tmp_shot_host_option.roleid, tmp_shot_host_option.ispublic, tmp_shot_host_option.macvendorid FROM tmp_shot_host_option INNER JOIN tmp_shot_host_option AS tsho ON tmp_shot_host_option.controllerid=tsho.id INNER JOIN shot_host_option ON tsho.optionid=shot_host_option.optionid AND tsho.hostuuid=shot_host_option.hostuuid AND tsho.idtype=shot_host_option.idtype WHERE tmp_shot_host_option.controllerid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM shot_host_option WHERE shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 3, 12, 'INSERT IGNORE INTO shot_host_option_uuid (hostid, optionid, uuid_type, uuid) SELECT shot_host_option.id, tmp_shot_host_option_uuid.optionid, tmp_shot_host_option_uuid.uuid_type, tmp_shot_host_option_uuid.uuid FROM tmp_shot_host_option_uuid INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_uuid.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid WHERE NOT EXISTS (SELECT NULL FROM shot_host_option_uuid WHERE shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 3, 13, 'INSERT IGNORE INTO shot_host_option_link (hostid, optionid, linkid, uuid) SELECT shot_host_option.id, tmp_shot_host_option_link.optionid, tmp_shot_host_option_link.linkid, tmp_shot_host_option_link.uuid FROM tmp_shot_host_option_link INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_link.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid WHERE NOT EXISTS (SELECT NULL FROM shot_host_option_link WHERE shot_host_option_link.hostid=shot_host_option.id AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 3, 20, 'UPDATE IGNORE shot_host_option INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype SET shot_host_option.ip=tmp_shot_host_option.ip, shot_host_option.mac=tmp_shot_host_option.mac, shot_host_option.name=tmp_shot_host_option.name, shot_host_option.hostname=tmp_shot_host_option.hostname, shot_host_option.manufacturerid=tmp_shot_host_option.manufacturerid, shot_host_option.devicetypeid=tmp_shot_host_option.devicetypeid, shot_host_option.weight=tmp_shot_host_option.weight, shot_host_option.controllerid=tmp_shot_host_option.controllerid, shot_host_option.idoncontroller=tmp_shot_host_option.idoncontroller, shot_host_option.ipprefixid=tmp_shot_host_option.ipprefixid, shot_host_option.vlan=tmp_shot_host_option.vlan, shot_host_option.roleid=tmp_shot_host_option.roleid, shot_host_option.ispublic=tmp_shot_host_option.ispublic, shot_host_option.macvendorid=tmp_shot_host_option.macvendorid WHERE tmp_shot_host_option.controllerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 3, 21, 'UPDATE IGNORE shot_host_option INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype INNER JOIN tmp_shot_host_option AS tsho ON tmp_shot_host_option.controllerid=tsho.id INNER JOIN shot_host_option AS sho ON tsho.optionid=sho.optionid AND tsho.hostuuid=sho.hostuuid AND tsho.idtype=sho.idtype SET shot_host_option.ip=tmp_shot_host_option.ip, shot_host_option.mac=tmp_shot_host_option.mac, shot_host_option.name=tmp_shot_host_option.name, shot_host_option.hostname=tmp_shot_host_option.hostname, shot_host_option.manufacturerid=tmp_shot_host_option.manufacturerid, shot_host_option.devicetypeid=tmp_shot_host_option.devicetypeid, shot_host_option.weight=tmp_shot_host_option.weight, shot_host_option.controllerid=sho.id, shot_host_option.idoncontroller=tmp_shot_host_option.idoncontroller, shot_host_option.ipprefixid=tmp_shot_host_option.ipprefixid, shot_host_option.vlan=tmp_shot_host_option.vlan, shot_host_option.roleid=tmp_shot_host_option.roleid, shot_host_option.ispublic=tmp_shot_host_option.ispublic, shot_host_option.macvendorid=tmp_shot_host_option.macvendorid WHERE tmp_shot_host_option.controllerid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 3, 22, 'UPDATE IGNORE shot_host_option_uuid INNER JOIN tmp_shot_host_option_uuid ON shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_uuid.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid SET shot_host_option_uuid.hostid=shot_host_option.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 3, 23, 'UPDATE IGNORE shot_host_option_link INNER JOIN shot_host_option ON shot_host_option_link.hostid=shot_host_option.id INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.idtype=tmp_shot_host_option.idtype AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid INNER JOIN tmp_shot_host_option_link ON tmp_shot_host_option.id=tmp_shot_host_option_link.hostid AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid SET shot_host_option_link.uuid=tmp_shot_host_option_link.uuid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 4, 10, 'DELETE IGNORE shot_host_option_uuid FROM shot_host_option_uuid INNER JOIN ref_host_option ON shot_host_option_uuid.optionid=ref_host_option.optionid LEFT JOIN tmp_shot_host_option_uuid ON shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid WHERE ref_host_option.option=\'ruckussz\' AND tmp_shot_host_option_uuid.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 4, 11, 'DELETE IGNORE shot_host_option_link FROM shot_host_option_link INNER JOIN ref_host_option ON shot_host_option_link.optionid=ref_host_option.optionid INNER JOIN shot_host_option ON shot_host_option_link.hostid=shot_host_option.id LEFT JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype LEFT JOIN tmp_shot_host_option_link ON tmp_shot_host_option.id=tmp_shot_host_option_link.hostid AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid WHERE ref_host_option.option=\'ruckussz\' AND tmp_shot_host_option_link.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1504, 4, 12, 'DELETE IGNORE shot_host_option FROM shot_host_option INNER JOIN ref_host_option ON shot_host_option.optionid=ref_host_option.optionid LEFT JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype WHERE ref_host_option.option=\'ruckussz\' AND tmp_shot_host_option.id IS NULL;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 1, 10, 'CREATE TEMPORARY TABLE tmp_shot_host_option (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, optionid INT UNSIGNED NOT NULL, hostuuid VARCHAR(256) NOT NULL, idtype INT UNSIGNED NOT NULL, ip VARCHAR(39) DEFAULT NULL, mac VARCHAR(12) DEFAULT NULL, name varchar(256) DEFAULT NULL, hostname varchar(100) DEFAULT NULL, manufacturerid INT UNSIGNED DEFAULT NULL, devicetypeid INT UNSIGNED NOT NULL, weight FLOAT NOT NULL, controllerid INT DEFAULT NULL, idoncontroller VARCHAR(256) DEFAULT NULL, ipprefixid INT UNSIGNED DEFAULT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, ispublic BOOLEAN DEFAULT NULL, macvendorid VARCHAR(12) DEFAULT NULL, UNIQUE KEY hostoptiontype (hostuuid, optionid, idtype), KEY hosttype (hostuuid, idtype), KEY optionid (optionid), KEY hostuuid (hostuuid), KEY ip (ip), KEY mac (mac), KEY controllerid (controllerid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 1, 20, 'CREATE TEMPORARY TABLE tmp_shot_host_option_uuid (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, hostid INT NOT NULL, optionid INT UNSIGNED NOT NULL, uuid_type INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY optionuuidtype (optionid, uuid_type, uuid), KEY uuidtype (uuid_type, uuid), KEY optionid (optionid), KEY uuid_type (uuid_type), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 1, 30, 'CREATE TEMPORARY TABLE tmp_shot_host_option_link (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, hostid INT NOT NULL, optionid INT UNSIGNED NOT NULL, linkid INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY optionhostlink (optionid, hostid, linkid), KEY hostlink (hostid, linkid), KEY linkid (linkid), KEY optionid (optionid), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 2, 10, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname, name) SELECT ref_host_option.optionid, src_ip.ip, ref_host_idtype.id, src_ip.ip, src_ip.mac, ref_wlc_type.manufacturerid, ref_wlc_type.wlc_devicetypeid, ref_host_option.weight, NULL, NULL, NULL, 0, NULL, src_ip.ispublic, src_ip.macvendorid, NULL, NULL FROM src_snmp_wlc INNER JOIN ref_wlc_type ON src_snmp_wlc.wlcid=ref_wlc_type.wlcid INNER JOIN src_scan_ip ON src_snmp_wlc.ipid=src_scan_ip.ipid INNER JOIN src_ip ON src_scan_ip.ip=src_ip.ip INNER JOIN ref_host_option ON ref_host_option.option=\'wap\' INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'ip\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 2, 11, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname, name) SELECT ref_host_option.optionid, src_ip.mac, ref_host_idtype.id, src_snmp_wap.ip, src_ip.mac, ref_wlc_type.manufacturerid, ref_wlc_type.wap_devicetypeid, ref_host_option.weight, tmp_shot_host_option.id, src_snmp_wap.mac, NULL, 0, NULL, src_ip.ispublic, NULL, src_snmp_wap.hostname, NULL FROM src_snmp_wap INNER JOIN src_snmp_wlc ON src_snmp_wap.wlcid=src_snmp_wlc.ipid INNER JOIN ref_wlc_type ON src_snmp_wlc.wlcid=ref_wlc_type.wlcid INNER JOIN src_ip ON src_snmp_wap.ip=src_ip.ip INNER JOIN src_scan_ip ON src_snmp_wap.wlcid=src_scan_ip.ipid INNER JOIN src_ip AS sip ON src_scan_ip.ip=sip.ip INNER JOIN tmp_shot_host_option ON tmp_shot_host_option.hostuuid=sip.ip INNER JOIN ref_host_option ON ref_host_option.option=\'wap\' INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'mac\' WHERE ref_wlc_type.wlc_type=\'cisco_wlc\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 2, 12, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname, name) SELECT ref_host_option.optionid, src_snmp_wap.mac, ref_host_idtype.id, src_snmp_wap.ip, src_snmp_wap.mac, ref_wlc_type.manufacturerid, ref_wlc_type.wap_devicetypeid, ref_host_option.weight, tmp_shot_host_option.id, src_snmp_wap.mac, NULL, 0, NULL, src_ip.ispublic, NULL, src_snmp_wap.hostname, NULL FROM src_snmp_wap INNER JOIN src_snmp_wlc ON src_snmp_wap.wlcid=src_snmp_wlc.ipid INNER JOIN ref_wlc_type ON src_snmp_wlc.wlcid=ref_wlc_type.wlcid INNER JOIN src_ip ON src_snmp_wap.mac=src_ip.mac INNER JOIN src_scan_ip ON src_snmp_wap.wlcid=src_scan_ip.ipid INNER JOIN src_ip AS sip ON src_scan_ip.ip=sip.ip INNER JOIN tmp_shot_host_option ON tmp_shot_host_option.hostuuid=sip.ip INNER JOIN ref_host_option ON ref_host_option.option=\'wap\' INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'mac\' WHERE ref_wlc_type.wlc_type<>\'cisco_wlc\' AND NOT EXISTS (SELECT NULL FROM tmp_shot_host_option WHERE tmp_shot_host_option.hostuuid=src_snmp_wap.mac AND tmp_shot_host_option.idtype=ref_host_idtype.id);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 2, 13, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname, name) SELECT ref_host_option.optionid, src_snmp_wap.mac, ref_host_idtype.id, src_snmp_wap.ip, src_snmp_wap.mac, ref_wlc_type.manufacturerid, ref_wlc_type.wap_devicetypeid, ref_host_option.weight, tmp_shot_host_option.id, src_snmp_wap.mac, NULL, 0, NULL, src_ip.ispublic, NULL, src_snmp_wap.hostname, NULL FROM src_snmp_wap INNER JOIN src_snmp_wlc ON src_snmp_wap.wlcid=src_snmp_wlc.ipid INNER JOIN ref_wlc_type ON src_snmp_wlc.wlcid=ref_wlc_type.wlcid INNER JOIN src_ip ON src_snmp_wap.ip=src_ip.ip INNER JOIN src_scan_ip ON src_snmp_wap.wlcid=src_scan_ip.ipid INNER JOIN src_ip AS sip ON src_scan_ip.ip=sip.ip INNER JOIN tmp_shot_host_option ON tmp_shot_host_option.hostuuid=sip.ip INNER JOIN ref_host_option ON ref_host_option.option=\'wap\' INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'mac\' WHERE ref_wlc_type.wlc_type<>\'cisco_wlc\' AND NOT EXISTS (SELECT NULL FROM tmp_shot_host_option WHERE tmp_shot_host_option.hostuuid=src_snmp_wap.mac AND tmp_shot_host_option.idtype=ref_host_idtype.id);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 2, 20, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.ip=src_ip.ip SET tmp_shot_host_option.ipprefixid=src_ip.ipprefixid, tmp_shot_host_option.vlan=src_ip.vlan, tmp_shot_host_option.roleid=src_ip.roleid, tmp_shot_host_option.macvendorid=src_ip.macvendorid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 2, 21, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.mac=src_ip.mac SET tmp_shot_host_option.ipprefixid=src_ip.ipprefixid, tmp_shot_host_option.vlan=src_ip.vlan, tmp_shot_host_option.roleid=src_ip.roleid, tmp_shot_host_option.macvendorid=src_ip.macvendorid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 2, 22, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.ip=src_ip.ip INNER JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid INNER JOIN ref_scan_ip_info ON src_ip_info.infoid=ref_scan_ip_info.infoid SET tmp_shot_host_option.name=src_ip_info.value WHERE ref_scan_ip_info.info=\'name\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 2, 23, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.mac=src_ip.mac INNER JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid INNER JOIN ref_scan_ip_info ON src_ip_info.infoid=ref_scan_ip_info.infoid SET tmp_shot_host_option.name=src_ip_info.value WHERE ref_scan_ip_info.info=\'name\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 3, 10, 'INSERT IGNORE INTO shot_host_option (optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid) SELECT optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid FROM tmp_shot_host_option WHERE tmp_shot_host_option.controllerid IS NULL AND NOT EXISTS (SELECT NULL FROM shot_host_option WHERE shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 3, 11, 'INSERT IGNORE INTO shot_host_option (optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid) SELECT tmp_shot_host_option.optionid, tmp_shot_host_option.hostuuid, tmp_shot_host_option.idtype, tmp_shot_host_option.ip, tmp_shot_host_option.mac, tmp_shot_host_option.name, tmp_shot_host_option.hostname, tmp_shot_host_option.manufacturerid, tmp_shot_host_option.devicetypeid, tmp_shot_host_option.weight, shot_host_option.id, tmp_shot_host_option.idoncontroller, tmp_shot_host_option.ipprefixid, tmp_shot_host_option.vlan, tmp_shot_host_option.roleid, tmp_shot_host_option.ispublic, tmp_shot_host_option.macvendorid FROM tmp_shot_host_option INNER JOIN tmp_shot_host_option AS tsho ON tmp_shot_host_option.controllerid=tsho.id INNER JOIN shot_host_option ON tsho.optionid=shot_host_option.optionid AND tsho.hostuuid=shot_host_option.hostuuid AND tsho.idtype=shot_host_option.idtype WHERE tmp_shot_host_option.controllerid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM shot_host_option WHERE shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 3, 12, 'INSERT IGNORE INTO shot_host_option_uuid (hostid, optionid, uuid_type, uuid) SELECT shot_host_option.id, tmp_shot_host_option_uuid.optionid, tmp_shot_host_option_uuid.uuid_type, tmp_shot_host_option_uuid.uuid FROM tmp_shot_host_option_uuid INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_uuid.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid WHERE NOT EXISTS (SELECT NULL FROM shot_host_option_uuid WHERE shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 3, 13, 'INSERT IGNORE INTO shot_host_option_link (hostid, optionid, linkid, uuid) SELECT shot_host_option.id, tmp_shot_host_option_link.optionid, tmp_shot_host_option_link.linkid, tmp_shot_host_option_link.uuid FROM tmp_shot_host_option_link INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_link.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid WHERE NOT EXISTS (SELECT NULL FROM shot_host_option_link WHERE shot_host_option_link.hostid=shot_host_option.id AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 3, 20, 'UPDATE IGNORE shot_host_option INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype SET shot_host_option.ip=tmp_shot_host_option.ip, shot_host_option.mac=tmp_shot_host_option.mac, shot_host_option.name=tmp_shot_host_option.name, shot_host_option.hostname=tmp_shot_host_option.hostname, shot_host_option.manufacturerid=tmp_shot_host_option.manufacturerid, shot_host_option.devicetypeid=tmp_shot_host_option.devicetypeid, shot_host_option.weight=tmp_shot_host_option.weight, shot_host_option.controllerid=tmp_shot_host_option.controllerid, shot_host_option.idoncontroller=tmp_shot_host_option.idoncontroller, shot_host_option.ipprefixid=tmp_shot_host_option.ipprefixid, shot_host_option.vlan=tmp_shot_host_option.vlan, shot_host_option.roleid=tmp_shot_host_option.roleid, shot_host_option.ispublic=tmp_shot_host_option.ispublic, shot_host_option.macvendorid=tmp_shot_host_option.macvendorid WHERE tmp_shot_host_option.controllerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 3, 21, 'UPDATE IGNORE shot_host_option INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype INNER JOIN tmp_shot_host_option AS tsho ON tmp_shot_host_option.controllerid=tsho.id INNER JOIN shot_host_option AS sho ON tsho.optionid=sho.optionid AND tsho.hostuuid=sho.hostuuid AND tsho.idtype=sho.idtype SET shot_host_option.ip=tmp_shot_host_option.ip, shot_host_option.mac=tmp_shot_host_option.mac, shot_host_option.name=tmp_shot_host_option.name, shot_host_option.hostname=tmp_shot_host_option.hostname, shot_host_option.manufacturerid=tmp_shot_host_option.manufacturerid, shot_host_option.devicetypeid=tmp_shot_host_option.devicetypeid, shot_host_option.weight=tmp_shot_host_option.weight, shot_host_option.controllerid=sho.id, shot_host_option.idoncontroller=tmp_shot_host_option.idoncontroller, shot_host_option.ipprefixid=tmp_shot_host_option.ipprefixid, shot_host_option.vlan=tmp_shot_host_option.vlan, shot_host_option.roleid=tmp_shot_host_option.roleid, shot_host_option.ispublic=tmp_shot_host_option.ispublic, shot_host_option.macvendorid=tmp_shot_host_option.macvendorid WHERE tmp_shot_host_option.controllerid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 3, 22, 'UPDATE IGNORE shot_host_option_uuid INNER JOIN tmp_shot_host_option_uuid ON shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_uuid.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid SET shot_host_option_uuid.hostid=shot_host_option.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 3, 23, 'UPDATE IGNORE shot_host_option_link INNER JOIN shot_host_option ON shot_host_option_link.hostid=shot_host_option.id INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.idtype=tmp_shot_host_option.idtype AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid INNER JOIN tmp_shot_host_option_link ON tmp_shot_host_option.id=tmp_shot_host_option_link.hostid AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid SET shot_host_option_link.uuid=tmp_shot_host_option_link.uuid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 4, 10, 'DELETE IGNORE shot_host_option_uuid FROM shot_host_option_uuid INNER JOIN ref_host_option ON shot_host_option_uuid.optionid=ref_host_option.optionid LEFT JOIN tmp_shot_host_option_uuid ON shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid WHERE ref_host_option.option=\'wap\' AND tmp_shot_host_option_uuid.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 4, 11, 'DELETE IGNORE shot_host_option_link FROM shot_host_option_link INNER JOIN ref_host_option ON shot_host_option_link.optionid=ref_host_option.optionid INNER JOIN shot_host_option ON shot_host_option_link.hostid=shot_host_option.id LEFT JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype LEFT JOIN tmp_shot_host_option_link ON tmp_shot_host_option.id=tmp_shot_host_option_link.hostid AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid WHERE ref_host_option.option=\'wap\' AND tmp_shot_host_option_link.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1505, 4, 12, 'DELETE IGNORE shot_host_option FROM shot_host_option INNER JOIN ref_host_option ON shot_host_option.optionid=ref_host_option.optionid LEFT JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype WHERE ref_host_option.option=\'wap\' AND tmp_shot_host_option.id IS NULL;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 1, 10, 'CREATE TEMPORARY TABLE tmp_shot_host (hostid INT NOT NULL PRIMARY KEY, hostuuid VARCHAR(256) NOT NULL, idtype INT UNSIGNED NOT NULL, ip VARCHAR(39) DEFAULT NULL, mac VARCHAR(12) DEFAULT NULL, name varchar(256) DEFAULT NULL, hostname varchar(100) DEFAULT NULL, manufacturerid INT UNSIGNED DEFAULT NULL, devicetypeid INT UNSIGNED NOT NULL, controllerid BIGINT DEFAULT NULL, idoncontroller VARCHAR(256) DEFAULT NULL, ipprefixid INT UNSIGNED DEFAULT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, ispublic BOOLEAN DEFAULT NULL, macvendorid VARCHAR(12) DEFAULT NULL, selectedid BIGINT NOT NULL, UNIQUE KEY hosttype (hostuuid, idtype), KEY hostuuid (hostuuid), KEY ip (ip), KEY mac (mac), KEY controllerid (controllerid), KEY selectedid (selectedid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 1, 20, 'CREATE TEMPORARY TABLE tmp_shot_host_uuid (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, hostid INT NOT NULL, uuid_type INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY uuidtype (uuid_type, uuid), KEY uuid_type (uuid_type), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 1, 30, 'CREATE TEMPORARY TABLE tmp_shot_host_link (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, hostid INT NOT NULL, linkid INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY hostlink (hostid, linkid), KEY linkid (linkid), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 1, 40, 'CREATE TEMPORARY TABLE tmp_shot_host_option_map (host_option_id BIGINT NOT NULL PRIMARY KEY, hostid INT NOT NULL, UNIQUE KEY hostidoptionid (hostid, host_option_id), KEY hostid (hostid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 2, 10, 'UPDATE IGNORE shot_host_option INNER JOIN ref_devicetype ON shot_host_option.devicetypeid=ref_devicetype.devicetypeid SET shot_host_option.manufacturerid=ref_devicetype.manufacturerid WHERE ref_devicetype.manufacturerid IS NOT NULL AND (shot_host_option.manufacturerid IS NULL OR shot_host_option.manufacturerid<>ref_devicetype.manufacturerid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 2, 11, 'UPDATE IGNORE shot_host_option INNER JOIN ref_devicetype AS rdt1 ON shot_host_option.devicetypeid=rdt1.devicetypeid INNER JOIN ref_devicetype AS rdt2 ON rdt1.devicetypeid=rdt2.parentid INNER JOIN ref_manufacturer ON shot_host_option.manufacturerid=ref_manufacturer.manufacturerid SET shot_host_option.devicetypeid=rdt2.devicetypeid WHERE rdt1.manufacturerid IS NULL AND rdt2.manufacturerid IS NOT NULL AND rdt2.manufacturerid=shot_host_option.manufacturerid AND rdt2.model_alias=ref_manufacturer.manufacturer_alias;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 3, 10, 'UPDATE IGNORE tmp_shot_host INNER JOIN shot_host_option ON tmp_shot_host.controllerid=shot_host_option.id LEFT JOIN tmp_shot_host AS tsh ON shot_host_option.hostuuid=tsh.hostuuid AND shot_host_option.idtype=tsh.idtype SET tmp_shot_host.controllerid=NULL, tmp_shot_host.idoncontroller=NULL WHERE tmp_shot_host.controllerid IS NOT NULL AND tsh.hostid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 3, 11, 'UPDATE IGNORE tmp_shot_host INNER JOIN shot_host_option ON tmp_shot_host.controllerid=shot_host_option.id INNER JOIN tmp_shot_host AS tsh ON shot_host_option.hostuuid=tsh.hostuuid AND shot_host_option.idtype=tsh.idtype SET tmp_shot_host.controllerid=tsh.hostid WHERE tmp_shot_host.controllerid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 3, 20, 'UPDATE IGNORE tmp_shot_host INNER JOIN tmp_shot_host_option_map ON tmp_shot_host.hostid=tmp_shot_host_option_map.hostid INNER JOIN shot_host_option ON tmp_shot_host_option_map.host_option_id=shot_host_option.id SET tmp_shot_host.name=shot_host_option.name WHERE tmp_shot_host.name IS NULL AND shot_host_option.name IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 3, 21, 'UPDATE IGNORE tmp_shot_host INNER JOIN tmp_shot_host_option_map ON tmp_shot_host.hostid=tmp_shot_host_option_map.hostid INNER JOIN shot_host_option ON tmp_shot_host_option_map.host_option_id=shot_host_option.id SET tmp_shot_host.hostname=shot_host_option.hostname WHERE tmp_shot_host.hostname IS NULL AND shot_host_option.hostname IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 3, 30, 'UPDATE IGNORE tmp_shot_host INNER JOIN tmp_shot_host_option_map ON tmp_shot_host.hostid=tmp_shot_host_option_map.hostid INNER JOIN shot_host_option ON tmp_shot_host_option_map.host_option_id=shot_host_option.id SET tmp_shot_host.ipprefixid=shot_host_option.ipprefixid WHERE tmp_shot_host.ipprefixid IS NULL AND shot_host_option.ipprefixid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 3, 31, 'UPDATE IGNORE tmp_shot_host INNER JOIN tmp_shot_host_option_map ON tmp_shot_host.hostid=tmp_shot_host_option_map.hostid INNER JOIN shot_host_option ON tmp_shot_host_option_map.host_option_id=shot_host_option.id SET tmp_shot_host.roleid=shot_host_option.roleid WHERE tmp_shot_host.roleid IS NULL AND shot_host_option.roleid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 3, 32, 'UPDATE IGNORE tmp_shot_host INNER JOIN tmp_shot_host_option_map ON tmp_shot_host.hostid=tmp_shot_host_option_map.hostid INNER JOIN shot_host_option ON tmp_shot_host_option_map.host_option_id=shot_host_option.id SET tmp_shot_host.vlan=shot_host_option.vlan WHERE tmp_shot_host.vlan=0 AND shot_host_option.vlan<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 3, 40, 'UPDATE IGNORE tmp_shot_host INNER JOIN shot_host_option ON tmp_shot_host.ip=shot_host_option.ip SET tmp_shot_host.ispublic=shot_host_option.ispublic WHERE tmp_shot_host.ispublic IS NULL AND tmp_shot_host.ip IS NOT NULL AND shot_host_option.ispublic IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 3, 41, 'UPDATE IGNORE tmp_shot_host INNER JOIN shot_host_option ON tmp_shot_host.mac=shot_host_option.mac SET tmp_shot_host.macvendorid=shot_host_option.macvendorid WHERE tmp_shot_host.macvendorid IS NULL AND tmp_shot_host.mac IS NOT NULL AND shot_host_option.macvendorid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 4, 10, 'INSERT IGNORE INTO tmp_shot_host_uuid (hostid, uuid_type, uuid) SELECT tmp_shot_host.hostid, shot_host_option_uuid.uuid_type, shot_host_option_uuid.uuid FROM tmp_shot_host INNER JOIN shot_host_option_uuid ON tmp_shot_host.selectedid=shot_host_option_uuid.hostid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 4, 11, 'INSERT IGNORE INTO tmp_shot_host_link (hostid, linkid, uuid) SELECT tmp_shot_host.hostid, shot_host_option_link.linkid, shot_host_option_link.uuid FROM tmp_shot_host INNER JOIN shot_host_option_link ON tmp_shot_host.selectedid=shot_host_option_link.hostid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 8, 10, 'INSERT IGNORE INTO shot_host (hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid) SELECT hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid FROM tmp_shot_host WHERE tmp_shot_host.controllerid IS NULL AND NOT EXISTS (SELECT NULL FROM shot_host WHERE shot_host.hostuuid=tmp_shot_host.hostuuid AND shot_host.idtype=tmp_shot_host.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 8, 11, 'INSERT IGNORE INTO shot_host (hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid) SELECT tmp_shot_host.hostuuid, tmp_shot_host.idtype, tmp_shot_host.ip, tmp_shot_host.mac, tmp_shot_host.name, tmp_shot_host.hostname, tmp_shot_host.manufacturerid, tmp_shot_host.devicetypeid, shot_host.controllerid, tmp_shot_host.idoncontroller, tmp_shot_host.ipprefixid, tmp_shot_host.vlan, tmp_shot_host.roleid, tmp_shot_host.ispublic, tmp_shot_host.macvendorid FROM tmp_shot_host INNER JOIN tmp_shot_host AS tsh ON tmp_shot_host.controllerid=tsh.hostid INNER JOIN shot_host ON tsh.hostuuid=shot_host.hostuuid AND tsh.idtype=shot_host.idtype WHERE NOT EXISTS (SELECT NULL FROM shot_host WHERE shot_host.hostuuid=tmp_shot_host.hostuuid AND shot_host.idtype=tmp_shot_host.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 8, 12, 'INSERT IGNORE INTO shot_host_uuid (hostid, uuid_type, uuid) SELECT shot_host.hostid, tmp_shot_host_uuid.uuid_type, tmp_shot_host_uuid.uuid FROM tmp_shot_host_uuid INNER JOIN tmp_shot_host ON tmp_shot_host_uuid.hostid=tmp_shot_host.hostid INNER JOIN shot_host ON tmp_shot_host.idtype=shot_host.idtype AND tmp_shot_host.hostuuid=shot_host.hostuuid WHERE NOT EXISTS (SELECT NULL FROM shot_host_uuid WHERE shot_host_uuid.uuid=tmp_shot_host_uuid.uuid AND shot_host_uuid.uuid_type=tmp_shot_host_uuid.uuid_type);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 8, 13, 'INSERT IGNORE INTO shot_host_link (hostid, linkid, uuid) SELECT shot_host.hostid, tmp_shot_host_link.linkid, tmp_shot_host_link.uuid FROM tmp_shot_host_link INNER JOIN tmp_shot_host ON tmp_shot_host_link.hostid=tmp_shot_host.hostid INNER JOIN shot_host ON tmp_shot_host.idtype=shot_host.idtype AND tmp_shot_host.hostuuid=shot_host.hostuuid WHERE NOT EXISTS (SELECT NULL FROM shot_host_link WHERE shot_host_link.hostid=shot_host.hostid AND shot_host_link.linkid=tmp_shot_host_link.linkid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 8, 20, 'UPDATE IGNORE shot_host INNER JOIN tmp_shot_host ON shot_host.hostuuid=tmp_shot_host.hostuuid AND shot_host.idtype=tmp_shot_host.idtype SET shot_host.ip=tmp_shot_host.ip, shot_host.mac=tmp_shot_host.mac, shot_host.name=tmp_shot_host.name, shot_host.hostname=tmp_shot_host.hostname, shot_host.manufacturerid=tmp_shot_host.manufacturerid, shot_host.devicetypeid=tmp_shot_host.devicetypeid, shot_host.controllerid=tmp_shot_host.controllerid, shot_host.idoncontroller=tmp_shot_host.idoncontroller, shot_host.ipprefixid=tmp_shot_host.ipprefixid, shot_host.vlan=tmp_shot_host.vlan, shot_host.roleid=tmp_shot_host.roleid, shot_host.ispublic=tmp_shot_host.ispublic, shot_host.macvendorid=tmp_shot_host.macvendorid WHERE tmp_shot_host.controllerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 8, 21, 'UPDATE IGNORE shot_host INNER JOIN tmp_shot_host ON shot_host.hostuuid=tmp_shot_host.hostuuid AND shot_host.idtype=tmp_shot_host.idtype INNER JOIN tmp_shot_host AS tsho ON tmp_shot_host.controllerid=tsho.hostid INNER JOIN shot_host AS sho ON tsho.hostuuid=sho.hostuuid AND tsho.idtype=sho.idtype SET shot_host.ip=tmp_shot_host.ip, shot_host.mac=tmp_shot_host.mac, shot_host.name=tmp_shot_host.name, shot_host.hostname=tmp_shot_host.hostname, shot_host.manufacturerid=tmp_shot_host.manufacturerid, shot_host.devicetypeid=tmp_shot_host.devicetypeid, shot_host.controllerid=sho.hostid, shot_host.idoncontroller=tmp_shot_host.idoncontroller, shot_host.ipprefixid=tmp_shot_host.ipprefixid, shot_host.vlan=tmp_shot_host.vlan, shot_host.roleid=tmp_shot_host.roleid, shot_host.ispublic=tmp_shot_host.ispublic, shot_host.macvendorid=tmp_shot_host.macvendorid WHERE tmp_shot_host.controllerid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 8, 22, 'UPDATE IGNORE shot_host_uuid INNER JOIN tmp_shot_host_uuid ON shot_host_uuid.uuid_type=tmp_shot_host_uuid.uuid_type AND shot_host_uuid.uuid=tmp_shot_host_uuid.uuid INNER JOIN tmp_shot_host ON tmp_shot_host_uuid.hostid=tmp_shot_host.hostid INNER JOIN shot_host ON tmp_shot_host.idtype=shot_host.idtype AND tmp_shot_host.hostuuid=shot_host.hostuuid SET shot_host_uuid.hostid=shot_host.hostid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 8, 23, 'UPDATE IGNORE shot_host_link INNER JOIN shot_host ON shot_host_link.hostid=shot_host.hostid INNER JOIN tmp_shot_host ON shot_host.idtype=tmp_shot_host.idtype AND shot_host.hostuuid=tmp_shot_host.hostuuid INNER JOIN tmp_shot_host_link ON tmp_shot_host.hostid=tmp_shot_host_link.hostid AND shot_host_link.linkid=tmp_shot_host_link.linkid SET shot_host_link.uuid=tmp_shot_host_link.uuid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 9, 10, 'DELETE IGNORE shot_host_uuid FROM shot_host_uuid LEFT JOIN tmp_shot_host_uuid ON shot_host_uuid.uuid_type=tmp_shot_host_uuid.uuid_type AND shot_host_uuid.uuid=tmp_shot_host_uuid.uuid WHERE tmp_shot_host_uuid.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 9, 11, 'DELETE IGNORE shot_host_link FROM shot_host_link INNER JOIN shot_host ON shot_host_link.hostid=shot_host.hostid LEFT JOIN tmp_shot_host ON shot_host.hostuuid=tmp_shot_host.hostuuid AND shot_host.idtype=tmp_shot_host.idtype LEFT JOIN tmp_shot_host_link ON tmp_shot_host.hostid=tmp_shot_host_link.hostid AND shot_host_link.linkid=tmp_shot_host_link.linkid WHERE tmp_shot_host_link.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1507, 9, 12, 'DELETE IGNORE shot_host FROM shot_host LEFT JOIN tmp_shot_host ON shot_host.hostuuid=tmp_shot_host.hostuuid AND shot_host.idtype=tmp_shot_host.idtype WHERE tmp_shot_host.hostid IS NULL;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 1, 10, 'CREATE TEMPORARY TABLE tmp_shot_host_option (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, optionid INT UNSIGNED NOT NULL, hostuuid VARCHAR(256) NOT NULL, idtype INT UNSIGNED NOT NULL, ip VARCHAR(39) DEFAULT NULL, mac VARCHAR(12) DEFAULT NULL, name varchar(256) DEFAULT NULL, hostname varchar(100) DEFAULT NULL, manufacturerid INT UNSIGNED DEFAULT NULL, devicetypeid INT UNSIGNED NOT NULL, weight FLOAT NOT NULL, controllerid INT DEFAULT NULL, idoncontroller VARCHAR(256) DEFAULT NULL, ipprefixid INT UNSIGNED DEFAULT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, ispublic BOOLEAN DEFAULT NULL, macvendorid VARCHAR(12) DEFAULT NULL, UNIQUE KEY hostoptiontype (hostuuid, optionid, idtype), KEY hosttype (hostuuid, idtype), KEY optionid (optionid), KEY hostuuid (hostuuid), KEY ip (ip), KEY mac (mac), KEY controllerid (controllerid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 1, 20, 'CREATE TEMPORARY TABLE tmp_shot_host_option_uuid (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, hostid INT NOT NULL, optionid INT UNSIGNED NOT NULL, uuid_type INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY optionuuidtype (optionid, uuid_type, uuid), KEY uuidtype (uuid_type, uuid), KEY optionid (optionid), KEY uuid_type (uuid_type), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 1, 30, 'CREATE TEMPORARY TABLE tmp_shot_host_option_link (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, hostid INT NOT NULL, optionid INT UNSIGNED NOT NULL, linkid INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY optionhostlink (optionid, hostid, linkid), KEY hostlink (hostid, linkid), KEY linkid (linkid), KEY optionid (optionid), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 1, 40, 'CREATE TEMPORARY TABLE tmp_intid (id INT NOT NULL PRIMARY KEY) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (1508, 1, 50, 1, 'CREATE TEMPORARY TABLE tmp_bigintid (id BIGINT NOT NULL PRIMARY KEY);');
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 2, 10, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 2, 11, 'INSERT IGNORE INTO tmp_intid (id) SELECT devicetypeid FROM ref_devicetype WHERE model_alias IN (\'router\', \'firewall\') AND parentid=0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled, nrepeat) VALUES (1508, 2, 12, 'INSERT IGNORE INTO tmp_intid (id) SELECT devicetypeid FROM ref_devicetype WHERE parentid IN (SELECT id FROM tmp_intid);', 1, 10);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 2, 20, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname) SELECT ref_host_option.optionid, nnml_ip.ip, ref_host_idtype.id, nnml_ip.ip, nnml_ip.mac, nnml_ip.label_manufacturerid, nnml_ip.label_devicetypeid, ref_host_option.weight, NULL, NULL, nnml_ip.ipprefixid, nnml_ip.vlan, nnml_ip.roleid, nnml_ip.ispublic, nnml_ip.macvendorid, NULL FROM nnml_ip INNER JOIN ref_host_option ON ref_host_option.option=\'router\' INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'ip\' WHERE nnml_ip.label_devicetypeid IN (SELECT id FROM tmp_intid) AND nnml_ip.label_devicetypeid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 2, 21, 'TRUNCATE TABLE tmp_bigintid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled, parameter) VALUES (1508, 2, 22, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT nnml_ip.ipid FROM nnml_ip WHERE nnml_ip.predict_devicetypeid IN (SELECT id FROM tmp_intid) AND nnml_ip.predict_devicetypeid_prob>{0};', 1, 'nnml_devicetypeid_threshold');
INSERT INTO code_program_query (programid, stage, priority, query, enabled, parameter) VALUES (1508, 2, 23, 'INSERT IGNORE INTO tmp_shot_host_option (optionid, hostuuid, idtype, ip, mac, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, hostname) SELECT ref_host_option.optionid, nnml_ip.ip, ref_host_idtype.id, nnml_ip.ip, nnml_ip.mac, IF(nnml_ip.predict_manufacturerid IS NULL, NULL, IF(nnml_ip.predict_manufacturerid_prob<={0}, NULL, nnml_ip.predict_manufacturerid_prob)) AS mid, nnml_ip.predict_devicetypeid, ref_host_option.weight*nnml_ip.predict_devicetypeid_prob AS wgt, NULL, NULL, nnml_ip.ipprefixid, nnml_ip.vlan, nnml_ip.roleid, nnml_ip.ispublic, nnml_ip.macvendorid, NULL FROM nnml_ip INNER JOIN tmp_bigintid ON nnml_ip.ipid=tmp_bigintid.id INNER JOIN ref_host_option ON ref_host_option.option=\'router\' INNER JOIN ref_host_idtype ON ref_host_idtype.idtype=\'ip\';', 1, 'nnml_manufacturerid_threshold');
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 2, 30, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.ip=src_ip.ip INNER JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid INNER JOIN ref_scan_ip_info ON src_ip_info.infoid=ref_scan_ip_info.infoid SET tmp_shot_host_option.hostname=src_ip_info.value WHERE ref_scan_ip_info.info=\'hostname\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 2, 31, 'UPDATE IGNORE tmp_shot_host_option INNER JOIN src_ip ON tmp_shot_host_option.ip=src_ip.ip INNER JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid INNER JOIN ref_scan_ip_info ON src_ip_info.infoid=ref_scan_ip_info.infoid SET tmp_shot_host_option.name=src_ip_info.value WHERE ref_scan_ip_info.info=\'name\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 3, 10, 'INSERT IGNORE INTO shot_host_option (optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid) SELECT optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid FROM tmp_shot_host_option WHERE tmp_shot_host_option.controllerid IS NULL AND NOT EXISTS (SELECT NULL FROM shot_host_option WHERE shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 3, 11, 'INSERT IGNORE INTO shot_host_option (optionid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, weight, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid) SELECT tmp_shot_host_option.optionid, tmp_shot_host_option.hostuuid, tmp_shot_host_option.idtype, tmp_shot_host_option.ip, tmp_shot_host_option.mac, tmp_shot_host_option.name, tmp_shot_host_option.hostname, tmp_shot_host_option.manufacturerid, tmp_shot_host_option.devicetypeid, tmp_shot_host_option.weight, shot_host_option.id, tmp_shot_host_option.idoncontroller, tmp_shot_host_option.ipprefixid, tmp_shot_host_option.vlan, tmp_shot_host_option.roleid, tmp_shot_host_option.ispublic, tmp_shot_host_option.macvendorid FROM tmp_shot_host_option INNER JOIN tmp_shot_host_option AS tsho ON tmp_shot_host_option.controllerid=tsho.id INNER JOIN shot_host_option ON tsho.optionid=shot_host_option.optionid AND tsho.hostuuid=shot_host_option.hostuuid AND tsho.idtype=shot_host_option.idtype WHERE tmp_shot_host_option.controllerid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM shot_host_option WHERE shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 3, 12, 'INSERT IGNORE INTO shot_host_option_uuid (hostid, optionid, uuid_type, uuid) SELECT shot_host_option.id, tmp_shot_host_option_uuid.optionid, tmp_shot_host_option_uuid.uuid_type, tmp_shot_host_option_uuid.uuid FROM tmp_shot_host_option_uuid INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_uuid.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid WHERE NOT EXISTS (SELECT NULL FROM shot_host_option_uuid WHERE shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 3, 13, 'INSERT IGNORE INTO shot_host_option_link (hostid, optionid, linkid, uuid) SELECT shot_host_option.id, tmp_shot_host_option_link.optionid, tmp_shot_host_option_link.linkid, tmp_shot_host_option_link.uuid FROM tmp_shot_host_option_link INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_link.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid WHERE NOT EXISTS (SELECT NULL FROM shot_host_option_link WHERE shot_host_option_link.hostid=shot_host_option.id AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 3, 20, 'UPDATE IGNORE shot_host_option INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype SET shot_host_option.ip=tmp_shot_host_option.ip, shot_host_option.mac=tmp_shot_host_option.mac, shot_host_option.name=tmp_shot_host_option.name, shot_host_option.hostname=tmp_shot_host_option.hostname, shot_host_option.manufacturerid=tmp_shot_host_option.manufacturerid, shot_host_option.devicetypeid=tmp_shot_host_option.devicetypeid, shot_host_option.weight=tmp_shot_host_option.weight, shot_host_option.controllerid=tmp_shot_host_option.controllerid, shot_host_option.idoncontroller=tmp_shot_host_option.idoncontroller, shot_host_option.ipprefixid=tmp_shot_host_option.ipprefixid, shot_host_option.vlan=tmp_shot_host_option.vlan, shot_host_option.roleid=tmp_shot_host_option.roleid, shot_host_option.ispublic=tmp_shot_host_option.ispublic, shot_host_option.macvendorid=tmp_shot_host_option.macvendorid WHERE tmp_shot_host_option.controllerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 3, 21, 'UPDATE IGNORE shot_host_option INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype INNER JOIN tmp_shot_host_option AS tsho ON tmp_shot_host_option.controllerid=tsho.id INNER JOIN shot_host_option AS sho ON tsho.optionid=sho.optionid AND tsho.hostuuid=sho.hostuuid AND tsho.idtype=sho.idtype SET shot_host_option.ip=tmp_shot_host_option.ip, shot_host_option.mac=tmp_shot_host_option.mac, shot_host_option.name=tmp_shot_host_option.name, shot_host_option.hostname=tmp_shot_host_option.hostname, shot_host_option.manufacturerid=tmp_shot_host_option.manufacturerid, shot_host_option.devicetypeid=tmp_shot_host_option.devicetypeid, shot_host_option.weight=tmp_shot_host_option.weight, shot_host_option.controllerid=sho.id, shot_host_option.idoncontroller=tmp_shot_host_option.idoncontroller, shot_host_option.ipprefixid=tmp_shot_host_option.ipprefixid, shot_host_option.vlan=tmp_shot_host_option.vlan, shot_host_option.roleid=tmp_shot_host_option.roleid, shot_host_option.ispublic=tmp_shot_host_option.ispublic, shot_host_option.macvendorid=tmp_shot_host_option.macvendorid WHERE tmp_shot_host_option.controllerid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 3, 22, 'UPDATE IGNORE shot_host_option_uuid INNER JOIN tmp_shot_host_option_uuid ON shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid INNER JOIN tmp_shot_host_option ON tmp_shot_host_option_uuid.hostid=tmp_shot_host_option.id INNER JOIN shot_host_option ON tmp_shot_host_option.optionid=shot_host_option.optionid AND tmp_shot_host_option.idtype=shot_host_option.idtype AND tmp_shot_host_option.hostuuid=shot_host_option.hostuuid SET shot_host_option_uuid.hostid=shot_host_option.id;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 3, 23, 'UPDATE IGNORE shot_host_option_link INNER JOIN shot_host_option ON shot_host_option_link.hostid=shot_host_option.id INNER JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.idtype=tmp_shot_host_option.idtype AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid INNER JOIN tmp_shot_host_option_link ON tmp_shot_host_option.id=tmp_shot_host_option_link.hostid AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid SET shot_host_option_link.uuid=tmp_shot_host_option_link.uuid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 4, 10, 'DELETE IGNORE shot_host_option_uuid FROM shot_host_option_uuid INNER JOIN ref_host_option ON shot_host_option_uuid.optionid=ref_host_option.optionid LEFT JOIN tmp_shot_host_option_uuid ON shot_host_option_uuid.optionid=tmp_shot_host_option_uuid.optionid AND shot_host_option_uuid.uuid_type=tmp_shot_host_option_uuid.uuid_type AND shot_host_option_uuid.uuid=tmp_shot_host_option_uuid.uuid WHERE ref_host_option.option=\'router\' AND tmp_shot_host_option_uuid.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 4, 11, 'DELETE IGNORE shot_host_option_link FROM shot_host_option_link INNER JOIN ref_host_option ON shot_host_option_link.optionid=ref_host_option.optionid INNER JOIN shot_host_option ON shot_host_option_link.hostid=shot_host_option.id LEFT JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype LEFT JOIN tmp_shot_host_option_link ON tmp_shot_host_option.id=tmp_shot_host_option_link.hostid AND shot_host_option_link.optionid=tmp_shot_host_option_link.optionid AND shot_host_option_link.linkid=tmp_shot_host_option_link.linkid WHERE ref_host_option.option=\'router\' AND tmp_shot_host_option_link.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1508, 4, 12, 'DELETE IGNORE shot_host_option FROM shot_host_option INNER JOIN ref_host_option ON shot_host_option.optionid=ref_host_option.optionid LEFT JOIN tmp_shot_host_option ON shot_host_option.optionid=tmp_shot_host_option.optionid AND shot_host_option.hostuuid=tmp_shot_host_option.hostuuid AND shot_host_option.idtype=tmp_shot_host_option.idtype WHERE ref_host_option.option=\'router\' AND tmp_shot_host_option.id IS NULL;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 2, 10, 'INSERT IGNORE INTO main_if (device, ifindex, ifdescr, ifname, ifalias, ifadminstatus, ifoperstatus, ip, netmask, netnum, siteid, vlanid, vlan, roleid, connectedto, macs, ifphysaddress, ifphysaddressnum, macvendorid, active, created, last_active) SELECT device, ifindex, ifdescr, ifname, ifalias, ifadminstatus, ifoperstatus, ip, netmask, netnum, siteid, vlanid, vlan, roleid, NULL, macs, ifphysaddress, ifphysaddressnum, macvendorid, True, NOW(), NOW() FROM src_if WHERE NOT EXISTS (SELECT NULL FROM main_if WHERE main_if.device=src_if.device AND main_if.ifindex=src_if.ifindex);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 2, 11, 'UPDATE IGNORE main_if INNER JOIN src_if AS si1 ON main_if.device=si1.device AND main_if.ifindex=si1.ifindex INNER JOIN src_if AS si2 ON si1.connectedto=si2.ifid INNER JOIN main_if AS mi ON si2.device=mi.device AND si2.ifindex=mi.ifindex SET main_if.connectedto=mi.ifid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 2, 20, 'INSERT IGNORE INTO main_arp_device (device, ip, ipnum, mac, vlanid, vlan, roleid, siteid, ipprefixid, ifindex, ispublic, active, created, last_active) SELECT device, ip, ipnum, mac, vlanid, vlan, roleid, siteid, ipprefixid, ifindex, ispublic, True, NOW(), NOW() FROM src_arp_device WHERE NOT EXISTS (SELECT NULL FROM main_arp_device WHERE main_arp_device.device=src_arp_device.device AND main_arp_device.ip=src_arp_device.ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 2, 21, 'INSERT IGNORE INTO main_arp_site (siteid, ip, ipnum, mac, vlanid, vlan, roleid, ipprefixid, ispublic, active, created, last_active) SELECT siteid, ip, ipnum, mac, vlanid, vlan, roleid, ipprefixid, ispublic, True, NOW(), NOW() FROM src_arp_site WHERE NOT EXISTS (SELECT NULL FROM main_arp_site WHERE main_arp_site.ip=src_arp_site.ip AND main_arp_site.siteid=src_arp_site.siteid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 2, 22, 'INSERT IGNORE INTO main_arp (ip, ipnum, mac, vlanid, vlan, roleid, ipprefixid, siteid, ispublic, active, created, last_active) SELECT ip, ipnum, mac, vlanid, vlan, roleid, ipprefixid, siteid, ispublic, True, NOW(), NOW() FROM src_arp WHERE NOT EXISTS (SELECT NULL FROM main_arp WHERE main_arp.ip=src_arp.ip);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 2, 30, 'INSERT IGNORE INTO main_mac_device (device, mac, macnum, port, vlan, siteid, vlanid, roleid, vendorid, active, created, last_active) SELECT device, mac, macnum, port, vlan, siteid, vlanid, roleid, vendorid, True, NOW(), NOW() FROM src_mac_device WHERE NOT EXISTS (SELECT NULL FROM main_mac_device WHERE main_mac_device.device=src_mac_device.device AND main_mac_device.mac=src_mac_device.mac AND main_mac_device.vlan=src_mac_device.vlan);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 2, 31, 'INSERT IGNORE INTO main_mac_site (device, mac, macnum, port, vlan, siteid, vlanid, roleid, vendorid, active, created, last_active) SELECT device, mac, macnum, port, vlan, siteid, vlanid, roleid, vendorid, True, NOW(), NOW() FROM src_mac_site WHERE NOT EXISTS (SELECT NULL FROM main_mac_site WHERE main_mac_site.siteid=src_mac_site.siteid AND main_mac_site.mac=src_mac_site.mac AND main_mac_site.vlan=src_mac_site.vlan);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 2, 32, 'INSERT IGNORE INTO main_mac (device, mac, macnum, port, siteid, vlan, roleid, vendorid, active, created, last_active) SELECT device, mac, macnum, port, siteid, vlan, roleid, vendorid, True, NOW(), NOW() FROM src_mac WHERE NOT EXISTS (SELECT NULL FROM main_mac WHERE main_mac.mac=src_mac.mac AND main_mac.vlan=src_mac.vlan);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 3, 10, 'UPDATE IGNORE main_if INNER JOIN src_if ON main_if.device=src_if.device AND main_if.ifindex=src_if.ifindex SET main_if.ifdescr=src_if.ifdescr, main_if.ifname=src_if.ifname, main_if.ifalias=src_if.ifalias, main_if.ifadminstatus=src_if.ifadminstatus, main_if.ifoperstatus=src_if.ifoperstatus, main_if.ip=src_if.ip, main_if.netmask=src_if.netmask, main_if.netnum=src_if.netnum, main_if.siteid=src_if.siteid, main_if.vlanid=src_if.vlanid, main_if.vlan=src_if.vlan, main_if.roleid=src_if.roleid, main_if.macs=src_if.macs, main_if.ifphysaddress=src_if.ifphysaddress, main_if.ifphysaddressnum=src_if.ifphysaddressnum, main_if.macvendorid=src_if.macvendorid, main_if.active=True, main_if.last_active=NOW();', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 3, 20, 'UPDATE IGNORE main_arp_device INNER JOIN src_arp_device ON main_arp_device.device=src_arp_device.device AND main_arp_device.ip=src_arp_device.ip SET main_arp_device.ipnum=src_arp_device.ipnum, main_arp_device.mac=src_arp_device.mac, main_arp_device.vlanid=src_arp_device.vlanid, main_arp_device.vlan=src_arp_device.vlan, main_arp_device.roleid=src_arp_device.roleid, main_arp_device.siteid=src_arp_device.siteid, main_arp_device.ipprefixid=src_arp_device.ipprefixid, main_arp_device.ifindex=src_arp_device.ifindex, main_arp_device.ispublic=src_arp_device.ispublic, main_arp_device.active=True, main_arp_device.last_active=NOW();', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 3, 21, 'UPDATE IGNORE main_arp_site INNER JOIN src_arp_site ON main_arp_site.ip=src_arp_site.ip AND main_arp_site.siteid=src_arp_site.siteid SET main_arp_site.ipnum=src_arp_site.ipnum, main_arp_site.mac=src_arp_site.mac, main_arp_site.vlanid=src_arp_site.vlanid, main_arp_site.vlan=src_arp_site.vlan, main_arp_site.roleid=src_arp_site.roleid, main_arp_site.ipprefixid=src_arp_site.ipprefixid, main_arp_site.ispublic=src_arp_site.ispublic, main_arp_site.active=True, main_arp_site.last_active=NOW();', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 3, 22, 'UPDATE IGNORE main_arp INNER JOIN src_arp ON main_arp.ip=src_arp.ip SET main_arp.ipnum=src_arp.ipnum, main_arp.mac=src_arp.mac, main_arp.vlanid=src_arp.vlanid, main_arp.vlan=src_arp.vlan, main_arp.roleid=src_arp.roleid, main_arp.ipprefixid=src_arp.ipprefixid, main_arp.siteid=src_arp.siteid, main_arp.ispublic=src_arp.ispublic, main_arp.active=True, main_arp.last_active=NOW();', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 3, 30, 'UPDATE IGNORE main_mac_device INNER JOIN src_mac_device ON main_mac_device.device=src_mac_device.device AND main_mac_device.mac=src_mac_device.mac AND main_mac_device.vlan=src_mac_device.vlan SET main_mac_device.macnum=src_mac_device.macnum, main_mac_device.port=src_mac_device.port, main_mac_device.siteid=src_mac_device.siteid, main_mac_device.vlanid=src_mac_device.vlanid, main_mac_device.roleid=src_mac_device.roleid, main_mac_device.vendorid=src_mac_device.vendorid, main_mac_device.active=True, main_mac_device.last_active=NOW();', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 3, 31, 'UPDATE IGNORE main_mac_site INNER JOIN src_mac_site ON main_mac_site.siteid=src_mac_site.siteid AND main_mac_site.mac=src_mac_site.mac AND main_mac_site.vlan=src_mac_site.vlan SET main_mac_site.device=src_mac_site.device, main_mac_site.macnum=src_mac_site.macnum, main_mac_site.port=src_mac_site.port, main_mac_site.vlanid=src_mac_site.vlanid, main_mac_site.roleid=src_mac_site.roleid, main_mac_site.vendorid=src_mac_site.vendorid, main_mac_site.active=True, main_mac_site.last_active=NOW();', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 3, 32, 'UPDATE IGNORE main_mac INNER JOIN src_mac ON main_mac.mac=src_mac.mac AND main_mac.vlan=src_mac.vlan SET main_mac.device=src_mac.device, main_mac.macnum=src_mac.macnum, main_mac.port=src_mac.port, main_mac.siteid=src_mac.siteid, main_mac.roleid=src_mac.roleid, main_mac.vendorid=src_mac.vendorid, main_mac.active=True, main_mac.last_active=NOW();', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 4, 10, 'UPDATE IGNORE main_if LEFT JOIN src_if ON main_if.device=src_if.device AND main_if.ifindex=src_if.ifindex SET main_if.active=False WHERE src_if.ifid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 4, 20, 'UPDATE IGNORE main_arp_device LEFT JOIN src_arp_device ON main_arp_device.device=src_arp_device.device AND main_arp_device.ip=src_arp_device.ip SET main_arp_device.active=False WHERE src_arp_device.arpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 4, 21, 'UPDATE IGNORE main_arp_site LEFT JOIN src_arp_site ON main_arp_site.ip=src_arp_site.ip AND main_arp_site.siteid=src_arp_site.siteid SET main_arp_site.active=False WHERE src_arp_site.arpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 4, 22, 'UPDATE IGNORE main_arp LEFT JOIN src_arp ON main_arp.ip=src_arp.ip SET main_arp.active=False WHERE src_arp.arpid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 4, 30, 'UPDATE IGNORE main_mac_device LEFT JOIN src_mac_device ON main_mac_device.device=src_mac_device.device AND main_mac_device.mac=src_mac_device.mac AND main_mac_device.vlan=src_mac_device.vlan SET main_mac_device.active=False WHERE src_mac_device.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 4, 31, 'UPDATE IGNORE main_mac_site LEFT JOIN src_mac_site ON main_mac_site.siteid=src_mac_site.siteid AND main_mac_site.mac=src_mac_site.mac AND main_mac_site.vlan=src_mac_site.vlan SET main_mac_site.active=False WHERE src_mac_site.macid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (801, 4, 32, 'UPDATE IGNORE main_mac LEFT JOIN src_mac ON main_mac.mac=src_mac.mac AND main_mac.vlan=src_mac.vlan SET main_mac.active=False WHERE src_mac.macid IS NULL;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (901, 1, 10, 'CREATE TEMPORARY TABLE tmp_intid (id INT NOT NULL PRIMARY KEY) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (901, 2, 10, 'DELETE IGNORE hist_dump FROM hist_dump WHERE NOT EXISTS (SELECT NULL FROM tmp_intid WHERE tmp_intid.id=hist_dump.dumpid);', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 1, 10, 'CREATE TEMPORARY TABLE tmp_main_host (hostid BIGINT NOT NULL PRIMARY KEY, hostuuid VARCHAR(256) NOT NULL, idtype INT UNSIGNED NOT NULL, ip VARCHAR(39) DEFAULT NULL, mac VARCHAR(12) DEFAULT NULL, name varchar(256) DEFAULT NULL, hostname varchar(100) DEFAULT NULL, manufacturerid INT UNSIGNED DEFAULT NULL, devicetypeid INT UNSIGNED NOT NULL, controllerid BIGINT DEFAULT NULL, idoncontroller VARCHAR(256) DEFAULT NULL, ipprefixid INT UNSIGNED DEFAULT NULL, vlan INT UNSIGNED NOT NULL DEFAULT 0, roleid INT UNSIGNED DEFAULT NULL, ispublic BOOLEAN DEFAULT NULL, macvendorid VARCHAR(12) DEFAULT NULL, snmp_community VARCHAR(50) DEFAULT NULL, siteid INT UNSIGNED NOT NULL DEFAULT 0, UNIQUE KEY hosttype (hostuuid, idtype), KEY hostuuid (hostuuid), KEY idtype (idtype), KEY ip (ip), KEY mac (mac), KEY manufacturerid (manufacturerid), KEY devicetypeid (devicetypeid), KEY controllerid (controllerid), KEY ipprefixid (ipprefixid), KEY siteid (siteid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 1, 20, 'CREATE TEMPORARY TABLE tmp_main_host_uuid (id BIGINT NOT NULL PRIMARY KEY, hostid BIGINT NOT NULL, uuid_type INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY uuidtype (uuid_type, uuid), KEY uuid_type (uuid_type), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 1, 30, 'CREATE TEMPORARY TABLE tmp_main_host_link (id BIGINT NOT NULL PRIMARY KEY, hostid BIGINT NOT NULL, linkid INT UNSIGNED NOT NULL, uuid VARCHAR(256) NOT NULL, UNIQUE KEY hostlink (hostid, linkid), KEY linkid (linkid), KEY hostid (hostid), KEY uuid (uuid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 1, 40, 'CREATE TEMPORARY TABLE tmp_bigintid (id BIGINT NOT NULL PRIMARY KEY);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 2, 10, 'INSERT IGNORE INTO tmp_main_host (hostid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, snmp_community, siteid) SELECT  hostid, hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, NULL, 0 FROM shot_host;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 2, 11, 'INSERT IGNORE INTO tmp_main_host_uuid (id, hostid, uuid_type, uuid) SELECT id, hostid, uuid_type, uuid FROM shot_host_uuid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 2, 12, 'INSERT IGNORE INTO tmp_main_host_link (id, hostid, linkid, uuid) SELECT id, hostid, linkid, uuid FROM shot_host_link;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 2, 20, 'UPDATE IGNORE tmp_main_host INNER JOIN ref_ipprefix ON tmp_main_host.ipprefixid=ref_ipprefix.ipprefixid SET tmp_main_host.siteid=ref_ipprefix.siteid WHERE tmp_main_host.siteid=0 AND ref_ipprefix.siteid IS NOT NULL AND ref_ipprefix.siteid<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 2, 21, 'UPDATE IGNORE tmp_main_host INNER JOIN src_ip ON tmp_main_host.ip=src_ip.ip INNER JOIN src_ip_info ON src_ip.ipid=src_ip_info.ipid INNER JOIN ref_scan_ip_info ON src_ip_info.infoid=ref_scan_ip_info.infoid SET tmp_main_host.snmp_community=src_ip_info.value WHERE ref_scan_ip_info.info=\'snmp_community\' AND tmp_main_host.snmp_community IS NULL;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 4, 10, 'TRUNCATE TABLE tmp_bigintid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 4, 11, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT hostid FROM main_host WHERE NOT EXISTS (SELECT NULL FROM tmp_main_host WHERE tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 4, 12, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT main_host.hostid FROM main_host INNER JOIN tmp_main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype WHERE main_host.devicetypeid<>tmp_main_host.devicetypeid OR main_host.vlan<>tmp_main_host.vlan OR main_host.siteid<>tmp_main_host.siteid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 4, 13, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT main_host.hostid FROM main_host INNER JOIN tmp_main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype WHERE NOT (main_host.manufacturerid<=>tmp_main_host.manufacturerid AND main_host.hostname<=>tmp_main_host.hostname AND main_host.name<=>tmp_main_host.name AND main_host.mac<=>tmp_main_host.mac AND main_host.ip<=>tmp_main_host.ip AND main_host.ipprefixid<=>tmp_main_host.ipprefixid AND main_host.idoncontroller<=>tmp_main_host.idoncontroller AND main_host.roleid<=>tmp_main_host.roleid AND main_host.ispublic<=>tmp_main_host.ispublic AND main_host.macvendorid<=>tmp_main_host.macvendorid AND main_host.snmp_community<=>tmp_main_host.snmp_community);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 4, 14, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT main_host.hostid FROM main_host INNER JOIN tmp_main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype WHERE (main_host.controllerid IS NOT NULL AND tmp_main_host.controllerid IS NULL) OR (main_host.controllerid IS NULL AND tmp_main_host.controllerid IS NOT NULL);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 4, 15, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT main_host.hostid FROM main_host INNER JOIN tmp_main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype INNER JOIN tmp_main_host AS tmh ON tmp_main_host.controllerid=tmh.hostid LEFT JOIN main_host AS mh ON tmh.hostuuid=mh.hostuuid AND tmh.idtype=mh.idtype WHERE main_host.controllerid IS NOT NULL AND tmp_main_host.controllerid IS NOT NULL AND main_host.hostid IS NOT NULL AND main_host.controllerid<>mh.hostid;', 1);
INSERT INTO code_program_query (programid, stage, priority, parameter, tablename, query, enabled) VALUES (802, 4, 20, 'main_host_change_delay', '','UPDATE IGNORE main_host SET change_delay=change_delay+1 WHERE change_delay<{0} AND NOT EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 4, 21, 'UPDATE IGNORE main_host SET change_delay=change_delay-1 WHERE change_delay>=0 AND EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host.hostid);', 1);

INSERT INTO code_program_query (programid, stage, priority, parameter, tablename, query, enabled) VALUES (802, 8, 10, 'main_host_change_delay', '', 'INSERT IGNORE INTO main_host (hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, snmp_community, siteid, active, created, last_active, change_delay) SELECT hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, snmp_community, siteid, True, NOW(), NOW(), {0} FROM tmp_main_host WHERE controllerid IS NULL AND NOT EXISTS (SELECT NULL FROM main_host WHERE main_host.hostuuid=tmp_main_host.hostuuid AND main_host.idtype=tmp_main_host.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, parameter, tablename, query, enabled) VALUES (802, 8, 11, 'main_host_change_delay', '', 'INSERT IGNORE INTO main_host (hostuuid, idtype, ip, mac, name, hostname, manufacturerid, devicetypeid, controllerid, idoncontroller, ipprefixid, vlan, roleid, ispublic, macvendorid, snmp_community, siteid, active, created, last_active, change_delay) SELECT tmp_main_host.hostuuid, tmp_main_host.idtype, tmp_main_host.ip, tmp_main_host.mac, tmp_main_host.name, tmp_main_host.hostname, tmp_main_host.manufacturerid, tmp_main_host.devicetypeid, main_host.hostid, tmp_main_host.idoncontroller, tmp_main_host.ipprefixid, tmp_main_host.vlan, tmp_main_host.roleid, tmp_main_host.ispublic, tmp_main_host.macvendorid, tmp_main_host.snmp_community, tmp_main_host.siteid, True, NOW(), NOW(), {0} FROM tmp_main_host INNER JOIN tmp_main_host AS tmh ON tmp_main_host.controllerid=tmh.hostid INNER JOIN main_host ON tmh.hostuuid=main_host.hostuuid AND tmh.idtype=main_host.idtype WHERE tmp_main_host.controllerid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM main_host WHERE main_host.hostuuid=tmp_main_host.hostuuid AND main_host.idtype=tmp_main_host.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 20, 'INSERT IGNORE INTO main_host_uuid (hostid, uuid_type, uuid) SELECT main_host.hostid, tmp_main_host_uuid.uuid_type, tmp_main_host_uuid.uuid FROM tmp_main_host_uuid INNER JOIN tmp_main_host ON tmp_main_host_uuid.hostid=tmp_main_host.hostid INNER JOIN main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype WHERE NOT EXISTS (SELECT NULL FROM main_host_uuid WHERE main_host_uuid.uuid_type=tmp_main_host_uuid.uuid_type AND main_host_uuid.uuid=tmp_main_host_uuid.uuid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 21, 'INSERT IGNORE INTO main_host_link (hostid, linkid, uuid) SELECT main_host.hostid, tmp_main_host_link.linkid, tmp_main_host_link.uuid FROM tmp_main_host_link INNER JOIN tmp_main_host ON tmp_main_host_link.hostid=tmp_main_host.hostid INNER JOIN main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype WHERE NOT EXISTS (SELECT NULL FROM main_host_link WHERE main_host_link.hostid=main_host.hostid AND main_host_link.linkid=tmp_main_host_link.linkid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 30, 'TRUNCATE TABLE tmp_bigintid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 31, 'INSERT IGNORE INTO tmp_bigintid (id) SELECT hostid FROM main_host WHERE change_delay<0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 32, 'UPDATE IGNORE main_host INNER JOIN tmp_main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype SET main_host.manufacturerid=tmp_main_host.manufacturerid, main_host.devicetypeid=tmp_main_host.devicetypeid, main_host.idoncontroller=tmp_main_host.idoncontroller WHERE EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 33, 'UPDATE IGNORE main_host INNER JOIN tmp_main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype SET main_host.controllerid=NULL WHERE EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host.hostid) AND tmp_main_host.controllerid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 34, 'UPDATE IGNORE main_host INNER JOIN tmp_main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype INNER JOIN tmp_main_host AS tmh ON tmp_main_host.controllerid=tmh.hostid INNER JOIN main_host AS mh ON tmh.hostuuid=mh.hostuuid AND tmh.idtype=mh.idtype SET main_host.controllerid=mh.hostid WHERE EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host.hostid) AND tmp_main_host.controllerid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 35, 'UPDATE IGNORE main_host INNER JOIN tmp_main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype SET main_host.name=tmp_main_host.name WHERE tmp_main_host.name IS NOT NULL AND EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 36, 'UPDATE IGNORE main_host INNER JOIN tmp_main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype SET main_host.hostname=tmp_main_host.hostname WHERE tmp_main_host.hostname IS NOT NULL AND EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 38, 'UPDATE IGNORE main_host INNER JOIN tmp_main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype SET main_host.snmp_community=tmp_main_host.snmp_community WHERE tmp_main_host.snmp_community IS NOT NULL AND EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 39, 'UPDATE IGNORE main_host INNER JOIN tmp_main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype SET main_host.siteid=tmp_main_host.siteid WHERE tmp_main_host.siteid<>0 AND EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 40, 'UPDATE IGNORE main_host INNER JOIN tmp_main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype SET main_host.vlan=tmp_main_host.vlan WHERE tmp_main_host.vlan<>0 AND EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 41, 'UPDATE IGNORE main_host INNER JOIN tmp_main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype SET main_host.roleid=tmp_main_host.roleid WHERE tmp_main_host.roleid IS NOT NULL AND EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 42, 'UPDATE IGNORE main_host INNER JOIN tmp_main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype SET main_host.ip=tmp_main_host.ip, main_host.ipprefixid=tmp_main_host.ipprefixid, main_host.ispublic=tmp_main_host.ispublic WHERE tmp_main_host.ip IS NOT NULL AND EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 43, 'UPDATE IGNORE main_host INNER JOIN tmp_main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype SET main_host.mac=tmp_main_host.mac, main_host.macvendorid=tmp_main_host.macvendorid WHERE tmp_main_host.mac IS NOT NULL AND EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, parameter, tablename, query, enabled) VALUES (802, 8, 49, 'main_host_change_delay', '', 'UPDATE IGNORE main_host INNER JOIN tmp_main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype SET main_host.change_delay={0} WHERE EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 50, 'UPDATE IGNORE main_host_uuid INNER JOIN tmp_main_host_uuid ON main_host_uuid.uuid_type=tmp_main_host_uuid.uuid_type AND main_host_uuid.uuid=tmp_main_host_uuid.uuid INNER JOIN tmp_main_host ON tmp_main_host_uuid.hostid=tmp_main_host.hostid INNER JOIN main_host ON tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype SET main_host_uuid.hostid=main_host.hostid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 8, 51, 'UPDATE IGNORE main_host_link INNER JOIN main_host ON main_host_link.hostid=main_host.hostid INNER JOIN tmp_main_host ON main_host.hostuuid=tmp_main_host.hostuuid AND main_host.idtype=tmp_main_host.idtype INNER JOIN tmp_main_host_link ON tmp_main_host.hostid=tmp_main_host_link.hostid AND main_host_link.linkid=tmp_main_host_link.linkid SET main_host_link.uuid=tmp_main_host_link.uuid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 9, 10, 'UPDATE IGNORE main_host SET active=False WHERE NOT EXISTS (SELECT NULL FROM tmp_main_host WHERE tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 9, 11, 'UPDATE IGNORE main_host SET active=True, last_active=NOW() WHERE EXISTS (SELECT NULL FROM tmp_main_host WHERE tmp_main_host.hostuuid=main_host.hostuuid AND tmp_main_host.idtype=main_host.idtype);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 9, 20, 'TRUNCATE TABLE tmp_bigintid;', 1);
INSERT INTO code_program_query (programid, stage, priority, parameter, tablename, query, enabled) VALUES (802, 9, 21, 'main_host_keep_inactive', '', 'INSERT IGNORE INTO tmp_bigintid (id) SELECT hostid FROM main_host WHERE DATEDIFF(NOW(), last_active)>{0};', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 9, 22, 'DELETE IGNORE main_host_uuid FROM main_host_uuid WHERE EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host_uuid.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 9, 23, 'DELETE IGNORE main_host_link FROM main_host_link WHERE EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host_link.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 9, 24, 'DELETE IGNORE main_host FROM main_host WHERE EXISTS (SELECT NULL FROM tmp_bigintid WHERE tmp_bigintid.id=main_host.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 9, 30, 'DELETE IGNORE main_host_uuid FROM main_host_uuid LEFT JOIN tmp_main_host_uuid ON main_host_uuid.uuid_type=tmp_main_host_uuid.uuid_type AND main_host_uuid.uuid=tmp_main_host_uuid.uuid WHERE tmp_main_host_uuid.id IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (802, 9, 31, 'DELETE IGNORE main_host_link FROM main_host_link INNER JOIN main_host ON main_host_link.hostid=main_host.hostid INNER JOIN tmp_main_host ON main_host.hostuuid=tmp_main_host.hostuuid AND main_host.idtype=tmp_main_host.idtype LEFT JOIN tmp_main_host_link ON tmp_main_host.hostid=tmp_main_host_link.hostid AND main_host_link.linkid=tmp_main_host_link.linkid WHERE tmp_main_host_link.id IS NULL;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 10, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_proxies (proxyid BIGINT UNSIGNED PRIMARY KEY NOT NULL, proxy VARCHAR(128) NOT NULL UNIQUE, name VARCHAR(128) NOT NULL DEFAULT \'\') ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 20, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_maintenances (maintenanceid BIGINT UNSIGNED PRIMARY KEY NOT NULL, name VARCHAR(128) NOT NULL UNIQUE, maintenance_type INT NOT NULL DEFAULT 0, active_since INT NOT NULL DEFAULT 0, active_till INT NOT NULL DEFAULT 0) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 30, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_hosts (hostid BIGINT UNSIGNED PRIMARY KEY NOT NULL, proxy_hostid BIGINT UNSIGNED DEFAULT NULL, host VARCHAR(128) NOT NULL UNIQUE, status INT NOT NULL, ipmi_authtype INT NOT NULL DEFAULT -1, ipmi_privilege INT NOT NULL DEFAULT 2, ipmi_username VARCHAR(16) NOT NULL DEFAULT \'\', ipmi_password VARCHAR(20) NOT NULL DEFAULT \'\', maintenanceid BIGINT UNSIGNED DEFAULT NULL, maintenance_status INT NOT NULL DEFAULT 0, maintenance_type INT NOT NULL DEFAULT 0, maintenance_from INT NOT NULL DEFAULT 0, name VARCHAR(128) NOT NULL DEFAULT \'\', flags INT NOT NULL DEFAULT 0, description TEXT NOT NULL, tls_connect INT NOT NULL DEFAULT 1, tls_accept INT NOT NULL DEFAULT 1, tls_issuer VARCHAR(1024) NOT NULL DEFAULT \'\', tls_subject VARCHAR(1024) NOT NULL DEFAULT \'\', lastaccess INT NOT NULL DEFAULT 0, KEY proxy_hostid (proxy_hostid), KEY maintenanceid (maintenanceid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 40, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_hstgrp (groupid BIGINT UNSIGNED PRIMARY KEY NOT NULL, name VARCHAR(255) NOT NULL UNIQUE, internal INT NOT NULL DEFAULT 0, flags INT NOT NULL DEFAULT 0, uuid VARCHAR(32) NOT NULL DEFAULT \'\') ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 50, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_hosts_templates (hosttemplateid BIGINT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT, hostid BIGINT UNSIGNED NOT NULL, templateid BIGINT UNSIGNED NOT NULL, UNIQUE KEY host_template (hostid, templateid), KEY hostid (hostid), KEY templateid (templateid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 60, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_hosts_groups (hostgroupid BIGINT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT, hostid BIGINT UNSIGNED NOT NULL, groupid BIGINT UNSIGNED NOT NULL, UNIQUE KEY host_group (hostid, groupid), KEY hostid (hostid), KEY groupid (groupid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 70, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_interface (interfaceid BIGINT UNSIGNED PRIMARY KEY NOT NULL, hostid BIGINT UNSIGNED NOT NULL, main INT NOT NULL DEFAULT 0, type INT NOT NULL DEFAULT 1, useip INT NOT NULL DEFAULT 1, ip VARCHAR(64) NOT NULL DEFAULT \'127.0.0.1\', dns VARCHAR(255) NOT NULL DEFAULT \'\', port VARCHAR(64) NOT NULL DEFAULT \'10050\', available INT NOT NULL DEFAULT 0, error VARCHAR(2048) NOT NULL DEFAULT \'\', errors_from INT NOT NULL DEFAULT 0, disable_until INT NOT NULL DEFAULT 0, version INT DEFAULT NULL, bulk INT DEFAULT NULL, community VARCHAR(50) DEFAULT NULL, securityname VARCHAR(50) DEFAULT NULL, securitylevel INT DEFAULT NULL, authpassphrase VARCHAR(50) DEFAULT NULL, privpassphrase VARCHAR(50) DEFAULT NULL, authprotocol INT DEFAULT NULL, privprotocol INT DEFAULT NULL, contextname VARCHAR(50) DEFAULT NULL, KEY hostid (hostid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 80, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_hostmacro (hostmacroid BIGINT UNSIGNED PRIMARY KEY NOT NULL, hostid BIGINT UNSIGNED NOT NULL, macro VARCHAR(255) NOT NULL DEFAULT \'\', value VARCHAR(2048) DEFAULT NULL, description TEXT NOT NULL, type INT NOT NULL DEFAULT 0, UNIQUE KEY host_macro (hostid, macro), KEY hostid (hostid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 90, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_host_tag (hosttagid BIGINT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT, hostid BIGINT UNSIGNED NOT NULL, tag VARCHAR(255) NOT NULL DEFAULT \'\', value VARCHAR(255) NOT NULL DEFAULT \'\', UNIQUE KEY host_tag_value (hostid, tag, value), KEY hostid (hostid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 100, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_host_inventory (hostid BIGINT UNSIGNED PRIMARY KEY NOT NULL, inventory_mode INT NOT NULL DEFAULT 0, type VARCHAR(64) NOT NULL DEFAULT \'\', type_full VARCHAR(64) NOT NULL DEFAULT \'\', name VARCHAR(128) NOT NULL DEFAULT \'\', alias VARCHAR(128) NOT NULL DEFAULT \'\', os VARCHAR(128) NOT NULL DEFAULT \'\', os_full VARCHAR(255) NOT NULL DEFAULT \'\', os_short VARCHAR(128) NOT NULL DEFAULT \'\', serialno_a VARCHAR(64) NOT NULL DEFAULT \'\', serialno_b VARCHAR(64) NOT NULL DEFAULT \'\', tag VARCHAR(64) NOT NULL DEFAULT \'\', asset_tag VARCHAR(64) NOT NULL DEFAULT \'\', macaddress_a VARCHAR(64) NOT NULL DEFAULT \'\', macaddress_b VARCHAR(64) NOT NULL DEFAULT \'\', hardware VARCHAR(255) NOT NULL DEFAULT \'\', hardware_full TEXT NOT NULL, software VARCHAR(255) NOT NULL DEFAULT \'\', software_full TEXT NOT NULL, software_app_a VARCHAR(64) NOT NULL DEFAULT \'\', software_app_b VARCHAR(64) NOT NULL DEFAULT \'\', software_app_c VARCHAR(64) NOT NULL DEFAULT \'\', software_app_d VARCHAR(64) NOT NULL DEFAULT \'\', software_app_e VARCHAR(64) NOT NULL DEFAULT \'\', contact TEXT NOT NULL, location TEXT NOT NULL, location_lat VARCHAR(16) NOT NULL DEFAULT \'\', location_lon VARCHAR(16) NOT NULL DEFAULT \'\', notes TEXT NOT NULL, chassis VARCHAR(64) NOT NULL DEFAULT \'\', model VARCHAR(64) NOT NULL DEFAULT \'\', hw_arch VARCHAR(32) NOT NULL DEFAULT \'\', vendor VARCHAR(64) NOT NULL DEFAULT \'\', contract_number VARCHAR(64) NOT NULL DEFAULT \'\', installer_name VARCHAR(64) NOT NULL DEFAULT \'\', deployment_status VARCHAR(64) NOT NULL DEFAULT \'\', url_a VARCHAR(255) NOT NULL DEFAULT \'\', url_b VARCHAR(255) NOT NULL DEFAULT \'\', url_c VARCHAR(255) NOT NULL DEFAULT \'\', host_networks TEXT NOT NULL, host_netmask VARCHAR(39) NOT NULL DEFAULT \'\', host_router VARCHAR(39) NOT NULL DEFAULT \'\', oob_ip VARCHAR(39) NOT NULL DEFAULT \'\', oob_netmask VARCHAR(39) NOT NULL DEFAULT \'\', oob_router VARCHAR(39) COLLATE utf8mb4_bin NOT NULL DEFAULT \'\', date_hw_purchase VARCHAR(64) NOT NULL DEFAULT \'\', date_hw_install VARCHAR(64) NOT NULL DEFAULT \'\', date_hw_expiry VARCHAR(64) NOT NULL DEFAULT \'\', date_hw_decomm VARCHAR(64) NOT NULL DEFAULT \'\', site_address_a VARCHAR(128) NOT NULL DEFAULT \'\', site_address_b VARCHAR(128) NOT NULL DEFAULT \'\', site_address_c VARCHAR(128) NOT NULL DEFAULT \'\', site_city VARCHAR(128) NOT NULL DEFAULT \'\', site_state VARCHAR(64) NOT NULL DEFAULT \'\', site_country VARCHAR(64) NOT NULL DEFAULT \'\', site_zip VARCHAR(64) NOT NULL DEFAULT \'\', site_rack VARCHAR(128) NOT NULL DEFAULT \'\', site_notes TEXT NOT NULL, poc_1_name VARCHAR(128) NOT NULL DEFAULT \'\', poc_1_email VARCHAR(128) NOT NULL DEFAULT \'\', poc_1_phone_a VARCHAR(64) NOT NULL DEFAULT \'\', poc_1_phone_b VARCHAR(64) NOT NULL DEFAULT \'\', poc_1_cell VARCHAR(64) NOT NULL DEFAULT \'\', poc_1_screen VARCHAR(64) NOT NULL DEFAULT \'\', poc_1_notes TEXT NOT NULL, poc_2_name VARCHAR(128) NOT NULL DEFAULT \'\', poc_2_email VARCHAR(128) NOT NULL DEFAULT \'\', poc_2_phone_a VARCHAR(64) NOT NULL DEFAULT \'\', poc_2_phone_b VARCHAR(64) NOT NULL DEFAULT \'\', poc_2_cell VARCHAR(64) NOT NULL DEFAULT \'\', poc_2_screen VARCHAR(64) NOT NULL DEFAULT \'\', poc_2_notes TEXT NOT NULL) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 110, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_items (itemid BIGINT UNSIGNED NOT NULL PRIMARY KEY, type INT NOT NULL DEFAULT 0, snmp_oid VARCHAR(512) NOT NULL DEFAULT \'\', hostid BIGINT UNSIGNED NOT NULL, name VARCHAR(255) NOT NULL DEFAULT \'\', key_ VARCHAR(2048) NOT NULL DEFAULT \'\', delay VARCHAR(1024) NOT NULL DEFAULT \'0\', history VARCHAR(255) NOT NULL DEFAULT \'90d\', trends VARCHAR(255) NOT NULL DEFAULT \'365d\', status INT NOT NULL DEFAULT 0, value_type INT NOT NULL DEFAULT 0, trapper_hosts VARCHAR(255) NOT NULL DEFAULT \'\', units VARCHAR(255) NOT NULL DEFAULT \'\', logtimefmt VARCHAR(64) NOT NULL DEFAULT \'\', templateid BIGINT UNSIGNED DEFAULT NULL, valuemapid BIGINT UNSIGNED DEFAULT NULL, params TEXT NOT NULL, ipmi_sensor VARCHAR(128) NOT NULL DEFAULT \'\', authtype INT NOT NULL DEFAULT 0, username VARCHAR(64) NOT NULL DEFAULT \'\', password VARCHAR(64) NOT NULL DEFAULT \'\', publickey VARCHAR(64) NOT NULL DEFAULT \'\', privatekey VARCHAR(64) NOT NULL DEFAULT \'\', flags INT NOT NULL DEFAULT 0, interfaceid BIGINT UNSIGNED DEFAULT NULL, description TEXT NOT NULL, inventory_link INT NOT NULL DEFAULT 0, jmx_endpoint VARCHAR(255) NOT NULL DEFAULT \'\', master_itemid BIGINT UNSIGNED DEFAULT NULL, timeout VARCHAR(255) NOT NULL DEFAULT \'3s\', url VARCHAR(2048) NOT NULL DEFAULT \'\', query_fields VARCHAR(2048) NOT NULL DEFAULT \'\', posts TEXT NOT NULL, status_codes VARCHAR(255) NOT NULL DEFAULT \'200\', follow_redirects INT NOT NULL DEFAULT 1, post_type INT NOT NULL DEFAULT 0, http_proxy VARCHAR(255) NOT NULL DEFAULT \'\', headers TEXT NOT NULL, retrieve_mode INT NOT NULL DEFAULT 0, request_method INT NOT NULL DEFAULT 0, output_format INT NOT NULL DEFAULT 0, ssl_cert_file VARCHAR(255) NOT NULL DEFAULT \'\', ssl_key_file VARCHAR(255) NOT NULL DEFAULT \'\', ssl_key_password VARCHAR(64) NOT NULL DEFAULT \'\', verify_peer INT NOT NULL DEFAULT 0, verify_host INT NOT NULL DEFAULT 0, allow_traps INT NOT NULL DEFAULT 0, state INT NOT NULL, error VARCHAR(255) DEFAULT NULL, KEY hostid (hostid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 120, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_triggers (triggerid BIGINT UNSIGNED NOT NULL PRIMARY KEY, hostid BIGINT UNSIGNED NOT NULL, expression VARCHAR(2048) NOT NULL DEFAULT \'\', description TEXT NOT NULL, url VARCHAR(255) NOT NULL DEFAULT \'\', status INT NOT NULL DEFAULT 0, value INT NOT NULL DEFAULT 0, priority INT NOT NULL DEFAULT 0, lastchange INT NOT NULL DEFAULT 0, comments TEXT NOT NULL, error VARCHAR(2048) NOT NULL DEFAULT \'\', templateid BIGINT UNSIGNED DEFAULT NULL, type INT NOT NULL DEFAULT 0, state INT NOT NULL DEFAULT 0, flags INT NOT NULL DEFAULT 0, recovery_mode INT NOT NULL DEFAULT 0, recovery_expression VARCHAR(2048) NOT NULL DEFAULT \'\', correlation_mode INT NOT NULL DEFAULT 0, correlation_tag VARCHAR(255) NOT NULL DEFAULT \'\', manual_close INT NOT NULL DEFAULT 0, opdata VARCHAR(255) NOT NULL DEFAULT \'\', event_name VARCHAR(2048) NOT NULL DEFAULT \'\', KEY hostid (hostid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 130, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_history (historyid INT NOT NULL PRIMARY KEY AUTO_INCREMENT, itemid BIGINT UNSIGNED NOT NULL, clock INT NOT NULL DEFAULT 0, value DOUBLE NOT NULL DEFAULT 0, ns INT NOT NULL DEFAULT 0, UNIQUE KEY itemclockns (itemid, clock, ns), KEY itemid (itemid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 140, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_history_uint (historyid INT NOT NULL PRIMARY KEY AUTO_INCREMENT, itemid BIGINT UNSIGNED NOT NULL, clock INT NOT NULL DEFAULT 0, value BIGINT UNSIGNED NOT NULL DEFAULT 0, ns INT NOT NULL DEFAULT 0, UNIQUE KEY itemclockns (itemid, clock, ns), KEY itemid (itemid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 150, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_history_str (historyid INT NOT NULL PRIMARY KEY AUTO_INCREMENT, itemid BIGINT UNSIGNED NOT NULL, clock INT NOT NULL DEFAULT 0, value VARCHAR(255) NOT NULL DEFAULT \'\', ns INT NOT NULL DEFAULT 0, UNIQUE KEY itemclockns (itemid,clock,ns), KEY itemid (itemid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 160, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_history_text (historyid INT NOT NULL PRIMARY KEY AUTO_INCREMENT, itemid BIGINT UNSIGNED NOT NULL, clock INT NOT NULL DEFAULT 0, value TEXT NOT NULL, ns INT NOT NULL DEFAULT 0, UNIQUE KEY itemclockns (itemid,clock,ns), KEY itemid (itemid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 170, 'CREATE TEMPORARY TABLE tmp_zbx_zbx_history_log (historyid INT NOT NULL PRIMARY KEY AUTO_INCREMENT, itemid BIGINT UNSIGNED NOT NULL, clock INT NOT NULL DEFAULT 0, timestamp INT NOT NULL DEFAULT 0, source VARCHAR(64) NOT NULL DEFAULT \'\', severity INT NOT NULL DEFAULT 0, value TEXT NOT NULL, logeventid INT NOT NULL DEFAULT 0, ns INT NOT NULL DEFAULT 0, UNIQUE KEY itemclockns (itemid,clock,ns), KEY itemid (itemid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 180, 'CREATE TEMPORARY TABLE tmp_bigintid (id BIGINT NOT NULL PRIMARY KEY);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 1, 181, 'CREATE TEMPORARY TABLE tmp_bigintid1 (id BIGINT NOT NULL PRIMARY KEY);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 10, 'DELETE IGNORE zbx_zbx_history FROM zbx_zbx_history WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_items WHERE tmp_zbx_zbx_items.itemid=zbx_zbx_history.itemid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 11, 'DELETE IGNORE zbx_zbx_history_uint FROM zbx_zbx_history_uint WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_items WHERE tmp_zbx_zbx_items.itemid=zbx_zbx_history_uint.itemid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 12, 'DELETE IGNORE zbx_zbx_history_str FROM zbx_zbx_history_str WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_items WHERE tmp_zbx_zbx_items.itemid=zbx_zbx_history_str.itemid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 13, 'DELETE IGNORE zbx_zbx_history_text FROM zbx_zbx_history_text WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_items WHERE tmp_zbx_zbx_items.itemid=zbx_zbx_history_text.itemid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 14, 'DELETE IGNORE zbx_zbx_history_log FROM zbx_zbx_history_log WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_items WHERE tmp_zbx_zbx_items.itemid=zbx_zbx_history_log.itemid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 20, 'UPDATE IGNORE zbx_zbx_items SET interfaceid=NULL WHERE interfaceid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_interface WHERE zbx_zbx_items.interfaceid=tmp_zbx_zbx_interface.interfaceid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 30, 'DELETE IGNORE zbx_zbx_hosts_templates FROM zbx_zbx_hosts_templates WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_hosts WHERE tmp_zbx_zbx_hosts.hostid=zbx_zbx_hosts_templates.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 31, 'DELETE IGNORE zbx_zbx_hosts_templates FROM zbx_zbx_hosts_templates WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_hosts WHERE tmp_zbx_zbx_hosts.hostid=zbx_zbx_hosts_templates.templateid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 32, 'DELETE IGNORE zbx_zbx_hosts_groups FROM zbx_zbx_hosts_groups WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_hosts WHERE tmp_zbx_zbx_hosts.hostid=zbx_zbx_hosts_groups.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 33, 'DELETE IGNORE zbx_zbx_interface FROM zbx_zbx_interface WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_hosts WHERE tmp_zbx_zbx_hosts.hostid=zbx_zbx_interface.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 34, 'DELETE IGNORE zbx_zbx_hostmacro FROM zbx_zbx_hostmacro WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_hosts WHERE tmp_zbx_zbx_hosts.hostid=zbx_zbx_hostmacro.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 35, 'DELETE IGNORE zbx_zbx_host_tag FROM zbx_zbx_host_tag WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_hosts WHERE tmp_zbx_zbx_hosts.hostid=zbx_zbx_host_tag.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 36, 'DELETE IGNORE zbx_zbx_host_inventory FROM zbx_zbx_host_inventory WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_hosts WHERE tmp_zbx_zbx_hosts.hostid=zbx_zbx_host_inventory.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 37, 'DELETE IGNORE zbx_zbx_items FROM zbx_zbx_items WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_hosts WHERE tmp_zbx_zbx_hosts.hostid=zbx_zbx_items.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 38, 'DELETE IGNORE zbx_zbx_triggers FROM zbx_zbx_triggers WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_hosts WHERE tmp_zbx_zbx_hosts.hostid=zbx_zbx_triggers.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 39, 'DELETE IGNORE zbx_omni_hosts_templates FROM zbx_omni_hosts_templates WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_hosts WHERE tmp_zbx_zbx_hosts.hostid=zbx_omni_hosts_templates.templateid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 50, 'DELETE IGNORE zbx_zbx_hosts_groups FROM zbx_zbx_hosts_groups WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_hstgrp WHERE tmp_zbx_zbx_hstgrp.groupid=zbx_zbx_hosts_groups.groupid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 60, 'UPDATE IGNORE zbx_zbx_hosts SET proxy_hostid=NULL WHERE proxy_hostid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_proxies WHERE tmp_zbx_zbx_proxies.proxyid=zbx_zbx_hosts.proxy_hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 61, 'UPDATE IGNORE zbx_zbx_hosts SET maintenanceid=NULL WHERE maintenanceid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_maintenances WHERE tmp_zbx_zbx_maintenances.maintenanceid=zbx_zbx_hosts.maintenanceid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 62, 'UPDATE IGNORE zbx_omni_hosts SET proxy_hostid=NULL WHERE proxy_hostid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_proxies WHERE tmp_zbx_zbx_proxies.proxyid=zbx_omni_hosts.proxy_hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 100, 'DELETE IGNORE zbx_zbx_triggers FROM zbx_zbx_triggers WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_triggers WHERE tmp_zbx_zbx_triggers.triggerid=zbx_zbx_triggers.triggerid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 101, 'DELETE IGNORE zbx_zbx_items FROM zbx_zbx_items WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_items WHERE tmp_zbx_zbx_items.itemid=zbx_zbx_items.itemid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 102, 'DELETE IGNORE zbx_zbx_host_inventory FROM zbx_zbx_host_inventory WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_host_inventory WHERE tmp_zbx_zbx_host_inventory.hostid=zbx_zbx_host_inventory.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 103, 'DELETE IGNORE zbx_zbx_host_tag FROM zbx_zbx_host_tag WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_host_tag WHERE tmp_zbx_zbx_host_tag.hostid=zbx_zbx_host_tag.hostid AND tmp_zbx_zbx_host_tag.tag=zbx_zbx_host_tag.tag AND tmp_zbx_zbx_host_tag.value=zbx_zbx_host_tag.value);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 104, 'DELETE IGNORE zbx_zbx_hostmacro FROM zbx_zbx_hostmacro WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_hostmacro WHERE tmp_zbx_zbx_hostmacro.hostmacroid=zbx_zbx_hostmacro.hostmacroid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 105, 'DELETE IGNORE zbx_zbx_interface FROM zbx_zbx_interface WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_interface WHERE tmp_zbx_zbx_interface.interfaceid=zbx_zbx_interface.interfaceid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 106, 'DELETE IGNORE zbx_zbx_hosts_groups FROM zbx_zbx_hosts_groups WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_hosts_groups WHERE tmp_zbx_zbx_hosts_groups.hostid=zbx_zbx_hosts_groups.hostid AND tmp_zbx_zbx_hosts_groups.groupid=zbx_zbx_hosts_groups.groupid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 107, 'DELETE IGNORE zbx_zbx_hosts_templates FROM zbx_zbx_hosts_templates WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_hosts_templates WHERE tmp_zbx_zbx_hosts_templates.hostid=zbx_zbx_hosts_templates.hostid AND tmp_zbx_zbx_hosts_templates.templateid=zbx_zbx_hosts_templates.templateid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 108, 'DELETE IGNORE zbx_zbx_hstgrp FROM zbx_zbx_hstgrp WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_hstgrp WHERE tmp_zbx_zbx_hstgrp.groupid=zbx_zbx_hstgrp.groupid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 109, 'DELETE IGNORE zbx_zbx_hosts FROM zbx_zbx_hosts WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_hosts WHERE tmp_zbx_zbx_hosts.hostid=zbx_zbx_hosts.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 110, 'DELETE IGNORE zbx_zbx_maintenances FROM zbx_zbx_maintenances WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_maintenances WHERE tmp_zbx_zbx_maintenances.maintenanceid=zbx_zbx_maintenances.maintenanceid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 3, 111, 'DELETE IGNORE zbx_zbx_proxies FROM zbx_zbx_proxies WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_zbx_proxies WHERE tmp_zbx_zbx_proxies.proxyid=zbx_zbx_proxies.proxyid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 10, 'INSERT IGNORE INTO zbx_zbx_proxies (proxyid, proxy, name) SELECT proxyid, proxy, name FROM tmp_zbx_zbx_proxies WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_proxies WHERE zbx_zbx_proxies.proxyid=tmp_zbx_zbx_proxies.proxyid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 11, 'INSERT IGNORE INTO zbx_zbx_maintenances (maintenanceid, name, maintenance_type, active_since, active_till) SELECT maintenanceid, name, maintenance_type, active_since, active_till FROM tmp_zbx_zbx_maintenances WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_maintenances WHERE zbx_zbx_maintenances.maintenanceid=tmp_zbx_zbx_maintenances.maintenanceid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 12, 'INSERT IGNORE INTO zbx_zbx_hosts (hostid, proxy_hostid, host, status, ipmi_authtype, ipmi_privilege, ipmi_username, ipmi_password, maintenanceid, maintenance_status, maintenance_type, maintenance_from, name, flags, description, tls_connect, tls_accept, tls_issuer, tls_subject, lastaccess) SELECT hostid, proxy_hostid, host, status, ipmi_authtype, ipmi_privilege, ipmi_username, ipmi_password, maintenanceid, maintenance_status, maintenance_type, maintenance_from, name, flags, description, tls_connect, tls_accept, tls_issuer, tls_subject, lastaccess FROM tmp_zbx_zbx_hosts WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_hosts WHERE zbx_zbx_hosts.hostid=tmp_zbx_zbx_hosts.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 13, 'INSERT IGNORE INTO zbx_zbx_hstgrp (groupid, name, internal, flags) SELECT groupid, name, internal, flags FROM tmp_zbx_zbx_hstgrp WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_hstgrp WHERE zbx_zbx_hstgrp.groupid=tmp_zbx_zbx_hstgrp.groupid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 14, 'INSERT IGNORE INTO zbx_zbx_hosts_groups (hostid, groupid) SELECT hostid, groupid FROM tmp_zbx_zbx_hosts_groups WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_hosts_groups WHERE zbx_zbx_hosts_groups.hostid=tmp_zbx_zbx_hosts_groups.hostid AND zbx_zbx_hosts_groups.groupid=tmp_zbx_zbx_hosts_groups.groupid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 15, 'INSERT IGNORE INTO zbx_zbx_hosts_templates (hostid, templateid) SELECT hostid, templateid FROM tmp_zbx_zbx_hosts_templates WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_hosts_templates WHERE zbx_zbx_hosts_templates.hostid=tmp_zbx_zbx_hosts_templates.hostid AND zbx_zbx_hosts_templates.templateid=tmp_zbx_zbx_hosts_templates.templateid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 16, 'INSERT IGNORE INTO zbx_zbx_interface (interfaceid, hostid, main, type, useip, ip, dns, port, available, error, errors_from, disable_until, version, bulk, community, securityname, securitylevel, authpassphrase, privpassphrase, authprotocol, privprotocol, contextname) SELECT interfaceid, hostid, main, type, useip, ip, dns, port, available, error, errors_from, disable_until, version, bulk, community, securityname, securitylevel, authpassphrase, privpassphrase, authprotocol, privprotocol, contextname FROM tmp_zbx_zbx_interface WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_interface WHERE zbx_zbx_interface.interfaceid=tmp_zbx_zbx_interface.interfaceid) AND EXISTS (SELECT NULL FROM zbx_zbx_hosts WHERE zbx_zbx_hosts.hostid=tmp_zbx_zbx_interface.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 17, 'INSERT IGNORE INTO zbx_zbx_hostmacro (hostmacroid, hostid, macro, value, description, type) SELECT hostmacroid, hostid, macro, value, description, type FROM tmp_zbx_zbx_hostmacro WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_hostmacro WHERE zbx_zbx_hostmacro.hostmacroid=tmp_zbx_zbx_hostmacro.hostmacroid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 18, 'INSERT IGNORE INTO zbx_zbx_host_tag (hostid, tag, value) SELECT hostid, tag, value FROM tmp_zbx_zbx_host_tag WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_host_tag WHERE zbx_zbx_host_tag.hostid=tmp_zbx_zbx_host_tag.hostid AND zbx_zbx_host_tag.tag=tmp_zbx_zbx_host_tag.tag AND zbx_zbx_host_tag.value=tmp_zbx_zbx_host_tag.value);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 19, 'INSERT IGNORE INTO zbx_zbx_host_inventory (hostid, inventory_mode, type, type_full, name, alias, os, os_full, os_short, serialno_a, serialno_b, tag, asset_tag, macaddress_a, macaddress_b, hardware, hardware_full, software, software_full, software_app_a, software_app_b, software_app_c, software_app_d, software_app_e, contact, location, location_lat, location_lon, notes, chassis, model, hw_arch, vendor, contract_number, installer_name, deployment_status, url_a, url_b, url_c, host_networks, host_netmask, host_router, oob_ip, oob_netmask, oob_router, date_hw_purchase, date_hw_install, date_hw_expiry, date_hw_decomm, site_address_a, site_address_b, site_address_c, site_city, site_state, site_country, site_zip, site_rack, site_notes, poc_1_name, poc_1_email, poc_1_phone_a, poc_1_phone_b, poc_1_cell, poc_1_screen, poc_1_notes, poc_2_name, poc_2_email, poc_2_phone_a, poc_2_phone_b, poc_2_cell, poc_2_screen, poc_2_notes) SELECT hostid, inventory_mode, type, type_full, name, alias, os, os_full, os_short, serialno_a, serialno_b, tag, asset_tag, macaddress_a, macaddress_b, hardware, hardware_full, software, software_full, software_app_a, software_app_b, software_app_c, software_app_d, software_app_e, contact, location, location_lat, location_lon, notes, chassis, model, hw_arch, vendor, contract_number, installer_name, deployment_status, url_a, url_b, url_c, host_networks, host_netmask, host_router, oob_ip, oob_netmask, oob_router, date_hw_purchase, date_hw_install, date_hw_expiry, date_hw_decomm, site_address_a, site_address_b, site_address_c, site_city, site_state, site_country, site_zip, site_rack, site_notes, poc_1_name, poc_1_email, poc_1_phone_a, poc_1_phone_b, poc_1_cell, poc_1_screen, poc_1_notes, poc_2_name, poc_2_email, poc_2_phone_a, poc_2_phone_b, poc_2_cell, poc_2_screen, poc_2_notes FROM tmp_zbx_zbx_host_inventory WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_host_inventory WHERE zbx_zbx_host_inventory.hostid=tmp_zbx_zbx_host_inventory.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 20, 'INSERT IGNORE INTO zbx_zbx_items (itemid, type, snmp_oid, hostid, name, key_, delay, history, trends, status, value_type, trapper_hosts, units, logtimefmt, templateid, valuemapid, params, ipmi_sensor, authtype, username, password, publickey, privatekey, flags, interfaceid, description, inventory_link, jmx_endpoint, master_itemid, timeout, url, query_fields, posts, status_codes, follow_redirects, post_type, http_proxy, headers, retrieve_mode, request_method, output_format, ssl_cert_file, ssl_key_file, ssl_key_password, verify_peer, verify_host, allow_traps, state, error) SELECT itemid, type, snmp_oid, hostid, name, key_, delay, history, trends, status, value_type, trapper_hosts, units, logtimefmt, templateid, valuemapid, params, ipmi_sensor, authtype, username, password, publickey, privatekey, flags, interfaceid, description, inventory_link, jmx_endpoint, master_itemid, timeout, url, query_fields, posts, status_codes, follow_redirects, post_type, http_proxy, headers, retrieve_mode, request_method, output_format, ssl_cert_file, ssl_key_file, ssl_key_password, verify_peer, verify_host, allow_traps, state, error FROM tmp_zbx_zbx_items WHERE templateid IS NULL AND master_itemid IS NULL AND NOT EXISTS (SELECT NULL FROM zbx_zbx_items WHERE zbx_zbx_items.itemid=tmp_zbx_zbx_items.itemid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 21, 'INSERT IGNORE INTO zbx_zbx_items (itemid, type, snmp_oid, hostid, name, key_, delay, history, trends, status, value_type, trapper_hosts, units, logtimefmt, templateid, valuemapid, params, ipmi_sensor, authtype, username, password, publickey, privatekey, flags, interfaceid, description, inventory_link, jmx_endpoint, master_itemid, timeout, url, query_fields, posts, status_codes, follow_redirects, post_type, http_proxy, headers, retrieve_mode, request_method, output_format, ssl_cert_file, ssl_key_file, ssl_key_password, verify_peer, verify_host, allow_traps, state, error) SELECT itemid, type, snmp_oid, hostid, name, key_, delay, history, trends, status, value_type, trapper_hosts, units, logtimefmt, templateid, valuemapid, params, ipmi_sensor, authtype, username, password, publickey, privatekey, flags, interfaceid, description, inventory_link, jmx_endpoint, master_itemid, timeout, url, query_fields, posts, status_codes, follow_redirects, post_type, http_proxy, headers, retrieve_mode, request_method, output_format, ssl_cert_file, ssl_key_file, ssl_key_password, verify_peer, verify_host, allow_traps, state, error FROM tmp_zbx_zbx_items WHERE templateid IS NOT NULL AND master_itemid IS NULL AND NOT EXISTS (SELECT NULL FROM zbx_zbx_items WHERE zbx_zbx_items.itemid=tmp_zbx_zbx_items.itemid);', 1);
INSERT INTO code_program_query (programid, stage, priority, nrepeat, query, enabled) VALUES (1201, 4, 22, 4, 'INSERT IGNORE INTO zbx_zbx_items (itemid, type, snmp_oid, hostid, name, key_, delay, history, trends, status, value_type, trapper_hosts, units, logtimefmt, templateid, valuemapid, params, ipmi_sensor, authtype, username, password, publickey, privatekey, flags, interfaceid, description, inventory_link, jmx_endpoint, master_itemid, timeout, url, query_fields, posts, status_codes, follow_redirects, post_type, http_proxy, headers, retrieve_mode, request_method, output_format, ssl_cert_file, ssl_key_file, ssl_key_password, verify_peer, verify_host, allow_traps, state, error) SELECT itemid, type, snmp_oid, hostid, name, key_, delay, history, trends, status, value_type, trapper_hosts, units, logtimefmt, templateid, valuemapid, params, ipmi_sensor, authtype, username, password, publickey, privatekey, flags, interfaceid, description, inventory_link, jmx_endpoint, master_itemid, timeout, url, query_fields, posts, status_codes, follow_redirects, post_type, http_proxy, headers, retrieve_mode, request_method, output_format, ssl_cert_file, ssl_key_file, ssl_key_password, verify_peer, verify_host, allow_traps, state, error FROM tmp_zbx_zbx_items WHERE templateid IS NULL AND master_itemid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_zbx_items WHERE zbx_zbx_items.itemid=tmp_zbx_zbx_items.itemid) AND EXISTS (SELECT NULL FROM zbx_zbx_items WHERE zbx_zbx_items.itemid=tmp_zbx_zbx_items.master_itemid);', 1);
INSERT INTO code_program_query (programid, stage, priority, nrepeat, query, enabled) VALUES (1201, 4, 23, 4, 'INSERT IGNORE INTO zbx_zbx_items (itemid, type, snmp_oid, hostid, name, key_, delay, history, trends, status, value_type, trapper_hosts, units, logtimefmt, templateid, valuemapid, params, ipmi_sensor, authtype, username, password, publickey, privatekey, flags, interfaceid, description, inventory_link, jmx_endpoint, master_itemid, timeout, url, query_fields, posts, status_codes, follow_redirects, post_type, http_proxy, headers, retrieve_mode, request_method, output_format, ssl_cert_file, ssl_key_file, ssl_key_password, verify_peer, verify_host, allow_traps, state, error) SELECT itemid, type, snmp_oid, hostid, name, key_, delay, history, trends, status, value_type, trapper_hosts, units, logtimefmt, templateid, valuemapid, params, ipmi_sensor, authtype, username, password, publickey, privatekey, flags, interfaceid, description, inventory_link, jmx_endpoint, master_itemid, timeout, url, query_fields, posts, status_codes, follow_redirects, post_type, http_proxy, headers, retrieve_mode, request_method, output_format, ssl_cert_file, ssl_key_file, ssl_key_password, verify_peer, verify_host, allow_traps, state, error FROM tmp_zbx_zbx_items WHERE templateid IS NOT NULL AND master_itemid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_zbx_items WHERE zbx_zbx_items.itemid=tmp_zbx_zbx_items.itemid) AND EXISTS (SELECT NULL FROM zbx_zbx_items WHERE zbx_zbx_items.itemid=tmp_zbx_zbx_items.master_itemid) AND EXISTS (SELECT NULL FROM zbx_zbx_items WHERE zbx_zbx_items.itemid=tmp_zbx_zbx_items.templateid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 28, 'INSERT IGNORE INTO zbx_zbx_items (itemid, type, snmp_oid, hostid, name, key_, delay, history, trends, status, value_type, trapper_hosts, units, logtimefmt, templateid, valuemapid, params, ipmi_sensor, authtype, username, password, publickey, privatekey, flags, interfaceid, description, inventory_link, jmx_endpoint, master_itemid, timeout, url, query_fields, posts, status_codes, follow_redirects, post_type, http_proxy, headers, retrieve_mode, request_method, output_format, ssl_cert_file, ssl_key_file, ssl_key_password, verify_peer, verify_host, allow_traps, state, error) SELECT itemid, type, snmp_oid, hostid, name, key_, delay, history, trends, status, value_type, trapper_hosts, units, logtimefmt, templateid, valuemapid, params, ipmi_sensor, authtype, username, password, publickey, privatekey, flags, interfaceid, description, inventory_link, jmx_endpoint, master_itemid, timeout, url, query_fields, posts, status_codes, follow_redirects, post_type, http_proxy, headers, retrieve_mode, request_method, output_format, ssl_cert_file, ssl_key_file, ssl_key_password, verify_peer, verify_host, allow_traps, state, error FROM tmp_zbx_zbx_items WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_items WHERE zbx_zbx_items.itemid=tmp_zbx_zbx_items.itemid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 29, 'INSERT IGNORE INTO zbx_zbx_triggers (triggerid, hostid, expression, description, url, status, value, priority, lastchange, comments, error, templateid, type, state, flags, recovery_mode, recovery_expression, correlation_mode, correlation_tag, manual_close, opdata, event_name) SELECT triggerid, hostid, expression, description, url, status, value, priority, lastchange, comments, error, templateid, type, state, flags, recovery_mode, recovery_expression, correlation_mode, correlation_tag, manual_close, opdata, event_name FROM tmp_zbx_zbx_triggers WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_triggers WHERE zbx_zbx_triggers.triggerid=tmp_zbx_zbx_triggers.triggerid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 30, 'INSERT IGNORE INTO zbx_zbx_history (itemid, clock, ns, value) SELECT itemid, clock, ns, value FROM tmp_zbx_zbx_history WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_history WHERE zbx_zbx_history.itemid=tmp_zbx_zbx_history.itemid AND zbx_zbx_history.clock=tmp_zbx_zbx_history.clock AND zbx_zbx_history.ns=tmp_zbx_zbx_history.ns);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 31, 'INSERT IGNORE INTO zbx_zbx_history_uint (itemid, clock, ns, value) SELECT itemid, clock, ns, value FROM tmp_zbx_zbx_history_uint WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_history_uint WHERE zbx_zbx_history_uint.itemid=tmp_zbx_zbx_history_uint.itemid AND zbx_zbx_history_uint.clock=tmp_zbx_zbx_history_uint.clock AND zbx_zbx_history_uint.ns=tmp_zbx_zbx_history_uint.ns);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 32, 'INSERT IGNORE INTO zbx_zbx_history_str (itemid, clock, ns, value) SELECT itemid, clock, ns, value FROM tmp_zbx_zbx_history_str WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_history_str WHERE zbx_zbx_history_str.itemid=tmp_zbx_zbx_history_str.itemid AND zbx_zbx_history_str.clock=tmp_zbx_zbx_history_str.clock AND zbx_zbx_history_str.ns=tmp_zbx_zbx_history_str.ns);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 33, 'INSERT IGNORE INTO zbx_zbx_history_text (itemid, clock, ns, value) SELECT itemid, clock, ns, value FROM tmp_zbx_zbx_history_text WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_history_text WHERE zbx_zbx_history_text.itemid=tmp_zbx_zbx_history_text.itemid AND zbx_zbx_history_text.clock=tmp_zbx_zbx_history_text.clock AND zbx_zbx_history_text.ns=tmp_zbx_zbx_history_text.ns);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 4, 34, 'INSERT IGNORE INTO zbx_zbx_history_log (itemid, clock, ns, value) SELECT itemid, clock, ns, value FROM tmp_zbx_zbx_history_log WHERE NOT EXISTS (SELECT NULL FROM zbx_zbx_history_log WHERE zbx_zbx_history_log.itemid=tmp_zbx_zbx_history_log.itemid AND zbx_zbx_history_log.clock=tmp_zbx_zbx_history_log.clock AND zbx_zbx_history_log.ns=tmp_zbx_zbx_history_log.ns);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 5, 10, 'UPDATE IGNORE zbx_zbx_proxies INNER JOIN tmp_zbx_zbx_proxies ON zbx_zbx_proxies.proxyid=tmp_zbx_zbx_proxies.proxyid SET zbx_zbx_proxies.proxy=tmp_zbx_zbx_proxies.proxy, zbx_zbx_proxies.name=tmp_zbx_zbx_proxies.name;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 5, 11, 'UPDATE IGNORE zbx_zbx_maintenances INNER JOIN tmp_zbx_zbx_maintenances ON zbx_zbx_maintenances.maintenanceid=tmp_zbx_zbx_maintenances.maintenanceid SET zbx_zbx_maintenances.name=tmp_zbx_zbx_maintenances.name, zbx_zbx_maintenances.maintenance_type=tmp_zbx_zbx_maintenances.maintenance_type, zbx_zbx_maintenances.active_since=tmp_zbx_zbx_maintenances.active_since, zbx_zbx_maintenances.active_till=tmp_zbx_zbx_maintenances.active_till;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 5, 12, 'UPDATE IGNORE zbx_zbx_hosts AS zzh INNER JOIN tmp_zbx_zbx_hosts AS tzzh ON zzh.hostid=tzzh.hostid SET zzh.proxy_hostid=tzzh.proxy_hostid, zzh.host=tzzh.host, zzh.status=tzzh.status, zzh.ipmi_authtype=tzzh.ipmi_authtype, zzh.ipmi_privilege=tzzh.ipmi_privilege, zzh.ipmi_username=tzzh.ipmi_username, zzh.ipmi_password=tzzh.ipmi_password, zzh.maintenanceid=tzzh.maintenanceid, zzh.maintenance_status=tzzh.maintenance_status, zzh.maintenance_type=tzzh.maintenance_type, zzh.maintenance_from=tzzh.maintenance_from, zzh.name=tzzh.name, zzh.flags=tzzh.flags, zzh.description=tzzh.description, zzh.tls_connect=tzzh.tls_connect, zzh.tls_accept=tzzh.tls_accept, zzh.tls_issuer=tzzh.tls_issuer, zzh.tls_subject=tzzh.tls_subject, zzh.lastaccess=tzzh.lastaccess;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 5, 13, 'UPDATE IGNORE zbx_zbx_hstgrp INNER JOIN tmp_zbx_zbx_hstgrp ON zbx_zbx_hstgrp.groupid=tmp_zbx_zbx_hstgrp.groupid SET zbx_zbx_hstgrp.name=tmp_zbx_zbx_hstgrp.name, zbx_zbx_hstgrp.internal=tmp_zbx_zbx_hstgrp.internal, zbx_zbx_hstgrp.flags=tmp_zbx_zbx_hstgrp.flags;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 5, 16, 'UPDATE IGNORE zbx_zbx_interface AS zi INNER JOIN tmp_zbx_zbx_interface AS tzi ON zi.interfaceid=tzi.interfaceid SET zi.hostid=tzi.hostid, zi.main=tzi.main, zi.type=tzi.type, zi.useip=tzi.useip, zi.ip=tzi.ip, zi.dns=tzi.dns, zi.port=tzi.port, zi.available=tzi.available, zi.error=tzi.error, zi.errors_from=tzi.errors_from, zi.disable_until=tzi.disable_until, zi.version=tzi.version, zi.bulk=tzi.bulk, zi.community=tzi.community, zi.securityname=tzi.securityname, zi.securitylevel=tzi.securitylevel, zi.authpassphrase=tzi.authpassphrase, zi.privpassphrase=tzi.privpassphrase, zi.authprotocol=tzi.authprotocol, zi.privprotocol=tzi.privprotocol, zi.contextname=tzi.contextname;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 5, 17, 'UPDATE IGNORE zbx_zbx_hostmacro INNER JOIN tmp_zbx_zbx_hostmacro ON zbx_zbx_hostmacro.hostmacroid=tmp_zbx_zbx_hostmacro.hostmacroid SET zbx_zbx_hostmacro.hostid=tmp_zbx_zbx_hostmacro.hostid, zbx_zbx_hostmacro.macro=tmp_zbx_zbx_hostmacro.macro, zbx_zbx_hostmacro.value=tmp_zbx_zbx_hostmacro.value, zbx_zbx_hostmacro.description=tmp_zbx_zbx_hostmacro.description, zbx_zbx_hostmacro.type=tmp_zbx_zbx_hostmacro.type;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 5, 19, 'UPDATE IGNORE zbx_zbx_host_inventory AS hi INNER JOIN tmp_zbx_zbx_host_inventory AS thi ON hi.hostid=thi.hostid SET hi.inventory_mode=thi.inventory_mode, hi.type=thi.type, hi.type_full=thi.type_full, hi.name=thi.name, hi.alias=thi.alias, hi.os=thi.os, hi.os_full=thi.os_full, hi.os_short=thi.os_short, hi.serialno_a=thi.serialno_a, hi.serialno_b=thi.serialno_b, hi.tag=thi.tag, hi.asset_tag=thi.asset_tag, hi.macaddress_a=thi.macaddress_a, hi.macaddress_b=thi.macaddress_b, hi.hardware=thi.hardware, hi.hardware_full=thi.hardware_full, hi.software=thi.software, hi.software_full=thi.software_full, hi.software_app_a=thi.software_app_a, hi.software_app_b=thi.software_app_b, hi.software_app_c=thi.software_app_c, hi.software_app_d=thi.software_app_d, hi.software_app_e=thi.software_app_e, hi.contact=thi.contact, hi.location=thi.location, hi.location_lat=thi.location_lat, hi.location_lon=thi.location_lon, hi.notes=thi.notes, hi.chassis=thi.chassis, hi.model=thi.model, hi.hw_arch=thi.hw_arch, hi.vendor=thi.vendor, hi.contract_number=thi.contract_number, hi.installer_name=thi.installer_name, hi.deployment_status=thi.deployment_status, hi.url_a=thi.url_a, hi.url_b=thi.url_b, hi.url_c=thi.url_c, hi.host_networks=thi.host_networks, hi.host_netmask=thi.host_netmask, hi.host_router=thi.host_router, hi.oob_ip=thi.oob_ip, hi.oob_netmask=thi.oob_netmask, hi.oob_router=thi.oob_router, hi.date_hw_purchase=thi.date_hw_purchase, hi.date_hw_install=thi.date_hw_install, hi.date_hw_expiry=thi.date_hw_expiry, hi.date_hw_decomm=thi.date_hw_decomm, hi.site_address_a=thi.site_address_a, hi.site_address_b=thi.site_address_b, hi.site_address_c=thi.site_address_c, hi.site_city=thi.site_city, hi.site_state=thi.site_state, hi.site_country=thi.site_country, hi.site_zip=thi.site_zip, hi.site_rack=thi.site_rack, hi.site_notes=thi.site_notes, hi.poc_1_name=thi.poc_1_name, hi.poc_1_email=thi.poc_1_email, hi.poc_1_phone_a=thi.poc_1_phone_a, hi.poc_1_phone_b=thi.poc_1_phone_b, hi.poc_1_cell=thi.poc_1_cell, hi.poc_1_screen=thi.poc_1_screen, hi.poc_1_notes=thi.poc_1_notes, hi.poc_2_name=thi.poc_2_name, hi.poc_2_email=thi.poc_2_email, hi.poc_2_phone_a=thi.poc_2_phone_a, hi.poc_2_phone_b=thi.poc_2_phone_b, hi.poc_2_cell=thi.poc_2_cell, hi.poc_2_screen=thi.poc_2_screen, hi.poc_2_notes=thi.poc_2_notes;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 5, 20, 'UPDATE IGNORE zbx_zbx_items AS zi INNER JOIN tmp_zbx_zbx_items AS tzi ON zi.itemid=tzi.itemid SET zi.type=tzi.type, zi.snmp_oid=tzi.snmp_oid, zi.hostid=tzi.hostid, zi.name=tzi.name, zi.key_=tzi.key_, zi.delay=tzi.delay, zi.history=tzi.history, zi.trends=tzi.trends, zi.status=tzi.status, zi.value_type=tzi.value_type, zi.trapper_hosts=tzi.trapper_hosts, zi.units=tzi.units, zi.logtimefmt=tzi.logtimefmt, zi.templateid=tzi.templateid, zi.valuemapid=tzi.valuemapid, zi.params=tzi.params, zi.ipmi_sensor=tzi.ipmi_sensor, zi.authtype=tzi.authtype, zi.username=tzi.username, zi.password=tzi.password, zi.publickey=tzi.publickey, zi.privatekey=tzi.privatekey, zi.flags=tzi.flags, zi.interfaceid=tzi.interfaceid, zi.description=tzi.description, zi.inventory_link=tzi.inventory_link, zi.jmx_endpoint=tzi.jmx_endpoint, zi.master_itemid=tzi.master_itemid, zi.timeout=tzi.timeout, zi.url=tzi.url, zi.query_fields=tzi.query_fields, zi.posts=tzi.posts, zi.status_codes=tzi.status_codes, zi.follow_redirects=tzi.follow_redirects, zi.post_type=tzi.post_type, zi.http_proxy=tzi.http_proxy, zi.headers=tzi.headers, zi.retrieve_mode=tzi.retrieve_mode, zi.request_method=tzi.request_method, zi.output_format=tzi.output_format, zi.ssl_cert_file=tzi.ssl_cert_file, zi.ssl_key_file=tzi.ssl_key_file, zi.ssl_key_password=tzi.ssl_key_password, zi.verify_peer=tzi.verify_peer, zi.verify_host=tzi.verify_host, zi.allow_traps=tzi.allow_traps, zi.state=tzi.state, zi.error=tzi.error;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 5, 21, 'UPDATE IGNORE zbx_zbx_triggers AS zt INNER JOIN tmp_zbx_zbx_triggers AS tzt ON zt.triggerid=tzt.triggerid SET zt.hostid=tzt.hostid, zt.expression=tzt.expression, zt.description=tzt.description, zt.url=tzt.url, zt.status=tzt.status, zt.value=tzt.value, zt.priority=tzt.priority, zt.lastchange=tzt.lastchange, zt.comments=tzt.comments, zt.error=tzt.error, zt.templateid=tzt.templateid, zt.type=tzt.type, zt.state=tzt.state, zt.flags=tzt.flags, zt.recovery_mode=tzt.recovery_mode, zt.recovery_expression=tzt.recovery_expression, zt.correlation_mode=tzt.correlation_mode, zt.correlation_tag=tzt.correlation_tag, zt.manual_close=tzt.manual_close, zt.opdata=tzt.opdata, zt.event_name=tzt.event_name;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 10, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid LEFT JOIN zbx_zbx_maintenances ON zbx_omni_map.zbxid=zbx_zbx_maintenances.maintenanceid SET zbx_omni_map.zbxid=NULL WHERE zbx_zbx_maintenances.maintenanceid IS NULL AND ref_zbx_omni_map.zbx_table=\'zbx_zbx_maintenances\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 11, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid LEFT JOIN zbx_zbx_hstgrp ON zbx_omni_map.zbxid=zbx_zbx_hstgrp.groupid SET zbx_omni_map.zbxid=NULL WHERE zbx_zbx_hstgrp.groupid IS NULL AND ref_zbx_omni_map.zbx_table=\'zbx_zbx_hstgrp\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 12, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid LEFT JOIN zbx_zbx_hosts ON zbx_omni_map.zbxid=zbx_zbx_hosts.hostid SET zbx_omni_map.zbxid=NULL WHERE zbx_zbx_hosts.hostid IS NULL AND ref_zbx_omni_map.zbx_table=\'zbx_zbx_hosts\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 13, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid LEFT JOIN zbx_zbx_interface ON zbx_omni_map.zbxid=zbx_zbx_interface.interfaceid SET zbx_omni_map.zbxid=NULL WHERE zbx_zbx_interface.interfaceid IS NULL AND ref_zbx_omni_map.zbx_table=\'zbx_zbx_interface\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 14, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid LEFT JOIN zbx_zbx_hostmacro ON zbx_omni_map.zbxid=zbx_zbx_hostmacro.hostmacroid SET zbx_omni_map.zbxid=NULL WHERE zbx_zbx_hostmacro.hostmacroid IS NULL AND ref_zbx_omni_map.zbx_table=\'zbx_zbx_hostmacro\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 29, 'DELETE IGNORE zbx_omni_map FROM zbx_omni_map WHERE omniid IS NULL AND zbxid is NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 30, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_zbx_maintenances ON zbx_omni_map.zbxid=zbx_zbx_maintenances.maintenanceid INNER JOIN zbx_omni_maintenances ON zbx_zbx_maintenances.name=zbx_omni_maintenances.name SET zbx_omni_map.omniid=zbx_omni_maintenances.maintenanceid WHERE ref_zbx_omni_map.zbx_table=\'zbx_zbx_maintenances\' AND zbx_omni_map.omniid IS NULL AND zbx_omni_map.zbxid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.omniid=zbx_omni_maintenances.maintenanceid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 31, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_zbx_hstgrp ON zbx_omni_map.zbxid=zbx_zbx_hstgrp.groupid INNER JOIN zbx_omni_hstgrp ON zbx_zbx_hstgrp.name=zbx_omni_hstgrp.name SET zbx_omni_map.omniid=zbx_omni_hstgrp.groupid WHERE ref_zbx_omni_map.zbx_table=\'zbx_zbx_hstgrp\' AND zbx_omni_map.omniid IS NULL AND zbx_omni_map.zbxid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.omniid=zbx_omni_hstgrp.groupid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 32, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_zbx_hosts ON zbx_omni_map.zbxid=zbx_zbx_hosts.hostid INNER JOIN zbx_omni_hosts ON zbx_zbx_hosts.host=zbx_omni_hosts.host SET zbx_omni_map.omniid=zbx_omni_hosts.hostid WHERE ref_zbx_omni_map.zbx_table=\'zbx_zbx_hosts\' AND zbx_omni_map.omniid IS NULL AND zbx_omni_map.zbxid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.omniid=zbx_omni_hosts.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 33, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_zbx_interface ON zbx_omni_map.zbxid=zbx_zbx_interface.interfaceid INNER JOIN zbx_zbx_hosts ON zbx_zbx_interface.hostid=zbx_zbx_hosts.hostid INNER JOIN zbx_omni_hosts ON zbx_zbx_hosts.host=zbx_omni_hosts.host INNER JOIN zbx_omni_interface ON zbx_omni_hosts.hostid=zbx_omni_interface.hostid AND zbx_zbx_interface.type=zbx_omni_interface.type AND zbx_zbx_interface.main=zbx_omni_interface.main SET zbx_omni_map.omniid=zbx_omni_interface.interfaceid WHERE ref_zbx_omni_map.zbx_table=\'zbx_zbx_interface\' AND zbx_omni_map.omniid IS NULL AND zbx_omni_map.zbxid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.omniid=zbx_omni_interface.interfaceid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 34, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_zbx_hostmacro ON zbx_omni_map.zbxid=zbx_zbx_hostmacro.hostmacroid INNER JOIN zbx_zbx_hosts ON zbx_zbx_hostmacro.hostid=zbx_zbx_hosts.hostid INNER JOIN zbx_omni_hosts ON zbx_zbx_hosts.host=zbx_omni_hosts.host INNER JOIN zbx_omni_hostmacro ON zbx_omni_hosts.hostid=zbx_omni_hostmacro.hostid AND zbx_zbx_hostmacro.macro=zbx_omni_hostmacro.macro SET zbx_omni_map.omniid=zbx_omni_hostmacro.hostmacroid WHERE ref_zbx_omni_map.zbx_table=\'zbx_zbx_hostmacro\' AND zbx_omni_map.omniid IS NULL AND zbx_omni_map.zbxid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.omniid=zbx_omni_hostmacro.hostmacroid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 40, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_omni_maintenances ON zbx_omni_map.omniid=zbx_omni_maintenances.maintenanceid INNER JOIN zbx_zbx_maintenances ON zbx_omni_maintenances.name=zbx_zbx_maintenances.name SET zbx_omni_map.zbxid=zbx_zbx_maintenances.maintenanceid WHERE ref_zbx_omni_map.omni_table=\'zbx_omni_maintenances\' AND zbx_omni_map.zbxid IS NULL AND zbx_omni_map.omniid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.zbxid=zbx_zbx_maintenances.maintenanceid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 41, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_omni_hstgrp ON zbx_omni_map.omniid=zbx_omni_hstgrp.groupid INNER JOIN zbx_zbx_hstgrp ON zbx_omni_hstgrp.name=zbx_zbx_hstgrp.name SET zbx_omni_map.zbxid=zbx_zbx_hstgrp.groupid WHERE ref_zbx_omni_map.omni_table=\'zbx_omni_hstgrp\' AND zbx_omni_map.zbxid IS NULL AND zbx_omni_map.omniid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.zbxid=zbx_zbx_hstgrp.groupid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 42, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_omni_hosts ON zbx_omni_map.omniid=zbx_omni_hosts.hostid INNER JOIN zbx_zbx_hosts ON zbx_omni_hosts.host=zbx_zbx_hosts.host SET zbx_omni_map.zbxid=zbx_zbx_hosts.hostid WHERE ref_zbx_omni_map.omni_table=\'zbx_omni_hosts\' AND zbx_omni_map.zbxid IS NULL AND zbx_omni_map.omniid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.zbxid=zbx_zbx_hosts.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 43, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_omni_interface ON zbx_omni_map.omniid=zbx_omni_interface.interfaceid INNER JOIN zbx_omni_hosts ON zbx_omni_interface.hostid=zbx_omni_hosts.hostid INNER JOIN zbx_zbx_hosts ON zbx_omni_hosts.host=zbx_zbx_hosts.host INNER JOIN zbx_zbx_interface ON zbx_zbx_hosts.hostid=zbx_zbx_interface.hostid AND zbx_omni_interface.type=zbx_zbx_interface.type AND zbx_omni_interface.main=zbx_zbx_interface.main SET zbx_omni_map.zbxid=zbx_zbx_interface.interfaceid WHERE ref_zbx_omni_map.omni_table=\'zbx_omni_interface\' AND zbx_omni_map.zbxid IS NULL AND zbx_omni_map.omniid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.zbxid=zbx_zbx_interface.interfaceid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 44, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_omni_hostmacro ON zbx_omni_map.omniid=zbx_omni_hostmacro.hostmacroid INNER JOIN zbx_omni_hosts ON zbx_omni_hostmacro.hostid=zbx_omni_hosts.hostid INNER JOIN zbx_zbx_hosts ON zbx_omni_hosts.host=zbx_zbx_hosts.host INNER JOIN zbx_zbx_hostmacro ON zbx_zbx_hosts.hostid=zbx_zbx_hostmacro.hostid AND zbx_omni_hostmacro.macro=zbx_zbx_hostmacro.macro SET zbx_omni_map.zbxid=zbx_zbx_hostmacro.hostmacroid WHERE ref_zbx_omni_map.omni_table=\'zbx_omni_hostmacro\' AND zbx_omni_map.zbxid IS NULL AND zbx_omni_map.omniid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.zbxid=zbx_zbx_hostmacro.hostmacroid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1201, 6, 99, 'DELETE IGNORE zbx_omni_hosts FROM zbx_omni_hosts WHERE main_hostid IS NULL AND zbx_groupid IS NULL;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 1, 10, 'CREATE TEMPORARY TABLE tmp_zbx_omni_maintenances (maintenanceid INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT, name VARCHAR(128) NOT NULL UNIQUE, maintenance_type INT NOT NULL DEFAULT 0, active_since INT NOT NULL DEFAULT 0, active_till INT NOT NULL DEFAULT 0, KEY active_since_till (active_since, active_till)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 1, 20, 'CREATE TEMPORARY TABLE tmp_zbx_omni_hstgrp (groupid INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT, name VARCHAR(255) NOT NULL UNIQUE, internal INT NOT NULL DEFAULT 0, flags INT NOT NULL DEFAULT 0, typeid INT UNSIGNED NOT NULL, srcid BIGINT UNSIGNED NOT NULL, UNIQUE KEY typesrc (typeid, srcid), KEY typeid (typeid), KEY srcid (srcid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 1, 30, 'CREATE TEMPORARY TABLE tmp_zbx_omni_hosts (hostid INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT, proxy_hostid BIGINT UNSIGNED DEFAULT NULL, host VARCHAR(128) NOT NULL UNIQUE, status INT NOT NULL, ipmi_authtype INT NOT NULL DEFAULT -1, ipmi_privilege INT NOT NULL DEFAULT 2, ipmi_username VARCHAR(16) NOT NULL DEFAULT \'\', ipmi_password VARCHAR(20) NOT NULL DEFAULT \'\', maintenanceid INT UNSIGNED DEFAULT NULL, maintenance_status INT NOT NULL DEFAULT 0, maintenance_type INT NOT NULL DEFAULT 0, maintenance_from INT NOT NULL DEFAULT 0, name VARCHAR(128) NOT NULL DEFAULT \'\', flags INT NOT NULL DEFAULT 0, description TEXT NOT NULL, tls_connect INT NOT NULL DEFAULT 1, tls_accept INT NOT NULL DEFAULT 1, tls_issuer VARCHAR(1024) NOT NULL DEFAULT \'\', tls_subject VARCHAR(1024) NOT NULL DEFAULT \'\', main_hostid BIGINT DEFAULT NULL UNIQUE, zbx_groupid INT UNSIGNED DEFAULT NULL UNIQUE, techid1 BIGINT UNSIGNED DEFAULT NULL, KEY status (status), KEY proxy_hostid (proxy_hostid), KEY name (name), KEY maintenanceid (maintenanceid), KEY techid1 (techid1)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 1, 40, 'CREATE TEMPORARY TABLE tmp_zbx_omni_hosts_templates (hosttemplateid INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT, hostid INT UNSIGNED NOT NULL, templateid BIGINT UNSIGNED NOT NULL, UNIQUE KEY host_template (hostid, templateid), KEY hostid (hostid), KEY templateid (templateid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 1, 50, 'CREATE TEMPORARY TABLE tmp_zbx_omni_hosts_groups (hostgroupid INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT, hostid INT UNSIGNED NOT NULL, groupid INT UNSIGNED NOT NULL, UNIQUE KEY host_group (hostid, groupid), KEY hostid (hostid), KEY groupid (groupid)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 1, 60, 'CREATE TEMPORARY TABLE tmp_zbx_omni_interface (interfaceid INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT, hostid INT UNSIGNED NOT NULL, main INT NOT NULL DEFAULT 0, type INT NOT NULL DEFAULT 1, useip INT NOT NULL DEFAULT 1, ip VARCHAR(64) NOT NULL DEFAULT \'127.0.0.1\', dns VARCHAR(255) NOT NULL DEFAULT \'\', port VARCHAR(64) NOT NULL DEFAULT \'10050\', available INT NOT NULL DEFAULT 0, error VARCHAR(2048) NOT NULL DEFAULT \'\', errors_from INT NOT NULL DEFAULT 0, disable_until INT NOT NULL DEFAULT 0, version INT DEFAULT NULL, bulk INT DEFAULT NULL, community VARCHAR(50) DEFAULT NULL, securityname VARCHAR(50) DEFAULT NULL, securitylevel INT DEFAULT NULL, authpassphrase VARCHAR(50) DEFAULT NULL, privpassphrase VARCHAR(50) DEFAULT NULL, authprotocol INT DEFAULT NULL, privprotocol INT DEFAULT NULL, contextname VARCHAR(50) DEFAULT NULL, UNIQUE KEY hosttypemain (hostid, type, main), KEY host_type (hostid, type), KEY hostid (hostid), KEY type (type), KEY ip (ip), KEY main (main)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 1, 70, 'CREATE TEMPORARY TABLE tmp_zbx_omni_hostmacro (hostmacroid INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT, hostid INT UNSIGNED NOT NULL, macro VARCHAR(255) NOT NULL DEFAULT \'\', value VARCHAR(2048) DEFAULT NULL, description TEXT NOT NULL, type INT NOT NULL DEFAULT 0, UNIQUE KEY host_macro (hostid, macro), KEY hostid (hostid), KEY macro (macro)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 1, 80, 'CREATE TEMPORARY TABLE tmp_zbx_omni_host_tag (hosttagid INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT, hostid INT UNSIGNED NOT NULL, tag VARCHAR(255) NOT NULL DEFAULT \'\', value VARCHAR(255) NOT NULL DEFAULT \'\', UNIQUE KEY host_tag (hostid, tag), KEY tag_value (tag, value), KEY hostid (hostid), KEY tag (tag)) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 1, 90, 'CREATE TEMPORARY TABLE tmp_zbx_omni_host_inventory (hostid INT UNSIGNED PRIMARY KEY NOT NULL, inventory_mode INT NOT NULL DEFAULT 0, type VARCHAR(64) NOT NULL DEFAULT \'\', type_full VARCHAR(64) NOT NULL DEFAULT \'\', name VARCHAR(128) NOT NULL DEFAULT \'\', alias VARCHAR(128) NOT NULL DEFAULT \'\', os VARCHAR(128) NOT NULL DEFAULT \'\', os_full VARCHAR(255) NOT NULL DEFAULT \'\', os_short VARCHAR(128) NOT NULL DEFAULT \'\', serialno_a VARCHAR(64) NOT NULL DEFAULT \'\', serialno_b VARCHAR(64) NOT NULL DEFAULT \'\', tag VARCHAR(64) NOT NULL DEFAULT \'\', asset_tag VARCHAR(64) NOT NULL DEFAULT \'\', macaddress_a VARCHAR(64) NOT NULL DEFAULT \'\', macaddress_b VARCHAR(64) NOT NULL DEFAULT \'\', hardware VARCHAR(255) NOT NULL DEFAULT \'\', hardware_full TEXT NOT NULL, software VARCHAR(255) NOT NULL DEFAULT \'\', software_full TEXT NOT NULL, software_app_a VARCHAR(64) NOT NULL DEFAULT \'\', software_app_b VARCHAR(64) NOT NULL DEFAULT \'\', software_app_c VARCHAR(64) NOT NULL DEFAULT \'\', software_app_d VARCHAR(64) NOT NULL DEFAULT \'\', software_app_e VARCHAR(64) NOT NULL DEFAULT \'\', contact TEXT NOT NULL, location TEXT NOT NULL, location_lat VARCHAR(16) NOT NULL DEFAULT \'\', location_lon VARCHAR(16) NOT NULL DEFAULT \'\', notes TEXT NOT NULL, chassis VARCHAR(64) NOT NULL DEFAULT \'\', model VARCHAR(64) NOT NULL DEFAULT \'\', hw_arch VARCHAR(32) NOT NULL DEFAULT \'\', vendor VARCHAR(64) NOT NULL DEFAULT \'\', contract_number VARCHAR(64) NOT NULL DEFAULT \'\', installer_name VARCHAR(64) NOT NULL DEFAULT \'\', deployment_status VARCHAR(64) NOT NULL DEFAULT \'\', url_a VARCHAR(255) NOT NULL DEFAULT \'\', url_b VARCHAR(255) NOT NULL DEFAULT \'\', url_c VARCHAR(255) NOT NULL DEFAULT \'\', host_networks TEXT NOT NULL, host_netmask VARCHAR(39) NOT NULL DEFAULT \'\', host_router VARCHAR(39) NOT NULL DEFAULT \'\', oob_ip VARCHAR(39) NOT NULL DEFAULT \'\', oob_netmask VARCHAR(39) NOT NULL DEFAULT \'\', oob_router VARCHAR(39) NOT NULL DEFAULT \'\', date_hw_purchase VARCHAR(64) NOT NULL DEFAULT \'\', date_hw_install VARCHAR(64) NOT NULL DEFAULT \'\', date_hw_expiry VARCHAR(64) NOT NULL DEFAULT \'\', date_hw_decomm VARCHAR(64) NOT NULL DEFAULT \'\', site_address_a VARCHAR(128) NOT NULL DEFAULT \'\', site_address_b VARCHAR(128) NOT NULL DEFAULT \'\', site_address_c VARCHAR(128) NOT NULL DEFAULT \'\', site_city VARCHAR(128) NOT NULL DEFAULT \'\', site_state VARCHAR(64) NOT NULL DEFAULT \'\', site_country VARCHAR(64) NOT NULL DEFAULT \'\', site_zip VARCHAR(64) NOT NULL DEFAULT \'\', site_rack VARCHAR(128) NOT NULL DEFAULT \'\', site_notes TEXT NOT NULL, poc_1_name VARCHAR(128) NOT NULL DEFAULT \'\', poc_1_email VARCHAR(128) NOT NULL DEFAULT \'\', poc_1_phone_a VARCHAR(64) NOT NULL DEFAULT \'\', poc_1_phone_b VARCHAR(64) NOT NULL DEFAULT \'\', poc_1_cell VARCHAR(64) NOT NULL DEFAULT \'\', poc_1_screen VARCHAR(64) NOT NULL DEFAULT \'\', poc_1_notes TEXT NOT NULL, poc_2_name VARCHAR(128) NOT NULL DEFAULT \'\', poc_2_email VARCHAR(128) NOT NULL DEFAULT \'\', poc_2_phone_a VARCHAR(64) NOT NULL DEFAULT \'\', poc_2_phone_b VARCHAR(64) NOT NULL DEFAULT \'\', poc_2_cell VARCHAR(64) NOT NULL DEFAULT \'\', poc_2_screen VARCHAR(64) NOT NULL DEFAULT \'\', poc_2_notes TEXT NOT NULL) ENGINE=InnoDB;', 1);
INSERT INTO code_program_query (programid, stage, priority, enabled, query) VALUES (1203, 1, 100, 1, 'CREATE TEMPORARY TABLE tmp_intid (id INT NOT NULL PRIMARY KEY);');
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 2, 10, 'INSERT IGNORE INTO ref_site_info (siteid, zbx_proxy) SELECT siteid, \'proxy\' FROM ref_site WHERE NOT EXISTS (SELECT NULL FROM ref_site_info WHERE ref_site_info.siteid=ref_site.siteid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 2, 11, 'UPDATE IGNORE ref_site_info SET zbx_proxy=\'proxy\' WHERE zbx_proxy IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 3, 10, 'INSERT IGNORE INTO tmp_zbx_omni_maintenances (name, maintenance_type, active_since, active_till) VALUES (\'omnissiah_notfound\', 0, 0, (POWER(2,31)-1) DIV 60 *60);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 3, 11, 'UPDATE IGNORE tmp_zbx_omni_maintenances INNER JOIN zbx_zbx_maintenances ON tmp_zbx_omni_maintenances.name=zbx_zbx_maintenances.name SET tmp_zbx_omni_maintenances.active_since=zbx_zbx_maintenances.active_since;', 1);
INSERT INTO code_program_query (programid, stage, priority, parameter, tablename, query, enabled) VALUES (1203, 3, 20, 'zbx_host_keep_inactive', '', 'INSERT IGNORE INTO tmp_zbx_omni_hosts (host, status, name, flags, description, main_hostid, zbx_groupid) SELECT CONCAT(ref_host_idtype.idtype,\'-\',main_host.hostuuid), 0, \'\', 0, \'\', main_host.hostid, NULL FROM main_host INNER JOIN ref_host_idtype ON main_host.idtype=ref_host_idtype.id WHERE DATEDIFF(NOW(), main_host.last_active)<={0};', 1);
INSERT INTO code_program_query (programid, stage, priority, parameter, tablename, query, enabled) VALUES (1203, 3, 21, 'zbx_host_keep_enabled', '', 'UPDATE IGNORE tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid SET tmp_zbx_omni_hosts.status=1 WHERE DATEDIFF(NOW(), main_host.last_active)>{0};', 1);
INSERT INTO code_program_query (programid, stage, priority, parameter, tablename, query, enabled) VALUES (1203, 3, 22, 'zbx_host_keep_monitored', '', 'UPDATE IGNORE tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN tmp_zbx_omni_maintenances ON tmp_zbx_omni_maintenances.name=\'omnissiah_notfound\' SET tmp_zbx_omni_hosts.maintenanceid=tmp_zbx_omni_maintenances.maintenanceid, tmp_zbx_omni_hosts.maintenance_status=1, tmp_zbx_omni_hosts.maintenance_type=tmp_zbx_omni_maintenances.maintenance_type, tmp_zbx_omni_hosts.maintenance_from=UNIX_TIMESTAMP() WHERE tmp_zbx_omni_hosts.status=0 AND DATEDIFF(NOW(), main_host.last_active)>{0};', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 3, 23, 'UPDATE tmp_zbx_omni_hosts SET proxy_hostid=zbx_zbx_proxies.proxyid FROM main_host INNER JOIN ref_site_info ON main_host.siteid=ref_site_info.siteid INNER JOIN zbx_zbx_proxies ON ref_site_info.zbx_proxy=zbx_zbx_proxies.proxy WHERE tmp_zbx_omni_hosts.main_hostid=main_host.hostid AND tmp_zbx_omni_hosts.proxy_hostid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 3, 24, 'UPDATE IGNORE tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_site_info ON main_host.siteid=ref_site_info.siteid INNER JOIN zbx_zbx_proxies ON ref_site_info.zbx_proxy=zbx_zbx_proxies.name SET tmp_zbx_omni_hosts.proxy_hostid=zbx_zbx_proxies.proxyid WHERE tmp_zbx_omni_hosts.proxy_hostid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 3, 30, 'UPDATE IGNORE tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_devicetype ON main_host.devicetypeid=ref_devicetype.devicetypeid SET tmp_zbx_omni_hosts.name=ref_devicetype.model, tmp_zbx_omni_hosts.techid1=ref_devicetype.parentid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled, nrepeat) VALUES (1203, 3, 31, 'UPDATE IGNORE tmp_zbx_omni_hosts INNER JOIN ref_devicetype ON tmp_zbx_omni_hosts.techid1=ref_devicetype.devicetypeid SET tmp_zbx_omni_hosts.name=CONCAT(ref_devicetype.model, \'/\', tmp_zbx_omni_hosts.name), tmp_zbx_omni_hosts.techid1=ref_devicetype.parentid WHERE tmp_zbx_omni_hosts.techid1 IS NOT NULL AND tmp_zbx_omni_hosts.techid1<>0;', 1, 10);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 3, 37, 'UPDATE IGNORE tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_host_idtype ON main_host.idtype=ref_host_idtype.id SET tmp_zbx_omni_hosts.name=LEFT(CONCAT(tmp_zbx_omni_hosts.name, \' \', main_host.name), 128) WHERE main_host.name IS NOT NULL AND main_host.name<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 3, 38, 'UPDATE IGNORE tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_host_idtype ON main_host.idtype=ref_host_idtype.id SET tmp_zbx_omni_hosts.name=LEFT(CONCAT(tmp_zbx_omni_hosts.name, \' \', main_host.hostname), 128) WHERE (main_host.name IS NULL OR main_host.name=\'\') AND main_host.hostname IS NOT NULL AND main_host.hostname<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 3, 39, 'UPDATE IGNORE tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_host_idtype ON main_host.idtype=ref_host_idtype.id SET tmp_zbx_omni_hosts.name=LEFT(CONCAT(tmp_zbx_omni_hosts.name, \' (\', ref_host_idtype.idtype, \'-\', main_host.hostuuid, \')\'), 128);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 3, 40, 'UPDATE IGNORE tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid SET tmp_zbx_omni_hosts.description=CONCAT(\'Created \', DATE_FORMAT(main_host.created, \'%Y%m%d-%H%i%s\'), \'\\\n\');', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 4, 10, 'INSERT IGNORE INTO tmp_zbx_omni_hosts_groups (hostid, groupid) SELECT tmp_zbx_omni_hosts.hostid, tmp_zbx_omni_hstgrp.groupid FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN tmp_zbx_omni_hstgrp ON main_host.devicetypeid=tmp_zbx_omni_hstgrp.srcid INNER JOIN ref_zbx_group ON tmp_zbx_omni_hstgrp.typeid=ref_zbx_group.groupid WHERE ref_zbx_group.table_name=\'ref_devicetype\' AND ref_zbx_group.id_field=\'devicetypeid\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 4, 11, 'INSERT IGNORE INTO tmp_zbx_omni_hosts_groups (hostid, groupid) SELECT tmp_zbx_omni_hosts.hostid, tmp_zbx_omni_hstgrp.groupid FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN tmp_zbx_omni_hstgrp ON main_host.manufacturerid=tmp_zbx_omni_hstgrp.srcid INNER JOIN ref_zbx_group ON tmp_zbx_omni_hstgrp.typeid=ref_zbx_group.groupid WHERE ref_zbx_group.table_name=\'ref_manufacturer\' AND ref_zbx_group.id_field=\'manufacturerid\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 4, 12, 'INSERT IGNORE INTO tmp_zbx_omni_hosts_groups (hostid, groupid) SELECT tmp_zbx_omni_hosts.hostid, tmp_zbx_omni_hstgrp.groupid FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_site ON main_host.siteid=ref_site.siteid INNER JOIN ref_region ON ref_site.regionid=ref_region.regionid INNER JOIN tmp_zbx_omni_hstgrp ON ref_region.regionid=tmp_zbx_omni_hstgrp.srcid INNER JOIN ref_zbx_group ON tmp_zbx_omni_hstgrp.typeid=ref_zbx_group.groupid WHERE ref_zbx_group.table_name=\'ref_region\' AND ref_zbx_group.id_field=\'regionid\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 4, 13, 'INSERT IGNORE INTO tmp_zbx_omni_hosts_groups (hostid, groupid) SELECT tmp_zbx_omni_hosts.hostid, tmp_zbx_omni_hstgrp.groupid FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN tmp_zbx_omni_hstgrp ON main_host.siteid=tmp_zbx_omni_hstgrp.srcid INNER JOIN ref_zbx_group ON tmp_zbx_omni_hstgrp.typeid=ref_zbx_group.groupid WHERE ref_zbx_group.table_name=\'ref_site\' AND ref_zbx_group.id_field=\'siteid\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 4, 14, 'INSERT IGNORE INTO tmp_zbx_omni_hosts_groups (hostid, groupid) SELECT tmp_zbx_omni_hosts.hostid, tmp_zbx_omni_hstgrp.groupid FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_site ON main_host.siteid=ref_site.siteid INNER JOIN ref_tenant ON ref_site.tenantid=ref_tenant.tenantid INNER JOIN tmp_zbx_omni_hstgrp ON ref_tenant.tenantid=tmp_zbx_omni_hstgrp.srcid INNER JOIN ref_zbx_group ON tmp_zbx_omni_hstgrp.typeid=ref_zbx_group.groupid WHERE ref_zbx_group.table_name=\'ref_tenant\' AND ref_zbx_group.id_field=\'tenantid\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 4, 20, 'TRUNCATE TABLE tmp_intid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 4, 21, 'INSERT IGNORE INTO tmp_intid (id) SELECT DISTINCT groupid FROM tmp_zbx_omni_hosts_groups;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled, nrepeat) VALUES (1203, 4, 22, 'INSERT IGNORE INTO tmp_intid (id) SELECT tmp_zbx_omni_hstgrp.groupid FROM tmp_zbx_omni_hstgrp INNER JOIN tmp_zbx_omni_hstgrp AS tzoh ON tmp_zbx_omni_hstgrp.name=LEFT(tzoh.name, LENGTH(tmp_zbx_omni_hstgrp.name)) WHERE NOT EXISTS (SELECT NULL FROM tmp_intid WHERE tmp_intid.id=tmp_zbx_omni_hstgrp.groupid) AND LENGTH(tmp_zbx_omni_hstgrp.name)<LENGTH(tzoh.name) AND EXISTS (SELECT NULL FROM tmp_intid WHERE tmp_intid.id=tzoh.groupid);', 1, 10);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 4, 23, 'DELETE IGNORE tmp_zbx_omni_hstgrp FROM tmp_zbx_omni_hstgrp WHERE typeid NOT IN (0,6) AND NOT EXISTS (SELECT NULL FROM tmp_intid WHERE tmp_intid.id=tmp_zbx_omni_hstgrp.groupid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 4, 30, 'INSERT IGNORE INTO tmp_zbx_omni_hosts (proxy_hostid, host, status, name, flags, description, main_hostid, zbx_groupid) SELECT NULL, CONCAT(ref_zbx_group.name, \'-\', CAST(tmp_zbx_omni_hstgrp.srcid AS CHAR)), 0, tmp_zbx_omni_hstgrp.name, 0, \'\', NULL, tmp_zbx_omni_hstgrp.groupid FROM tmp_zbx_omni_hstgrp INNER JOIN ref_zbx_group ON tmp_zbx_omni_hstgrp.typeid=ref_zbx_group.groupid WHERE tmp_zbx_omni_hstgrp.typeid NOT IN (0,6);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 4, 31, 'UPDATE IGNORE tmp_zbx_omni_hosts INNER JOIN (SELECT tmp_zbx_omni_hosts.zbx_groupid, MIN(tmp_zbx_omni_hosts.status) AS minstatus FROM tmp_zbx_omni_hosts_groups INNER JOIN tmp_zbx_omni_hosts ON tmp_zbx_omni_hosts_groups.hostid=tmp_zbx_omni_hosts.hostid GROUP BY tmp_zbx_omni_hosts.zbx_groupid) AS tzohg ON tmp_zbx_omni_hosts.zbx_groupid=tzohg.zbx_groupid SET tmp_zbx_omni_hosts.status=tzohg.minstatus WHERE tmp_zbx_omni_hosts.zbx_groupid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 4, 32, 'UPDATE IGNORE tmp_zbx_omni_hosts INNER JOIN (SELECT tmp_zbx_omni_hosts.zbx_groupid, MIN(IFNULL(tmp_zbx_omni_hosts.maintenanceid, 0)) AS minmaintenanceid FROM tmp_zbx_omni_hosts_groups INNER JOIN tmp_zbx_omni_hosts ON tmp_zbx_omni_hosts_groups.hostid=tmp_zbx_omni_hosts.hostid GROUP BY tmp_zbx_omni_hosts.zbx_groupid) AS tzohg ON tmp_zbx_omni_hosts.zbx_groupid=tzohg.zbx_groupid INNER JOIN zbx_omni_maintenances ON zbx_omni_maintenances.name=\'omnissiah_notfound\' SET tmp_zbx_omni_hosts.maintenanceid=zbx_omni_maintenances.maintenanceid, tmp_zbx_omni_hosts.maintenance_status=1, tmp_zbx_omni_hosts.maintenance_type=zbx_omni_maintenances.maintenance_type, tmp_zbx_omni_hosts.maintenance_from=UNIX_TIMESTAMP() WHERE tmp_zbx_omni_hosts.zbx_groupid IS NOT NULL AND tzohg.minmaintenanceid>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 4, 40, 'UPDATE IGNORE tmp_zbx_omni_hosts INNER JOIN zbx_omni_hstgrp ON tmp_zbx_omni_hosts.zbx_groupid=zbx_omni_hstgrp.groupid INNER JOIN ref_zbx_group ON zbx_omni_hstgrp.typeid=ref_zbx_group.groupid SET tmp_zbx_omni_hosts.description=CONCAT(\'Table-\', ref_zbx_group.table_name, \', id field-\', ref_zbx_group.id_field, \', name field-\', ref_zbx_group.field_name, \'\\\n\') WHERE tmp_zbx_omni_hosts.zbx_groupid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 4, 50, 'INSERT IGNORE INTO tmp_zbx_omni_hosts_groups (hostid, groupid) SELECT tmp_zbx_omni_hosts.hostid, tzoh.groupid FROM tmp_zbx_omni_hosts INNER JOIN ref_zbx_group ON ref_zbx_group.name=\'statistic\' INNER JOIN tmp_zbx_omni_hstgrp ON tmp_zbx_omni_hosts.zbx_groupid=tmp_zbx_omni_hstgrp.groupid INNER JOIN tmp_zbx_omni_hstgrp AS tzoh ON tzoh.typeid=ref_zbx_group.groupid AND tmp_zbx_omni_hstgrp.typeid=tzoh.srcid WHERE tmp_zbx_omni_hosts.zbx_groupid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 5, 10, 'INSERT IGNORE INTO tmp_zbx_omni_hosts_templates (hostid, templateid) SELECT tmp_zbx_omni_hosts.hostid, zbx_zbx_hosts.hostid FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_zbx_device_template ON main_host.devicetypeid=ref_zbx_device_template.devicetypeid INNER JOIN zbx_zbx_hosts ON zbx_zbx_hosts.host=ref_zbx_device_template.template WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM tmp_zbx_omni_hosts_templates WHERE tmp_zbx_omni_hosts_templates.hostid=tmp_zbx_omni_hosts.hostid) AND zbx_zbx_hosts.status=3;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 5, 11, 'INSERT IGNORE INTO tmp_zbx_omni_hosts_templates (hostid, templateid) SELECT tmp_zbx_omni_hosts.hostid, zbx_zbx_hosts.hostid FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_zbx_device_template ON main_host.devicetypeid=ref_zbx_device_template.devicetypeid INNER JOIN zbx_zbx_hosts ON zbx_zbx_hosts.name=ref_zbx_device_template.template WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM tmp_zbx_omni_hosts_templates WHERE tmp_zbx_omni_hosts_templates.hostid=tmp_zbx_omni_hosts.hostid) AND zbx_zbx_hosts.status=3;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 5, 12, 'INSERT IGNORE INTO tmp_zbx_omni_hosts_templates (hostid, templateid) SELECT tmp_zbx_omni_hosts.hostid, zbx_zbx_hosts.hostid FROM tmp_zbx_omni_hosts INNER JOIN tmp_zbx_omni_hstgrp ON tmp_zbx_omni_hosts.zbx_groupid=tmp_zbx_omni_hstgrp.groupid INNER JOIN ref_zbx_group_template ON tmp_zbx_omni_hstgrp.typeid=ref_zbx_group_template.groupid INNER JOIN zbx_zbx_hosts ON zbx_zbx_hosts.host=ref_zbx_group_template.template WHERE tmp_zbx_omni_hosts.zbx_groupid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM tmp_zbx_omni_hosts_templates WHERE tmp_zbx_omni_hosts_templates.hostid=tmp_zbx_omni_hosts.hostid) AND zbx_zbx_hosts.status=3;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 5, 13, 'INSERT IGNORE INTO tmp_zbx_omni_hosts_templates (hostid, templateid) SELECT tmp_zbx_omni_hosts.hostid, zbx_zbx_hosts.hostid FROM tmp_zbx_omni_hosts INNER JOIN tmp_zbx_omni_hstgrp ON tmp_zbx_omni_hosts.zbx_groupid=tmp_zbx_omni_hstgrp.groupid INNER JOIN ref_zbx_group_template ON tmp_zbx_omni_hstgrp.typeid=ref_zbx_group_template.groupid INNER JOIN zbx_zbx_hosts ON zbx_zbx_hosts.name=ref_zbx_group_template.template WHERE tmp_zbx_omni_hosts.zbx_groupid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM tmp_zbx_omni_hosts_templates WHERE tmp_zbx_omni_hosts_templates.hostid=tmp_zbx_omni_hosts.hostid) AND zbx_zbx_hosts.status=3;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 5, 14, 'UPDATE IGNORE tmp_zbx_omni_hosts SET techid1=NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 5, 15, 'UPDATE IGNORE tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_devicetype ON main_host.devicetypeid=ref_devicetype.devicetypeid SET tmp_zbx_omni_hosts.techid1=ref_devicetype.parentid WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM tmp_zbx_omni_hosts_templates WHERE tmp_zbx_omni_hosts_templates.hostid=tmp_zbx_omni_hosts.hostid) AND ref_devicetype.parentid IS NOT NULL AND ref_devicetype.parentid<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled, nrepeat) VALUES (1203, 5, 16, 'UPDATE IGNORE tmp_zbx_omni_hosts INNER JOIN ref_devicetype ON tmp_zbx_omni_hosts.techid1=ref_devicetype.devicetypeid LEFT JOIN ref_zbx_device_template ON tmp_zbx_omni_hosts.techid1=ref_zbx_device_template.devicetypeid LEFT JOIN zbx_zbx_hosts ON zbx_zbx_hosts.host=ref_zbx_device_template.template SET tmp_zbx_omni_hosts.techid1=ref_devicetype.parentid WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND tmp_zbx_omni_hosts.techid1 IS NOT NULL AND tmp_zbx_omni_hosts.techid1<>0 AND (zbx_zbx_hosts.hostid IS NULL OR zbx_zbx_hosts.status<>3);', 1, 10);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 5, 17, 'INSERT IGNORE INTO tmp_zbx_omni_hosts_templates (hostid, templateid) SELECT tmp_zbx_omni_hosts.hostid, zbx_zbx_hosts.hostid FROM tmp_zbx_omni_hosts INNER JOIN ref_zbx_device_template ON tmp_zbx_omni_hosts.techid1=ref_zbx_device_template.devicetypeid INNER JOIN zbx_zbx_hosts ON zbx_zbx_hosts.host=ref_zbx_device_template.template WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND tmp_zbx_omni_hosts.techid1 IS NOT NULL AND tmp_zbx_omni_hosts.techid1<>0 AND zbx_zbx_hosts.status=3;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 5, 18, 'UPDATE IGNORE tmp_zbx_omni_hosts SET techid1=NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 5, 19, 'UPDATE IGNORE tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_devicetype ON main_host.devicetypeid=ref_devicetype.devicetypeid SET tmp_zbx_omni_hosts.techid1=ref_devicetype.parentid WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM tmp_zbx_omni_hosts_templates WHERE tmp_zbx_omni_hosts_templates.hostid=tmp_zbx_omni_hosts.hostid) AND ref_devicetype.parentid IS NOT NULL AND ref_devicetype.parentid<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled, nrepeat) VALUES (1203, 5, 20, 'UPDATE IGNORE tmp_zbx_omni_hosts INNER JOIN ref_devicetype ON tmp_zbx_omni_hosts.techid1=ref_devicetype.devicetypeid LEFT JOIN ref_zbx_device_template ON tmp_zbx_omni_hosts.techid1=ref_zbx_device_template.devicetypeid LEFT JOIN zbx_zbx_hosts ON zbx_zbx_hosts.name=ref_zbx_device_template.template SET tmp_zbx_omni_hosts.techid1=ref_devicetype.parentid WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND tmp_zbx_omni_hosts.techid1 IS NOT NULL AND tmp_zbx_omni_hosts.techid1<>0 AND (zbx_zbx_hosts.hostid IS NULL OR zbx_zbx_hosts.status<>3);', 1, 10);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 5, 21, 'INSERT IGNORE INTO tmp_zbx_omni_hosts_templates (hostid, templateid) SELECT tmp_zbx_omni_hosts.hostid, zbx_zbx_hosts.hostid FROM tmp_zbx_omni_hosts INNER JOIN ref_zbx_device_template ON tmp_zbx_omni_hosts.techid1=ref_zbx_device_template.devicetypeid INNER JOIN zbx_zbx_hosts ON zbx_zbx_hosts.name=ref_zbx_device_template.template WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND tmp_zbx_omni_hosts.techid1 IS NOT NULL AND tmp_zbx_omni_hosts.techid1<>0 AND zbx_zbx_hosts.status=3;', 1);
INSERT INTO code_program_query (programid, stage, priority, parameter, tablename, query, enabled) VALUES (1203, 5, 26, 'zbx_device_host_template', '', 'INSERT IGNORE INTO tmp_zbx_omni_hosts_templates (hostid, templateid) SELECT tmp_zbx_omni_hosts.hostid, zbx_zbx_hosts.hostid FROM tmp_zbx_omni_hosts INNER JOIN zbx_zbx_hosts ON zbx_zbx_hosts.host=\'{0}\' WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM tmp_zbx_omni_hosts_templates WHERE tmp_zbx_omni_hosts_templates.hostid=tmp_zbx_omni_hosts.hostid) AND zbx_zbx_hosts.status=3;', 1);
INSERT INTO code_program_query (programid, stage, priority, parameter, tablename, query, enabled) VALUES (1203, 5, 27, 'zbx_device_host_template', '', 'INSERT IGNORE INTO tmp_zbx_omni_hosts_templates (hostid, templateid) SELECT tmp_zbx_omni_hosts.hostid, zbx_zbx_hosts.hostid FROM tmp_zbx_omni_hosts INNER JOIN zbx_zbx_hosts ON zbx_zbx_hosts.name=\'{0}\' WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM tmp_zbx_omni_hosts_templates WHERE tmp_zbx_omni_hosts_templates.hostid=tmp_zbx_omni_hosts.hostid) AND zbx_zbx_hosts.status=3;', 1);
INSERT INTO code_program_query (programid, stage, priority,parameter, tablename,  query, enabled) VALUES (1203, 5, 28, 'zbx_group_host_template', '', 'INSERT IGNORE INTO tmp_zbx_omni_hosts_templates (hostid, templateid) SELECT tmp_zbx_omni_hosts.hostid, zbx_zbx_hosts.hostid FROM tmp_zbx_omni_hosts INNER JOIN zbx_zbx_hosts ON zbx_zbx_hosts.host=\'{0}\' WHERE tmp_zbx_omni_hosts.zbx_groupid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM tmp_zbx_omni_hosts_templates WHERE tmp_zbx_omni_hosts_templates.hostid=tmp_zbx_omni_hosts.hostid) AND zbx_zbx_hosts.status=3;', 1);
INSERT INTO code_program_query (programid, stage, priority,parameter, tablename,  query, enabled) VALUES (1203, 5, 29, 'zbx_group_host_template', '', 'INSERT IGNORE INTO tmp_zbx_omni_hosts_templates (hostid, templateid) SELECT tmp_zbx_omni_hosts.hostid, zbx_zbx_hosts.hostid FROM tmp_zbx_omni_hosts INNER JOIN zbx_zbx_hosts ON zbx_zbx_hosts.name=\'{0}\' WHERE tmp_zbx_omni_hosts.zbx_groupid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM tmp_zbx_omni_hosts_templates WHERE tmp_zbx_omni_hosts_templates.hostid=tmp_zbx_omni_hosts.hostid) AND zbx_zbx_hosts.status=3;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 6, 10, 'INSERT IGNORE INTO tmp_zbx_omni_interface (hostid, main, useip, ip, dns, port, available, type) SELECT tmp_zbx_omni_hosts.hostid, 1, 1, main_host.ip, \'\', \'\', 1, 2 FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND main_host.controllerid IS NULL AND main_host.ip IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 6, 11, 'INSERT IGNORE INTO tmp_zbx_omni_interface (hostid, main, useip, ip, dns, port, available, type) SELECT tmp_zbx_omni_hosts.hostid, 1, 1, mh.ip, \'\', \'\', 1, 2 FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN main_host AS mh ON main_host.controllerid=mh.hostid WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND main_host.controllerid IS NOT NULL AND mh.ip IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 6, 12, 'INSERT IGNORE INTO tmp_zbx_omni_interface (hostid, main, useip, ip, dns, port, available, type) SELECT tmp_zbx_omni_hosts.hostid, 0, 1, main_host.ip, \'\', \'\', 1, 2 FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND main_host.controllerid IS NOT NULL AND main_host.ip IS NOT NULL AND EXISTS (SELECT NULL FROM tmp_zbx_omni_interface WHERE tmp_zbx_omni_interface.hostid=tmp_zbx_omni_hosts.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 6, 13, 'INSERT IGNORE INTO tmp_zbx_omni_interface (hostid, main, useip, ip, dns, port, available, type) SELECT tmp_zbx_omni_hosts.hostid, 1, 1, main_host.ip, \'\', \'\', 1, 2 FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND main_host.controllerid IS NOT NULL AND main_host.ip IS NOT NULL AND NOT EXISTS (SELECT NULL FROM tmp_zbx_omni_interface WHERE tmp_zbx_omni_interface.hostid=tmp_zbx_omni_hosts.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 6, 20, 'UPDATE IGNORE tmp_zbx_omni_interface INNER JOIN tmp_zbx_omni_hosts_templates ON tmp_zbx_omni_interface.hostid=tmp_zbx_omni_hosts_templates.hostid INNER JOIN zbx_zbx_hosts ON tmp_zbx_omni_hosts_templates.templateid=zbx_zbx_hosts.hostid INNER JOIN ref_zbx_device_template ON zbx_zbx_hosts.name=ref_zbx_device_template.template SET tmp_zbx_omni_interface.type=ref_zbx_device_template.type;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 6, 21, 'UPDATE IGNORE tmp_zbx_omni_interface SET port=\'10050\' WHERE type=1;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 6, 22, 'UPDATE IGNORE tmp_zbx_omni_interface SET port=\'161\' WHERE type=2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 6, 23, 'UPDATE IGNORE tmp_zbx_omni_interface SET port=\'623\' WHERE type=3;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 6, 24, 'UPDATE IGNORE tmp_zbx_omni_interface SET port=\'12345\' WHERE type=4;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 6, 25, 'UPDATE IGNORE tmp_zbx_omni_interface SET version=2, bulk=1, community=\'{$SNMP_COMMUNITY}\' WHERE type=2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 6, 26, 'UPDATE IGNORE tmp_zbx_omni_interface INNER JOIN tmp_zbx_omni_hosts_templates ON tmp_zbx_omni_interface.hostid=tmp_zbx_omni_hosts_templates.hostid INNER JOIN zbx_zbx_hosts ON tmp_zbx_omni_hosts_templates.templateid=zbx_zbx_hosts.hostid INNER JOIN ref_zbx_device_template ON zbx_zbx_hosts.name=ref_zbx_device_template.template SET tmp_zbx_omni_interface.version=ref_zbx_device_template.version, tmp_zbx_omni_interface.bulk=ref_zbx_device_template.bulk WHERE tmp_zbx_omni_interface.type=2;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 7, 10, 'INSERT IGNORE INTO tmp_zbx_omni_hostmacro (hostid, type, macro, value, description) SELECT tmp_zbx_omni_hosts.hostid, 0, ref_zbx_macro.macro, main_host.mac, \'Device MAC address\' FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_zbx_macro ON ref_zbx_macro.name=\'mac\' WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND main_host.mac IS NOT NULL AND main_host.mac<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 7, 11, 'INSERT IGNORE INTO tmp_zbx_omni_hostmacro (hostid, type, macro, value, description) SELECT tmp_zbx_omni_hosts.hostid, 0, ref_zbx_macro.macro, main_host.snmp_community, \'SNMP community string\' FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_zbx_macro ON ref_zbx_macro.name=\'snmp_community\' WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND main_host.snmp_community IS NOT NULL AND main_host.snmp_community<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 7, 12, 'INSERT IGNORE INTO tmp_zbx_omni_hostmacro (hostid, type, macro, value, description) SELECT tmp_zbx_omni_hosts.hostid, 0, ref_zbx_macro.macro, main_host.vlan, \'Device VLAN number\' FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_zbx_macro ON ref_zbx_macro.name=\'vlan\' WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND main_host.vlan<>0;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 7, 13, 'INSERT IGNORE INTO tmp_zbx_omni_hostmacro (hostid, type, macro, value, description) SELECT tmp_zbx_omni_hosts.hostid, 0, ref_zbx_macro.macro, main_host.idoncontroller, \'Device id (maybe MAC address) on controller device\' FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_zbx_macro ON ref_zbx_macro.name=\'idoncontroller\' WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND main_host.idoncontroller IS NOT NULL AND main_host.idoncontroller<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 7, 14, 'INSERT IGNORE INTO tmp_zbx_omni_hostmacro (hostid, type, macro, value, description) SELECT tmp_zbx_omni_hosts.hostid, 0, ref_zbx_macro.macro, ref_site.site, \'Device site\' FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_site ON main_host.siteid=ref_site.siteid INNER JOIN ref_zbx_macro ON ref_zbx_macro.name=\'site\' WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 7, 15, 'INSERT IGNORE INTO tmp_zbx_omni_hostmacro (hostid, type, macro, value, description) SELECT tmp_zbx_omni_hosts.hostid, 0, ref_zbx_macro.macro, ref_subnet_role.subnet_role, \'VLAN/subnet role\' FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_subnet_role ON main_host.roleid=ref_subnet_role.subnet_roleid INNER JOIN ref_zbx_macro ON ref_zbx_macro.name=\'subnet_role\' WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 7, 16, 'INSERT IGNORE INTO tmp_zbx_omni_hostmacro (hostid, type, macro, value, description) SELECT tmp_zbx_omni_hosts.hostid, 0, ref_zbx_macro.macro, main_host.hostuuid, \'Enplud edu id\' FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_host_idtype ON main_host.idtype=ref_host_idtype.id INNER JOIN ref_zbx_macro ON ref_zbx_macro.name=\'enplugid\' WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND ref_host_idtype.idtype=\'enplug_eduid\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 7, 17, 'INSERT IGNORE INTO tmp_zbx_omni_hostmacro (hostid, type, macro, value, description) SELECT tmp_zbx_omni_hosts.hostid, 0, ref_zbx_macro.macro, main_host.hostuuid, \'Activaire device id\' FROM tmp_zbx_omni_hosts INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_host_idtype ON main_host.idtype=ref_host_idtype.id INNER JOIN ref_zbx_macro ON ref_zbx_macro.name=\'activaireid\' WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND ref_host_idtype.idtype=\'activaire_uuid\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 7, 18, 'INSERT IGNORE INTO tmp_zbx_omni_hostmacro (hostid, type, macro, value, description) SELECT tmp_zbx_omni_hosts.hostid, 0, ref_zbx_macro.macro, RIGHT(tmp_zbx_omni_hstgrp.name, LENGTH(tmp_zbx_omni_hstgrp.name)-LENGTH(ref_zbx_group.prefix)-1), \'Device site region\' FROM tmp_zbx_omni_hosts INNER JOIN tmp_zbx_omni_hosts_groups ON tmp_zbx_omni_hosts.hostid=tmp_zbx_omni_hosts_groups.hostid INNER JOIN tmp_zbx_omni_hstgrp ON tmp_zbx_omni_hosts_groups.groupid=tmp_zbx_omni_hstgrp.groupid INNER JOIN ref_zbx_group ON tmp_zbx_omni_hstgrp.typeid=ref_zbx_group.groupid INNER JOIN ref_zbx_macro ON ref_zbx_macro.name=\'region\' WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND ref_zbx_group.name=\'region\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 7, 30, 'INSERT IGNORE INTO tmp_zbx_omni_hostmacro (hostid, type, macro, value, description) SELECT tmp_zbx_omni_hosts.hostid, 0, ref_zbx_macro.macro, tmp_zbx_omni_hstgrp.name, \'Name of group for aggregation\' FROM tmp_zbx_omni_hosts INNER JOIN tmp_zbx_omni_hstgrp ON tmp_zbx_omni_hosts.zbx_groupid=tmp_zbx_omni_hstgrp.groupid INNER JOIN ref_zbx_macro ON ref_zbx_macro.name=\'groupname\' WHERE tmp_zbx_omni_hosts.zbx_groupid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 7, 31, 'INSERT IGNORE INTO tmp_zbx_omni_hostmacro (hostid, type, macro, value, description) SELECT tmp_zbx_omni_hosts.hostid, 0, ref_zbx_macro.macro, RIGHT(tmp_zbx_omni_hstgrp.name, LENGTH(tmp_zbx_omni_hstgrp.name)-LENGTH(ref_zbx_group.prefix)-1), \'Site of group host\' FROM tmp_zbx_omni_hosts INNER JOIN tmp_zbx_omni_hstgrp ON tmp_zbx_omni_hosts.zbx_groupid=tmp_zbx_omni_hstgrp.groupid INNER JOIN ref_zbx_group ON tmp_zbx_omni_hstgrp.typeid=ref_zbx_group.groupid INNER JOIN ref_zbx_macro ON ref_zbx_macro.name=\'site\' WHERE tmp_zbx_omni_hosts.zbx_groupid IS NOT NULL AND ref_zbx_group.name=\'site\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 7, 32, 'INSERT IGNORE INTO tmp_zbx_omni_hostmacro (hostid, type, macro, value, description) SELECT tmp_zbx_omni_hosts.hostid, 0, ref_zbx_macro.macro, RIGHT(tmp_zbx_omni_hstgrp.name, LENGTH(tmp_zbx_omni_hstgrp.name)-LENGTH(ref_zbx_group.prefix)-1), \'Region of group host\' FROM tmp_zbx_omni_hosts INNER JOIN tmp_zbx_omni_hstgrp ON tmp_zbx_omni_hosts.zbx_groupid=tmp_zbx_omni_hstgrp.groupid INNER JOIN ref_zbx_group ON tmp_zbx_omni_hstgrp.typeid=ref_zbx_group.groupid INNER JOIN ref_zbx_macro ON ref_zbx_macro.name=\'region\' WHERE tmp_zbx_omni_hosts.zbx_groupid IS NOT NULL AND ref_zbx_group.name=\'region\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 8, 10, 'INSERT IGNORE INTO tmp_zbx_omni_host_inventory (hostid, inventory_mode, hardware_full, software_full, contact, location, notes, host_networks, site_notes, poc_1_notes, poc_2_notes) SELECT hostid, 0, \'\', \'\', \'\', \'\', \'\', \'\', \'\', \'\', \'\'  FROM tmp_zbx_omni_hosts;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 8, 20, 'UPDATE IGNORE tmp_zbx_omni_host_inventory INNER JOIN tmp_zbx_omni_hosts ON tmp_zbx_omni_host_inventory.hostid=tmp_zbx_omni_hosts.hostid INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid SET tmp_zbx_omni_host_inventory.macaddress_a=main_host.mac WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND main_host.mac IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 8, 21, 'UPDATE IGNORE tmp_zbx_omni_host_inventory INNER JOIN tmp_zbx_omni_hosts ON tmp_zbx_omni_host_inventory.hostid=tmp_zbx_omni_hosts.hostid INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_manufacturer ON main_host.manufacturerid=ref_manufacturer.manufacturerid SET tmp_zbx_omni_host_inventory.vendor=ref_manufacturer.manufacturer WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 8, 22, 'UPDATE IGNORE tmp_zbx_omni_host_inventory INNER JOIN tmp_zbx_omni_hosts ON tmp_zbx_omni_host_inventory.hostid=tmp_zbx_omni_hosts.hostid INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid INNER JOIN ref_site ON main_host.siteid=ref_site.siteid SET tmp_zbx_omni_host_inventory.site_city=ref_site.site WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 8, 23, 'UPDATE IGNORE tmp_zbx_omni_host_inventory INNER JOIN tmp_zbx_omni_hosts ON tmp_zbx_omni_host_inventory.hostid=tmp_zbx_omni_hosts.hostid INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid SET tmp_zbx_omni_host_inventory.name=main_host.name WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND main_host.name IS NOT NULL AND main_host.name<>\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 8, 24, 'UPDATE IGNORE tmp_zbx_omni_host_inventory INNER JOIN tmp_zbx_omni_hosts ON tmp_zbx_omni_host_inventory.hostid=tmp_zbx_omni_hosts.hostid INNER JOIN main_host ON tmp_zbx_omni_hosts.main_hostid=main_host.hostid SET tmp_zbx_omni_host_inventory.name=main_host.hostname WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND main_host.hostname IS NOT NULL AND main_host.hostname<>\'\' AND tmp_zbx_omni_host_inventory.name=\'\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 8, 25, 'UPDATE IGNORE tmp_zbx_omni_host_inventory INNER JOIN tmp_zbx_omni_hosts ON tmp_zbx_omni_host_inventory.hostid=tmp_zbx_omni_hosts.hostid INNER JOIN ref_zbx_macro ON ref_zbx_macro.name=\'region\' INNER JOIN tmp_zbx_omni_hostmacro ON tmp_zbx_omni_hosts.hostid=tmp_zbx_omni_hostmacro.hostid AND ref_zbx_macro.macro=tmp_zbx_omni_hostmacro.macro SET tmp_zbx_omni_host_inventory.site_country=tmp_zbx_omni_hostmacro.value WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 8, 26, 'UPDATE IGNORE tmp_zbx_omni_host_inventory INNER JOIN tmp_zbx_omni_hosts ON tmp_zbx_omni_host_inventory.hostid=tmp_zbx_omni_hosts.hostid INNER JOIN tmp_zbx_omni_hosts_groups ON tmp_zbx_omni_hosts.hostid=tmp_zbx_omni_hosts_groups.hostid INNER JOIN zbx_omni_hstgrp ON tmp_zbx_omni_hosts_groups.groupid=zbx_omni_hstgrp.groupid INNER JOIN ref_zbx_group ON zbx_omni_hstgrp.typeid=ref_zbx_group.groupid SET tmp_zbx_omni_host_inventory.type=RIGHT(ref_zbx_group.name, LENGTH(ref_zbx_group.name)-LENGTH(ref_zbx_group.prefix)-1) WHERE tmp_zbx_omni_hosts.main_hostid IS NOT NULL AND ref_zbx_group.prefix=\'devicetype\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 10, 'DELETE IGNORE zbx_omni_host_inventory FROM zbx_omni_host_inventory INNER JOIN zbx_omni_hosts ON zbx_omni_host_inventory.hostid=zbx_omni_hosts.hostid LEFT JOIN tmp_zbx_omni_hosts ON zbx_omni_hosts.host=tmp_zbx_omni_hosts.host LEFT JOIN tmp_zbx_omni_host_inventory ON tmp_zbx_omni_hosts.hostid=tmp_zbx_omni_host_inventory.hostid WHERE tmp_zbx_omni_host_inventory.hostid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 11, 'DELETE IGNORE zbx_omni_host_tag FROM zbx_omni_host_tag INNER JOIN zbx_omni_hosts ON zbx_omni_host_tag.hostid=zbx_omni_hosts.hostid LEFT JOIN tmp_zbx_omni_hosts ON zbx_omni_hosts.host=tmp_zbx_omni_hosts.host LEFT JOIN tmp_zbx_omni_host_tag ON tmp_zbx_omni_hosts.hostid=tmp_zbx_omni_host_tag.hostid AND zbx_omni_host_tag.tag=tmp_zbx_omni_host_tag.tag WHERE tmp_zbx_omni_host_tag.hosttagid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 12, 'DELETE IGNORE zbx_omni_hostmacro FROM zbx_omni_hostmacro INNER JOIN zbx_omni_hosts ON zbx_omni_hostmacro.hostid=zbx_omni_hosts.hostid LEFT JOIN tmp_zbx_omni_hosts ON zbx_omni_hosts.host=tmp_zbx_omni_hosts.host LEFT JOIN tmp_zbx_omni_hostmacro ON tmp_zbx_omni_hosts.hostid=tmp_zbx_omni_hostmacro.hostid AND zbx_omni_hostmacro.macro=tmp_zbx_omni_hostmacro.macro WHERE tmp_zbx_omni_hostmacro.hostmacroid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 13, 'DELETE IGNORE zbx_omni_interface FROM zbx_omni_interface INNER JOIN zbx_omni_hosts ON zbx_omni_interface.hostid=zbx_omni_hosts.hostid LEFT JOIN tmp_zbx_omni_hosts ON zbx_omni_hosts.host=tmp_zbx_omni_hosts.host LEFT JOIN tmp_zbx_omni_interface ON tmp_zbx_omni_hosts.hostid=tmp_zbx_omni_interface.hostid AND zbx_omni_interface.type=tmp_zbx_omni_interface.type AND zbx_omni_interface.main=tmp_zbx_omni_interface.main WHERE tmp_zbx_omni_interface.interfaceid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 14, 'DELETE IGNORE zbx_omni_hosts_groups FROM zbx_omni_hosts_groups INNER JOIN zbx_omni_hosts ON zbx_omni_hosts_groups.hostid=zbx_omni_hosts.hostid INNER JOIN zbx_omni_hstgrp ON zbx_omni_hosts_groups.groupid=zbx_omni_hstgrp.groupid LEFT JOIN tmp_zbx_omni_hosts ON zbx_omni_hosts.host=tmp_zbx_omni_hosts.host LEFT JOIN tmp_zbx_omni_hstgrp ON zbx_omni_hstgrp.name=tmp_zbx_omni_hstgrp.name LEFT JOIN tmp_zbx_omni_hosts_groups ON tmp_zbx_omni_hosts.hostid=tmp_zbx_omni_hosts_groups.hostid AND tmp_zbx_omni_hstgrp.groupid=tmp_zbx_omni_hosts_groups.groupid WHERE tmp_zbx_omni_hosts_groups.hostgroupid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 15, 'DELETE IGNORE zbx_omni_hosts_templates FROM zbx_omni_hosts_templates INNER JOIN zbx_omni_hosts ON zbx_omni_hosts_templates.hostid=zbx_omni_hosts.hostid LEFT JOIN tmp_zbx_omni_hosts ON zbx_omni_hosts.host=tmp_zbx_omni_hosts.host LEFT JOIN tmp_zbx_omni_hosts_templates ON tmp_zbx_omni_hosts.hostid=tmp_zbx_omni_hosts_templates.hostid AND zbx_omni_hosts_templates.templateid=tmp_zbx_omni_hosts_templates.templateid WHERE tmp_zbx_omni_hosts_templates.hosttemplateid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 17, 'DELETE IGNORE zbx_omni_hosts FROM zbx_omni_hosts WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_omni_hosts WHERE tmp_zbx_omni_hosts.host=zbx_omni_hosts.host);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 18, 'DELETE IGNORE zbx_omni_hstgrp FROM zbx_omni_hstgrp WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_omni_hstgrp WHERE tmp_zbx_omni_hstgrp.name=zbx_omni_hstgrp.name);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 19, 'DELETE IGNORE zbx_omni_maintenances FROM zbx_omni_maintenances WHERE NOT EXISTS (SELECT NULL FROM tmp_zbx_omni_maintenances WHERE tmp_zbx_omni_maintenances.name=zbx_omni_maintenances.name);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 40, 'INSERT IGNORE INTO zbx_omni_maintenances (name, maintenance_type, active_since, active_till) SELECT name, maintenance_type, active_since, active_till FROM tmp_zbx_omni_maintenances WHERE NOT EXISTS (SELECT NULL FROM zbx_omni_maintenances WHERE zbx_omni_maintenances.name=tmp_zbx_omni_maintenances.name);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 41, 'INSERT IGNORE INTO zbx_omni_hstgrp (name, internal, flags, typeid, srcid) SELECT name, internal, flags, typeid, srcid FROM tmp_zbx_omni_hstgrp WHERE NOT EXISTS (SELECT NULL FROM zbx_omni_hstgrp WHERE zbx_omni_hstgrp.name=tmp_zbx_omni_hstgrp.name);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 42, 'INSERT IGNORE INTO zbx_omni_hosts (proxy_hostid, host, status, ipmi_authtype, ipmi_privilege, ipmi_username, ipmi_password, maintenanceid, maintenance_status, maintenance_type, maintenance_from, name, flags, description, tls_connect, tls_accept, tls_issuer, tls_subject, main_hostid, zbx_groupid) SELECT th.proxy_hostid, th.host, th.status, th.ipmi_authtype, th.ipmi_privilege, th.ipmi_username, th.ipmi_password, zbx_omni_maintenances.maintenanceid, th.maintenance_status, th.maintenance_type, th.maintenance_from, th.name, th.flags, th.description, th.tls_connect, th.tls_accept, th.tls_issuer, th.tls_subject, th.main_hostid, zbx_omni_hstgrp.groupid FROM tmp_zbx_omni_hosts AS th LEFT JOIN tmp_zbx_omni_maintenances ON th.maintenanceid=tmp_zbx_omni_maintenances.maintenanceid LEFT JOIN zbx_omni_maintenances ON tmp_zbx_omni_maintenances.name=zbx_omni_maintenances.name LEFT JOIN tmp_zbx_omni_hstgrp ON th.zbx_groupid=tmp_zbx_omni_hstgrp.groupid LEFT JOIN zbx_omni_hstgrp ON tmp_zbx_omni_hstgrp.name=zbx_omni_hstgrp.name WHERE NOT EXISTS (SELECT NULL FROM zbx_omni_hosts WHERE zbx_omni_hosts.host=th.host);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 43, 'INSERT IGNORE INTO zbx_omni_hosts_templates (hostid, templateid) SELECT zbx_omni_hosts.hostid, tmp_zbx_omni_hosts_templates.templateid FROM tmp_zbx_omni_hosts_templates INNER JOIN tmp_zbx_omni_hosts ON tmp_zbx_omni_hosts_templates.hostid=tmp_zbx_omni_hosts.hostid INNER JOIN zbx_omni_hosts ON tmp_zbx_omni_hosts.host=zbx_omni_hosts.host WHERE NOT EXISTS (SELECT NULL FROM zbx_omni_hosts_templates WHERE zbx_omni_hosts_templates.hostid=zbx_omni_hosts.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 44, 'INSERT IGNORE INTO zbx_omni_hosts_groups (hostid, groupid) SELECT zbx_omni_hosts.hostid, zbx_omni_hstgrp.groupid FROM tmp_zbx_omni_hosts_groups INNER JOIN tmp_zbx_omni_hosts ON tmp_zbx_omni_hosts_groups.hostid=tmp_zbx_omni_hosts.hostid INNER JOIN zbx_omni_hosts ON tmp_zbx_omni_hosts.host=zbx_omni_hosts.host INNER JOIN tmp_zbx_omni_hstgrp ON tmp_zbx_omni_hosts_groups.groupid=tmp_zbx_omni_hstgrp.groupid INNER JOIN zbx_omni_hstgrp ON tmp_zbx_omni_hstgrp.name=zbx_omni_hstgrp.name WHERE NOT EXISTS (SELECT NULL FROM zbx_omni_hosts_groups WHERE zbx_omni_hosts_groups.hostid=zbx_omni_hosts.hostid AND zbx_omni_hosts_groups.groupid=zbx_omni_hstgrp.groupid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 45, 'INSERT IGNORE INTO zbx_omni_interface (hostid, main, type, useip, ip, dns, port, available, error, errors_from, disable_until, version, bulk, community, securityname, securitylevel, authpassphrase, privpassphrase, authprotocol, privprotocol, contextname) SELECT zbx_omni_hosts.hostid, ti.main, ti.type, ti.useip, ti.ip, ti.dns, ti.port, ti.available, ti.error, ti.errors_from, ti.disable_until, ti.version, ti.bulk, ti.community, ti.securityname, ti.securitylevel, ti.authpassphrase, ti.privpassphrase, ti.authprotocol, ti.privprotocol, ti.contextname FROM tmp_zbx_omni_interface AS ti INNER JOIN tmp_zbx_omni_hosts ON ti.hostid=tmp_zbx_omni_hosts.hostid INNER JOIN zbx_omni_hosts ON tmp_zbx_omni_hosts.host=zbx_omni_hosts.host WHERE NOT EXISTS (SELECT NULL FROM zbx_omni_interface WHERE zbx_omni_interface.hostid=zbx_omni_hosts.hostid AND zbx_omni_interface.type=ti.type AND zbx_omni_interface.main=ti.main);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 46, 'INSERT IGNORE INTO zbx_omni_hostmacro (hostid, macro, value, description, type) SELECT zbx_omni_hosts.hostid, tmp_zbx_omni_hostmacro.macro, tmp_zbx_omni_hostmacro.value, tmp_zbx_omni_hostmacro.description, tmp_zbx_omni_hostmacro.type FROM tmp_zbx_omni_hostmacro INNER JOIN tmp_zbx_omni_hosts ON tmp_zbx_omni_hostmacro.hostid=tmp_zbx_omni_hosts.hostid INNER JOIN zbx_omni_hosts ON tmp_zbx_omni_hosts.host=zbx_omni_hosts.host WHERE NOT EXISTS (SELECT NULL FROM zbx_omni_hostmacro WHERE zbx_omni_hostmacro.hostid=zbx_omni_hosts.hostid AND zbx_omni_hostmacro.macro=tmp_zbx_omni_hostmacro.macro);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 47, 'INSERT IGNORE INTO zbx_omni_host_tag (hostid, tag, value) SELECT zbx_omni_hosts.hostid, tmp_zbx_omni_host_tag.tag, tmp_zbx_omni_host_tag.value FROM tmp_zbx_omni_host_tag INNER JOIN tmp_zbx_omni_hosts ON tmp_zbx_omni_host_tag.hostid=tmp_zbx_omni_hosts.hostid INNER JOIN zbx_omni_hosts ON tmp_zbx_omni_hosts.host=zbx_omni_hosts.host WHERE NOT EXISTS (SELECT NULL FROM zbx_omni_host_tag WHERE zbx_omni_host_tag.hostid=zbx_omni_hosts.hostid AND zbx_omni_host_tag.tag=tmp_zbx_omni_host_tag.tag);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 48, 'INSERT IGNORE INTO zbx_omni_host_inventory (hostid, inventory_mode, type, type_full, name, alias, os, os_full, os_short, serialno_a, serialno_b, tag, asset_tag, macaddress_a, macaddress_b, hardware, hardware_full, software, software_full, software_app_a, software_app_b, software_app_c, software_app_d, software_app_e, contact, location, location_lat, location_lon, notes, chassis, model, hw_arch, vendor, contract_number, installer_name, deployment_status, url_a, url_b, url_c, host_networks, host_netmask, host_router, oob_ip, oob_netmask, oob_router, date_hw_purchase, date_hw_install, date_hw_expiry, date_hw_decomm, site_address_a, site_address_b, site_address_c, site_city, site_state, site_country, site_zip, site_rack, site_notes, poc_1_name, poc_1_email, poc_1_phone_a, poc_1_phone_b, poc_1_cell, poc_1_screen, poc_1_notes, poc_2_name, poc_2_email, poc_2_phone_a, poc_2_phone_b, poc_2_cell, poc_2_screen, poc_2_notes) SELECT zbx_omni_hosts.hostid, ti.inventory_mode, ti.type, ti.type_full, ti.name, ti.alias, ti.os, ti.os_full, ti.os_short, ti.serialno_a, ti.serialno_b, ti.tag, ti.asset_tag, ti.macaddress_a, ti.macaddress_b, ti.hardware, ti.hardware_full, ti.software, ti.software_full, ti.software_app_a, ti.software_app_b, ti.software_app_c, ti.software_app_d, ti.software_app_e, ti.contact, ti.location, ti.location_lat, ti.location_lon, ti.notes, ti.chassis, ti.model, ti.hw_arch, ti.vendor, ti.contract_number, ti.installer_name, ti.deployment_status, ti.url_a, ti.url_b, ti.url_c, ti.host_networks, ti.host_netmask, ti.host_router, ti.oob_ip, ti.oob_netmask, ti.oob_router, ti.date_hw_purchase, ti.date_hw_install, ti.date_hw_expiry, ti.date_hw_decomm, ti.site_address_a, ti.site_address_b, ti.site_address_c, ti.site_city, ti.site_state, ti.site_country, ti.site_zip, ti.site_rack, ti.site_notes, ti.poc_1_name, ti.poc_1_email, ti.poc_1_phone_a, ti.poc_1_phone_b, ti.poc_1_cell, ti.poc_1_screen, ti.poc_1_notes, ti.poc_2_name, ti.poc_2_email, ti.poc_2_phone_a, ti.poc_2_phone_b, ti.poc_2_cell, ti.poc_2_screen, ti.poc_2_notes FROM tmp_zbx_omni_host_inventory AS ti INNER JOIN tmp_zbx_omni_hosts ON ti.hostid=tmp_zbx_omni_hosts.hostid INNER JOIN zbx_omni_hosts ON tmp_zbx_omni_hosts.host=zbx_omni_hosts.host WHERE NOT EXISTS (SELECT NULL FROM zbx_omni_host_inventory WHERE zbx_omni_host_inventory.hostid=ti.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 70, 'UPDATE IGNORE zbx_omni_maintenances INNER JOIN tmp_zbx_omni_maintenances ON zbx_omni_maintenances.name=tmp_zbx_omni_maintenances.name SET zbx_omni_maintenances.maintenance_type=tmp_zbx_omni_maintenances.maintenance_type, zbx_omni_maintenances.active_since=tmp_zbx_omni_maintenances.active_since, zbx_omni_maintenances.active_till=tmp_zbx_omni_maintenances.active_till;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 71, 'UPDATE IGNORE zbx_omni_hstgrp INNER JOIN tmp_zbx_omni_hstgrp ON zbx_omni_hstgrp.name=tmp_zbx_omni_hstgrp.name SET zbx_omni_hstgrp.internal=tmp_zbx_omni_hstgrp.internal, zbx_omni_hstgrp.flags=tmp_zbx_omni_hstgrp.flags, zbx_omni_hstgrp.typeid=tmp_zbx_omni_hstgrp.typeid, zbx_omni_hstgrp.srcid=tmp_zbx_omni_hstgrp.srcid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 72, 'UPDATE IGNORE zbx_omni_hosts INNER JOIN tmp_zbx_omni_hosts ON zbx_omni_hosts.host=tmp_zbx_omni_hosts.host INNER JOIN tmp_zbx_omni_hstgrp ON tmp_zbx_omni_hosts.zbx_groupid=tmp_zbx_omni_hstgrp.groupid INNER JOIN zbx_omni_hstgrp ON tmp_zbx_omni_hstgrp.name=zbx_omni_hstgrp.name LEFT JOIN tmp_zbx_omni_maintenances ON tmp_zbx_omni_hosts.maintenanceid=tmp_zbx_omni_maintenances.maintenanceid LEFT JOIN zbx_omni_maintenances ON tmp_zbx_omni_maintenances.name=zbx_omni_maintenances.name SET zbx_omni_hosts.proxy_hostid=tmp_zbx_omni_hosts.proxy_hostid, zbx_omni_hosts.status=tmp_zbx_omni_hosts.status, zbx_omni_hosts.ipmi_authtype=tmp_zbx_omni_hosts.ipmi_authtype, zbx_omni_hosts.ipmi_privilege=tmp_zbx_omni_hosts.ipmi_privilege, zbx_omni_hosts.ipmi_username=tmp_zbx_omni_hosts.ipmi_username, zbx_omni_hosts.ipmi_password=tmp_zbx_omni_hosts.ipmi_password, zbx_omni_hosts.maintenanceid=zbx_omni_maintenances.maintenanceid, zbx_omni_hosts.maintenance_status=tmp_zbx_omni_hosts.maintenance_status, zbx_omni_hosts.maintenance_type=tmp_zbx_omni_hosts.maintenance_type, zbx_omni_hosts.maintenance_from=tmp_zbx_omni_hosts.maintenance_from, zbx_omni_hosts.name=tmp_zbx_omni_hosts.name, zbx_omni_hosts.flags=tmp_zbx_omni_hosts.flags, zbx_omni_hosts.description=tmp_zbx_omni_hosts.description, zbx_omni_hosts.tls_connect=tmp_zbx_omni_hosts.tls_connect, zbx_omni_hosts.tls_accept=tmp_zbx_omni_hosts.tls_accept, zbx_omni_hosts.tls_issuer=tmp_zbx_omni_hosts.tls_issuer, zbx_omni_hosts.tls_subject=tmp_zbx_omni_hosts.tls_subject, zbx_omni_hosts.main_hostid=tmp_zbx_omni_hosts.main_hostid, zbx_omni_hosts.zbx_groupid=zbx_omni_hstgrp.groupid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 73, 'UPDATE IGNORE zbx_omni_hosts_templates INNER JOIN zbx_omni_hosts ON zbx_omni_hosts_templates.hostid=zbx_omni_hosts.hostid INNER JOIN tmp_zbx_omni_hosts ON zbx_omni_hosts.host=tmp_zbx_omni_hosts.host INNER JOIN tmp_zbx_omni_hosts_templates ON tmp_zbx_omni_hosts.hostid=tmp_zbx_omni_hosts_templates.hostid SET zbx_omni_hosts_templates.templateid=tmp_zbx_omni_hosts_templates.templateid;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 74, 'UPDATE IGNORE zbx_omni_interface AS i INNER JOIN zbx_omni_hosts ON i.hostid=zbx_omni_hosts.hostid INNER JOIN tmp_zbx_omni_hosts ON zbx_omni_hosts.host=tmp_zbx_omni_hosts.host INNER JOIN tmp_zbx_omni_interface AS ti ON tmp_zbx_omni_hosts.hostid=ti.hostid AND i.type=ti.type AND i.main=ti.main SET i.useip=ti.useip, i.ip=ti.ip, i.dns=ti.dns, i.port=ti.port, i.available=ti.available, i.error=ti.error, i.errors_from=ti.errors_from, i.disable_until=ti.disable_until, i.version=ti.version, i.bulk=ti.bulk, i.community=ti.community, i.securityname=ti.securityname, i.securitylevel=ti.securitylevel, i.authpassphrase=ti.authpassphrase, i.privpassphrase=ti.privpassphrase, i.authprotocol=ti.authprotocol, i.privprotocol=ti.privprotocol, i.contextname=ti.contextname;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 75, 'UPDATE IGNORE zbx_omni_hostmacro INNER JOIN zbx_omni_hosts ON zbx_omni_hostmacro.hostid=zbx_omni_hosts.hostid INNER JOIN tmp_zbx_omni_hosts ON zbx_omni_hosts.host=tmp_zbx_omni_hosts.host INNER JOIN tmp_zbx_omni_hostmacro ON tmp_zbx_omni_hosts.hostid=tmp_zbx_omni_hostmacro.hostid AND zbx_omni_hostmacro.macro=tmp_zbx_omni_hostmacro.macro SET zbx_omni_hostmacro.value=tmp_zbx_omni_hostmacro.value, zbx_omni_hostmacro.description=tmp_zbx_omni_hostmacro.description, zbx_omni_hostmacro.type=tmp_zbx_omni_hostmacro.type;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 76, 'UPDATE IGNORE zbx_omni_host_tag INNER JOIN zbx_omni_hosts ON zbx_omni_host_tag.hostid=zbx_omni_hosts.hostid INNER JOIN tmp_zbx_omni_hosts ON zbx_omni_hosts.host=tmp_zbx_omni_hosts.host INNER JOIN tmp_zbx_omni_host_tag ON tmp_zbx_omni_hosts.hostid=tmp_zbx_omni_host_tag.hostid AND zbx_omni_host_tag.tag=tmp_zbx_omni_host_tag.tag SET zbx_omni_host_tag.value=tmp_zbx_omni_host_tag.value;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 9, 77, 'UPDATE IGNORE zbx_omni_host_inventory AS i INNER JOIN zbx_omni_hosts ON i.hostid=zbx_omni_hosts.hostid INNER JOIN tmp_zbx_omni_hosts ON zbx_omni_hosts.host=tmp_zbx_omni_hosts.host INNER JOIN tmp_zbx_omni_host_inventory AS ti ON tmp_zbx_omni_hosts.hostid=ti.hostid SET i.inventory_mode=ti.inventory_mode, i.type=ti.type, i.type_full=ti.type_full, i.name=ti.name, i.alias=ti.alias, i.os=ti.os, i.os_full=ti.os_full, i.os_short=ti.os_short, i.serialno_a=ti.serialno_a, i.serialno_b=ti.serialno_b, i.tag=ti.tag, i.asset_tag=ti.asset_tag, i.macaddress_a=ti.macaddress_a, i.macaddress_b=ti.macaddress_b, i.hardware=ti.hardware, i.hardware_full=ti.hardware_full, i.software=ti.software, i.software_full=ti.software_full, i.software_app_a=ti.software_app_a, i.software_app_b=ti.software_app_b, i.software_app_c=ti.software_app_c, i.software_app_d=ti.software_app_d, i.software_app_e=ti.software_app_e, i.contact=ti.contact, i.location=ti.location, i.location_lat=ti.location_lat, i.location_lon=ti.location_lon, i.notes=ti.notes, i.chassis=ti.chassis, i.model=ti.model, i.hw_arch=ti.hw_arch, i.vendor=ti.vendor, i.contract_number=ti.contract_number, i.installer_name=ti.installer_name, i.deployment_status=ti.deployment_status, i.url_a=ti.url_a, i.url_b=ti.url_b, i.url_c=ti.url_c, i.host_networks=ti.host_networks, i.host_netmask=ti.host_netmask, i.host_router=ti.host_router, i.oob_ip=ti.oob_ip, i.oob_netmask=ti.oob_netmask, i.oob_router=ti.oob_router, i.date_hw_purchase=ti.date_hw_purchase, i.date_hw_install=ti.date_hw_install, i.date_hw_expiry=ti.date_hw_expiry, i.date_hw_decomm=ti.date_hw_decomm, i.site_address_a=ti.site_address_a, i.site_address_b=ti.site_address_b, i.site_address_c=ti.site_address_c, i.site_city=ti.site_city, i.site_state=ti.site_state, i.site_country=ti.site_country, i.site_zip=ti.site_zip, i.site_rack=ti.site_rack, i.site_notes=ti.site_notes, i.poc_1_name=ti.poc_1_name, i.poc_1_email=ti.poc_1_email, i.poc_1_phone_a=ti.poc_1_phone_a, i.poc_1_phone_b=ti.poc_1_phone_b, i.poc_1_cell=ti.poc_1_cell, i.poc_1_screen=ti.poc_1_screen, i.poc_1_notes=ti.poc_1_notes, i.poc_2_name=ti.poc_2_name, i.poc_2_email=ti.poc_2_email, i.poc_2_phone_a=ti.poc_2_phone_a, i.poc_2_phone_b=ti.poc_2_phone_b, i.poc_2_cell=ti.poc_2_cell, i.poc_2_screen=ti.poc_2_screen, i.poc_2_notes=ti.poc_2_notes;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 10, 'DELETE IGNORE zbx_omni_hosts FROM zbx_omni_hosts WHERE main_hostid IS NULL AND zbx_groupid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 20, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid LEFT JOIN zbx_omni_maintenances ON zbx_omni_map.omniid=zbx_omni_maintenances.maintenanceid SET zbx_omni_map.omniid=NULL WHERE zbx_omni_maintenances.maintenanceid IS NULL AND ref_zbx_omni_map.zbx_table=\'zbx_zbx_maintenances\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 21, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid LEFT JOIN zbx_omni_hstgrp ON zbx_omni_map.omniid=zbx_omni_hstgrp.groupid SET zbx_omni_map.omniid=NULL WHERE zbx_omni_hstgrp.groupid IS NULL AND ref_zbx_omni_map.zbx_table=\'zbx_zbx_hstgrp\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 22, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid LEFT JOIN zbx_omni_hosts ON zbx_omni_map.omniid=zbx_omni_hosts.hostid SET zbx_omni_map.omniid=NULL WHERE zbx_omni_hosts.hostid IS NULL AND ref_zbx_omni_map.zbx_table=\'zbx_zbx_hosts\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 23, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid LEFT JOIN zbx_omni_interface ON zbx_omni_map.omniid=zbx_omni_interface.interfaceid SET zbx_omni_map.omniid=NULL WHERE zbx_omni_interface.interfaceid IS NULL AND ref_zbx_omni_map.zbx_table=\'zbx_zbx_interface\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 24, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid LEFT JOIN zbx_omni_hostmacro ON zbx_omni_map.omniid=zbx_omni_hostmacro.hostmacroid SET zbx_omni_map.omniid=NULL WHERE zbx_omni_hostmacro.hostmacroid IS NULL AND ref_zbx_omni_map.zbx_table=\'zbx_zbx_hostmacro\';', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 29, 'DELETE IGNORE zbx_omni_map FROM zbx_omni_map WHERE omniid IS NULL AND zbxid is NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 30, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_zbx_maintenances ON zbx_omni_map.zbxid=zbx_zbx_maintenances.maintenanceid INNER JOIN zbx_omni_maintenances ON zbx_zbx_maintenances.name=zbx_omni_maintenances.name SET zbx_omni_map.omniid=zbx_omni_maintenances.maintenanceid WHERE ref_zbx_omni_map.zbx_table=\'zbx_zbx_maintenances\' AND zbx_omni_map.omniid IS NULL AND zbx_omni_map.zbxid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.omniid=zbx_omni_maintenances.maintenanceid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 31, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_zbx_hstgrp ON zbx_omni_map.zbxid=zbx_zbx_hstgrp.groupid INNER JOIN zbx_omni_hstgrp ON zbx_zbx_hstgrp.name=zbx_omni_hstgrp.name SET zbx_omni_map.omniid=zbx_omni_hstgrp.groupid WHERE ref_zbx_omni_map.zbx_table=\'zbx_zbx_hstgrp\' AND zbx_omni_map.omniid IS NULL AND zbx_omni_map.zbxid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.omniid=zbx_omni_hstgrp.groupid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 32, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_zbx_hosts ON zbx_omni_map.zbxid=zbx_zbx_hosts.hostid INNER JOIN zbx_omni_hosts ON zbx_zbx_hosts.host=zbx_omni_hosts.host SET zbx_omni_map.omniid=zbx_omni_hosts.hostid WHERE ref_zbx_omni_map.zbx_table=\'zbx_zbx_hosts\' AND zbx_omni_map.omniid IS NULL AND zbx_omni_map.zbxid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.omniid=zbx_omni_hosts.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 33, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_zbx_interface ON zbx_omni_map.zbxid=zbx_zbx_interface.interfaceid INNER JOIN zbx_zbx_hosts ON zbx_zbx_interface.hostid=zbx_zbx_hosts.hostid INNER JOIN zbx_omni_hosts ON zbx_zbx_hosts.host=zbx_omni_hosts.host INNER JOIN zbx_omni_interface ON zbx_omni_hosts.hostid=zbx_omni_interface.hostid AND zbx_zbx_interface.type=zbx_omni_interface.type AND zbx_zbx_interface.main=zbx_omni_interface.main SET zbx_omni_map.omniid=zbx_omni_interface.interfaceid WHERE ref_zbx_omni_map.zbx_table=\'zbx_zbx_interface\' AND zbx_omni_map.omniid IS NULL AND zbx_omni_map.zbxid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.omniid=zbx_omni_interface.interfaceid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 34, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_zbx_hostmacro ON zbx_omni_map.zbxid=zbx_zbx_hostmacro.hostmacroid INNER JOIN zbx_zbx_hosts ON zbx_zbx_hostmacro.hostid=zbx_zbx_hosts.hostid INNER JOIN zbx_omni_hosts ON zbx_zbx_hosts.host=zbx_omni_hosts.host INNER JOIN zbx_omni_hostmacro ON zbx_omni_hosts.hostid=zbx_omni_hostmacro.hostid AND zbx_zbx_hostmacro.macro=zbx_omni_hostmacro.macro SET zbx_omni_map.omniid=zbx_omni_hostmacro.hostmacroid WHERE ref_zbx_omni_map.zbx_table=\'zbx_zbx_hostmacro\' AND zbx_omni_map.omniid IS NULL AND zbx_omni_map.zbxid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.omniid=zbx_omni_hostmacro.hostmacroid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 40, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_omni_maintenances ON zbx_omni_map.omniid=zbx_omni_maintenances.maintenanceid INNER JOIN zbx_zbx_maintenances ON zbx_omni_maintenances.name=zbx_zbx_maintenances.name SET zbx_omni_map.zbxid=zbx_zbx_maintenances.maintenanceid WHERE ref_zbx_omni_map.omni_table=\'zbx_omni_maintenances\' AND zbx_omni_map.zbxid IS NULL AND zbx_omni_map.omniid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.zbxid=zbx_zbx_maintenances.maintenanceid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 41, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_omni_hstgrp ON zbx_omni_map.omniid=zbx_omni_hstgrp.groupid INNER JOIN zbx_zbx_hstgrp ON zbx_omni_hstgrp.name=zbx_zbx_hstgrp.name SET zbx_omni_map.zbxid=zbx_zbx_hstgrp.groupid WHERE ref_zbx_omni_map.omni_table=\'zbx_omni_hstgrp\' AND zbx_omni_map.zbxid IS NULL AND zbx_omni_map.omniid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.zbxid=zbx_zbx_hstgrp.groupid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 42, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_omni_hosts ON zbx_omni_map.omniid=zbx_omni_hosts.hostid INNER JOIN zbx_zbx_hosts ON zbx_omni_hosts.host=zbx_zbx_hosts.host SET zbx_omni_map.zbxid=zbx_zbx_hosts.hostid WHERE ref_zbx_omni_map.omni_table=\'zbx_omni_hosts\' AND zbx_omni_map.zbxid IS NULL AND zbx_omni_map.omniid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.zbxid=zbx_zbx_hosts.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 43, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_omni_interface ON zbx_omni_map.omniid=zbx_omni_interface.interfaceid INNER JOIN zbx_omni_hosts ON zbx_omni_interface.hostid=zbx_omni_hosts.hostid INNER JOIN zbx_zbx_hosts ON zbx_omni_hosts.host=zbx_zbx_hosts.host INNER JOIN zbx_zbx_interface ON zbx_zbx_hosts.hostid=zbx_zbx_interface.hostid AND zbx_omni_interface.type=zbx_zbx_interface.type AND zbx_omni_interface.main=zbx_zbx_interface.main SET zbx_omni_map.zbxid=zbx_zbx_interface.interfaceid WHERE ref_zbx_omni_map.omni_table=\'zbx_omni_interface\' AND zbx_omni_map.zbxid IS NULL AND zbx_omni_map.omniid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.zbxid=zbx_zbx_interface.interfaceid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 44, 'UPDATE IGNORE zbx_omni_map INNER JOIN ref_zbx_omni_map ON zbx_omni_map.typeid=ref_zbx_omni_map.mapid INNER JOIN zbx_omni_hostmacro ON zbx_omni_map.omniid=zbx_omni_hostmacro.hostmacroid INNER JOIN zbx_omni_hosts ON zbx_omni_hostmacro.hostid=zbx_omni_hosts.hostid INNER JOIN zbx_zbx_hosts ON zbx_omni_hosts.host=zbx_zbx_hosts.host INNER JOIN zbx_zbx_hostmacro ON zbx_zbx_hosts.hostid=zbx_zbx_hostmacro.hostid AND zbx_omni_hostmacro.macro=zbx_zbx_hostmacro.macro SET zbx_omni_map.zbxid=zbx_zbx_hostmacro.hostmacroid WHERE ref_zbx_omni_map.omni_table=\'zbx_omni_hostmacro\' AND zbx_omni_map.zbxid IS NULL AND zbx_omni_map.omniid IS NOT NULL AND NOT EXISTS (SELECT NULL FROM zbx_omni_map AS zop WHERE zop.typeid=zbx_omni_map.typeid AND zop.zbxid=zbx_zbx_hostmacro.hostmacroid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 50, 'INSERT IGNORE INTO zbx_omni_map (typeid, omniid, zbxid) SELECT ref_zbx_omni_map.mapid, zbx_omni_maintenances.maintenanceid, NULL FROM zbx_omni_maintenances INNER JOIN ref_zbx_omni_map ON ref_zbx_omni_map.omni_table=\'zbx_omni_maintenances\' WHERE NOT EXISTs (SELECT NULL FROM zbx_omni_map WHERE zbx_omni_map.typeid=ref_zbx_omni_map.mapid AND zbx_omni_map.omniid=zbx_omni_maintenances.maintenanceid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 51, 'INSERT IGNORE INTO zbx_omni_map (typeid, omniid, zbxid) SELECT ref_zbx_omni_map.mapid, zbx_omni_hstgrp.groupid, NULL FROM zbx_omni_hstgrp INNER JOIN ref_zbx_omni_map ON ref_zbx_omni_map.omni_table=\'zbx_omni_hstgrp\' WHERE NOT EXISTS (SELECT NULL FROM zbx_omni_map WHERE zbx_omni_map.typeid=ref_zbx_omni_map.mapid AND zbx_omni_map.omniid=zbx_omni_hstgrp.groupid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 52, 'INSERT IGNORE INTO zbx_omni_map (typeid, omniid, zbxid) SELECT ref_zbx_omni_map.mapid, zbx_omni_hosts.hostid, NULL FROM zbx_omni_hosts INNER JOIN ref_zbx_omni_map ON ref_zbx_omni_map.omni_table=\'zbx_omni_hosts\' WHERE NOT EXISTS (SELECT NULL FROM zbx_omni_map WHERE zbx_omni_map.typeid=ref_zbx_omni_map.mapid AND zbx_omni_map.omniid=zbx_omni_hosts.hostid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 53, 'INSERT IGNORE INTO zbx_omni_map (typeid, omniid, zbxid) SELECT ref_zbx_omni_map.mapid, zbx_omni_interface.interfaceid, NULL FROM zbx_omni_interface INNER JOIN ref_zbx_omni_map ON ref_zbx_omni_map.omni_table=\'zbx_omni_interface\' WHERE NOT EXISTS (SELECT NULL FROM zbx_omni_map WHERE zbx_omni_map.typeid=ref_zbx_omni_map.mapid AND zbx_omni_map.omniid=zbx_omni_interface.interfaceid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 54, 'INSERT IGNORE INTO zbx_omni_map (typeid, omniid, zbxid) SELECT ref_zbx_omni_map.mapid, zbx_omni_hostmacro.hostmacroid, NULL FROM zbx_omni_hostmacro INNER JOIN ref_zbx_omni_map ON ref_zbx_omni_map.omni_table=\'zbx_omni_hostmacro\' WHERE NOT EXISTS (SELECT NULL FROM zbx_omni_map WHERE zbx_omni_map.typeid=ref_zbx_omni_map.mapid AND zbx_omni_map.omniid=zbx_omni_hostmacro.hostmacroid);', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1203, 10, 99, 'DELETE IGNORE zbx_omni_hosts FROM zbx_omni_hosts WHERE main_hostid IS NULL AND zbx_groupid IS NULL;', 1);

INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1202, 1, 10, 'DELETE FROM zbx_omni_hosts WHERE main_hostid IS NULL AND zbx_groupid IS NULL;', 1);
INSERT INTO code_program_query (programid, stage, priority, query, enabled) VALUES (1202, 2, 10, 'DELETE FROM zbx_omni_hosts WHERE main_hostid IS NULL AND zbx_groupid IS NULL;', 1);
